---
id: context-engineering
sidebar_position: 1
title: Context Engineering é€šä¿—å…¨è§£
last_update:
  author: Aurelius Huang
  created_at: 2025-12-19
  updated_at: 2026-01-05
  version: 1.4
  status: Reviewed
tags:
  - Context Engineering
  - å­¦æœ¯è®ºæ–‡
  - ä¸»æµæ¡†æ¶
---

> [!IMPORTANT]
>
> **Context Engineeringï¼ˆä¸Šä¸‹æ–‡å·¥ç¨‹ï¼‰** æ˜¯æ„å»ºå¯é ã€å¯æ‰©å±• AI Agent ç³»ç»Ÿçš„æ ¸å¿ƒå­¦ç§‘ï¼Œæ˜¯ AI Agent ç³»ç»Ÿä»"ç©å…·"è¿ˆå‘"ç”Ÿäº§"çš„å…³é”®æŠ€æœ¯ã€‚
>
> å®ƒä»ä¼ ç»Ÿçš„"å†™ Prompt"æ¼”è¿›ä¸º**ç³»ç»Ÿæ€§åœ°è®¾è®¡å’Œä¼˜åŒ– AI ç³»ç»Ÿè¿è¡Œæ—¶æ‰€éœ€çš„æ•´ä¸ªåŠ¨æ€ä¿¡æ¯ç”Ÿæ€ç³»ç»Ÿ**â€”â€”æ¶µç›–ä¸Šä¸‹æ–‡ï¼ˆ**Context**ï¼‰çš„æ”¶é›†ï¼ˆ**Collection**ï¼‰ã€ç®¡ç†ï¼ˆ**Management**ï¼‰å’Œä½¿ç”¨ï¼ˆ**Usage**ï¼‰ã€‚æ˜¯ä¸€ä¸ªæ¶‰åŠè®°å¿†ç³»ç»Ÿï¼ˆ**Memory**ï¼‰ã€ä¼šè¯ç®¡ç†ï¼ˆ**Session**ï¼‰ã€çŠ¶æ€æŒä¹…åŒ–ï¼ˆ**Persistence**ï¼‰ã€çŸ¥è¯†æ£€ç´¢ï¼ˆ**RAG**ï¼‰ç­‰æ¨¡å—çš„å®Œæ•´æ¶æ„é—®é¢˜ã€‚

> [!NOTE]
>
> æœ¬æŠ¥å‘Šæ ¸å¿ƒå†…å®¹ï¼š
>
> - **ç†è®ºæ¡†æ¶**ï¼šä» Dey (2001) çš„å®šä¹‰åˆ° SII-GAIR (2025) çš„å½¢å¼åŒ–æ¼”è¿›
> - **ä¸‰å¤§æ”¯æŸ±**ï¼šContext çš„ Collectionã€Managementã€Usage å®Œæ•´æŠ€æœ¯æ ˆ
> - **æ¡†æ¶æ¨ªæ¯”**ï¼šGoogle ADKã€Agnoã€LangGraph çš„å®ç°ç­–ç•¥
> - **é¡¹ç›®å®è·µ**ï¼šå¤åˆ» Vertex AI Agent Engine çš„ `SessionService` å’Œ `MemoryService`ï¼Œæ„å»º Context Assembler ç»„ä»¶ï¼Œé›†æˆè‡³ Google ADK æ¡†æ¶
>
> **æœ¬è°ƒç ”åŸºäº**ï¼š
>
> - **å­¦æœ¯è®ºæ–‡**ï¼š
>   - ã€ŠContext Engineering 2.0: The Context of Context Engineeringã€‹<sup>[[1]](#ref1)</sup>
>   - ã€ŠUnderstanding and Using Contextã€‹<sup>[[2]](#ref2)</sup>
> - **ä¸»æµæ¡†æ¶**ï¼š
>   - Google ADK<sup>[[4]](#ref4)</sup><sup>[[5]](#ref5)</sup>
>   - Agno<sup>[[6]](#ref6)</sup><sup>[[7]](#ref7)</sup>
>   - LangChain<sup>[[8]](#ref8)</sup>
>   - LangGraph<sup>[[9]](#ref9)</sup>

---

## 1. Context Engineering çš„å­¦æœ¯å®šä¹‰

### 1.1 å†å²æº¯æº

Context Engineering å¹¶é Agent æ—¶ä»£çš„æ–°å‘æ˜ã€‚æ ¹æ® Dey (2001) çš„å¼€åˆ›æ€§å·¥ä½œ<sup>[[2]](#ref2)</sup>ï¼Œæ—©åœ¨ 2000 å¹´ä»£åˆæœŸï¼Œç ”ç©¶è€…å°±å·²ç»åœ¨æ¢ç´¢"ä¸Šä¸‹æ–‡æ„ŸçŸ¥è®¡ç®—"ï¼ˆContext-Aware Computingï¼‰ã€‚

> [!NOTE]
>
> **Context-Aware Computing**
>
> "Context is a poorly used source of information in our computing environments. As a result, we have an impoverished understanding of what context is and how it can be used." â€” Dey<sup>[[2]](#ref2)</sup>
>
> ---
>
> åœ¨æˆ‘ä»¬çš„è®¡ç®—ç¯å¢ƒä¸­ï¼Œä¸Šä¸‹æ–‡è¿™ä¸€ä¿¡æ¯æ¥æºè¢«ä½¿ç”¨å¾—ä¸å¤Ÿå……åˆ†ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯¹äºâ€œä¸Šä¸‹æ–‡â€ç©¶ç«Ÿæ˜¯ä»€ä¹ˆä»¥åŠå¦‚ä½•è¿ç”¨å®ƒï¼Œéƒ½ç¼ºä¹æ·±å…¥çš„ç†è§£ã€‚

> [!NOTE]
>
> **Dey çš„å®šä¹‰ (2001)**
>
> **Context** is any information that can be used to characterize the situation of an entity. An entity is a person, place, or object that is considered relevant to the interaction between a user and an application, including the user and applications themselves.
>
> ---
>
> ä¸Šä¸‹æ–‡æ˜¯ä»»ä½•å¯ä»¥ç”¨æ¥æè¿°å®ä½“æƒ…å†µçš„ä¿¡æ¯ã€‚å®ä½“å¯ä»¥æ˜¯äººã€åœ°ç‚¹æˆ–å¯¹è±¡ï¼Œè¿™äº›å®ä½“è¢«è®¤ä¸ºä¸ç”¨æˆ·å’Œåº”ç”¨ç¨‹åºé—´çš„äº¤äº’æ˜¯ç›¸å…³çš„ï¼ŒåŒ…æ‹¬ç”¨æˆ·å’Œåº”ç”¨ç¨‹åºæœ¬èº«ã€‚

### 1.2 æ ¸å¿ƒå®šä¹‰

SII-GAIR è®ºæ–‡ã€ŠContext Engineering 2.0: The Context of Context Engineeringã€‹<sup>[[1]](#ref1)</sup> å¯¹ Context Engineering ç»™å®šäº†ä¸¥è°¨çš„å½¢å¼åŒ–å®šä¹‰ï¼š

> [!NOTE]
>
> **Context**
>
> å¯¹äºç»™å®šçš„ç”¨æˆ· - åº”ç”¨çš„äº¤äº’ï¼Œä¸Šä¸‹æ–‡ $C$ çš„å®šä¹‰ä¸ºï¼š
>
> $$
>   C = \bigcup_{e \in E_{rel}} Char(e)
> $$
>
> **å…¶ä¸­**ï¼š
>
> - $E$ â€”â€” **å…¨éƒ¨å®ä½“çš„é›†åˆ**ï¼ˆç±»æ¯”ï¼šå›¾ä¹¦é¦†é‡Œçš„æ‰€æœ‰ä¹¦ç±ï¼‰
> - $E_{rel} \subseteq E$ â€”â€” **ä¸å½“å‰äº¤äº’ç›¸å…³çš„å®ä½“å­é›†**ï¼ˆç±»æ¯”ï¼šä¸å½“å‰é—®é¢˜ç›¸å…³çš„ä¹¦ç±ï¼‰
> - $Char(e)$ â€”â€” **æè¿°å®ä½“ $e$ çš„ä¿¡æ¯é›†åˆ**ï¼ˆç±»æ¯”ï¼šæ¯æœ¬ä¹¦çš„å†…å®¹æ‘˜è¦ã€æ ‡ç­¾ã€ä½œè€…ç­‰å…ƒä¿¡æ¯ï¼‰
> - $\bigcup$ â€”â€” **å¹¶é›†æ“ä½œ**ï¼ˆç±»æ¯”ï¼šæŠŠæ‰€æœ‰ç›¸å…³ä¹¦ç±çš„ä¿¡æ¯æ±‡æ€»åœ¨ä¸€èµ·ï¼‰
>
> æƒ³è±¡ä½ æ˜¯ä¸€ä½å›¾ä¹¦é¦†ç®¡ç†å‘˜ï¼Œè¯»è€…é—®ä½ ä¸€ä¸ªé—®é¢˜ã€‚ä½ ä¸ä¼šæŠŠæ•´ä¸ªå›¾ä¹¦é¦†çš„ä¹¦éƒ½æ¬å‡ºæ¥ï¼ˆ$E$ï¼‰ï¼Œè€Œæ˜¯åªæŒ‘é€‰ä¸é—®é¢˜ç›¸å…³çš„ä¹¦ç±ï¼ˆ$E_{rel}$ï¼‰ï¼Œç„¶åä»æ¯æœ¬ä¹¦ä¸­æå–å…³é”®ä¿¡æ¯ï¼ˆ$Char(e)$ï¼‰ï¼Œæœ€åæŠŠè¿™äº›ä¿¡æ¯æ±‡æ€»æˆä¸€ä»½å›ç­”ï¼ˆ$C$ï¼‰ã€‚
>
> **è§£è¯»**ï¼šä¸Šä¸‹æ–‡ $C$ æ˜¯"å¯ç”¨äºæè¿°ä¸ç”¨æˆ·å’Œåº”ç”¨ä¹‹é—´äº¤äº’ç›¸å…³çš„å®ä½“æƒ…å†µçš„ä»»ä½•ä¿¡æ¯"ã€‚è¿™åŒ…æ‹¬ç”¨æˆ·è¾“å…¥ã€åº”ç”¨é…ç½®ã€ç¯å¢ƒçŠ¶æ€ã€å¤–éƒ¨å·¥å…·ã€è®°å¿†æ¨¡å—ç­‰ã€‚

> [!NOTE]
>
> **Context Engineering**
>
> æ‹¥æœ‰äº†ä¸Šä¸‹æ–‡ï¼ˆåŸææ–™ï¼‰è¿˜ä¸å¤Ÿï¼ŒContext Engineering æ˜¯æ ¹æ®å½“å‰ä»»åŠ¡ï¼ˆ$T$ï¼‰ï¼Œå¯¹åŸå§‹ä¸Šä¸‹æ–‡ï¼ˆ$C$ï¼‰è¿›è¡ŒåŠ å·¥çš„ä¸€ç³»åˆ—**å·¥è‰ºæµç¨‹**ï¼ˆ$f_{context}$ï¼šä¼˜åŒ–åçš„ä¸Šä¸‹æ–‡å¤„ç†å‡½æ•°ï¼‰ï¼š
>
> $$
>   CE: (C, T) \rightarrow f_{context}
> $$
>
> **å½¢å¼åŒ–å®šä¹‰**ï¼š
>
> $$
>   f_{context}(C) = F(\phi_1, \phi_2, \ldots, \phi_n)(C)
> $$
>
> å‡½æ•° $F$ ç»„åˆäº†å¤šç§æ“ä½œ $\phi_i$ï¼šæ”¶é›†ã€å­˜å‚¨ã€è¡¨ç¤ºã€å¤šæ¨¡æ€å¤„ç†ã€å¤ç”¨ã€é€‰æ‹©ã€å…±äº«åŠåŠ¨æ€è°ƒæ•´ï¼š
>
> - é€šè¿‡ä¼ æ„Ÿå™¨æˆ–å…¶ä»–æ¸ é“**æ”¶é›†**ç›¸å…³ä¸Šä¸‹æ–‡ä¿¡æ¯
> - é«˜æ•ˆåœ°**å­˜å‚¨å’Œç®¡ç†**ä¸Šä¸‹æ–‡
> - ä»¥ä¸€è‡´ä¸”å¯äº’æ“ä½œçš„æ ¼å¼**è¡¨ç¤º**ä¸Šä¸‹æ–‡
> - å¤„ç†æ¥è‡ªæ–‡æœ¬ã€éŸ³é¢‘ã€è§†è§‰çš„**å¤šæ¨¡æ€**è¾“å…¥
> - **é›†æˆå’Œå¤ç”¨**è¿‡å»çš„ä¸Šä¸‹æ–‡ï¼ˆ"Self-baking"ï¼‰
> - **é€‰æ‹©**æœ€ç›¸å…³çš„ä¸Šä¸‹æ–‡å…ƒç´ 
> - è·¨ Agent æˆ–ç³»ç»Ÿ**å…±äº«**ä¸Šä¸‹æ–‡
> - åŸºäºåé¦ˆæˆ–å­¦ä¹ æ¨¡å¼**åŠ¨æ€è°ƒæ•´**ä¸Šä¸‹æ–‡

### 1.3 å‘å±•é˜¶æ®µ

å¯ä»¥æŠŠ Context Engineering çœ‹ä½œæ˜¯ Agent ä¸äººç±»æ²Ÿé€šçš„è‰ºæœ¯ï¼Œè¿™é—¨è‰ºæœ¯æ­£ç»å†ç€ä»ç¬¨æ‹™çš„æŒ‡ä»¤æ²Ÿé€šåˆ°å¿ƒæœ‰çµçŠ€çš„è¿›åŒ–ã€‚

è®ºæ–‡ [[1]](#ref1) å°† Context Engineering åˆ’åˆ†ä¸ºå››ä¸ªæ—¶ä»£ï¼š

```mermaid
gantt
    title Context Engineering å‘å±•æ—¶ä»£
    dateFormat YYYY
    section Era 1.0
    åŸå§‹è®¡ç®—æ—¶ä»£ (åˆšæ€§/é¢„å®šä¹‰æ ¼å¼) :done, 1990, 2020
    section Era 2.0
    Agent-Centric æ—¶ä»£ (è‡ªç„¶è¯­è¨€/åŠ¨æ€ä¸Šä¸‹æ–‡) :active, 2020, 2030
    section Era 3.0
    Human-Level æ™ºèƒ½ (æ·±åº¦æ„å›¾ç†è§£) :2030, 2040
    section Era 4.0
    Superhuman æ™ºèƒ½ (äººæœºè§’è‰²åè½¬) :2040, 2050
```

| æ—¶ä»£        | æ—¶é—´èŒƒå›´   | æ™ºèƒ½æ°´å¹³                  | Context Engineering ç‰¹å¾                 | è§’è‰²çš„è¿›åŒ–                                                                                        |
| :---------- | :--------- | :------------------------ | :--------------------------------------- | :------------------------------------------------------------------------------------------------ |
| **Era 1.0** | 1990s-2020 | åŸå§‹è®¡ç®—ï¼Œè¢«åŠ¨æ‰§è¡Œè€…      | åˆšæ€§ã€é¢„å®šä¹‰æ ¼å¼ï¼ˆèœå•é€‰æ‹©ã€ä¼ æ„Ÿå™¨è¾“å…¥ï¼‰ | ä¸Šä¸‹æ–‡ä½œä¸º"ç¿»è¯‘"<br/>**å‘†æ¿æœºå™¨äºº**ï¼šåªèƒ½å¬æ‡‚ç‰¹å®šæŒ‡ä»¤ï¼ˆ"å¼€ç¯"ï¼‰ï¼Œè¯´"å¤ªé»‘äº†"å®ƒä¼šæŠ¥é”™ã€‚             |
| **Era 2.0** | 2020-è‡³ä»Š  | Agent-Centricï¼Œä¸»åŠ¨æ™ºèƒ½ä½“ | è‡ªç„¶è¯­è¨€ç†è§£ã€æ¨æ–­éšå«æ„å›¾ã€åŠ¨æ€ä¸Šä¸‹æ–‡   | ä¸Šä¸‹æ–‡ä½œä¸º"æŒ‡ä»¤"<br/>**èªæ˜å®ä¹ ç”Ÿ**ï¼šèƒ½å¬æ‡‚"å¤ªé»‘äº†"æ˜¯æŒ‡è¦å¼€ç¯ï¼Œä½†è®°æ€§ä¸å¥½ï¼Œéœ€è¦åå¤æé†’èƒŒæ™¯ä¿¡æ¯ã€‚ |
| Era 3.0     | æœªæ¥       | Human-Levelï¼Œå¯é åä½œè€…   | æ·±åº¦æ„å›¾ç†è§£ã€æœ€å°æ˜¾å¼ä¸Šä¸‹æ–‡éœ€æ±‚         | ä¸Šä¸‹æ–‡ä½œä¸º"åœºæ™¯"<br/>**é»˜å¥‘è€ç®¡å®¶**ï¼šæ·±åº¦æ„å›¾ç†è§£ã€‚ä¸ç”¨ä½ å¼€å£ï¼Œçœ‹ä½ çœ‰å¤´ä¸€çš±å°±çŸ¥é“è¯¥å€’èŒ¶äº†ã€‚       |
| Era 4.0     | æ¨æµ‹       | Superhumanï¼Œä½“è´´çš„ä¸»äºº    | æœºå™¨å¼•å¯¼äººç±»ã€äººæœºè§’è‰²åè½¬               | ä¸Šä¸‹æ–‡ä½œä¸º"ä¸–ç•Œ"<br/>**äººç”Ÿå¯¼å¸ˆ**ï¼šæ¯”ä½ æ›´æ‡‚ä½ è‡ªå·±ã€‚åœ¨ä½ æ„è¯†åˆ°ä¹‹å‰ï¼Œå°±ä¸»åŠ¨ä¸ºä½ è§„åˆ’æœ€ä¼˜è·¯å¾„ã€‚       |

> [!TIP]
>
> æ™ºèƒ½è¶Šé«˜ â†’ ä¸Šä¸‹æ–‡å¤„ç†èƒ½åŠ›è¶Šå¼º â†’ äººæœºäº¤äº’æˆæœ¬è¶Šä½
>
> **å½“å‰æŒ‘æˆ˜ (Era 2.0)**ï¼š
>
> - ç†è§£è‡ªç„¶è¯­è¨€è¾“å…¥
> - æ¨æ–­éšå«æ„å›¾
> - å¤„ç†ä¸å®Œæ•´ä¿¡æ¯
> - åœ¨æœ‰é™çš„ Context Window ä¸­åšå‡ºæœ€ä¼˜é€‰æ‹©
>
> æ ¸å¿ƒä»»åŠ¡æ˜¯åŸ¹å…»è¿™ä½"èªæ˜å®ä¹ ç”Ÿ"ï¼Œè®©ä»–**è®°æ€§æ›´å¥½ï¼ˆMemoryï¼‰ã€ååº”æ›´å‡†ï¼ˆIntent Inferenceï¼‰ã€å¹²æ´»æ›´åˆ©ç´¢ï¼ˆToken Efficiencyï¼‰**ã€‚

> [!TIP]
>
> **æœªæ¥æŒ‘æˆ˜ (Era 3.0)**ï¼š
>
> - **ç»ˆèº«ä¸Šä¸‹æ–‡ä¿å­˜**ï¼šå¦‚ä½•å¯é å­˜å‚¨ç”¨æˆ·ä¸€ç”Ÿçš„äº¤äº’ä¸Šä¸‹æ–‡ï¼Ÿ
> - **è¯­ä¹‰ä¸€è‡´æ€§**ï¼šéšç€æ•°æ®è§„æ¨¡è†¨èƒ€ï¼Œå¦‚ä½•ä¿æŒè¯­ä¹‰çš„å‡†ç¡®æ€§ï¼Ÿ
> - **åŠ¨æ€æ›´æ–°**ï¼šå¦‚ä½•å¤„ç†è¿‡æ—¶ä¿¡æ¯å’ŒçŸ¥è¯†å†²çªï¼Ÿ
> - **éšç§ä¸å®‰å…¨**ï¼šå¦‚ä½•åœ¨ä¿æŠ¤ç”¨æˆ·éšç§çš„åŒæ—¶æä¾›ä¸ªæ€§åŒ–æœåŠ¡ï¼Ÿ
>
> å¦‚ä½•ä¿å­˜ç”¨æˆ·**ä¸€ç”Ÿçš„ä¸Šä¸‹æ–‡**ï¼Ÿå½“æ•°æ®é‡çˆ†ç‚¸æ—¶ï¼Œå¦‚ä½•ä¿è¯"ç®¡å®¶"ä¸äº§ç”Ÿå¹»è§‰ï¼Ÿä»¥åŠæœ€å…³é”®çš„â€”â€”å¦‚ä½•ç¡®ä¿å®ƒæ°¸è¿œå¿ è¯šï¼ˆéšç§ä¸å®‰å…¨ï¼‰ï¼Ÿ

## 2. Context Engineering çš„ç†è®ºåŸºç¡€

è¦æ‰“é€ å…·å¤‡"é»˜å¥‘è€ç®¡å®¶"ç‰¹è´¨çš„ Agentï¼Œæˆ‘ä»¬ä¸èƒ½åªå…³æ³¨ Prompt ç¼–å†™ï¼ˆEra 1.0 çš„æ€ç»´ï¼‰ï¼Œè€Œå¿…é¡»æ„å»ºå®Œæ•´çš„ä¸Šä¸‹æ–‡ç”Ÿå‘½å‘¨æœŸã€‚åŸºäºè®ºæ–‡ [[1]](#ref1) çš„å®šä¹‰ä¸ä¸»æµæ¡†æ¶çš„æœ€ä½³å®è·µï¼ŒContext Engineering è¢«ç³»ç»Ÿæ€§åœ°è§£æ„ä¸ºä»¥ä¸‹ä¸‰å¤§æ ¸å¿ƒç»´åº¦ï¼š

```mermaid
graph LR
    subgraph CE["ğŸ§  Context Engineering"]
        subgraph Context Usage[ä¸Šä¸‹æ–‡ä½¿ç”¨]
            CU["ğŸ” Usage<br>ä¸Šä¸‹æ–‡ä½¿ç”¨"]
            CU --> CU1["è¯­ä¹‰æ£€ç´¢"]
            CU --> CU2["æ„å›¾æ¨æ–­"]
            CU --> CU3["åŠ¨æ€ç»„è£…"]
        end

        subgraph Context Management[ä¸Šä¸‹æ–‡ç®¡ç†]
            CM["ğŸ“¦ Management<br>ä¸Šä¸‹æ–‡ç®¡ç†"]
            CM --> CM1["åˆ†å±‚è®°å¿†æ¶æ„"]
            CM --> CM2["ä¸Šä¸‹æ–‡å‹ç¼©"]
            CM --> CM3["ä¸Šä¸‹æ–‡éš”ç¦»"]
            CM --> CM4["æŒä¹…åŒ–å­˜å‚¨"]
            CM --> CM5[å¤šæ¨¡æ€å¤„ç†]
        end

        subgraph Context Collection[ä¸Šä¸‹æ–‡æ”¶é›†]
            CC["ğŸ“¥ Collection<br>ä¸Šä¸‹æ–‡æ”¶é›† - ç¯å¢ƒæ„ŸçŸ¥"]
            CC --> CC1["ç”¨æˆ·è¾“å…¥"]
            CC --> CC2["ç³»ç»ŸæŒ‡ä»¤"]
            CC --> CC3["å¯¹è¯å†å²"]
            CC --> CC4["å¤–éƒ¨æ•°æ®/RAG"]
            CC --> CC5["å·¥å…·å®šä¹‰"]
            CC --> CC6[è·¨æ¨¡æ€ä¿¡æ¯]
        end
    end

    style CC fill:#065f46,stroke:#34d399,color:#fff
    style CM fill:#7c2d12,stroke:#fb923c,color:#fff
    style CU fill:#581c87,stroke:#c084fc,color:#fff
```

### 2.1 Context Collection

ä½œä¸ºä¸Šä¸‹æ–‡æµè½¬çš„ç¬¬ä¸€ç«™ï¼Œ**Context Collectionï¼ˆä¸Šä¸‹æ–‡æ”¶é›†ï¼‰** è´Ÿè´£æ„å»º Agent çš„"æ„ŸçŸ¥ä¸–ç•Œ"ï¼Œè§£å†³"æ•°æ®ä»ä½•è€Œæ¥"çš„é—®é¢˜ã€‚

> [!TIP]
>
> **Context Collectionï¼šå¤§å¨å¤‡èœ**
>
> æƒ³è±¡ç°åœ¨ Agent æ˜¯ä¸€ä½**å¤§å¨**ï¼ŒContext Collection å°±æ˜¯**åœ¨å¼€ç«ï¼ˆæ¨ç†ï¼‰å‰æ±‡é›†æ‰€æœ‰ç´ æçš„è¿‡ç¨‹**ï¼šæ—¢è¦å¬æ¸…å®¢äººçš„ç‚¹å•ï¼ˆ**User Input**ï¼‰ï¼Œåˆè¦éµå¾ªé¤å…çš„çƒ¹é¥ª SOPï¼ˆ**System Instructions**ï¼‰ï¼Œè¿˜å¾—ä»å‚¨è—å®¤å–å›é™ˆå¹´ç§˜åˆ¶é…±æ–™ï¼ˆ**Memory**ï¼‰å’Œæ—¶ä»¤é²œè”¬ï¼ˆ**RAG**ï¼‰ã€‚

è¿™äº›"ç´ æ"ä¸»è¦æ¥æºäºï¼š

| æ¥æº               | æè¿°                           | æ¡†æ¶å®ç°ç¤ºä¾‹                                                |
| :----------------- | :----------------------------- | :---------------------------------------------------------- |
| **ç”¨æˆ·è¾“å…¥**       | å½“å‰ä»»åŠ¡æˆ–æŸ¥è¯¢                 | ADK `user message`, Agno `input`                            |
| **ç³»ç»ŸæŒ‡ä»¤**       | è§„åˆ™ã€è§’è‰²ã€è¡Œä¸ºå‡†åˆ™           | ADK `system_instruction`, Agno `description`+`instructions` |
| **å¯¹è¯å†å²**       | å½“å‰ä¼šè¯çš„çŸ­æœŸè®°å¿†             | ADK `session.events`, Agno `chat_history`                   |
| **é•¿æœŸè®°å¿†**       | è·¨ä¼šè¯çš„æŒä¹…ä¿¡æ¯               | ADK `MemoryService`, Agno `enable_user_memories`            |
| **å¤–éƒ¨æ•°æ® (RAG)** | å®æ—¶è·å–çš„çŸ¥è¯†                 | LangChain `VectorStoreRetriever`, Agno `Knowledge`          |
| **å·¥å…·å®šä¹‰**       | å¯ç”¨å·¥å…·çš„æè¿°å’Œæ ¼å¼           | ADK `FunctionTool`, Agno `tools`                            |
| **è¾“å‡ºæ ¼å¼**       | å“åº”ç»“æ„è§„èŒƒï¼ˆå¦‚ JSON Schemaï¼‰ | ADK `expected_output`, Agno `response_model`                |

### 2.2 Context Management

æ”¶é›†å¥½"ç´ æ"ï¼ˆContext Collectionï¼‰åªæ˜¯ç¬¬ä¸€æ­¥ã€‚å¦‚æœå¨æˆ¿ä¹±ä½œä¸€å›¢ï¼Œå¤§å¨ä¹Ÿæ²¡æ³•å¹²æ´»ã€‚**Context Managementï¼ˆä¸Šä¸‹æ–‡ç®¡ç†ï¼‰** çš„æ ¸å¿ƒå°±æ˜¯**é«˜æ•ˆçš„å¨æˆ¿æ”¶çº³æœ¯**ï¼šç¡®ä¿æ¡ˆæ¿ä¸Šï¼ˆçŸ­æœŸï¼‰åªæ”¾å½“ä¸‹çš„èœï¼Œå†·åº“é‡Œï¼ˆé•¿æœŸï¼‰å›¤ç€å¸¸ç”¨çš„æ–™ï¼Œå¹¶ä¸”ä¸åŒå·¥ç§ï¼ˆéš”ç¦»ï¼‰äº’ä¸å¹²æ‰°ã€‚

#### 2.2.1 Layered Memory Architecture

è®ºæ–‡ [[1]](#ref1) æå‡ºçš„**Layered Memory Architectureï¼ˆåˆ†å±‚è®°å¿†æ¶æ„ï¼‰**ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯å¨æˆ¿çš„äºŒçº§æ”¶çº³ä½“ç³»ï¼š

> [!NOTE]
>
> å®šä¹‰ 1ï¼š**çŸ­æœŸè®°å¿† (Short-term Memory) â€”â€” æ¡ˆæ¿åŒº/æ“ä½œå°**
>
> $$
>   M_s = f_{short}(c \in C : w_{temporal}(c) > \theta_s)
> $$
>
> - **ç‰¹ç‚¹**ï¼šé«˜æ—¶é—´ç›¸å…³æ€§ï¼ˆæ‰‹è¾¹æ€¥éœ€ï¼‰ã€‚
> - **ç¼ºç‚¹**ï¼šç©ºé—´æœ‰é™ï¼Œåšå®Œè¿™é“èœå°±ä¼šè¢«æ¸…ç†ã€‚

> [!IMPORTANT]
>
> è§£è¯»ï¼šå¯¹åº”å„æ¡†æ¶çš„**å¯¹è¯å†å² (Chat History)** å’Œ **ä¼šè¯çŠ¶æ€ (Session State)**

> [!NOTE]
>
> å®šä¹‰ 2ï¼š**é•¿æœŸè®°å¿† (Long-term Memory) â€”â€” å†·åº“/å‚¨è—å®¤**
>
> $$
>   M_l = f_{long}(c \in C : w_{importance}(c) > \theta_l \land w_{temporal}(c) \leq \theta_s)
> $$
>
> - **ç‰¹ç‚¹**ï¼šé«˜é‡è¦æ€§ï¼Œç»è¿‡ç­›é€‰å’Œæ‰“åŒ…ï¼ˆå‹ç¼©/æŠ½è±¡ï¼‰ã€‚
> - **ä½œç”¨**ï¼šå­˜æ”¾ VIP å®¢äººå–œå¥½ã€å­£èŠ‚æ€§ç»å…¸èœè°±ç­‰éœ€è¦æŒä¹…ä¿å­˜çš„ä¿¡æ¯ã€‚

> [!IMPORTANT]
>
> è§£è¯»ï¼šå¯¹åº”å„æ¡†æ¶ **Memory Service** ä¸­çš„ **æŒä¹…åŒ–å­˜å‚¨ (Persistent Storage)**

> [!NOTE]
>
> å®šä¹‰ 3ï¼š**è®°å¿†è¿ç§» (Memory Transfer) â€”â€” å¤‡èœå…¥åº“**
>
> $$
>   f_{transfer}: M_s \rightarrow M_l
> $$
>
> - **å·©å›ºè¿‡ç¨‹**ï¼šæŠŠæ¡ˆæ¿ä¸Šåˆ‡å¥½ä½†æ²¡ç”¨å®Œçš„ä¼˜è´¨é£Ÿæï¼Œæˆ–è€…ç ”å‘å‡ºçš„æ–°é…±æ–™ï¼Œæ‰“åŒ…æ”¾å…¥å†·åº“ï¼ˆé«˜é¢‘è®¿é—®æˆ–é«˜é‡è¦æ€§çš„çŸ­æœŸè®°å¿†ç»å¤„ç†åæˆä¸ºé•¿æœŸè®°å¿†ï¼‰ã€‚
> - **è§¦å‘æ¡ä»¶**ï¼šé«˜é¢‘ä½¿ç”¨ã€å¦‚æœä¸è®°ä¸‹æ¥ä¸‹æ¬¡è¿˜å¾—é‡æ–°åšï¼ˆæƒ…æ„Ÿæ„ä¹‰ã€ä¸ç°æœ‰çŸ¥è¯†ç»“æ„çš„ç›¸å…³æ€§ç­‰å› ç´ ï¼‰ã€‚

> [!IMPORTANT]
>
> è§£è¯»ï¼šå¯¹åº” Google Memory Bank ä¸­ **"Session â†’ Insight" çš„å¼‚æ­¥è®°å¿†æç‚¼ï¼ˆå·©å›ºï¼‰è¿‡ç¨‹**ã€‚

#### 2.2.2 Context Compression

| ç­–ç•¥                              | æè¿°                               | ä¼˜ç¼ºç‚¹                             | æ¡†æ¶æ”¯æŒ             |
| :-------------------------------- | :--------------------------------- | :--------------------------------- | :------------------- |
| **Trimming**                      | ä¿ç•™æœ€è¿‘ K æ¡æ¶ˆæ¯                  | âœ… ç®€å•ï¼›âŒ ä¸¢å¤±æ—©æœŸé‡è¦ä¿¡æ¯       | LangGraph, Agno      |
| **Summarizationï¼ˆäººç±»å¯è¯»æ‘˜è¦ï¼‰** | å°†å†å²æ‘˜è¦ä¸ºç²¾ç®€è‡ªç„¶è¯­è¨€           | âœ… ä¿ç•™è¯­ä¹‰ï¼›âŒ ä¸¢å¤±ç»†èŠ‚ï¼›è®¡ç®—å¼€é”€ | ADK, Agno, LangGraph |
| **Tagging (æ ‡ç­¾åŒ–)**              | ä»å¤šç»´åº¦æ ‡è®°ä¿¡æ¯ï¼ˆä¼˜å…ˆçº§ã€æ¥æºç­‰ï¼‰ | âœ… é«˜æ•ˆæ£€ç´¢ï¼›âŒ å¯èƒ½è¿‡äºåˆšæ€§       |
| **Sliding Window**                | æ»‘åŠ¨çª—å£æ‘˜è¦è€æ—§äº‹ä»¶               | âœ… å¹³è¡¡ä¿ç•™ä¸å‹ç¼©                  | ADK                  |
| **Semantic Filter**               | åŸºäºç›¸å…³æ€§è¿‡æ»¤                     | âœ… ä¿ç•™é‡è¦ä¿¡æ¯ï¼›âŒ å¯èƒ½é—æ¼       | è‡ªå®šä¹‰å®ç°           |
| **å±‚æ¬¡åŒ–ç¬”è®°**                    | æ ‘çŠ¶ç»“æ„ç»„ç»‡ä¿¡æ¯                   | âœ… æ¸…æ™°å±•ç¤ºï¼›âŒ ä¸æ•æ‰é€»è¾‘å…³è”     |
| **QA å¯¹å‹ç¼©**                     | å°†ä¸Šä¸‹æ–‡è½¬æ¢ä¸ºé—®ç­”å¯¹               | âœ… æ£€ç´¢å‹å¥½ï¼›âŒ ç ´åä¿¡æ¯æµ         | è‡ªå®šä¹‰å®ç°           |

#### 2.2.3 Context Isolation

éšç€å®´å¸­ï¼ˆä»»åŠ¡ï¼‰è§„æ¨¡æ‰©å¤§ï¼Œä¸€ä½ä¸»å¨æ— æ³•æå®šæ‰€æœ‰èœå“ã€‚**Context Isolationï¼ˆä¸Šä¸‹æ–‡éš”ç¦»ï¼‰** å°±æ˜¯å¼•å…¥**åå¨æµæ°´çº¿åˆ†å·¥**ï¼š

> [!TIP]
>
> **Sub-Agent æ¶æ„**
>
> å°±åƒ**ç”œç‚¹å¸ˆï¼ˆSub-Agent Aï¼‰**åªå…³æ³¨é¢ç²‰å’Œç³–ï¼Œä¸éœ€è¦çŸ¥é“**çƒ¤è‚‰å¸ˆï¼ˆSub-Agent Bï¼‰**æŠŠç‰›æ’ç…åˆ°äº†å‡ åˆ†ç†Ÿã€‚
>
> è®ºæ–‡å®šä¹‰ï¼š"Each sub-agent has its own focused context window, and the main agent coordinates through efficient communication."
>
> ---
>
> æ¯ä¸ª Sub-Agent æ‹¥æœ‰ç‹¬ç«‹çš„ã€èšç„¦çš„ä¸Šä¸‹æ–‡çª—å£ï¼Œä¸» Agent é€šè¿‡é«˜æ•ˆé€šä¿¡åè°ƒå„ Sub-Agentã€‚

> [!IMPORTANT]
>
> è§£è¯»ï¼šå¯¹åº” Google çš„ **Agent-to-Agent Protocol**ï¼Œä»¥åŠ ADK çš„ **Multi-Agent**ã€LangGraph çš„ **Subgraph** ç­‰è®¾è®¡ã€‚

### 2.3 Context Usage

ç´ æå¤‡é½ï¼ˆCollectionï¼‰ï¼Œæ”¶çº³æœ‰åºï¼ˆManagementï¼‰ï¼Œæœ€åä¸€æ­¥å°±æ˜¯**Context Usageï¼ˆä¸Šä¸‹æ–‡ä½¿ç”¨ï¼‰â€”â€”å¤§å¨çš„æ­£å¼çƒ¹é¥ª**ã€‚è¿™æ˜¯ Agent å±•ç°"æ™ºèƒ½"çš„å…³é”®ç¯èŠ‚ï¼šå¦‚ä½•ä»æµ·é‡åº“å­˜ä¸­ç²¾å‡†æŠ“å–ä¿¡æ¯ï¼Œå¹¶åœ¨æœ‰é™çš„é¤ç›˜ï¼ˆContext Windowï¼‰ä¸­å‘ˆç°å‡ºæœ€å®Œç¾çš„æ–™ç†ï¼ˆPromptï¼‰ã€‚

#### 2.3.1 Retrieval and Selection

å¤§å¨ç‚’èœä¸ä¼šæŠŠå†·åº“é‡Œæ‰€æœ‰ä¸œè¥¿éƒ½å€’è¿›é”…é‡Œã€‚**Retrieval and Selectionï¼ˆè®°å¿†æ£€ç´¢ä¸é€‰æ‹©ï¼‰** å°±æ˜¯**æ ¹æ®å½“å‰èœå•ï¼ˆQueryï¼‰ç²¾å‡†æŠ“å–é£Ÿæ**çš„è¿‡ç¨‹ã€‚è®ºæ–‡ [[1]](#ref1) å¼ºè°ƒå¤šç»´åº¦çš„æ£€ç´¢ä¾æ®ï¼š

| æ£€ç´¢ä¾æ®                 | æè¿°                       | å®ç°æ–¹å¼       |
| :----------------------- | :------------------------- | :------------- |
| **è¯­ä¹‰ç›¸ä¼¼åº¦**           | åŸºäºå‘é‡åµŒå…¥çš„ç›¸ä¼¼åº¦æœç´¢   | Vector Search  |
| **æ—¶é—´é‚»è¿‘æ€§ (Recency)** | æœ€è¿‘ä½¿ç”¨çš„ä¿¡æ¯ä¼˜å…ˆçº§æ›´é«˜   | æ—¶é—´æˆ³æ’åº     |
| **è®¿é—®é¢‘ç‡ (Frequency)** | é«˜é¢‘è®¿é—®çš„ä¿¡æ¯ä¿æŒé«˜å¯ç”¨æ€§ | è®¿é—®è®¡æ•°å™¨     |
| **é‡è¦æ€§è¯„åˆ†**           | é¢„è®¡ç®—çš„é‡è¦æ€§æƒé‡         | LLM è¯„ä¼°       |
| **é€»è¾‘ä¾èµ–**             | è¿½è¸ªæ¨ç†æ­¥éª¤ä¹‹é—´çš„ä¾èµ–å…³ç³» | ä¾èµ–å›¾ï¼ˆå›¾åº“ï¼‰ |
| **ä¿¡æ¯å»é‡**             | è¿‡æ»¤ä¼ è¾¾ç›¸åŒå«ä¹‰çš„é‡å¤ä¿¡æ¯ | è¯­ä¹‰å»é‡       |
| **ç”¨æˆ·åå¥½**             | æ ¹æ®ç”¨æˆ·åé¦ˆå’Œä¹ æƒ¯è°ƒæ•´     |

#### 2.3.2 Proactive Intent Inference

é¡¶çº§ç®¡å®¶ä¸éœ€è¦ä¸»äººå¼€å£ï¼Œå…·å¤‡ Proactive Intent Inferenceï¼ˆä¸»åŠ¨æ„å›¾æ¨æ–­ï¼‰èƒ½åŠ›ã€‚è®ºæ–‡ [[1]](#ref1) æŒ‡å‡ºï¼ŒContext Engineering å¿…é¡»å…·å¤‡**ä¸»åŠ¨æ€§** â€”â€” å°±åƒè€ç»ƒçš„æœåŠ¡å‘˜å¬åˆ°å®¢äººå’³å—½ï¼Œä¸ä»…é€’ä¸Šæ°´ï¼Œè¿˜ä¼šé»˜é»˜å…³å°å†·æ°”ã€‚

> [!TIP]
>
> **Proactive User Need Inferenceï¼ˆä¸»åŠ¨ç”¨æˆ·éœ€æ±‚æ¨æ–­ï¼‰**
>
> - **å­¦ä¹ ç”¨æˆ·åå¥½**ï¼šåˆ†æå¯¹è¯å†å²å’Œä¸ªäººæ•°æ®ï¼Œè¯†åˆ«æ²Ÿé€šé£æ ¼ã€å…´è¶£å’Œå†³ç­–æ¨¡å¼
> - **ä»ç›¸å…³é—®é¢˜æ¨æ–­éšè—ç›®æ ‡**ï¼šåˆ†ææŸ¥è¯¢åºåˆ—ï¼Œé¢„æµ‹æ›´å¹¿æ³›çš„ç›®æ ‡
> - **ä¸»åŠ¨æä¾›å¸®åŠ©**ï¼šæ£€æµ‹ç”¨æˆ·å›°å¢ƒï¼ˆçŠ¹è±«ã€å¤šæ¬¡å°è¯•ï¼‰ï¼Œä¸»åŠ¨æä¾›å·¥å…·æˆ–å»ºè®®

#### 2.3.3 Dynamic Context Assembly

æ‰€æœ‰çš„ç´ æç­›é€‰å®Œæ¯•åï¼Œéœ€è¦é€šè¿‡ **Dynamic Context Assemblerï¼ˆåŠ¨æ€ä¸Šä¸‹æ–‡ç»„è£…ï¼‰** è¿›è¡Œ**æœ€ç»ˆæ‘†ç›˜**ï¼Œå°†å…¶ç»„è£…æˆ LLM æœ€æ˜“æ¶ˆåŒ–çš„æ ¼å¼ï¼ˆFormatted Promptï¼‰ã€‚

```mermaid
graph LR
    subgraph Inputs["è¾“å…¥æº"]
        I1["System Instruction"]
        I2["User Message"]
        I3["Chat History"]
        I4["Memories"]
        I5["Knowledge (RAG)"]
        I6["Tools"]
    end

    subgraph Assembler["Context Assembler"]
        A1["Token é¢„ç®—è®¡ç®—"]
        A2["ä¼˜å…ˆçº§æ’åº"]
        A3["æˆªæ–­ä¸å¡«å……"]
        A4["æ ¼å¼åŒ–è¾“å‡º"]
    end

    subgraph Output["è¾“å‡º"]
        O1["Formatted Prompt"]
    end

    I1 --> A1
    I2 --> A1
    I3 --> A1
    I4 --> A1
    I5 --> A1
    I6 --> A1
    A1 --> A2 --> A3 --> A4 --> O1

    style Inputs fill:#065f46,stroke:#34d399,color:#fff
    style Assembler fill:#7c2d12,stroke:#fb923c,color:#fff
    style Output fill:#581c87,stroke:#c084fc,color:#fff
```

## 3. Context Engineering çš„ä¸»æµå®è·µ

æ˜ç™½äº†"å¨æˆ¿ç†è®º"ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹**ä¸šç•Œä¸‰å¤§é¡¶å°–"å¨å…·å•†"ï¼ˆAgent Frameworkï¼‰**æ˜¯å¦‚ä½•æ‰“é€ ä»–ä»¬çš„å¨æˆ¿çš„ã€‚

### 3.1 Google ADK (Agent Development Kit)

**Google ADK å°±åƒæ˜¯ä¸€åº§æ ‡å‡†åŒ–çš„å·¥ä¸šçº§ä¸­å¤®å¨æˆ¿**ã€‚å®ƒæœ€æ˜¾è‘—çš„ç‰¹ç‚¹æ˜¯æä¾›äº†æåº¦ä¸¥è°¨çš„**åˆ†ç®±æ”¶çº³ä½“ç³»ï¼ˆContext Hierarchyï¼‰**ï¼š

#### 3.1.1 æ ¸å¿ƒ Context ä½“ç³»

åœ¨ ADK ä¸­ï¼Œå¤§å¨ä¸éœ€è¦æ¯æ¬¡éƒ½é‡æ–°æ‰¾ç›’å­ï¼Œæ‰€æœ‰ä¸œè¥¿éƒ½æœ‰ä¸¥æ ¼çš„æ ‡ç­¾ï¼š

```mermaid
graph TD
    subgraph ADK["Google ADK è®°å¿†ä½“ç³»"]
        IC[Invocation Context] --> S[Session]
        IC --> ST[State]
        IC --> M[Memory]

        S --> SE["Events<br>æ—¶é—´åºåˆ—æ¶ˆæ¯"]
        S --> SS["session.state<br>ä¼šè¯çº§ä¸´æ—¶æ•°æ®"]

        ST --> ST1["æ— å‰ç¼€: Session Scope"]
        ST --> ST2["user: User Scope"]
        ST --> ST3["app: App Scope"]
        ST --> ST4["temp: Invocation Scope"]

        M --> MM[MemoryService]
        MM --> MM1[InMemoryMemoryService]
        MM --> MM2[VertexAiMemoryBankService]
    end

    style ADK fill:#1e3a5f,stroke:#60a5fa,color:#fff
    style IC fill:#065f46,stroke:#34d399,color:#fff
    style MM fill:#7c2d12,stroke:#fb923c,color:#fff
```

| æ¦‚å¿µ         | å®šä¹‰                        | ä½œç”¨åŸŸ   | æŒä¹…æ€§                 |
| :----------- | :-------------------------- | :------- | :--------------------- |
| **Session**  | å•æ¬¡è¿›è¡Œä¸­çš„ç”¨æˆ·-Agent äº¤äº’ | å½“å‰ä¼šè¯ | å–å†³äº SessionService  |
| **State**    | ä¼šè¯å†…çš„ Key-Value æ•°æ®     | è§å‰ç¼€   | è§å‰ç¼€                 |
| **Memory**   | è·¨ä¼šè¯çš„å¯æœç´¢çŸ¥è¯†åº“        | è·¨ä¼šè¯   | æŒä¹…                   |
| **Event**    | äº¤äº’ä¸­çš„åŸå­æ“ä½œè®°å½•        | å½“å‰ä¼šè¯ | å–å†³äº SessionService  |
| **Artifact** | ä¸ä¼šè¯å…³è”çš„æ–‡ä»¶/æ•°æ®å—     | å½“å‰ä¼šè¯ | å–å†³äº ArtifactService |

ADK ç‹¬åˆ›äº†ä¸€å¥— **'é­”æ³•ä¾¿åˆ©è´´'ï¼ˆPrefix-based Stateï¼‰** æœºåˆ¶ã€‚ä½ åªéœ€è¦åœ¨ Key ä¸ŠåŠ ä¸åŒçš„ **å‰ç¼€**ï¼Œç³»ç»Ÿå°±ä¼šè‡ªåŠ¨æŠŠè¿™å¼ ä¾¿åˆ©è´´è´´åˆ°ä¸åŒçš„åœ°æ–¹ï¼ˆä½œç”¨åŸŸï¼‰ï¼š

| å‰ç¼€    | ä½œç”¨åŸŸ               | æŒä¹…æ€§                 | åœºæ™¯ç±»æ¯”ï¼ˆä¾¿åˆ©è´´è´´åœ¨å“ªï¼Ÿï¼‰                             |
| :------ | :------------------- | :--------------------- | :----------------------------------------------------- |
| æ— å‰ç¼€  | å½“å‰ Session         | å–å†³äº SessionService  | **é¤æ¡Œä¸Š**ï¼šåƒå®Œè¿™é¡¿é¥­å°±æ¸…ç†äº†ï¼ˆä»»åŠ¡è¿›åº¦ã€ä¸´æ—¶æ ‡å¿—ï¼‰   |
| `user:` | è·¨è¯¥ç”¨æˆ·æ‰€æœ‰ Session | Database/VertexAI æŒä¹… | **VIP æ¡£æ¡ˆé‡Œ**ï¼šè€é¡¾å®¢ä¸‹æ¬¡æ¥è¿˜æœ‰ï¼ˆç”¨æˆ·åå¥½ã€é…ç½®ï¼‰     |
| `app:`  | è·¨è¯¥åº”ç”¨æ‰€æœ‰ç”¨æˆ·     | Database/VertexAI æŒä¹… | **é¤å…å¢™ä¸Š**ï¼šæ‰€æœ‰äººéƒ½å¾—éµå®ˆï¼ˆå…¨å±€è®¾ç½®ã€æ¨¡æ¿ï¼‰         |
| `temp:` | å½“å‰ Invocation      | ä¸æŒä¹…                 | **æ‰‹å¿ƒé‡Œ**ï¼šåšå®Œè¿™ä¸ªåŠ¨ä½œå°±æ´—æ‰äº†ï¼ˆä¸­é—´è®¡ç®—ã€ä¸´æ—¶å˜é‡ï¼‰ |

```python
# Google ADK State ä½¿ç”¨ç¤ºä¾‹ [5]
async def my_tool(ctx: ToolContext):
    # Session scope - ä»…å½“å‰ä¼šè¯
    ctx.state["task_progress"] = 50

    # User scope - è·¨ä¼šè¯æŒä¹…åŒ–
    ctx.state["user:preferred_language"] = "zh-CN"

    # App scope - å…¨å±€é…ç½®
    ctx.state["app:max_retries"] = 3

    # Temp scope - ä»…å½“å‰è°ƒç”¨
    ctx.state["temp:intermediate_result"] = {...}
```

#### 3.1.2 Context Engineering

åœ¨ ADK è¿™ä¸ª"ä¸­å¤®å¨æˆ¿"ä¸­ï¼ŒåŸææ–™ï¼ˆContextï¼‰çš„æµè½¬æœ‰ç€ä¸¥æ ¼çš„ SOPï¼š

1. **Context Collectionï¼ˆæŒ‰éœ€é¢†æ–™ï¼‰**

   ADK å¹¶ä¸æŠŠæ‰€æœ‰ä¿¡æ¯ä¸€æ¬¡æ€§å †ç»™æ‰€æœ‰äººï¼Œè€Œæ˜¯æ ¹æ®**å·¥ç§ï¼ˆä½ç½®ï¼‰**åˆ†å‘ä¸åŒçš„**é¢†æ–™å•ï¼ˆContext Objectï¼‰**ï¼š

   | Context ç±»å‹          | æè¿°                         | å¯è®¿é—®ä½ç½®                 | è§’è‰²ç±»æ¯”                   |
   | :-------------------- | :--------------------------- | :------------------------- | :------------------------- |
   | **InvocationContext** | å®Œæ•´è°ƒç”¨ä¸Šä¸‹æ–‡ï¼ŒåŒ…å«æ‰€æœ‰ä¿¡æ¯ | Agent çš„ `_run_async_impl` | **ä¸»å¨**ï¼šå…¨çŸ¥å…¨èƒ½         |
   | **CallbackContext**   | å›è°ƒä¸­çš„åªè¯»ä¸Šä¸‹æ–‡           | Agent/Model å›è°ƒ           | **ç£å¯¼**ï¼šåªçœ‹ä¸åŠ¨         |
   | **ToolContext**       | å·¥å…·æ‰§è¡Œæ—¶çš„å¯å†™ä¸Šä¸‹æ–‡       | Function Tools             | **é…èœå‘˜**ï¼šå¯æ“ä½œå±€éƒ¨çŠ¶æ€ |
   | **ReadonlyContext**   | åªè¯»ä¸Šä¸‹æ–‡ï¼Œç”¨äºè¡¨è¾¾å¼è¯„ä¼°   | Agent Config è¡¨è¾¾å¼        | **æ˜¾ç¤ºå±**ï¼šä»…ä¾›å‚è€ƒ       |

   ```python
   # Google ADK ä¸Šä¸‹æ–‡æ”¶é›†ç¤ºä¾‹
   from google.adk.agents import Agent
   from google.adk.agents.callback_context import CallbackContext

   class MyAgent(Agent):
       async def _run_async_impl(self, ctx):
           # ä» InvocationContext æ”¶é›†å„ç±»ä¿¡æ¯
           session = ctx.session                    # ä¼šè¯
           state = ctx.session.state                # ä¼šè¯çŠ¶æ€
           user_content = ctx.user_content          # ç”¨æˆ·è¾“å…¥
           agent = ctx.agent                        # Agent é…ç½®

           # ä» Memory Service æ£€ç´¢é•¿æœŸè®°å¿†
           if ctx.memory_service:
               memories = await ctx.memory_service.search_memory(
                   query=user_content.parts[0].text
               )
   ```

2. **Context Compactionï¼ˆå°é¢æ¸…ç†ï¼‰**

   ä¸ºäº†é˜²æ­¢"ç¶å°"ï¼ˆContext Windowï¼‰å †æ»¡ï¼ŒADK é‡‡ç”¨**æ»‘åŠ¨çª—å£ï¼ˆSliding Windowï¼‰**æœºåˆ¶ï¼Œå®šæœŸæ¸…ç†é™ˆæ—§çš„"æœçš®çº¸å±‘"ï¼ˆOld Eventsï¼‰ã€‚

   ```python
   # Google ADK Context Compaction
   from google.adk.apps.app import EventsCompactionConfig

   app = App(
       name='my-agent',
       root_agent=root_agent,
       events_compaction_config=EventsCompactionConfig(
           compaction_interval=3,  # æ¯ 3 æ¬¡è°ƒç”¨è§¦å‘å‹ç¼©
           overlap_size=1,         # ä¿ç•™å‰ä¸€çª—å£çš„ 1 ä¸ªäº‹ä»¶
       ),
   )
   ```

3. **Context Cachingï¼ˆé¢„åˆ¶å¤‡èœï¼‰**

   å¯¹äºé‚£äº›ä½“ç§¯å·¨å¤§ä¸”åå¤ä½¿ç”¨çš„"é£Ÿæ"ï¼ˆå¦‚è¶…é•¿ System Prompt æˆ–å¤§æ–‡ä»¶ï¼‰ï¼ŒADK ä¼šå°†å…¶æš‚å­˜ä¸º**é¢„åˆ¶èœï¼ˆCacheï¼‰**ï¼Œé¿å…æ¯æ¬¡éƒ½ä»é›¶å¤„ç†ï¼ˆToken Re-computationï¼‰ã€‚

   ```python
   from google.adk.agents.context_cache_config import ContextCacheConfig

   app = App(
       name='my-agent',
       root_agent=root_agent,
       context_cache_config=ContextCacheConfig(
           min_tokens=2048,      # è§¦å‘ç¼“å­˜çš„æœ€å° token æ•°
           ttl_seconds=600,      # ç¼“å­˜å­˜æ´»æ—¶é—´ (10åˆ†é’Ÿ)
           cache_intervals=5,    # åˆ·æ–°é—´éš”ï¼ˆä½¿ç”¨æ¬¡æ•°ï¼‰
       ),
   )
   ```

### 3.2 Agno

å¦‚æœè¯´ Google ADK æ˜¯å·¥ä¸šçº§ä¸­å¤®å¨æˆ¿ï¼Œé‚£ä¹ˆ **Agno å°±æ˜¯ä¸€ä¸ªä¸»æ‰“"æ‡’äººåŒ…"çš„é«˜çº§è‡ªåŠ©é¤å…**ã€‚å®ƒçš„è®¾è®¡å“²å­¦æ˜¯**é…ç½®é©±åŠ¨ï¼ˆConfiguration Drivenï¼‰**â€”â€”ä½ ä¸éœ€è¦è‡ªå·±å»åœ°é‡Œæ‹”èåœï¼Œåªéœ€è¦åœ¨èœå•ä¸Šå‹¾é€‰ä½ è¦çš„"å¥—é¤ç»„ä»¶"ï¼Œç³»ç»Ÿå°±ä¼šè‡ªåŠ¨æŠŠèœåšå¥½ã€‚

#### 3.2.1 Context Collectionï¼ˆè‡ªåŠ©é€‰é¤ï¼‰

Agno çš„ä¸Šä¸‹æ–‡æ”¶é›†å°±åƒæ˜¯åœ¨**ç‚¹è‡ªåŠ©é¤**ï¼Œæ‰€æœ‰åŠŸèƒ½éƒ½å°è£…æˆäº†å¼€ç®±å³ç”¨çš„**å¼€å…³ï¼ˆOptionsï¼‰**ï¼š

| ç»„ä»¶                   | æè¿°                                                    | é…ç½®æ–¹å¼                      | è‡ªåŠ©é¤ç±»æ¯”                               |
| :--------------------- | :------------------------------------------------------ | :---------------------------- | :--------------------------------------- |
| **System Message**     | ä¸»ä¸Šä¸‹æ–‡<br/>descriptionã€instructionsã€expected_output | Agent æ„é€ å‚æ•°                | **ä¸»èœ**ï¼šå®šä¸‹é¤å…çš„åŸºè°ƒï¼ˆå·èœè¿˜æ˜¯ç²¤èœï¼‰ |
| **User Message**       | ç”¨æˆ·è¾“å…¥                                                | `Agent.run(input)`            | **å®¢äººçš„ç‚¹å•**                           |
| **Chat History**       | å¯¹è¯å†å²                                                | `add_history_to_context=True` | **ä¸Šä¸€è½®çš„ç›˜å­**ï¼šå‚è€ƒå®¢äººåˆšåƒäº†å•¥       |
| **Additional Context** | Few-shot ç¤ºä¾‹æˆ–å…¶ä»–è¡¥å……ç­‰                               | `additional_context` å‚æ•°     | **ä½æ–™/å°èœ**ï¼šç»™è¿™é“èœåŠ ç‚¹æ–™            |
| **Memory**             | é•¿æœŸè®°å¿†                                                | `enable_user_memories=True`   | **ä¼šå‘˜è®°å½•**ï¼šè€è§„çŸ©ï¼Œä¸åŠ é¦™èœ           |
| **Knowledge**          | å¤–éƒ¨çŸ¥è¯†                                                | `knowledge` å‚æ•°              | **ç™¾ç§‘å…¨ä¹¦**ï¼šä¸æ‡‚éšæ—¶æŸ¥                 |

```python
# Agno "è‡ªåŠ©ç‚¹é¤å•" ç¤ºä¾‹
from agno.agent import Agent

agent = Agent(
    # [ä¸»èœ] è®¾å®šè§’è‰²å’ŒåŸºè°ƒ
    name="Helpful Assistant",
    role="Assistant",
    description="You are a helpful assistant",
    instructions=["Help the user with their question"],

    # [å°èœ] åŠ ç‚¹ Few-shot ç¤ºä¾‹æå‘³
    additional_context="""
        Here is an example:
        Request: What is the capital of France?
        Response: The capital of France is Paris.
    """,
    expected_output="Format response with `Response: <response>`",

    # [å¥—é¤åŠ é¡¹] å‹¾é€‰éœ€è¦çš„é…èœ
    add_datetime_to_context=True,          # åŠ ç‚¹æ—¶é—´è§‚å¿µ
    add_location_to_context=True,          # åŠ ç‚¹åœ°ç†ä½ç½®
    add_name_to_context=True,              # åŠ ä¸Šå®¢äººåå­—
    add_session_summary_to_context=True,   # åŠ ä¸Šå†å²æ‘˜è¦ï¼ˆè§£è…»ï¼‰
    add_memories_to_context=True,          # åŠ ä¸Šä¼šå‘˜è®°å¿†
    add_session_state_to_context=True,     # åŠ ä¸Šå½“å‰çŠ¶æ€

    # [å¤–æŒ‚] å…è®¸æŸ¥é˜…ç™¾ç§‘å…¨ä¹¦
    knowledge=my_knowledge_base,
)
```

#### 3.2.2 Memory & Knowledgeï¼ˆè®°å¿†ä¸çŸ¥è¯†ï¼‰

ç‚¹å®Œé¤ï¼ˆCollectionï¼‰åï¼Œå¦‚ä½•è®°ä½å®¢äººçš„å–œå¥½ï¼ŸAgno æä¾›äº†ä¸€å¥—æ™ºèƒ½çš„ **VIP å®¢æˆ·æ¡£æ¡ˆç³»ç»Ÿï¼ˆMemoryï¼‰**ï¼Œå¹¶å°†å…¶ä¸**ç™¾ç§‘å…¨ä¹¦ï¼ˆKnowledgeï¼‰**åšäº†æ¸…æ™°çš„åˆ‡å‰²ã€‚

**1. Memory æ¨¡å¼ï¼šè°æ¥å†™æ¡£æ¡ˆï¼Ÿ**

Agno æä¾›ä¸¤ç§ç»´æŠ¤å®¢æˆ·æ¡£æ¡ˆçš„æ–¹å¼ <sup>[[8]](#ref8)</sup>ï¼š

| æ¨¡å¼                 | é…ç½®                         | è¡Œä¸º                            | æ¡£æ¡ˆå‘˜ç±»æ¯”                                                                     |
| :------------------- | :--------------------------- | :------------------------------ | :----------------------------------------------------------------------------- |
| **Automatic Memory** | `enable_user_memories=True`  | è‡ªåŠ¨ä»å¯¹è¯ä¸­æå–å’Œå¬å›è®°å¿†      | **éšå½¢è®°å½•å‘˜**ï¼šé»˜é»˜ç«™åœ¨æ—è¾¹ï¼Œå¬åˆ°"æˆ‘ä¸åƒè¾£"å°±è‡ªåŠ¨è®°å…¥æ¡£æ¡ˆï¼Œå®Œå…¨ä¸ç”¨å¤§å¨æ“å¿ƒã€‚ |
| **Agentic Memory**   | `enable_agentic_memory=True` | Agent è‡ªä¸»å†³å®šä½•æ—¶åˆ›å»º/æ›´æ–°è®°å¿† | **å¤§å¨äº²è‡ªè®°**ï¼šå¤§å¨ï¼ˆAgentï¼‰è§‰å¾—è¿™ç‚¹å¾ˆé‡è¦ï¼Œä¸»åŠ¨æå‡ºæœ¬å­è®°ä¸‹æ¥ï¼ˆè°ƒç”¨å·¥å…·ï¼‰ã€‚  |

```python
# Agno "æ™ºèƒ½æ¡£æ¡ˆ" ç¤ºä¾‹
from agno.agent import Agent
from agno.db.postgres import PostgresDb

db = PostgresDb(
    db_url="postgresql://user:pass@localhost:5432/mydb",
    memory_table="agent_memories"
)

agent = Agent(
    db=db,
    enable_user_memories=True,  # [éšå½¢è®°å½•å‘˜] ä¸Šå²—
)

# åœºæ™¯ï¼šè®°å½•å‘˜è‡ªåŠ¨å·¥ä½œ
agent.print_response(
    "My name is Sarah and I prefer email over phone calls.",
    user_id="user-123"
)

# åœºæ™¯ï¼šè‡ªåŠ¨ç¿»é˜…æ¡£æ¡ˆ
agent.print_response(
    "What's the best way to reach me?",
    user_id="user-123"
)  # Agent ä¼šç¿»çœ‹æ¡£æ¡ˆï¼Œå›ç­” "Email"
```

> [!IMPORTANT]
>
> **åŸºæœ¬æ¦‚å¿µåŒºåˆ†ï¼šç™¾ç§‘å…¨ä¹¦ vs ç§äººæ—¥è®°**
>
> Agno ä¸¥æ ¼åŒºåˆ†äº† **Knowledge** å’Œ **Memory**ï¼Œåˆ‡å‹¿æ··æ·†ï¼š
>
> - **Knowledge (RAG)** = **ç™¾ç§‘å…¨ä¹¦/èœè°±å¤§å…¨**ã€‚å®ƒæ˜¯å…¬å…±çš„ã€é™æ€çš„çŸ¥è¯†ï¼ˆæ¯”å¦‚"æ³•å¼é¹…è‚çš„åšæ³•"ï¼‰ï¼Œç”¨æ¥å¢å¼º Agent çš„ä¸šåŠ¡èƒ½åŠ›ã€‚
> - **Memory** = **ç§äººæ—¥è®°/å®¢æˆ·æ¡£æ¡ˆ**ã€‚å®ƒæ˜¯ç§æœ‰çš„ã€åŠ¨æ€çš„è®°å½•ï¼ˆæ¯”å¦‚"Sarah ä¸åƒè‘±"ï¼‰ï¼Œç”¨æ¥æå‡ä¸ªæ€§åŒ–ä½“éªŒã€‚

### 3.3 LangChain / LangGraph

ä¸ç®¡æ˜¯ä¸­å¤®å¨æˆ¿ï¼ˆADKï¼‰è¿˜æ˜¯è‡ªåŠ©é¤å…ï¼ˆAgnoï¼‰ï¼Œéƒ½æ˜¯ä¸ºä½ å»ºå¥½çš„æˆ¿å­ã€‚è€Œ **LangChain/LangGraph å°±åƒæ˜¯"ä¹é«˜ç§¯æœ¨ç‹å›½"** â€”â€” ç»™ä½ ä¸€åœ°é›¶ä»¶ï¼ˆå·¥å…·ï¼‰ï¼Œæƒ³ç›–æ‘©å¤©å¤§æ¥¼è¿˜æ˜¯éœæ¯”ç‰¹äººå°å±‹ï¼Œå…¨çœ‹ä½ çš„æƒ³è±¡åŠ›ã€‚

LangChain å®˜æ–¹æ€»ç»“äº†å››å¤§"ç§¯æœ¨æ­å»º"ç­–ç•¥ï¼š

```mermaid
graph TD
    CE[Context Engineering] --> W["Writing<br>å¤–éƒ¨è®°äº‹(å¤–éƒ¨å­˜å‚¨)"]
    CE --> S["Selecting<br>æŒ‰éœ€ç¿»æ‰¾(åŠ¨æ€æ£€ç´¢)"]
    CE --> C["Compressing<br>æ‰“åŒ…å‹ç¼©(å‹ç¼©æ‘˜è¦)"]
    CE --> I["Isolating<br>åˆ†å·¥éš”ç¦»(ä¸Šä¸‹æ–‡éš”ç¦»)"]

    W --> W1["Scratchpad<br>è‰ç¨¿æœ¬(ä¸´æ—¶å­˜å‚¨)"]
    W --> W2["LangGraph State<br>å­˜æ¡£ç‚¹(å›¾çŠ¶æ€æŒä¹…åŒ–)"]

    S --> S1["Vector Search<br>ç›¸ä¼¼ç§¯æœ¨(å‘é‡æ£€ç´¢)"]
    S --> S2["Just-in-Time RAG<br>ç¼ºå•¥æ‰¾å•¥(å®æ—¶ RAG)"]

    C --> C1["Summarization<br>å†™æ¸¸è®°(å¯¹è¯æ‘˜è¦)"]
    C --> C2["Token Pruning<br>æ‰”æ‰åºŸæ–™(Token ä¿®å‰ª)"]

    I --> I1["Sub-Agent<br>å„ç®¡ä¸€æ‘Š(å­ Agent)"]
    I --> I2["Subgraph<br>ç‹¬ç«‹æˆ¿é—´(å­å›¾)"]
```

#### 3.3.1 Memory æœºåˆ¶ï¼ˆæ¸¸æˆå­˜æ¡£ï¼‰

å¯ä»¥å°† **Memory æœºåˆ¶** å½¢è±¡åœ°ç±»æ¯”ä¸º **æ¸¸æˆè¿›åº¦å­˜æ¡£**ã€‚åœ¨å†’é™©æ¸¸æˆä¸­ï¼ŒLangGraph æä¾›äº†ä¸¤å¥—ä¸åŒç»´åº¦çš„"å­˜æ¡£"æœºåˆ¶ï¼ˆæŒä¹…åŒ–æœºåˆ¶ï¼‰ <sup>[[11]](#ref11)[[12]](#ref12)</sup>ï¼š

| ç±»å‹                  | æœºåˆ¶             | èŒƒå›´      | ç”¨é€”/ç±»æ¯”                                                                                                                             |
| :-------------------- | :--------------- | :-------- | :------------------------------------------------------------------------------------------------------------------------------------ |
| **Short-term Memory** | **Checkpointer** | Thread å†… | å¯¹è¯å†å²ã€çŠ¶æ€å¿«ç…§ã€‚<br/>**æ¸¸æˆå­˜æ¡£ç‚¹ (Save Point)**ï¼šéšæ—¶å¯ä»¥å›æ¡£é‡ç©ï¼ˆTime Travelï¼‰ï¼Œè®°å½•æ¯ä¸€å…³çš„çŠ¶æ€ï¼Œå…³æœºï¼ˆä¼šè¯ç»“æŸï¼‰å¯èƒ½å°±æ²¡äº†ã€‚ |
| **Long-term Memory**  | **Store**        | è·¨ Thread | ç”¨æˆ·åå¥½ã€å­¦ä¹ åˆ°çš„çŸ¥è¯†ã€‚<br/>**å…¨æˆå°±å¥–æ¯åº“ (Global Trophy Room)**ï¼šä¸ç®¡å¼€å‡ ä¸ªæ–°å­˜æ¡£ï¼Œä½ è§£é”çš„æˆå°±å’Œæ”¶é›†çš„å›¾é‰´éƒ½åœ¨ã€‚                  |

LangGraph è¿˜æä¾›äº†å„ç§ä¸åŒæ¬¾å¼çš„ **"å†’é™©èƒŒåŒ…"ï¼ˆMemory Typesï¼‰**ï¼š

| Memory ç±»å‹                         | æè¿°                                                                                 | é€‚ç”¨åœºæ™¯             |
| :---------------------------------- | :----------------------------------------------------------------------------------- | :------------------- |
| **ConversationBufferMemory**        | å­˜å‚¨å®Œæ•´å¯¹è¯å†å²<br/>**æ— é™æ¬¡å…ƒè¢‹**ï¼šå•¥éƒ½å¾€é‡Œå¡ï¼Œä¸ç®¡å¤šé‡ã€‚                          | çŸ­é€”æ—…è¡Œï¼ˆçŸ­å¯¹è¯ï¼‰   |
| **ConversationBufferWindowMemory**  | æ»‘åŠ¨çª—å£ï¼Œä»…ä¿ç•™æœ€è¿‘ K æ¡<br/>**é™å®šå®¹é‡åŒ…**ï¼šæ–°ä¸œè¥¿è¿›æ¥ï¼Œæ—§ä¸œè¥¿æŒ¤å‡ºå»ã€‚             | è½»è£…ä¸Šé˜µï¼ˆä¸­ç­‰å¯¹è¯ï¼‰ |
| **ConversationSummaryMemory**       | æ‘˜è¦å†å²å¯¹è¯<br/>**æ¢é™©æ—¥è®°æœ¬**ï¼šä¸œè¥¿éƒ½æ‰”äº†ï¼Œåªè®°å‘ç”Ÿäº†ä»€ä¹ˆã€‚                        | é•¿ç¯‡å²è¯—ï¼ˆé•¿å¯¹è¯ï¼‰   |
| **ConversationSummaryBufferMemory** | æ··åˆï¼šæ‘˜è¦æ—§å¯¹è¯ + å®Œæ•´ä¿ç•™è¿‘æœŸ<br/>**æ··åˆæˆ˜æœ¯åŒ…**ï¼šè¿‘æœŸç‰©å“éšèº«å¸¦ï¼Œæ—©æœŸç»å†å†™æ—¥è®°ã€‚ | å¹³è¡¡å‹ï¼ˆæœ€ä½³å®è·µï¼‰   |
| **VectorStoreRetrieverMemory**      | å‘é‡å­˜å‚¨ï¼ŒåŸºäºç›¸ä¼¼åº¦æ£€ç´¢<br/>**é­”æ³•å¬å”¤é˜µ**ï¼šå¿ƒå¿µä¸€åŠ¨ï¼Œç›¸å…³ç‰©å“è‡ªåŠ¨é£æ¥ã€‚            | è·¨è¶Šæ—¶ç©ºçš„è®°å¿†       |

```python
# LangGraph æ¸¸æˆå­˜æ¡£ç‚¹ (Checkpointer)
from langgraph.checkpoint.memory import InMemorySaver
from langgraph.checkpoint.postgres import PostgresSaver

# [è¯•ç©ç‰ˆå­˜æ¡£] - å†…å­˜
checkpointer = InMemorySaver()

# [æ­£å¼ç‰ˆäº‘å­˜æ¡£] - æ•°æ®åº“
checkpointer = PostgresSaver(conn)

# ç¼–è¯‘æ¸¸æˆå¼•æ“
graph = builder.compile(checkpointer=checkpointer)

# [è‡ªåŠ¨å­˜æ¡£/è¯»æ¡£æœºåˆ¶]
# åªè¦é…ç½®äº† thread_idï¼ŒLangGraph å°±ä¼šå¼€å¯"RPG æ¨¡å¼"ï¼š
# 1. Load (è¯»æ¡£): è‡ªåŠ¨è¯»å–è¯¥ thread_id çš„å†å²çŠ¶æ€
# 2. Auto-Save (è‡ªåŠ¨å­˜æ¡£): æ¯æ¬¡èŠ‚ç‚¹(Node)æ‰§è¡Œå®Œï¼Œè‡ªåŠ¨ä¿å­˜æœ€æ–°çŠ¶æ€
config = {"configurable": {"thread_id": "save-file-001"}}
graph.invoke(input_data, config)
```

```python
# LangGraph æˆå°±/è—å®åº“ (Store)
from langgraph.store.memory import InMemoryStore
from langgraph_checkpoint_postgres import PostgresStore

store = InMemoryStore()

# æ¸¸æˆå¼•æ“ç”±åŒæ ¸é©±åŠ¨ï¼šå­˜æ¡£ç‚¹ + è—å®åº“
graph = builder.compile(checkpointer=checkpointer, store=store)

# åœ¨å…³å¡(Node)ä¸­å­˜å–å®ç‰©
def my_node(state, config, *, store):
    user_id = config["configurable"]["user_id"]
    namespace = (user_id, "memories")

    # è·å¾—æˆå°±ï¼šå–œæ¬¢æŠ«è¨
    store.put(namespace, "preference", {"food": "pizza"})

    # æŸ¥æ”»ç•¥ï¼šæˆ‘å–œæ¬¢å•¥ï¼Ÿ
    memories = store.search(namespace, query="what do I like?")
```

#### 3.3.2 Context Engineeringï¼ˆå†’é™©å·¥å…·ç®±ï¼‰

æœ‰äº†å­˜æ¡£æœºåˆ¶ï¼ŒLangGraph è¿˜æä¾›äº†ä¸€å¥— **"å†’é™©å·¥å…·ç®±"** æ¥å¤„ç†ä¸Šä¸‹æ–‡çš„æµè½¬ï¼š

1. **Context Collectionï¼ˆæˆ˜å‰ç‚¹éªŒï¼‰**

   åœ¨æ‰§è¡Œä»»åŠ¡ï¼ˆNodeï¼‰å‰ï¼ŒAgent éœ€è¦ç¡®è®¤èº«ä¸Šçš„æ‰€æœ‰è£…å¤‡ï¼š

   - **State (èƒŒåŒ…)**ï¼šå½“å‰çš„è¡€é‡ã€é“å…·ï¼ˆå¯¹è¯å†å²ï¼‰ã€‚
   - **Config (èº«ä»½è¯)**ï¼šæˆ‘æ˜¯è°ï¼ˆUser IDï¼‰ï¼Œæˆ‘åœ¨å“ªä¸ªå­˜æ¡£ï¼ˆThread IDï¼‰ã€‚
   - **Store (æˆå°±åº“)**ï¼šæˆ‘ä»¥å‰å­¦è¿‡ä»€ä¹ˆæŠ€èƒ½ï¼ˆé•¿æœŸè®°å¿†ï¼‰ã€‚

   ```python
   # LangGraph "æˆ˜å‰ç‚¹éªŒ" ç¤ºä¾‹
   from langgraph.graph import StateGraph, MessagesState

   def my_node(state: MessagesState, config, *, store):
       # 1. æŸ¥èƒŒåŒ… (State): è·å–æ¶ˆæ¯å†å²
       messages = state["messages"]

       # 2. æŸ¥èº«ä»½è¯ (Config): è·å–ç”¨æˆ·ä¸å­˜æ¡£æ ‡è¯†
       user_id = config["configurable"]["user_id"]
       thread_id = config["configurable"]["thread_id"]

       # 3. æŸ¥æˆå°±åº“ (Store): æ£€ç´¢é•¿æœŸè®°å¿†
       namespace = (user_id, "memories")
       memories = store.search(namespace, query=messages[-1].content)

       return {"messages": [...]}
   ```

2. **Context Compressionï¼ˆæ•´ç†èƒŒåŒ…ï¼‰**

   å†’é™©è€…çš„èƒŒåŒ…å®¹é‡ï¼ˆContext Windowï¼‰æ˜¯æœ‰é™çš„ã€‚å½“æˆ˜åˆ©å“å¤ªå¤šæ—¶ï¼Œå¿…é¡»è¿›è¡Œ **"è´Ÿé‡ç®¡ç†"** â€”â€”ä¸¢å¼ƒä½ä»·å€¼çš„ç ´çŸ³å¤´ï¼ˆè€æ—§æ¶ˆæ¯ï¼‰ï¼Œåªä¿ç•™æ ¸å¿ƒé“å…·ã€‚

   ```python
   # LangGraph æ¶ˆæ¯ä¿®å‰ª (æ•´ç†èƒŒåŒ…)
   from langchain_core.messages import trim_messages

   # è®¾å®šèƒŒåŒ…æœ€å¤§è´Ÿé‡ (Token Limit)
   trimmer = trim_messages(
       max_tokens=1000,
       strategy="last",  # ä¿ç•™æœ€æ–°è·å¾—çš„é“å…·
       token_counter=len,
   )

   # åœ¨èŠ‚ç‚¹ä¸­ä½¿ç”¨
   def agent_node(state):
       # è‡ªåŠ¨ä¸¢å¼ƒè¶…é‡çš„æ—§ç‰©å“
       messages = trimmer.invoke(state["messages"])
       response = llm.invoke(messages)
       return {"messages": [response]}
   ```

3. **Context Isolationï¼ˆç‹¬ç«‹å‰¯æœ¬ï¼‰**

   å½“ä¸»çº¿ä»»åŠ¡å¤ªå¤æ‚æ—¶ï¼Œå¯ä»¥å¼€å¯ä¸€ä¸ª **"ç‹¬ç«‹å‰¯æœ¬"ï¼ˆSubgraphï¼‰**ã€‚åœ¨å‰¯æœ¬é‡Œï¼Œæœ‰ç‹¬ç«‹çš„åœ°å›¾å’ŒçŠ¶æ€æ ã€‚æ‰“é€šå‰¯æœ¬åï¼ŒåªæŠŠ"æ‰è½å¥–åŠ±"ï¼ˆæœ€ç»ˆç»“æœï¼‰å¸¦å›ä¸»ä¸–ç•Œï¼Œé¿å…ä¸»åœ°å›¾å˜å¾—æ··ä¹±ã€‚

   ```python
   # LangGraph å‰¯æœ¬æŒ‘æˆ˜ (Subgraph)
   from langgraph.graph import StateGraph

   # [å‰¯æœ¬] ç‹¬ç«‹çš„ç§‘ç ”ä»»åŠ¡ï¼Œæœ‰ç‹¬ç«‹çš„çŠ¶æ€
   def create_research_subgraph():
       builder = StateGraph(ResearchState)
       builder.add_node("search", search_node)
       builder.add_node("analyze", analyze_node)
       return builder.compile()

   # [ä¸»ä¸–ç•Œ]
   main_builder = StateGraph(MainState)
   # ç©å®¶è¿›å…¥å‰¯æœ¬
   main_builder.add_node("research", create_research_subgraph())
   main_builder.add_node("respond", respond_node)
   ```

### 3.4 æ ¸å¿ƒæ¦‚å¿µæ˜ å°„

| æ¦‚å¿µ           | Google ADK<sup>[[3]](#ref3)</sup> | Agno<sup>[[7]](#ref7)</sup>   | LangGraph<sup>[[11]](#ref11)</sup> / LangGraph<sup>[[12]](#ref12)</sup> |
| :------------- | :-------------------------------- | :---------------------------- | :---------------------------------------------------------------------- |
| **ä¼šè¯å®¹å™¨**   | Session                           | Session (session_id)          | Thread (checkpointer)                                                   |
| **ä¸´æ—¶çŠ¶æ€**   | session.state                     | session_state                 | State (graph state)                                                     |
| **å¯¹è¯å†å²**   | session.events                    | chat_history                  | messages                                                                |
| **é•¿æœŸè®°å¿†**   | MemoryService                     | Memory (enable_user_memories) | Long-term Memory Store                                                  |
| **çŸ¥è¯†åº“/RAG** | (éœ€è‡ªè¡Œå®ç°)                      | Knowledge                     | VectorStore / Retriever                                                 |
| **ä¸Šä¸‹æ–‡ç¼“å­˜** | ContextCacheConfig                | ä¾èµ– LLM Provider             | ä¾èµ– LLM Provider                                                       |
| **ä¸Šä¸‹æ–‡å‹ç¼©** | EventsCompactionConfig            | session_summary               | trim_messages / summarize                                               |
| **æŒä¹…åŒ–**     | SessionService                    | Database                      | Checkpointer                                                            |

### 3.5 æ¡†æ¶æ¨ªè¯„

| æ¡†æ¶           | ä¼˜åŠ¿                                                                                                                        | åŠ£åŠ¿                                              |
| :------------- | :-------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------ |
| **Google ADK** | âœ… æ¸…æ™°çš„ Service æŠ½è±¡ï¼ˆSessionService, MemoryServiceï¼‰<br>âœ… ä¸ Vertex AI æ·±åº¦é›†æˆ<br>âœ… å¤šè¯­è¨€æ”¯æŒ (Python, Go, Java, TS) | âŒ MemoryBank å¼ºä¾èµ– Vertex AI<br>âŒ ç¤¾åŒºç”Ÿæ€è¾ƒæ–° |
| **Agno**       | âœ… å¼€å‘ä½“éªŒæä½³ï¼ˆé…ç½®é©±åŠ¨ï¼‰<br>âœ… Memory å¼€ç®±å³ç”¨<br>âœ… Team/Workflow å¤š Agent æ”¯æŒ                                         | âŒ ç›¸å¯¹å°é—­çš„ç”Ÿæ€<br>âŒ æ–‡æ¡£æ·±åº¦æœ‰é™              |
| **LangChain**  | âœ… æœ€æˆç†Ÿçš„ç”Ÿæ€ç³»ç»Ÿ<br>âœ… ä¸°å¯Œçš„ Memory ç±»å‹<br>âœ… ä¸å„ç§ Vector DB é›†æˆ                                                    | âŒ æŠ½è±¡å±‚å¤šï¼Œå­¦ä¹ æ›²çº¿é™¡<br>âŒ Memory ç¢ç‰‡åŒ–       |
| **LangGraph**  | âœ… çŠ¶æ€ç®¡ç†ä¼˜ç§€ï¼ˆcheckpointerï¼‰<br>âœ… å¤æ‚å·¥ä½œæµæ”¯æŒ<br>âœ… Context Engineering ç­–ç•¥å®Œå¤‡<br>âœ… ç¤¾åŒºæ´»è·ƒ                      | âŒ é…ç½®å¤æ‚åº¦é«˜<br>âŒ è°ƒè¯•å›°éš¾                    |

### 3.6 é€‰å‹è·¯å¾„

```mermaid
graph LR
    Q1{Google Cloud é›†æˆ?}
    Q2{å¤æ‚å·¥ä½œæµ?}
    Q3{å¿«é€Ÿå¼€å‘?}

    Q1 -->|æ˜¯| ADK["Google ADK"]
    Q1 -->|å¦| Q2

    Q2 -->|æ˜¯| LG["LangGraph"]
    Q2 -->|å¦| Q3

    Q3 -->|æ˜¯| AGNO["Agno"]
    Q3 -->|å¦| CUSTOM["è‡ªå®šä¹‰å®ç°"]

    style ADK fill:#4285f4,stroke:#1a73e8,color:#fff
    style LG fill:#ff6b35,stroke:#e85a2e,color:#fff
    style AGNO fill:#10b981,stroke:#059669,color:#fff
    style CUSTOM fill:#6366f1,stroke:#4f46e5,color:#fff
```

## References

<a id="ref1"></a>[1] SII-GAIR, "Context Engineering 2.0: The Context of Context Engineering," _SII-GAIR Technical Report_, 2025.

<a id="ref2"></a>[2] A. K. Dey, "Understanding and Using Context," _Pers. Ubiquitous Comput._, vol. 5, no. 1, pp. 4â€“7, 2001.

<a id="ref3"></a>[3] Google, "Google ADK - Context," 2024. [Online]. Available: https://google.github.io/adk-docs/context/

<a id="ref4"></a>[4] Google, "Google ADK - Sessions, State, Memory Overview," 2024. [Online]. Available: https://google.github.io/adk-docs/sessions/

<a id="ref5"></a>[5] Google, "Google ADK - State," 2024. [Online]. Available: https://google.github.io/adk-docs/sessions/state/

<a id="ref6"></a>[6] Google, "Google ADK - Memory," 2024. [Online]. Available: https://google.github.io/adk-docs/sessions/memory/

<a id="ref7"></a>[7] Agno, "Agno - Context Engineering," 2024. [Online]. Available: https://docs.agno.com/basics/context/overview

<a id="ref8"></a>[8] Agno, "Agno - Memory," 2024. [Online]. Available: https://docs.agno.com/basics/memory/overview

<a id="ref9"></a>[9] Agno, "Agno - Knowledge," 2024. [Online]. Available: https://docs.agno.com/basics/knowledge/overview

<a id="ref10"></a>[10] Agno, "Agno - Sessions," 2024. [Online]. Available: https://docs.agno.com/basics/sessions

<a id="ref11"></a>[11] LangChain, "LangChain - Context Engineering," 2024. [Online]. Available: https://docs.langchain.com/oss/python/langchain/context-engineering

<a id="ref12"></a>[12] LangChain, "LangGraph - Memory," 2024. [Online]. Available: https://docs.langchain.com/oss/python/langgraph/add-memory
