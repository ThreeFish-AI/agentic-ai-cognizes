---
id: vector-databases
sidebar_position: 5
title: å‘é‡æ•°æ®åº“æ·±åº¦è°ƒç ”
last_update:
  author: Aurelius Huang
  created_at: 2025-12-23
  updated_at: 2026-01-01
  version: 1.2
  status: Reviewed
tags:
  - Vector Databases
  - PGVector
  - VectorChord
  - Milvus
  - Weaviate
  - Pinecone
  - Spanner
---

> [!IMPORTANT]
>
> åœ¨å‰ç½®è°ƒç ”ä¸­ï¼Œæˆ‘ä»¬å·²ç»å¯¹ä¸»æµ **ANN å‘é‡ç´¢å¼•ç®—æ³•**ï¼ˆHNSW / IVF / PQ / DiskANN ç­‰ï¼‰å»ºç«‹äº†æ¯”è¾ƒå®Œæ•´çš„è®¤è¯†ï¼Œå¹¶å¯¹å¸‚åœºä¸Šä¸»æµå‘é‡æ•°æ®åº“åšè¿‡ä¸€æ¬¡â€œä»å…¨æ™¯åˆ°åˆ†å±‚â€çš„å®è§‚æ¢³ç†ã€‚æ¥ä¸‹æ¥éœ€è¦å›ç­”çš„é—®é¢˜ï¼Œä¼šä»â€œå‘é‡æ£€ç´¢ä¸ºä»€ä¹ˆèƒ½è·‘ã€æ€ä¹ˆè·‘å¾—å¿«â€ï¼Œæ”¶æŸåˆ°â€œåœ¨æˆ‘çš„çœŸå®ä¸šåŠ¡é‡Œï¼Œé€‰å“ªä¸€ä¸ªèƒ½é•¿æœŸè·‘å¾—ç¨³ã€è¿­ä»£æˆæœ¬æœ€ä½â€ã€‚
>
> å› æ­¤ï¼Œæœ¬æ–‡ä¼šæŠŠè°ƒç ”èŒƒå›´è¿›ä¸€æ­¥èšç„¦åˆ° 6 ä¸ªæœ€å…·ä»£è¡¨æ€§çš„å€™é€‰ï¼š**Milvusã€Weaviateã€Pineconeã€PGVectorã€VectorChordã€Google Cloud Spanner**ï¼Œå¹¶ä»æ¶æ„å½¢æ€ã€èƒ½åŠ›è¾¹ç•Œã€å·¥ç¨‹è½åœ°å’Œ TCO æ§åˆ¶å››ä¸ªç»´åº¦åšæ›´æ·±å…¥çš„å¯¹æ¯”ã€‚
>
> | ç±»å‹                            | äº§å“        | æ ¸å¿ƒç‰¹ç‚¹                             |
> | ------------------------------- | ----------- | ------------------------------------ |
> | **PostgreSQL Extension**        | PGVector    | å®˜æ–¹æ‰©å±•ï¼Œä¸ç°æœ‰ PostgreSQL å®Œç¾é›†æˆ |
> |                                 | VectorChord | é«˜æ€§èƒ½æ‰©å±•ï¼Œçªç ´ PGVector æ€§èƒ½ç“¶é¢ˆ   |
> | **Specialized Vector DataBase** | Milvus      | å¼€æºåˆ†å¸ƒå¼ï¼Œæ”¯æŒç™¾äº¿çº§å‘é‡           |
> |                                 | Weaviate    | AI-Nativeï¼Œå†…ç½®å‘é‡åŒ–æ¨¡å—            |
> |                                 | Pinecone    | å…¨æ‰˜ç®¡ SaaSï¼Œé›¶è¿ç»´                  |
> | **Multi-Model Cloud Database**  | Spanner     | å…¨çƒåˆ†å¸ƒå¼ + ACID + å‘é‡ + Graph     |

---

## 1. PostgreSQL + PGVector

### 1.1 äº§å“æ¦‚è¿°

**æ ¸å¿ƒå®šä½**ï¼š**PostgreSQL ç”¨æˆ·çš„é¦–é€‰â€œé›¶è¿ç§»â€æ–¹æ¡ˆï¼Œç”¨æ¶æ„çš„ç»Ÿä¸€æ€§æ¢å–ç»å¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯ä¸‹çš„â€œå¤Ÿç”¨â€æ€§èƒ½ã€‚**

ä½œä¸ºâ€œæ”¹è‰¯æ´¾â€å‘é‡æ•°æ®åº“çš„æ ‡æ†ï¼ŒPGVector èµ°äº†ä¸€æ¡ä¸å…¶ä»–ç«å“æˆªç„¶ä¸åŒçš„**åŸç”Ÿèåˆ**è·¯çº¿ã€‚å¦‚æœå°†ç‹¬ç«‹å‘é‡æ•°æ®åº“ï¼ˆå¦‚ Milvusï¼‰æ¯”ä½œ**ä¸“ä¸ºèµ›é“æ‰“é€ çš„ F1 èµ›è½¦**ï¼Œé‚£ä¹ˆ PGVector å°±åƒæ˜¯**ä¸ºä½ ç°æœ‰çš„å®¶ç”¨ SUV åŠ è£…äº†ä¸€å¥—é«˜æ€§èƒ½å¯¼èˆªç³»ç»Ÿ**ã€‚

- **F1 èµ›è½¦ï¼ˆç‹¬ç«‹åº“ï¼‰**ï¼šä¸ºäº†æè‡´çš„æ£€ç´¢é€Ÿåº¦å’Œè§„æ¨¡è€Œç”Ÿï¼Œä½†ä½ éœ€è¦ä»˜å‡ºæ˜‚è´µçš„â€œèµ›é“ç»´æŠ¤è´¹â€ï¼ˆç‹¬ç«‹çš„è¿ç»´æˆæœ¬ä¸åŸºç¡€è®¾æ–½ï¼‰ã€‚
- **SUV å‡çº§ï¼ˆPGVectorï¼‰**ï¼šå®ƒä¾ç„¶æ˜¯ä½ é‚£è¾†çš®å®è€ç”¨ã€é€šè¿‡æ€§æå¥½çš„åº§é©¾ï¼ˆACID äº‹åŠ¡ã€å¤æ‚æŸ¥è¯¢ï¼Œä»¥åŠ PostgreSQL çš„æ‰€æœ‰ä¼ä¸šçº§ç‰¹æ€§ï¼‰ã€‚ä½ ä¸éœ€è¦æ¢è½¦ï¼ˆæ•°æ®è¿ç§»ï¼‰ï¼Œåªéœ€ä¸€æ¬¡ç®€å•çš„æ”¹è£…ï¼Œå®ƒå°±èƒ½å¸¦ä½ é©¶å‘â€œè¯­ä¹‰æ£€ç´¢â€çš„æ–°é¢†åŸŸã€‚

```mermaid
graph LR
    subgraph "PGVectorï¼šä¼ ç»Ÿæ•°æ®åº“çš„ AI è¿›åŒ–"
        direction LR
        A[PostgreSQL] --> B[ç»“æ„åŒ–æ•°æ®<br/>ï¼ˆACIDï¼‰]
        A --> C[+ PGVector æ‰©å±•]
        C --> D[å‘é‡æ£€ç´¢èƒ½åŠ›<br/>ï¼ˆHNSWã€IVFFlatï¼‰]
        B & D --> E[ç»Ÿä¸€ SQL æŸ¥è¯¢]

        style A fill:#336791,color:#fff
        style C fill:#e67e22,color:#fff
        style E fill:#27ae60,color:#fff
    end
```

### 1.2 æ ¸å¿ƒç‰¹æ€§

| ç‰¹æ€§          | æè¿°             | æŠ€æœ¯è§„æ ¼                                      |
| ------------- | ---------------- | --------------------------------------------- |
| **å‘é‡ç±»å‹**  | æ”¯æŒå¤šç§å‘é‡æ ¼å¼ | vector (FP32)ã€halfvec (FP16)ã€bitã€sparsevec |
| **æœ€å¤§ç»´åº¦**  | å•ç²¾åº¦å‘é‡       | 2,000 ç»´ï¼ˆHNSWï¼‰/ 16,000 ç»´ï¼ˆå­˜å‚¨ï¼‰           |
| **è·ç¦»å‡½æ•°**  | 6 ç§åº¦é‡æ–¹å¼     | L2ã€å†…ç§¯ã€ä½™å¼¦ã€L1ã€æ±‰æ˜ã€Jaccard             |
| **ç´¢å¼•ç±»å‹**  | è¿‘ä¼¼æœ€è¿‘é‚»       | HNSWã€IVFFlat                                 |
| **ACID æ”¯æŒ** | å®Œæ•´äº‹åŠ¡ä¿è¯     | âœ… æ”¯æŒ                                       |

### 1.3 å‘é‡æ•°æ®ç±»å‹

é€‰æ‹©å‘é‡ç²¾åº¦å°±åƒé€‰æ‹©**å›¾ç‰‡æ ¼å¼**ï¼š

- **vector (FP32)**ï¼š**RAW æ ¼å¼**ã€‚ç²¾åº¦æ— æŸï¼Œç»†èŠ‚æœ€å…¨ï¼Œä½†ä½“ç§¯æœ€å¤§ã€‚
- **halfvec (FP16)**ï¼š**é«˜æ¸… JPEG**ã€‚**æ¨èé¦–é€‰**ã€‚è‚‰çœ¼ï¼ˆæ¨¡å‹ï¼‰éš¾ä»¥åˆ†è¾¨å·®å¼‚ï¼Œä½†ç©ºé—´èŠ‚çœä¸€åŠï¼Œé€Ÿåº¦æ›´å¿«ã€‚
- **bit**ï¼š**é»‘ç™½ä½å›¾**ã€‚æè‡´å‹ç¼©ï¼Œä»…é€‚ç”¨äºç‰¹å®šäºŒå€¼åŒ–åœºæ™¯ã€‚
- **sparsevec**ï¼š**ç¨€ç–å‘é‡**ã€‚ä»…å­˜å‚¨éé›¶å…ƒç´ ï¼Œé€‚ç”¨äºç¨€ç–å‘é‡åœºæ™¯ã€‚

```sql
CREATE TABLE items (
    id bigserial PRIMARY KEY,
    -- æ¨èï¼šå¤§å¤šæ•° AI åœºæ™¯ä½¿ç”¨ halfvec å¹³è¡¡æ€§èƒ½ä¸æˆæœ¬
    embedding halfvec(1536)
);

-- æ’å…¥æ“ä½œï¼ˆPGVector ä¼šè‡ªåŠ¨å¤„ç†ç±»å‹è½¬æ¢ï¼‰
INSERT INTO items (embedding) VALUES ('[1.1, 2.2, 3.3, ...]');
```

### 1.4 è·ç¦»åº¦é‡

è®¡ç®—ç›¸ä¼¼åº¦ï¼Œå–å†³äºä½ æ‰‹é‡Œæ‹¿çš„æ˜¯å“ªæŠŠ**å°ºå­**ï¼š

- **Cosine (<=>)**ï¼š**æŒ‡å—é’ˆ**ã€‚åªçœ‹**æ–¹å‘**æ˜¯å¦ä¸€è‡´ï¼Œä¸çœ‹é•¿çŸ­ã€‚**è¯­ä¹‰æœç´¢ï¼ˆNLPï¼‰çš„æ ‡å‡†å°ºå­**ã€‚
- **L2 (<->)**ï¼š**ç›´å°º**ã€‚æµ‹é‡ä¸¤ç‚¹é—´çš„ç»å¯¹è·ç¦»ã€‚å¸¸ç”¨äºå›¾åƒæˆ–éŸ³é¢‘çš„ç‰©ç†ç‰¹å¾åŒ¹é…ã€‚
- **Inner Product (<#>)**ï¼š**æŠ•å½±ä»ª**ã€‚è®¡ç®—å‘é‡çš„æŠ•å½±å¼ºåº¦ã€‚åœ¨å‘é‡å½’ä¸€åŒ–åï¼Œå®ƒæ˜¯æœ€é«˜æ•ˆçš„æ›¿ä»£æ–¹æ¡ˆã€‚

| æ“ä½œç¬¦ | è·ç¦»ç±»å‹     | æ ¸å¿ƒåœºæ™¯       | å¤‡æ³¨             |
| :----- | :----------- | :------------- | :--------------- |
| `<=>`  | ä½™å¼¦è·ç¦»     | è¯­ä¹‰ç›¸ä¼¼åº¦     | æ¨èç”¨äºæ–‡æœ¬åµŒå…¥ |
| `<->`  | L2 æ¬§æ°è·ç¦»  | å›¾ç‰‡/éŸ³é¢‘æœç´¢  | ç‰©ç†ç‰¹å¾         |
| `<#>`  | è´Ÿå†…ç§¯       | é«˜æ€§èƒ½æ¨èç³»ç»Ÿ | éœ€å½’ä¸€åŒ–         |
| `<+>`  | L1 è·ç¦»      | æ›¼å“ˆé¡¿è·ç¦»     | ç‰¹å®šåœºæ™¯         |
| `<~>`  | æ±‰æ˜è·ç¦»     | äºŒè¿›åˆ¶å‘é‡     | bit ç±»å‹ä¸“ç”¨     |
| `<%>`  | Jaccard è·ç¦» | äºŒè¿›åˆ¶å‘é‡     | bit ç±»å‹ä¸“ç”¨     |

### 1.5 ç´¢å¼•ç®—æ³•

> [!TIP]
>
> ç´¢å¼•æ˜¯é¢å¯¹æµ·é‡æ•°æ®çš„**å¯¼èˆªç­–ç•¥**ï¼š
>
> - **HNSWï¼ˆHierarchical Navigable Small Worldï¼Œåˆ†å±‚å¯¼èˆªå°ä¸–ç•Œå›¾ï¼‰**ï¼š**ç«‹ä½“äº¤é€šç½‘**ï¼ˆGraphï¼‰ã€‚åˆ©ç”¨é«˜é€Ÿå…¬è·¯å’Œç«‹ä½“æ¢çº½å®ç°è·¨è¶Šå¼å¯»æ‰¾ã€‚**æ€§èƒ½æœ€å¼ºï¼ˆé¦–é€‰ï¼‰**ï¼Œä½†åƒä¿®è·¯ä¸€æ ·æˆæœ¬é«˜ï¼ˆæ„å»ºæ…¢ï¼‰ã€å åœ°å¤§ï¼ˆåƒå†…å­˜ï¼‰ã€‚
> - **IVFFlatï¼ˆInverted File with Flat Clusteringï¼Œå€’æ’æ–‡ä»¶ä¸å¹³é¢èšç±»ï¼‰**ï¼š**è¡Œæ”¿åŒºåˆ’å›¾**ï¼ˆClusterï¼‰ã€‚æŠŠåŸå¸‚åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªæ–¹æ ¼ï¼ˆèšç±»åˆ—è¡¨ï¼‰ï¼Œåªå»ç›®æ ‡æ‰€åœ¨çš„æ–¹æ ¼é‡Œæ‰¾ã€‚**ç®€å•çœåœ°ï¼ˆä¸ä»…çœå†…å­˜ï¼Œè¿˜èƒ½å¿«é€Ÿæ„å»ºï¼‰**ï¼Œä½†å‰ææ˜¯å¿…é¡»å…ˆæœ‰äººï¼ˆæ•°æ®ï¼‰æ‰èƒ½åˆ’åˆ†åŒºåŸŸã€‚
>
> ğŸ’¡ ç®—æ³•åº•å±‚åŸç†åŠæŠ€æœ¯ç»†èŠ‚è¯·å‚é˜… [003-vector-search-algorithm](./003-vector-search-algorithm.md)ã€‚

#### 1.5.1 HNSW ç´¢å¼•

HNSW æ˜¯ç›®å‰ç»¼åˆæ€§èƒ½æœ€å¥½çš„ç´¢å¼•ç®—æ³•ï¼Œå®ç°äº†**é€Ÿåº¦ä¸å¬å›ç‡çš„æœ€ä½³å¹³è¡¡**ã€‚

```sql
-- åˆ›å»º HNSW ç´¢å¼•
-- m: æ¯å±‚æœ€å¤§è¿æ¥æ•°ï¼ˆé»˜è®¤ 16ï¼Œå»ºè®® 16-64ï¼‰ï¼Œ"è·¯å£"çš„åˆ†å²”æ•°ã€‚åˆ†å²”è¶Šå¤šæœç´¢è¶Šå¿«ï¼Œä½†è·¯ä¹Ÿè¶Šå®½ï¼ˆå†…å­˜å ç”¨â†‘ï¼‰ã€‚
-- ef_construction: æ„å»ºæ—¶æœç´¢å®½åº¦ï¼ˆé»˜è®¤ 64ï¼Œå»ºè®® 100-200ï¼‰ã€‚å»ºè·¯æ—¶çš„æ¢ç´¢èŒƒå›´ã€‚èŒƒå›´è¶Šå¤§è·¯ç½‘è´¨é‡è¶Šå¥½ï¼Œä½†ä¿®è·¯è¶Šæ…¢ã€‚
CREATE INDEX ON items USING hnsw (embedding vector_cosine_ops)
WITH (m = 16, ef_construction = 64);

-- ef_search: æŸ¥è¯¢æ—¶æœç´¢å®½åº¦ï¼ˆé»˜è®¤ 40ï¼Œå»ºè®® 100-200ï¼‰ã€‚
SET hnsw.ef_search = 100;
```

#### 1.5.2 IVFFlat ç´¢å¼•

IVFFlat æ˜¯ä¸€ç§åŸºäºèšç±»çš„å€’æ’ç´¢å¼•ï¼Œæ„å»ºé€Ÿåº¦å¿«ï¼Œå†…å­˜å ç”¨ä½ï¼Œé€‚åˆ**å†…å­˜å—é™**çš„åœºæ™¯ï¼Œä½†æŸ¥è¯¢æ€§èƒ½ç¨é€Šäº HNSWã€‚

```sql
-- åˆ›å»º IVFFlat ç´¢å¼•
-- âš ï¸ å¿…é¡»è¡¨ä¸­å·²æœ‰æ•°æ®ï¼ˆå»ºè®® >10ä¸‡è¡Œï¼‰æ‰èƒ½è®¡ç®—èšç±»ä¸­å¿ƒ
-- lists: æŠŠæ•°æ®åˆ’åˆ†æˆå¤šå°‘ä¸ªâ€œæ ¼å­â€ã€‚rows < 1M: lists = rows / 1000ï¼›rows >= 1M: lists = sqrt(rows)ã€‚
CREATE INDEX ON items USING ivfflat (embedding vector_l2_ops)
WITH (lists = 100);

-- probes: æ¢é’ˆæ•°ï¼Œæ¯æ¬¡æŸ¥è¯¢è¦ç¿»æ‰¾æœ€è¿‘çš„å‡ ä¸ªâ€œæ ¼å­â€ï¼ˆæŸ¥è¯¢æ—¶ SET ivfflat.probesï¼‰ã€‚
SET ivfflat.probes = 10;  -- å»ºè®® sqrt(lists)
```

### 1.6 è¿‡æ»¤ä¸æ··åˆæŸ¥è¯¢ç­–ç•¥

ç°å®æŸ¥è¯¢å¾€å¾€å¸¦æœ‰æ¡ä»¶ï¼ˆ`WHERE`ï¼‰ã€‚è¿™å°±åƒåœ¨æ‰¾äººï¼ˆç›¸ä¼¼åº¦ï¼‰çš„åŒæ—¶ï¼Œè¦æ±‚ä»–å¿…é¡»ç©¿çº¢è¡£æœï¼ˆè¿‡æ»¤ï¼‰ï¼š

- **å…ˆç­›é€‰ï¼ˆåˆ—ç´¢å¼•ï¼‰**ï¼š**æŒ‰åå•ç‚¹å**ã€‚å¦‚æœç©¿çº¢è¡£æœçš„äººæå°‘ï¼Œç›´æ¥æŠŠä»–ä»¬å«å‡ºæ¥é€ä¸ªæ¯”å¯¹é•¿ç›¸æœ€å¿«ã€‚
- **å…ˆæ£€ç´¢ï¼ˆå‘é‡ç´¢å¼•ï¼‰**ï¼š**å¹¿åœºæ‰«è§†**ã€‚å¦‚æœç©¿çº¢è¡£æœçš„äººæ»¡å¤§è¡—éƒ½æ˜¯ï¼Œç›´æ¥åœ¨å¹¿åœºä¸Šæ‰¾é•¿å¾—åƒçš„äººï¼Œå¤§æ¦‚ç‡ä»–æ­£å¥½ç©¿çº¢è¡£æœã€‚
- **ä¸“ç”¨åˆ†åŒºï¼ˆéƒ¨åˆ†ç´¢å¼•/åˆ†åŒºï¼‰**ï¼š**VIP åŒ…é—´**ã€‚å¦‚æœç»å¸¸åªåœ¨â€œçº¢è¡£ä¿±ä¹éƒ¨â€é‡Œæ‰¾äººï¼Œå¹²è„†æŠŠä»–ä»¬å•ç‹¬å…³åœ¨ä¸€ä¸ªæˆ¿é—´æœï¼Œäº’ä¸å¹²æ‰°ï¼Œæ•ˆç‡æœ€é«˜ã€‚

#### 1.6.1 ç­–ç•¥é€‰æ‹©æŒ‡å—

```sql
-- æ··åˆæŸ¥è¯¢ï¼šæ—¢è¦â€œé•¿å¾—åƒâ€ï¼Œåˆè¦â€œæ»¡è¶³æ¡ä»¶â€
SELECT * FROM items WHERE category_id = 123 ORDER BY embedding <-> '[3,1,2]' LIMIT 5;
```

| ç­–ç•¥              | é€‚ç”¨åœºæ™¯                             | å¯¹åº”é€»è¾‘           | å»ºè®®                                                                                                                                              |
| :---------------- | :----------------------------------- | :----------------- | :------------------------------------------------------------------------------------------------------------------------------------------------ |
| **åˆ—ç´¢å¼•ä¼˜å…ˆ**    | **å¼ºè¿‡æ»¤**ï¼ˆç¬¦åˆæ¡ä»¶çš„æ•°æ®**å¾ˆå°‘**ï¼‰ | ç²¾ç¡®æ‰¾ -> ç®—è·ç¦»   | å»ºç«‹æ™®é€š B-Tree ç´¢å¼•ã€‚<br/>`CREATE INDEX ON items (category_id)`                                                                                  |
| **å‘é‡ç´¢å¼•ä¼˜å…ˆ**  | **å¼±è¿‡æ»¤**ï¼ˆç¬¦åˆæ¡ä»¶çš„æ•°æ®**å¾ˆå¤š**ï¼‰ | è¿‘ä¼¼æœ -> å‰”é™¤ä¸ç¬¦ | é€‚å½“å¢å¤§ `ef_search` é˜²æ­¢æœä¸åˆ°                                                                                                                   |
| **éƒ¨åˆ†/åˆ†åŒºç´¢å¼•** | **å›ºå®šé«˜é¢‘**ï¼ˆç‰¹å®šä¸šåŠ¡åŸŸï¼‰           | åœ¨å­é›†ä¸­æœ HNSW    | æ€§èƒ½æœ€ä½³ï¼Œé€‚åˆå¤šç§Ÿæˆ·/ç±»åˆ«å›ºå®šçš„åœºæ™¯ã€‚<br/>`CREATE INDEX ON items USING hnsw (...) WHERE (category_id = 123)`<br/>`PARTITION BY LIST(category_id)` |

#### 1.6.2 è¿­ä»£ç´¢å¼•æ‰«æ (v0.8.0+)

è¿™æ˜¯ä¸ºäº†è§£å†³â€œå…ˆæ£€ç´¢åè¿‡æ»¤â€å¯èƒ½å¯¼è‡´ç»“æœä¸è¶³çš„é—®é¢˜ã€‚å°±åƒ **HR æ‹›è˜**ï¼š

- **æ™®é€šæ¨¡å¼**ï¼šä½ è¦æ±‚â€œæ‹› 5 ä¸ªæ‡‚ Rust çš„ä¸“å®¶ï¼ˆFilterï¼‰â€ã€‚çŒå¤´æŒ‰æŠ€æœ¯æ’åæ‰¾æ¥å‰ 5 åå¤§ç‰›ï¼ˆVectorï¼‰ï¼Œç»“æœå‘ç°åªæœ‰ 1 ä¸ªäººæ‡‚ Rustã€‚äºæ˜¯åªç»™ä½  1 ä»½ç®€å†ï¼Œä»»åŠ¡ç»“æŸã€‚
- **è¿­ä»£æ‰«æ**ï¼šçŒå¤´å‘ç°å‰ 5 åé‡Œåªæœ‰ 1 ä¸ªç¬¦åˆï¼Œäºæ˜¯è‡ªåŠ¨ç»§ç»­å¾€ä¸‹ç¿»ç¬¬ 6-10 åã€ç¬¬ 11-20 å... ç›´åˆ°å‡‘é½ 5 ä¸ªæ‡‚ Rust çš„ä¸“å®¶ç»™ä½ ã€‚

```sql
-- å®½æ¾é¡ºåºï¼ˆRelaxed Orderï¼‰ï¼šä¸ºäº†å‡‘é½äººæ•°ï¼Œå…è®¸ç¨å¾®ç‰ºç‰²ä¸€ç‚¹æ’åºçš„ä¸¥æ ¼æ€§ï¼ˆæ€§èƒ½æ›´å¥½ï¼‰
SET hnsw.iterative_scan = relaxed_order;

-- ä¸¥æ ¼é¡ºåºï¼ˆStrict Orderï¼‰ï¼šå¿…é¡»ä¸¥æ ¼æŒ‰è·ç¦»æ’åºï¼Œå“ªæ€•è¦æ‰«ææ›´å¤šæ•°æ®
SET hnsw.iterative_scan = strict_order;
-- SET ivfflat.iterative_scan = relaxed_order;  -- IVFFlat ç´¢å¼•çš„è¿­ä»£æ‰«ææ¨¡å¼

-- ä½¿ç”¨ç‰©åŒ– CTE åœ¨å®½æ¾é¡ºåºä¸‹è·å–é«˜é¢‘æŸ¥è¯¢çš„ä¸¥æ ¼æ’åº
WITH relaxed_results AS MATERIALIZED (
    SELECT id, embedding <-> '[1,2,3]' AS distance
    FROM items WHERE category_id = 123
    ORDER BY distance LIMIT 5
) SELECT * FROM relaxed_results ORDER BY distance + 0;  -- +0 for PG17+
```

**è¿­ä»£æ‰«æå‚æ•°**ï¼š

| å‚æ•°                   | æè¿°                   | é»˜è®¤å€¼ |
| ---------------------- | ---------------------- | ------ |
| `hnsw.max_scan_tuples` | HNSW æœ€å¤§æ‰«æå…ƒç»„æ•°    | 20000  |
| `ivfflat.max_probes`   | IVFFlat æœ€å¤§æ¢æµ‹åˆ—è¡¨æ•° | å…¨éƒ¨   |

#### 1.6.3 æ··åˆæœç´¢ï¼ˆå‘é‡ + å…¨æ–‡ï¼‰

è¿™æ˜¯ "Just use PostgreSQL" çš„é‡è¦åŸå› ï¼Œæ¯”å¦‚ **åˆ‘ä¾¦ç ´æ¡ˆ**ï¼š

- **å‘é‡æœç´¢**ï¼šæ‹¿ç€**å«Œç–‘äººç´ æ**æ‰¾é•¿å¾—åƒçš„äººï¼ˆæ¨¡ç³Šè¯­ä¹‰ï¼‰ã€‚
- **å…¨æ–‡æœç´¢**ï¼šæŸ¥**è½¦ç‰Œå·**åŒ…å« "888" çš„è®°å½•ï¼ˆç²¾ç¡®å…³é”®è¯ï¼‰ã€‚
- **æ··åˆå¨åŠ›**ï¼šåœ¨åŒä¸€ä¸ª SQL é‡Œï¼Œæ—¢æŸ¥â€œé•¿å¾—åƒç´ æâ€åˆæŸ¥â€œè½¦ç‰Œå¯¹å¾—ä¸Šâ€çš„äººï¼Œæ— éœ€æ‹¼æ¥ä¸¤ä¸ªç³»ç»Ÿçš„ç»“æœã€‚

```sql
-- æ··åˆæœæŸ¥ä»¤ï¼šç»“åˆâ€œè½¦ç‰Œå·â€ä¸â€œç´ æç”»â€
SELECT id, content,
    -- ç»¼åˆå«Œç–‘æŒ‡æ•° = è½¦ç‰ŒåŒ¹é…åº¦(30%) + é•¿ç›¸ç›¸ä¼¼åº¦(70%)
    ts_rank(to_tsvector('english', content), query) * 0.3  -- [è½¦ç‰Œ] å…³é”®è¯åŒ¹é…å¾—åˆ†
    + (1 - (embedding <=> '[...]')) * 0.7                  -- [ç´ æ] å‘é‡ç›¸ä¼¼åº¦å¾—åˆ†
    AS final_score
FROM items, plainto_tsquery('english', 'machine learning') query
WHERE to_tsvector('english', content) @@ query  -- [åˆç­›] å¿…é¡»åŒ…å«å…³é”®çº¿ç´¢
ORDER BY final_score DESC
LIMIT 10;
```

### 1.7 æ€§èƒ½è°ƒä¼˜

è¦æƒ³æ•°æ®åº“è·‘å¾—å¿«ï¼Œé™¤äº†å¼•æ“å¥½ï¼Œè¿˜å¾—ä¼š**ä¿å…»å’Œé©¾é©¶**ï¼š

- **æ•°æ®å¯¼å…¥**ï¼šåƒ**æ¬å®¶**ã€‚å…ˆæŠŠä¸œè¥¿å…¨æ¬è¿›å±‹ï¼ˆCOPYï¼‰ï¼Œæœ€åå†æ…¢æ…¢æ•´ç†å½’ä½ï¼ˆå»ºç´¢å¼•ï¼‰ã€‚è¾¹æ¬è¾¹æ•´æœ€æ…¢ã€‚
- **ç´¢å¼•æ„å»º**ï¼šç»™å·¥äººå‡†å¤‡**å¤§å·¥ä½œå°**ï¼ˆMemoryï¼‰ä¸**å¤šå¸®æ‰‹**ï¼ˆWorkersï¼‰ï¼Œå¹²æ´»æ‰èƒ½å¿«ã€‚
- **æŸ¥è¯¢ç²¾åº¦**ï¼šåƒ**å¯»å®**ã€‚æœå¾—è¶Šç»†ï¼ˆef_search å¤§ï¼‰ï¼Œç»“æœè¶Šå‡†ï¼Œä½†è€—æ—¶è¶Šé•¿ã€‚

| å…³é”®åŠ¨ä½œ     | å½¢è±¡æ¯”å–»         | ä¼˜åŒ–ç­–ç•¥                                   | æ ¸å¿ƒé…ç½®                                     |
| :----------- | :--------------- | :----------------------------------------- | :------------------------------------------- |
| **æ‰¹é‡å¯¼å…¥** | **å…ˆæ¬å®¶åæ•´ç†** | ä½¿ç”¨ `COPY` åè®®ï¼Œ**å…ˆæ’å…¥æ•°æ®ï¼Œåå»ºç´¢å¼•** | `COPY items FROM STDIN WITH (FORMAT BINARY)` |
| **ç´¢å¼•æ„å»º** | **åŠ å¤§å·¥ä½œå°**   | ä¸´æ—¶è°ƒå¤§ç»´æŠ¤å†…å­˜ï¼Œé¿å…é¢‘ç¹è¯»å†™ç£ç›˜         | `SET maintenance_work_mem = '8GB'`           |
| **å¹¶è¡Œæ„å»º** | **å¤šè¯·å‡ ä¸ªå·¥äºº** | å¢åŠ å¹¶è¡Œè¿›ç¨‹æ•°ï¼Œå……åˆ†åˆ©ç”¨å¤šæ ¸ CPU           | `SET max_parallel_maintenance_workers = 7`   |
| **æŸ¥è¯¢ä¼˜åŒ–** | **æœå¾—æ›´ä»”ç»†**   | å¢å¤§æœç´¢å¹¿åº¦ï¼Œç”¨æ—¶é—´æ¢å¬å›ç‡               | `SET hnsw.ef_search = 100`                   |
| **æè‡´æ€§èƒ½** | **æŠ„è¿‘é“**       | å½’ä¸€åŒ–å‘é‡æ”¹ç”¨å†…ç§¯ï¼ˆæŠ•å½±ï¼‰è®¡ç®—             | æ›¿æ¢ `<=>` ä¸º `<#>`                          |

```sql
-- æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨æƒ…å†µ
EXPLAIN (ANALYZE, BUFFERS)
SELECT * FROM source_embeddings
ORDER BY embedding <=> '[0.1, 0.2, ...]'::vector
LIMIT 10;

-- è°ƒæ•´ HNSW æœç´¢å‚æ•°
SET hnsw.ef_search = 100;  -- æå‡å¬å›ç‡

-- æ‰¹é‡æ•°æ®å¯¼å…¥åé‡å»ºç´¢å¼•
REINDEX INDEX CONCURRENTLY idx_source_embedding_hnsw;

-- æ¸…ç†ç¢ç‰‡
VACUUM ANALYZE source_embeddings;
```

---

## 2. VectorChord

### 2.1 äº§å“æ¦‚è¿°

**æ ¸å¿ƒå®šä½**ï¼š**å³ä¾¿æ­»å®ˆ PostgreSQL ç”Ÿæ€ï¼Œä¹Ÿä¸æƒ³åœ¨æ€§èƒ½ä¸Šå‘ç‹¬ç«‹å‘é‡æ•°æ®åº“ï¼ˆå¦‚ Milvusï¼‰ä½å¤´çš„â€œæå®¢æ–¹æ¡ˆâ€ã€‚**

å¦‚æœè¯´ PGVector æ˜¯ PostgreSQL çš„â€œå®˜æ–¹æ ‡é…â€ï¼Œé‚£ä¹ˆ VectorChord å°±æ˜¯è¿½æ±‚æé™æ€§èƒ½çš„**ç¬¬ä¸‰æ–¹æ”¹è£…å¥—ä»¶**ã€‚

è¿˜æ˜¯é‚£è¾†ç†Ÿæ‚‰çš„ **PostgreSQL (SUV)**ï¼Œä½† VectorChord ä¸ºå®ƒæ¢ä¸Šäº† **Rust æ‰“é€ çš„æ¶¡è½®å¢å‹å¼•æ“**ï¼š

- **åŸå‚è½¦ (PGVector)**ï¼šä¸»æ‰“ç¨³å¥å…¼å®¹ï¼Œé€‚åˆç»å¤§å¤šæ•°é€šç”¨é€”å¾„ã€‚
- **æ”¹è£…è½¦ (VectorChord)**ï¼šä¸»æ‰“**æš´åŠ›æ€§èƒ½**ã€‚ä¸æ¢è½¦ä¹Ÿèƒ½ä½“éªŒâ€œæ¨èƒŒæ„Ÿâ€â€”â€”æŸ¥è¯¢å¿« 5 å€ï¼Œå†™å…¥å¿« 16 å€ï¼Œä¸”èƒ½æ‰¿è½½è¶…å¤§è§„æ ¼è´§ç‰©ï¼ˆ60K ç»´ï¼‰ã€‚

> âš ï¸ **æ³¨æ„**ï¼šVectorChord æ˜¯ç”± TensorChord å¼€å‘çš„åŸ pgvecto.rs çš„ä¸‹ä¸€ä»£é‡æ„ç‰ˆæœ¬ï¼Œæ–°é¡¹ç›®è¯·ç›´æ¥ä½¿ç”¨ VectorChord<sup>[[5]](#ref5)</sup>ã€‚

```mermaid
graph LR
    subgraph "VectorChordï¼šRust é©±åŠ¨çš„æ€§èƒ½æ€ªå…½"
        direction LR
        A[PostgreSQL]:::pg --> B("VectorChord æ‰©å±•<br/>(RaBitQ é‡åŒ–ç®—æ³•)"):::vc
        B --> C[5x æŸ¥è¯¢é€Ÿåº¦]:::feat
        B --> D[16x å†™å…¥åå]:::feat
        B --> E[60K ç»´è¶…å®½å‘é‡]:::feat
    end

    classDef pg fill:#336791,color:#fff
    classDef vc fill:#e67e22,color:#fff
    classDef feat fill:#87d068,color:#fff
```

### 2.2 æ ¸å¿ƒç‰¹æ€§å¯¹æ¯” PGVector

| ç‰¹æ€§         | PGVector (åŸå‚) | VectorChord (æ”¹è£…) | æå‡å¹…åº¦ |
| :----------- | :-------------- | :----------------- | :------- |
| **æŸ¥è¯¢æ€§èƒ½** | åŸºå‡†            | **5x æ›´å¿«**        | ğŸš€ 5x    |
| **å†™å…¥åå** | åŸºå‡†            | **16x æ›´é«˜**       | ğŸš€ 16x   |
| **ç´¢å¼•æ„å»º** | åŸºå‡†            | **16x æ›´å¿«**       | ğŸš€ 16x   |
| **æœ€å¤§ç»´åº¦** | 2,000 (HNSW)    | **60,000**         | ğŸ“ 30x   |
| **å­˜å‚¨æˆæœ¬** | $6/400K         | **$1/400K**        | ğŸ’° çœ 6x |

### 2.3 RaBitQ é‡åŒ–ç®—æ³•

**RaBitQï¼ˆRandomized Bit Quantizationï¼‰**<sup>[[7]](#ref7)</sup> å°±åƒæ˜¯ç»™æ¯ä¸ªå‘é‡æ‹äº†ä¸€å¼ **è¶…å¾®ç¼©ç•¥å›¾**ã€‚åœ¨æœç´¢æ—¶ï¼Œå…ˆå¿«é€Ÿæ¯”å¯¹ç¼©ç•¥å›¾ï¼ˆäºŒè¿›åˆ¶é‡åŒ–ï¼Œä½“ç§¯ä»…ä¸ºåŸå§‹æ•°æ®çš„ 1/32ï¼‰å‰”é™¤ç»å¤§å¤šæ•°æ— å…³æ•°æ®ï¼Œå†å¯¹å‰©ä¸‹çš„å€™é€‰è€…è¿›è¡Œç²¾ç»†æ¯”å¯¹ã€‚è¿™è®©å®ƒèƒ½åœ¨æä½çš„å†…å­˜å ç”¨ä¸‹å®ç°æé€Ÿæ£€ç´¢ã€‚

```sql
-- æ ‡å‡†åˆ›å»ºï¼ˆæ¨èï¼‰
CREATE INDEX ON items USING vchordrq (embedding vector_l2_ops);

-- æå®¢æ¨¡å¼ï¼šé€šè¿‡ TOML é£æ ¼é…ç½®å¾®è°ƒå‚æ•°
CREATE INDEX ON items USING vchordrq (embedding vector_cosine_ops)
WITH (options = $$
    residual_quantization = true  -- [ç…§ç‰‡å¢å¼º] ä¸ä»…å­˜ç¼©ç•¥å›¾ï¼Œè¿˜ä¿ç•™äº†å’ŒåŸå›¾çš„å·®å¼‚ç»†èŠ‚ï¼Œè¶Šçœ‹è¶Šæ¸…
    [build.internal]
    lists = [2000]                -- [åŸå¸‚è§„åˆ’] å¼ºåˆ¶åˆ’åˆ†ä¸º 2000 ä¸ªè¡Œæ”¿åŒºï¼ˆè‹¥ä¸å¡«åˆ™ AI è‡ªåŠ¨è§„åˆ’ï¼‰
    spherical_centroids = true    -- [çƒé¢æŠ•å½±] é€‚åˆ Cosine è·ç¦»ï¼Œåƒåœ¨åœ°çƒä»ªè¡¨é¢åˆ’åˆ†åŒºåŸŸè€Œä¸æ˜¯å¹³é¢åœ°å›¾
    build_threads = 8             -- [æ–½å·¥é˜Ÿ] 8 ä¸ªå·¥äººåŒæ—¶å¹²æ´»
$$);
```

### 2.4 ç´¢å¼•è°ƒä¼˜

å‚æ•°è°ƒä¼˜çš„æ ¸å¿ƒæ˜¯ **â€œåˆ†åŒºç®¡ç†â€**ï¼Œå°±åƒ**åŸå¸‚è§„åˆ’**ï¼š

- **lists (åˆ†åŒºæ•°)**ï¼šåŸå¸‚è¶Šå¤§ï¼Œ**è¡Œæ”¿åŒºï¼ˆListsï¼‰** å°±è¦åˆ’å¾—è¶Šç»†ï¼Œé˜²æ­¢å•åŒºäººå£çˆ†ç‚¸ï¼Œæ£€ç´¢å˜æ…¢ã€‚
- **probes (æ¢é’ˆæ•°)**ï¼šæ‰¾äººæ—¶ï¼Œéœ€è¦æ’æŸ¥å¤šå°‘ä¸ª**ç›¸é‚»è¡Œæ”¿åŒº**ã€‚æ’æŸ¥è¶Šå¤šè¶Šå‡†ï¼Œä½†è¶Šæ…¢ã€‚

| æ•°æ®è§„æ¨¡                | lists (è§„åˆ’å»ºè®®) | probes (æœå¯»å»ºè®®) |
| :---------------------- | :--------------- | :---------------- |
| **< 1M (å°é•‡)**         | `[]` (è‡ªåŠ¨)      | é»˜è®¤              |
| **1M - 10M (åŸå¸‚)**     | `[2000]`         | 10                |
| **10M - 100M (å¤§éƒ½ä¼š)** | `[10000]`        | 30                |
| **> 100M (å·¨å‹åŸå¸‚)**   | `[80000]`        | 100               |

```sql
-- æŸ¥è¯¢æ—¶è°ƒæ•´æœç´¢èŒƒå›´ï¼ˆå³æœå¯»å¤šå°‘ä¸ªç›¸é‚»è¡Œæ”¿åŒºï¼‰
SET vchordrq.probes TO '10';
SELECT * FROM items ORDER BY embedding <-> '[3,1,2]' LIMIT 10;
```

### 2.5 ä¸ PGVector å…¼å®¹æ€§

VectorChord å°±åƒæ˜¯èƒ½æ’è¿›**æ ‡å‡†æ’åº§ï¼ˆPGVector æ¥å£ï¼‰**çš„**è¶…çº§å……ç”µå™¨**ã€‚å®ƒæ²¿ç”¨äº† PGVector çš„æ•°æ®ç±»å‹ï¼ˆæ’å¤´å½¢çŠ¶ä¸€æ ·ï¼‰<sup>[[8]](#ref8)</sup>ï¼Œä½ ä¸éœ€è¦ä¿®æ”¹è¡¨ç»“æ„æˆ–ä¸šåŠ¡ä»£ç ï¼Œåªéœ€æ¢ä¸ªâ€œå†…éƒ¨å¼•æ“â€ï¼ˆç´¢å¼•ç±»å‹ï¼‰ï¼Œå°±èƒ½ç¬é—´è·å¾—æ€§èƒ½æå‡ã€‚

```sql
-- ä¾èµ– vchord
CREATE EXTENSION IF NOT EXISTS vchord CASCADE;
-- 1. æ•°æ®è¡¨è¿˜æ˜¯åŸæ¥çš„é…æ–¹ï¼ˆä½¿ç”¨ vector ç±»å‹ï¼‰
CREATE TABLE items (embedding vector(1536));

-- 2. åªéœ€è¦åœ¨åˆ›å»ºç´¢å¼•æ—¶ï¼Œæ‚„æ‚„å°†â€œå¼•æ“â€åä» hnsw æ”¹ä¸º vchordrq
-- CREATE INDEX ON items USING hnsw ...  <-- æ—§å¼•æ“
CREATE INDEX ON items USING vchordrq ...  -- <-- æ–°å¼•æ“
```

### 2.6 vchordg å›¾ç´¢å¼• (v0.5.0+)

ç›¸æ¯” `vchordrq` æ˜¯å…¨å†…å­˜ç´¢å¼•ï¼Œé£å¿«ä½†è´µï¼›`vchordg` åˆ™æ˜¯åŸºäºç£ç›˜çš„**ç¦»çº¿åœ°å›¾åŒ…**ï¼ˆDiskANN æŠ€æœ¯ï¼‰ï¼šå®ƒå…è®¸ä½ æŠŠåºå¤§çš„å‘é‡æ•°æ®å­˜åœ¨ä¾¿å®œçš„ SSD ç¡¬ç›˜ä¸Šï¼ŒåªæŠŠæœ€å…³é”®çš„â€œè·¯æ ‡â€åŠ è½½åˆ°å†…å­˜ã€‚**é€‚åˆæ•°æ®é‡å¤§åˆ°å†…å­˜è£…ä¸ä¸‹çš„åœºæ™¯ã€‚**

```sql
/**
 * ç¦»çº¿åœ°å›¾æ¨¡å¼ (Disk-Based Index)
 * é€‚åˆåœºæ™¯ï¼šå†…å­˜æœ‰é™ï¼Œä½†æœ‰ä¸€å—æé€Ÿ SSD
 */
CREATE INDEX ON items USING vchordg (embedding vector_cosine_ops)
WITH (options = $$
    bits = 2                -- [åœ°å›¾ç¼©æ”¾] 2x ç¼©æ”¾ã€‚å€¼è¶Šå°è¶Šçœåœ°ï¼Œä½†åœ°å›¾è¶Šæ¨¡ç³Šï¼ˆæ˜“æŒ‡é”™è·¯ï¼‰ï¼›1 = æçœç©ºé—´ï¼Œ2 = å…¼é¡¾å‡†ç¡®ï¼›RaBitQ é‡åŒ–æ¯”ç‡ï¼Œé»˜è®¤ 2
    m = 32                  -- [äº¤é€šæ¢çº½] è§„å®šæ¯ä¸ªè·¯å£æœ€å¤šè¿æ¥ 32 æ¡è·¯ã€‚è·¯è¶Šå¤šè¶Šç²¾å‡†ï¼Œä½†è·¯ç½‘è¶Šå¤æ‚ï¼›æ¯é¡¶ç‚¹æœ€å¤§é‚»å±…æ•°ï¼Œé»˜è®¤ 32
    ef_construction = 64    -- [å‹˜æµ‹èŒƒå›´] é€ åœ°å›¾æ—¶ï¼Œå…ˆæ¢ç´¢å‘¨è¾¹ 64 ä¸ªè·¯æ ‡æ¥ç¡®å®šæœ€ä½³è·¯çº¿ã€‚æ¢ç´¢è¶Šå¹¿ï¼Œåœ°å›¾è´¨é‡è¶Šé«˜ï¼›æ„å»ºæ—¶çš„æœç´¢èŒƒå›´ï¼Œé»˜è®¤ 64
    alpha = [1.0, 1.2]      -- [ç»•è·¯å®¹å¿åº¦] å…è®¸åœ¨å»ºå›¾æ—¶ç¨å¾®ç»•ç‚¹è·¯ï¼ˆ1.0-1.2å€ï¼‰ï¼Œä»¥å‘ç°æ½œåœ¨çš„æ·å¾„ï¼Œé˜²æ­¢é™·å…¥å±€éƒ¨æ­»èƒ¡åŒï¼›å‰ªææ—¶çš„ alpha å€¼ï¼Œé»˜è®¤ [1.0, 1.2]
$$);
```

### 2.7 é¢„è¿‡æ»¤ Prefilter (v0.4.0+)

VectorChord çš„ `vchordrq.prefilter` å‚æ•°å…è®¸å‘é‡ç´¢å¼•åˆ©ç”¨è¿‡æ»¤æ¡ä»¶è¿›è¡Œå‰ªæ<sup>[[24]](#ref24)</sup>ï¼š

```sql
-- å¯ç”¨é¢„è¿‡æ»¤
SET vchordrq.prefilter = on;

-- é€‚ç”¨äºä¸¥æ ¼ä¸”ä½æˆæœ¬çš„è¿‡æ»¤æ¡ä»¶
-- 1% é€‰æ‹©ç‡æ—¶å¯è·å¾— 200% QPS æå‡
-- 10% é€‰æ‹©ç‡æ—¶å¯è·å¾— 5% QPS æå‡
```

> [!WARNING]
>
> **æ³¨æ„**ï¼šé¢„è¿‡æ»¤ä»…æ¨èç”¨äº**ä¸¥æ ¼**ï¼ˆè¿‡æ»¤å¤§é‡è¡Œï¼‰ä¸”**ä½æˆæœ¬**ï¼ˆè®¡ç®—å¼€é”€è¿œä½äºå‘é‡è·ç¦»è®¡ç®—ï¼‰çš„è¿‡æ»¤æ¡ä»¶ã€‚

---

## 3. Milvus

### 3.1 äº§å“æ¦‚è¿°

**æ ¸å¿ƒå®šä½**ï¼š**ç”¨ï¼ˆè¾ƒé«˜çš„ï¼‰è¿ç»´å¤æ‚åº¦ï¼Œæ¢å–ï¼ˆæé«˜çš„ï¼‰æ°´å¹³æ‰©å±•èƒ½åŠ›ã€‚æ˜¯â€œå¤§å‚â€æ„å»ºæ ¸å¿ƒ AI åŸºç¡€è®¾æ–½çš„é¦–é€‰ã€‚**

å‘Šåˆ«â€œæ’ä»¶åŒ–â€çš„è½»é‡çº§æ–¹æ¡ˆï¼Œæˆ‘ä»¬è¿›å…¥**äº‘åŸç”Ÿåˆ†å¸ƒå¼**çš„é‡å·¥ä¸šé¢†åŸŸã€‚Milvus æ˜¯ LF AI & Data Foundation åŸºé‡‘ä¼šçš„æ¯•ä¸šé¡¹ç›®ï¼Œä¸“ä¸º **åäº¿çº§ï¼ˆBillion-scaleï¼‰** å‘é‡æ£€ç´¢è€Œç”Ÿã€‚

Milvus çš„éƒ¨ç½²æ¨¡å¼å°±åƒ**ä»â€œä¹é«˜ç§¯æœ¨â€åˆ°â€œæ‘©å¤©å¤§æ¥¼â€**çš„è¿›åŒ–ï¼š

- **Milvus Lite**ï¼š**ä¹é«˜å°äºº**ã€‚åµŒå…¥ Python è¿›ç¨‹ï¼Œé›¶ä¾èµ–ï¼Œå†™ Demo æœ€å¿«ã€‚
- **Standalone**ï¼š**å•å±‚å¹³æˆ¿**ã€‚ä¸€ä¸ª Docker å®¹å™¨æå®šï¼Œé€‚åˆæµ‹è¯•æˆ–ä¸­å°è§„æ¨¡ã€‚
- **Distributed**ï¼š**æ‘©å¤©å¤§æ¥¼ç¾¤**ã€‚åŸºäº Kubernetes çš„å¾®æœåŠ¡æ¶æ„ï¼Œå­˜ç®—åˆ†ç¦»ï¼Œä¸“æ²»å„ç§â€œæ•°æ®é‡å¤§åˆ°å­˜ä¸ä¸‹â€çš„ç–‘éš¾æ‚ç—‡ã€‚

```mermaid
graph LR
    subgraph "Milvusï¼šä»ç©å…·åˆ°æ‘©å¤©æ¥¼"
        direction LR
        L["Lite<br/>(åµŒå…¥å¼)"]:::lego
        S["Standalone<br/>(Docker)"]:::house
        D["Distributed<br/>(K8s)"]:::city
        Z["Zilliz Cloud<br/>(æ‰˜ç®¡)"]:::cloud

        L --> |å¼€å‘| S
        S --> |ç”Ÿäº§| D
        D -.-> |æ‰˜ç®¡| Z
    end

    classDef lego fill:#b7eb8f,stroke:none,color:#000
    classDef house fill:#40a9ff,color:#fff,stroke:none
    classDef city fill:#003a8c,color:#fff,stroke:none
    classDef cloud fill:#722ed1,color:#fff,stroke:none
```

### 3.2 æ ¸å¿ƒæ¶æ„

Milvus çš„è¿ä½œæœºåˆ¶å°±åƒä¸€ä¸ªç¹å¿™çš„**å›½é™…æœºåœº**ï¼š

- **è®¿é—®å±‚ (Proxy)**ï¼š**å€¼æœºå¤§å…**ã€‚è´Ÿè´£æ¥å¾…æ—…å®¢ï¼ˆè¯·æ±‚ï¼‰ï¼Œæœ¬æ¥ä¸å¹²é‡æ´»ï¼Œåªç®¡æŠŠäººå¼•å¯¼åˆ°æ­£ç¡®çš„ç™»æœºå£ã€‚
- **åè°ƒå±‚ (Coordinators)**ï¼š**å¡”å°**ã€‚ä¸äº²è‡ªå¼€é£æœºï¼Œä½†æŒ‡æŒ¥æ‰€æœ‰é£æœºçš„èµ·é™é¡ºåºï¼Œç¡®ä¿èˆªçº¿ä¸å†²çªï¼ˆäº‹åŠ¡ä¸€è‡´æ€§ï¼‰ã€‚
- **å·¥ä½œèŠ‚ç‚¹ (Worker Nodes)**ï¼š**åœ°å‹¤äººå‘˜**ã€‚æœ€è‹¦æœ€ç´¯çš„ä¸€çº¿ã€‚æœ‰çš„æ¬è¡Œæï¼ˆDataNodeï¼‰ï¼Œæœ‰çš„ä¿®é£æœºï¼ˆIndexNodeï¼‰ï¼Œæœ‰çš„è´Ÿè´£å®‰æ£€æ‰«æï¼ˆQueryNodeï¼‰ã€‚
- **å­˜å‚¨å±‚ (etcd + MinIO + MQ)**ï¼š**åœæœºåªä¸ä»“åº“**ã€‚çœŸæ­£çš„ç‰©èµ„é›†æ•£åœ°ã€‚etcd å­˜èˆªç­è¡¨ï¼ŒMinIO å­˜è¡Œæï¼ŒKafka æ˜¯è¡Œæä¼ é€å¸¦ã€‚

```mermaid
graph TB
    subgraph "Milvus: å›½é™…æœºåœºæ¶æ„"
        direction TB
        subgraph "è®¿é—®å±‚(å€¼æœºå¤§å…)"
            Proxy[Proxy<br/>è´Ÿè½½å‡è¡¡ä¸è¯·æ±‚è·¯ç”±]:::proxy
        end

        subgraph "åè°ƒå±‚(å¡”å°)"
            RC[Root Coord<br/>DDL/DCL ç®¡ç†]:::coord
            QC[Query Coord<br/>æŸ¥è¯¢è°ƒåº¦]:::coord
            DC[Data Coord<br/>æ•°æ®è°ƒåº¦]:::coord
            IC[Index Coord<br/>ç´¢å¼•è°ƒåº¦]:::coord
        end

        subgraph "å·¥ä½œèŠ‚ç‚¹å±‚(åœ°å‹¤)"
            QN[Query Node<br/>å‘é‡æœç´¢]:::work
            DN[Data Node<br/>æ•°æ®æŒä¹…åŒ–]:::work
            IN[Index Node<br/>ç´¢å¼•æ„å»º]:::work
        end

        subgraph "å­˜å‚¨å±‚(ä»“åº“)"
            ETCD[(etcd<br/>å…ƒæ•°æ®)]:::store
            MINIO[(MinIO/S3<br/>å¯¹è±¡å­˜å‚¨)]
            MQ[Kafka/Pulsar<br/>æ¶ˆæ¯é˜Ÿåˆ—]:::store
        end

        Proxy --> RC & QC & DC & IC
        QC --> QN
        DC --> DN
        IC --> IN
        QN & DN & IN --> MINIO
        RC --> ETCD
        DN --> MQ
    end

    classDef proxy fill:#00A1EA,color:#fff,stroke:none
    classDef coord fill:#722ed1,color:#fff,stroke:none
    classDef work fill:#faad14,color:#fff,stroke:none
    classDef store fill:#52c41a,color:#fff,stroke:none

    style MINIO fill:#ff5722,color:#fff
```

**ç»„ä»¶åˆ†å·¥è¡¨**ï¼š

| å±‚çº§       | ç»„ä»¶              | æœºåœºè§’è‰²     | æ ¸å¿ƒèŒè´£                                                            | æ‰©å±•æ€§                                   |
| :--------- | :---------------- | :----------- | :------------------------------------------------------------------ | :--------------------------------------- |
| **è®¿é—®å±‚** | Proxy             | **å€¼æœºå¤§å…** | é—¨é¢æ‹…å½“ï¼Œèšåˆç»“æœ<br/>æ— çŠ¶æ€ä»£ç†ï¼Œå¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ä¸ç»“æœèšåˆ         | æ— çŠ¶æ€ï¼Œéšä¾¿åŠ æœºå™¨                       |
| **åè°ƒå±‚** | Coordinators      | **å¡”å°**     | å‘å·æ–½ä»¤ï¼Œè„‘éƒ¨ä¸­æ¢<br/>é›†ç¾¤æ‹“æ‰‘ç®¡ç†ã€ä»»åŠ¡è°ƒåº¦ã€ä¸€è‡´æ€§æ§åˆ¶           | å‹åŠ›è¾ƒå°ï¼Œé€šå¸¸ä¸éœ€è¦æ‰©å±•                 |
| **å·¥ä½œå±‚** | Worker Nodes      | **åœ°å‹¤**     | **ç®—åŠ›é»‘æ´**ã€‚æœç´¢ã€å»ºç´¢å¼•å…¨é å®ƒ<br/>å‘é‡æœç´¢ã€æ•°æ®æŒä¹…åŒ–ã€ç´¢å¼•æ„å»º | **å¼¹æ€§ä¼¸ç¼©çš„æ ¸å¿ƒ**ï¼ˆå¿™æ—¶åŠ äººï¼Œé—²æ—¶è£å‘˜ï¼‰ |
| **å­˜å‚¨å±‚** | etcd + MinIO + MQ | **ä»“åº“**     | æ•°æ®åº•åº§ï¼ŒæŒä¹…åŒ–å­˜å‚¨<br/>å…ƒæ•°æ®ã€å‘é‡/ç´¢å¼•å­˜å‚¨ã€WAL æ—¥å¿—            | ä¾èµ– S3/MinIO çš„æ— é™å®¹é‡                 |

### 3.3 ç´¢å¼•ç®—æ³•ä½“ç³»

æ‹¥æœ‰äº†èƒ½å¤Ÿæ— é™æ‰©å±•çš„**å­˜å‚¨æ¶æ„**åï¼ŒMilvus è¿›ä¸€æ­¥æä¾›äº†è¦†ç›–å…¨åœºæ™¯çš„**ç´¢å¼•åˆ†çº§ä½“ç³»**ï¼Œè®©ä½ åœ¨â€œé€Ÿåº¦ã€æˆæœ¬ã€ç²¾åº¦â€çš„ä¸å¯èƒ½ä¸‰è§’ä¸­è‡ªç”±è£å†³ã€‚

Milvus çš„ç´¢å¼•ä½“ç³»å°±åƒä¸€ä¸ª**å¤šçº§ç‰©æµç½‘ç»œ**ï¼š

- **HNSW (å†…å­˜ç´¢å¼•)**ï¼š**å‰ç½®ä»“ï¼ˆæé€Ÿè¾¾ï¼‰**ã€‚è´§ç‰©å°±åœ¨å¸‚ä¸­å¿ƒï¼ˆå†…å­˜ï¼‰ï¼Œä¸‹å•å³é€è¾¾ï¼ˆå»¶è¿Ÿæœ€ä½ï¼‰ï¼Œä½†ç§Ÿé‡‘å¯¸åœŸå¯¸é‡‘ï¼Œé€‚åˆçƒ­ç‚¹æ•°æ®ã€‚
- **IVF_PQ (å‹ç¼©ç´¢å¼•)**ï¼š**é›†çº¦åŒ–è´§æ¶ï¼ˆé«˜å¯†åº¦ï¼‰**ã€‚é€šè¿‡çœŸç©ºå‹ç¼©ï¼ˆé‡åŒ–ï¼‰æŠ€æœ¯ï¼Œåœ¨åŒæ ·çš„ä»“åº“é‡Œå¡è¿› 10 å€çš„è´§ç‰©ï¼Œè™½ç„¶å–è´§å¤šä¸€é“å·¥åºï¼Œä½†æ€§ä»·æ¯”æé«˜ã€‚
- **DiskANN (ç£ç›˜ç´¢å¼•)**ï¼š**éƒŠåŒºä¸­å¿ƒä»“ï¼ˆæµ·é‡ï¼‰**ã€‚å»ºåœ¨åœ°çš®ä¾¿å®œçš„éƒŠåŒºï¼ˆSSDï¼‰ï¼Œé€šè¿‡é«˜é€Ÿå…¬è·¯ï¼ˆNVMeï¼‰ä¸´æ—¶è°ƒè´§ï¼Œæˆæœ¬ä»…ä¸ºå‰ç½®ä»“çš„ 1/10ï¼Œé€‚åˆç™¾äº¿çº§æ•°æ®å…œåº•ã€‚
- **GPU Index (GPU ç´¢å¼•)**ï¼š**è‡ªåŠ¨åŒ–æµæ°´çº¿ï¼ˆé«˜ååï¼‰**ã€‚é‡åˆ°â€œåŒ 11â€æµ·é‡è®¢å•ï¼ˆé«˜ QPSï¼‰ï¼Œç›´æ¥ä¸Šæœºå™¨è‡‚é›†ç¾¤ï¼ˆGPUï¼‰ï¼Œå¤„ç†æ•ˆç‡æ˜¯äººå·¥çš„å‡ åå€ã€‚

ä¸ºäº†æ”¯æ’‘ä¸Šè¿°å¤šçº§ç‰©æµä½“ç³»ï¼ŒåŒæ—¶å¤„ç†å¤æ‚çš„å…ƒæ•°æ®è¿‡æ»¤ï¼ˆå¦‚æŸ¥æ‰¾ç‰¹å®šç±»åˆ«çš„å•†å“ï¼‰ï¼ŒMilvus æ„å»ºäº†ä¸šç•Œæœ€å…¨çš„**ç´¢å¼•åˆ†ç±»æ ‘**ï¼š

```mermaid
mindmap
  root((Milvus ç´¢å¼•å…¨æ™¯))
    å‘é‡ç´¢å¼•
      å›¾ç´¢å¼•(HNSW å‰ç½®ä»“)
        HNSW
        [HNSW_SQ|PQ|PRQ]
      IVF ç³»åˆ—(IVF é›†çº¦è´§æ¶)
        [IVF_FLAT|SQ8|PQ|RABITQ]
      ç£ç›˜ç´¢å¼•(DiskANN ä¸­å¿ƒä»“)
      GPU ç´¢å¼•(GPU è‡ªåŠ¨åŒ–)
        [GPU_CAGRA|IVF_FLAT|IVF_PQ|BRUTE_FORCE]
    æ ‡é‡ç´¢å¼•
      å€’æ’ç´¢å¼•ï¼šç‰©å“æ¸…å•-æŸ¥åç§°
      Bitmap ç´¢å¼•ï¼šçŠ¶æ€çœ‹æ¿-æŸ¥åº“å­˜
      Trie ç´¢å¼•ï¼šè´§å·å‰ç¼€-æŸ¥æ‰¹æ¬¡
```

| ç´¢å¼•ç±»å‹      | ç‰©æµè§’è‰²     | ç®—æ³•            | é€‚ç”¨åœºæ™¯                                       | èµ„æºæ¶ˆè€—    |
| ------------- | ------------ | --------------- | ---------------------------------------------- | ----------- |
| **HNSW**      | **å‰ç½®ä»“**   | å¤šå±‚å›¾æœç´¢      | **å”¯å¿«ä¸ç ´**ã€‚ä½å»¶è¿Ÿé«˜å¬å›                     | ğŸ§  å†…å­˜æé«˜ |
| **IVF_FLAT**  | **é›†çº¦è´§æ¶** | èšç±» + ç²¾ç¡®æœç´¢ | é«˜å¬å›åœºæ™¯                                     | ğŸ§  å†…å­˜ä¸­   |
| **IVF_SQ8**   | **é›†çº¦è´§æ¶** | èšç±» + æ ‡é‡é‡åŒ– | **ç©ºé—´é­”æ³•**ã€‚é€šè¿‡é‡åŒ–å‹ç¼©æ•°æ®ï¼Œå¹³è¡¡æ€§èƒ½ä¸å¬å› | ğŸ§  å†…å­˜ä½   |
| **IVF_PQ**    | **é›†çº¦è´§æ¶** | èšç±» + ç§¯é‡åŒ–   | **ç©ºé—´é­”æ³•**ã€‚é€šè¿‡é‡åŒ–å‹ç¼©æ•°æ®ï¼Œå¤§è§„æ¨¡ä½å†…å­˜   | ğŸ§  å†…å­˜æä½ |
| **DiskANN**   | **ä¸­å¿ƒä»“**   | ç£ç›˜å›¾ç´¢å¼•      | **æˆæœ¬æ€æ‰‹**ã€‚ä½¿ç”¨ SSD å­˜å‚¨è¶…å¤§è§„æ¨¡æ•°æ®        | ğŸ’¾ ä¾èµ– SSD |
| **GPU Index** | **è‡ªåŠ¨åŒ–**   | GPU ä¼˜åŒ–å›¾      | **æš´åŠ›åå**ã€‚GPU åŠ é€Ÿï¼Œé€‚åˆè¶…é«˜å¹¶å‘åœºæ™¯       | ğŸ® æ˜¾å­˜     |

### 3.4 å‘é‡æ£€ç´¢å®è·µ

#### 3.4.1 pymilvus å¼€å‘æ¨¡å¼

Milvus çš„ `pymilvus` SDK å°±æ˜¯**æ™ºèƒ½ä»“å‚¨ç³»ç»Ÿçš„â€œæ‰‹æŒç»ˆç«¯â€**ï¼Œç®€å•å‡ è¡ŒæŒ‡ä»¤å°±èƒ½è°ƒåº¦åº•å±‚çš„åºå¤§ç®—åŠ›ã€‚

```python
from pymilvus import MilvusClient

# ä½¿ç”¨ Milvus Lite è¿›è¡Œæœ¬åœ°å¼€å‘
client = MilvusClient("./milvus_demo.db")

# åˆ›å»º Collection
client.create_collection(
    collection_name="papers",
    dimension=1536,
    metric_type="COSINE"
)

# æ’å…¥æ•°æ®
client.insert(
    collection_name="papers",
    data=[
        {"id": 1, "vector": embedding, "title": "ReAct Paper", "abstract": "..."},
        # ...
    ]
)

# åˆ›å»ºç´¢å¼•
client.create_index(
    collection_name="papers",
    field_name="vector",
    index_type="HNSW",
    metric_type="COSINE",
    params={"M": 16, "efConstruction": 128}
)

# æœç´¢
results = client.search(
    collection_name="papers",
    data=[query_embedding],
    limit=10,
    output_fields=["title", "abstract"]
)
```

**å…¨èƒ½æ£€ç´¢çŸ©é˜µ**ï¼š

| èƒ½åŠ›           | æè¿°          | ä»·å€¼                                                        |
| :------------- | :------------ | :---------------------------------------------------------- |
| **ANN æœç´¢**   | è¿‘ä¼¼æœ€è¿‘é‚»    | **æ ¸å¿ƒèƒ½åŠ›**ã€‚äº¿çº§æ•°æ®æ¯«ç§’å“åº”ã€‚                            |
| **å…ƒæ•°æ®è¿‡æ»¤** | æ ‡é‡æ¡ä»¶è¿‡æ»¤  | **ç²¾å‡†å®šä½**ã€‚æ”¯æŒå¤æ‚çš„ boolean è¡¨è¾¾å¼ã€‚                   |
| **æ··åˆæœç´¢**   | å¤šè·¯å¬å›èåˆ  | **å…¨èƒ½è§†è§’**ã€‚åŒæ—¶åˆ©ç”¨å‘é‡ã€BM25 å…³é”®è¯ã€å›¾ç‰‡ç­‰å¤šæ¨¡æ€ä¿¡æ¯ã€‚ |
| **èŒƒå›´æœç´¢**   | Radius Search | **ç”»åœˆåœˆåœ°**ã€‚åªæ‰¾ç‰¹å®šç›¸ä¼¼åº¦èŒƒå›´å†…çš„ç»“æœã€‚                  |
| **é‡æ’åº**     | Rerank        | **ç²¾ä¿®æ•´å¤‡**ã€‚å¼•å…¥é«˜ç²¾åº¦æ¨¡å‹å¯¹ç²—æ’ç»“æœè¿›è¡ŒäºŒæ¬¡ç²¾é€‰ã€‚        |

#### 3.4.2 Collection è®¾è®¡

```python
from pymilvus import MilvusClient, DataType, FieldSchema, CollectionSchema

# ä½¿ç”¨ Milvus Liteï¼ˆæœ¬åœ°å¼€å‘ï¼‰æˆ–è¿æ¥è¿œç¨‹æœåŠ¡
client = MilvusClient("./agentic_ai.db")  # Lite æ¨¡å¼

# å®šä¹‰ Schema
fields = [
    FieldSchema(name="id", dtype=DataType.INT64, is_primary=True, auto_id=True),
    FieldSchema(name="source_id", dtype=DataType.INT64),
    FieldSchema(name="source_type", dtype=DataType.VARCHAR, max_length=50),
    FieldSchema(name="title", dtype=DataType.VARCHAR, max_length=500),
    FieldSchema(name="chunk_text", dtype=DataType.VARCHAR, max_length=65535),
    FieldSchema(name="embedding", dtype=DataType.FLOAT_VECTOR, dim=1536),
]

# åˆ›å»º Collection
client.create_collection(
    collection_name="source_embeddings",
    schema=CollectionSchema(fields, description="å­¦æœ¯èµ„æºå‘é‡åµŒå…¥"),
    index_params={
        "index_type": "HNSW",
        "metric_type": "COSINE",
        "params": {"M": 16, "efConstruction": 128}
    }
```

#### 3.4.3 å‘é‡æ£€ç´¢ä¸æ··åˆæœç´¢

```python
from pymilvus import MilvusClient
from openai import OpenAI

client = MilvusClient("./agentic_ai.db")
openai_client = OpenAI()

def get_embedding(text: str) -> list:
    """ç”Ÿæˆæ–‡æœ¬åµŒå…¥å‘é‡"""
    response = openai_client.embeddings.create(
        model="text-embedding-3-small",
        input=text
    )
    return response.data[0].embedding

def semantic_search(query: str, source_type: str = None, top_k: int = 10):
    """è¯­ä¹‰ç›¸ä¼¼åº¦æœç´¢"""
    query_embedding = get_embedding(query)

    # æ„å»ºè¿‡æ»¤æ¡ä»¶
    filter_expr = f'source_type == "{source_type}"' if source_type else ""

    results = client.search(
        collection_name="source_embeddings",
        data=[query_embedding],
        limit=top_k,
        filter=filter_expr,
        output_fields=["title", "chunk_text", "source_type"]
    )
    return results

def hybrid_search(query: str, top_k: int = 10):
    """æ··åˆæœç´¢ï¼ˆå‘é‡ + BM25 å…¨æ–‡ï¼‰"""
    # Milvus 2.4+ æ”¯æŒ BM25 å…¨æ–‡æœç´¢
    from pymilvus import AnnSearchRequest, RRFRanker

    query_embedding = get_embedding(query)

    # å‘é‡æœç´¢è¯·æ±‚
    vector_req = AnnSearchRequest(
        data=[query_embedding],
        anns_field="embedding",
        param={"metric_type": "COSINE", "params": {"ef": 100}},
        limit=top_k * 2
    )

    # BM25 å…¨æ–‡æœç´¢è¯·æ±‚ï¼ˆéœ€è¦åœ¨ Collection ä¸­å¯ç”¨ BM25ï¼‰
    bm25_req = AnnSearchRequest(
        data=[query],
        anns_field="chunk_text",
        param={"metric_type": "BM25"},
        limit=top_k * 2
    )

    # ä½¿ç”¨ RRF èåˆç»“æœ
    results = client.hybrid_search(
        collection_name="source_embeddings",
        reqs=[vector_req, bm25_req],
        ranker=RRFRanker(k=60),
        limit=top_k,
        output_fields=["title", "chunk_text"]
    )
    return results
```

### 3.5 Agent Framework é›†æˆ

#### 3.5.1 LlamaIndex é›†æˆç¤ºä¾‹

```python
from llama_index.core import VectorStoreIndex, Settings
from llama_index.vector_stores.milvus import MilvusVectorStore
from llama_index.embeddings.openai import OpenAIEmbedding

# é…ç½®åµŒå…¥æ¨¡å‹
Settings.embed_model = OpenAIEmbedding(model="text-embedding-3-small")

# è¿æ¥ Milvusï¼ˆæ”¯æŒ Lite / Standalone / Distributedï¼‰
vector_store = MilvusVectorStore(
    uri="./agentic_ai.db",  # Milvus Lite
    # uri="http://localhost:19530",  # Milvus Standalone
    collection_name="source_embeddings",
    dim=1536,
    overwrite=False
)

# åˆ›å»ºç´¢å¼•
index = VectorStoreIndex.from_vector_store(vector_store)

# RAG æŸ¥è¯¢
query_engine = index.as_query_engine(
    similarity_top_k=10,
    response_mode="tree_summarize"
)

response = query_engine.query(
    "ReAct å’Œ Chain-of-Thought æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"
)
print(response)
```

#### 3.5.2 LangChain é›†æˆç¤ºä¾‹

```python
from langchain_milvus import Milvus
from langchain_openai import OpenAIEmbeddings, ChatOpenAI
from langchain.chains import RetrievalQA

# åˆå§‹åŒ–åµŒå…¥æ¨¡å‹
embeddings = OpenAIEmbeddings(model="text-embedding-3-small")

# è¿æ¥ Milvus å‘é‡å­˜å‚¨
vector_store = Milvus(
    embedding_function=embeddings,
    collection_name="source_embeddings",
    connection_args={
        "uri": "./agentic_ai.db"  # Milvus Lite
        # "uri": "http://localhost:19530"  # Milvus Standalone
    }
)

# åˆ›å»ºæ£€ç´¢å™¨
retriever = vector_store.as_retriever(
    search_type="similarity",
    search_kwargs={"k": 10}
)

# æ„å»º RAG é“¾
llm = ChatOpenAI(model="gpt-4o", temperature=0)
qa_chain = RetrievalQA.from_chain_type(
    llm=llm,
    chain_type="stuff",
    retriever=retriever,
    return_source_documents=True
)

# æ‰§è¡ŒæŸ¥è¯¢
result = qa_chain.invoke({"query": "ä»€ä¹ˆæ˜¯ Agentic RAGï¼Ÿ"})
print(result["result"])
```

### 3.6 æ€§èƒ½åŸºå‡†

åŸºäº Milvus 2.2 å®˜æ–¹åŸºå‡†æµ‹è¯•<sup>[[12]](#ref12)</sup>ï¼Œå• QueryNodeï¼ˆ8 æ ¸ CPUã€8GB å†…å­˜ã€1M 128D Datasetï¼‰æ€§èƒ½è¡¨ç°ï¼š

| æŒ‡æ ‡        | æ€§èƒ½è¡¨ç°                        |
| ----------- | ------------------------------- |
| **QPS**     | 7153                            |
| **å»¶è¿Ÿ**    | 127ms (P99)<br/> 83ms (P50)     |
| **æ‰©å±•æ€§**  | çº¿æ€§æ‰©å±•ï¼ˆCPUï¼‰                 |
| **vs å…¶ä»–** | 2.5x Latencyã€4.5x QPS æ€§èƒ½ä¼˜åŠ¿ |

### 3.7 éƒ¨ç½²æ¨¡å¼

| æ¨¡å¼             | é€‚ç”¨åœºæ™¯          | æ•°æ®è§„æ¨¡ | è¿ç»´å¤æ‚åº¦ |
| ---------------- | ----------------- | -------- | ---------- |
| **Milvus Lite**  | æœ¬åœ°å¼€å‘ã€Jupyter | < 100K   | â˜…â˜†â˜†â˜†â˜†      |
| **Standalone**   | å•æœºå¼€å‘æµ‹è¯•      | < 10M    | â˜…â˜…â˜†â˜†â˜†      |
| **Distributed**  | ç”Ÿäº§ç¯å¢ƒ          | ç™¾äº¿çº§   | â˜…â˜…â˜…â˜…â˜†      |
| **Zilliz Cloud** | å…¨æ‰˜ç®¡ç”Ÿäº§        | ç™¾äº¿çº§   | â˜…â˜†â˜†â˜†â˜†      |

---

## 4. Weaviate

### 4.1 äº§å“æ¦‚è¿°

**æ ¸å¿ƒå®šä½**ï¼šAI-Native å‘é‡æ•°æ®åº“ï¼Œæä¾›å¼€ç®±å³ç”¨çš„è¯­ä¹‰æœç´¢å’Œ RAG èƒ½åŠ›ã€‚

Weaviate æ˜¯ä¸€æ¬¾å¼€æºçš„ AI-Native å‘é‡æ•°æ®åº“ï¼Œä¸“ä¸ºæ„å»º AI åº”ç”¨è€Œè®¾è®¡<sup>[[13]](#ref13)</sup>ã€‚å®ƒçš„æ ¸å¿ƒç‰¹ç‚¹æ˜¯å†…ç½®å‘é‡åŒ–æ¨¡å—ï¼Œå¯ä»¥è‡ªåŠ¨å°†æ•°æ®è½¬åŒ–ä¸ºå‘é‡åµŒå…¥ã€‚

```mermaid
graph TB
    subgraph "Weaviate ç”Ÿæ€ç³»ç»Ÿ"
        WDB[Weaviate Database<br/>å¼€æºå‘é‡æ•°æ®åº“]
        WC[Weaviate Cloud<br/>æ‰˜ç®¡æœåŠ¡]
        WA[Weaviate Agents<br/>é¢„æ„å»ºä»£ç†æœåŠ¡]
        WE[Weaviate Embeddings<br/>æ‰˜ç®¡åµŒå…¥æœåŠ¡]
    end

    WDB --> WC
    WC --> WA & WE

    style WDB fill:#38b2ac,color:#fff
    style WC fill:#805ad5,color:#fff
```

### 4.2 æ ¸å¿ƒç‰¹æ€§

| ç‰¹æ€§           | æè¿°                 | ä¼˜åŠ¿                    |
| -------------- | -------------------- | ----------------------- |
| **å†…ç½®å‘é‡åŒ–** | è‡ªåŠ¨ç”Ÿæˆå‘é‡åµŒå…¥     | æ— éœ€å¤–éƒ¨ Embedding æœåŠ¡ |
| **è¯­ä¹‰æœç´¢**   | åŸºäºå«ä¹‰çš„ç›¸ä¼¼æ€§æœç´¢ | è¶…è¶Šå…³é”®è¯åŒ¹é…          |
| **æ··åˆæœç´¢**   | å‘é‡ + BM25 ç»“åˆ     | å…¼é¡¾è¯­ä¹‰ä¸å…³é”®è¯        |
| **RAG æ”¯æŒ**   | å†…ç½®ç”Ÿæˆå¼æœç´¢       | ç®€åŒ– RAG æµç¨‹           |
| **æ¨¡å—åŒ–æ¶æ„** | å¯æ’æ‹”çš„å‘é‡åŒ–æ¨¡å—   | çµæ´»é€‰æ‹©æ¨¡å‹            |

### 4.3 å‘é‡ç´¢å¼•ç±»å‹

Weaviate æ”¯æŒä¸‰ç§å‘é‡ç´¢å¼•ç±»å‹<sup>[[14]](#ref14)</sup>ï¼š

```mermaid
graph BT
    subgraph "ç´¢å¼•ç±»å‹é€‰æ‹©"
        direction LR
        HNSW[HNSW ç´¢å¼•<br/>å¤§è§„æ¨¡æ•°æ®]
        Flat[Flat ç´¢å¼•<br/>å°è§„æ¨¡æ•°æ®]
        Dynamic[Dynamic ç´¢å¼•<br/>è‡ªåŠ¨åˆ‡æ¢]
    end

    Small[å°æ•°æ®é›†] --> Flat
    Large[å¤§æ•°æ®é›†] --> HNSW
    Unknown[æœªçŸ¥è§„æ¨¡] --> Dynamic

    style HNSW fill:#4285f4,color:#fff
    style Dynamic fill:#34a853,color:#fff
```

| ç´¢å¼•ç±»å‹    | ç®—æ³•     | é€‚ç”¨åœºæ™¯   | ç‰¹ç‚¹                     |
| ----------- | -------- | ---------- | ------------------------ |
| **HNSW**    | å¤šå±‚å›¾   | å¤§è§„æ¨¡æ•°æ® | å¯¹æ•°æ—¶é—´å¤æ‚åº¦ï¼Œé«˜å¬å›   |
| **Flat**    | æš´åŠ›æœç´¢ | å°è§„æ¨¡æ•°æ® | å®Œç¾å¬å›ï¼Œé€‚åˆå¤šç§Ÿæˆ·     |
| **Dynamic** | è‡ªåŠ¨åˆ‡æ¢ | æœªçŸ¥è§„æ¨¡   | å°æ—¶ç”¨ Flatï¼Œå¤§æ—¶åˆ‡ HNSW |

### 4.4 å‘é‡åŒ–æ¨¡å—

**æå®šäº†åº•å±‚å­˜å‚¨ï¼ˆç´¢å¼•ï¼‰ï¼Œæ¥ä¸‹æ¥è§£å†³æ•°æ®ç†è§£ï¼ˆå‘é‡åŒ–ï¼‰ã€‚**

Weaviate çš„å‘é‡åŒ–æ¨¡å—ï¼ˆVectorizerï¼‰å°±åƒæ˜¯æ•°æ®åº“çš„**åŒå£°ä¼ è¯‘è€³æœº**ã€‚å®ƒæ‰“ç ´äº†â€œå¤–éƒ¨å‘é‡åŒ– -> å­˜å…¥æ•°æ®åº“â€çš„å‰²è£‚æµç¨‹ï¼Œè®©æ•°æ®åº“æ ¸å¿ƒèƒ½ç›´æ¥â€œå¬æ‡‚â€äººç±»çš„æ–‡æœ¬æˆ–å›¾åƒã€‚ä½ åªéœ€åƒ**æ›´æ¢é•œå¤´**ä¸€æ ·æŒ‚è½½ä¸åŒçš„æ¨¡å‹æ’ä»¶ï¼ˆOpenAIã€HuggingFace ç­‰ï¼‰ï¼Œæ•°æ®åœ¨å…¥åº“ç¬é—´å°±ä¼šè¢«è‡ªåŠ¨â€œç¿»è¯‘â€æˆé«˜ç»´å‘é‡ï¼ŒçœŸæ­£å®ç°**å…¥åº“å³ç´¢å¼•**<sup>[[15]](#ref15)</sup>ï¼š

| æ¨¡å—ç±»å‹                 | æ¨¡å‹æä¾›å•†  | æ”¯æŒæ¨¡æ€    |
| ------------------------ | ----------- | ----------- |
| **text2vec-openai**      | OpenAI      | æ–‡æœ¬        |
| **text2vec-cohere**      | Cohere      | æ–‡æœ¬        |
| **text2vec-huggingface** | HuggingFace | æ–‡æœ¬        |
| **multi2vec-clip**       | OpenAI CLIP | å›¾åƒ + æ–‡æœ¬ |
| **multi2vec-bind**       | ImageBind   | å¤šæ¨¡æ€      |

### 4.5 æœç´¢èƒ½åŠ›

Weaviate çš„æœç´¢æ¥å£è®¾è®¡å¾—åƒä¸€ä¸ª**å…¨èƒ½æŒ‡æŒ¥å°**ï¼Œä¸ä»…èƒ½æŒ‡æŒ¥å‘é‡å¯»æ‰¾â€œæ„æ€ç›¸è¿‘â€çš„å†…å®¹ï¼Œè¿˜èƒ½æŒ‡æŒ¥å€’æ’ç´¢å¼•å¯»æ‰¾â€œå­—é¢ç²¾ç¡®â€çš„åŒ¹é…ï¼Œç”šè‡³èƒ½ä¸¤æ‰‹ä¸€èµ·æŠ“ã€‚

```python
import weaviate

# ... (è¿æ¥ä¸é›†åˆåˆ›å»ºä»£ç ç•¥) ...
client = weaviate.connect_to_wcs(
    cluster_url="YOUR_WCS_URL",
    auth_credentials=weaviate.auth.AuthApiKey("YOUR_API_KEY")
)

# åˆ›å»º Collectionï¼ˆè‡ªåŠ¨å‘é‡åŒ–ï¼‰
collection = client.collections.create(
    name="Article",
    vectorizer_config=weaviate.Configure.Vectorizer.text2vec_openai()
)

# æ’å…¥æ•°æ®ï¼ˆè‡ªåŠ¨ç”Ÿæˆå‘é‡ï¼‰
collection.data.insert({
    "title": "AI æŠ€æœ¯å‘å±•",
    "content": "äººå·¥æ™ºèƒ½æ­£åœ¨æ”¹å˜ä¸–ç•Œ..."
})

# 1. è¯­ä¹‰æœç´¢ (The Radar)
# "è¿™å°±å¥½æ¯”ç”¨é›·è¾¾æ‰«æï¼Œå¯»æ‰¾â€˜æ„æ€â€™ä¸Šæ¥è¿‘çš„ç›®æ ‡ï¼Œä¸åœ¨ä¹ç”¨è¯æ˜¯å¦å®Œå…¨ä¸€è‡´"
results = collection.query.near_text(
    query="æœºå™¨å­¦ä¹ çš„æœªæ¥",
    limit=5
)

# 2. æ··åˆæœç´¢ (The Fusion)
# "ç»“åˆé›·è¾¾ä¸å­—å…¸ã€‚alpha å‚æ•°å°±åƒâ€˜æ··éŸ³å°æ¨æ†â€™ï¼š"
#  - alpha = 0.0 (çº¯ç†æ€§): å®Œå…¨ä¾èµ–å…³é”®è¯åŒ¹é… (BM25)ï¼Œå°±åƒä¼ ç»Ÿçš„ SQL æœç´¢
#  - alpha = 1.0 (çº¯æ„Ÿæ€§): å®Œå…¨ä¾èµ–è¯­ä¹‰ç†è§£ (Vector)ï¼Œå°±åƒäººç±»çš„ç›´è§‰
#  - alpha = 0.5 (å‡è¡¡): ç†æ€§ä¸æ„Ÿæ€§çš„å®Œç¾èåˆï¼Œé€šå¸¸èƒ½è·å¾—æœ€ä½³æ•ˆæœ
results = collection.query.hybrid(
    query="AI applications",
    alpha=0.5,
    limit=5
)

# 3. ç”Ÿæˆå¼æœç´¢ (The Reader)
# "ä¸ä»…å¸®ä½ æŠŠç›¸å…³ä¹¦ç±æ‰¾å‡ºæ¥(æ£€ç´¢)ï¼Œè¿˜å½“åœºè¯»ä¸€éå¹¶å›ç­”ä½ çš„é—®é¢˜(ç”Ÿæˆ)"
# è¿™å°±æ˜¯å†…ç½®çš„ RAG èƒ½åŠ›ï¼Œæå¤§ç®€åŒ–äº†åº”ç”¨å¼€å‘æµç¨‹
results = collection.generate.near_text(
    query="äººå·¥æ™ºèƒ½",
    grouped_task="è¯·åŸºäºä»¥ä¸‹æ£€ç´¢ç»“æœï¼Œæ€»ç»“ AI çš„æ ¸å¿ƒå‘å±•è¶‹åŠ¿",
    limit=3
)
```

**å…¨èƒ½æ£€ç´¢çŸ©é˜µ**ï¼š

| åŠŸèƒ½æ¨¡å—                           | ç±»æ¯”           | æ ¸å¿ƒä»·å€¼                                                   |
| :--------------------------------- | :------------- | :--------------------------------------------------------- |
| **Vector Search** (`near_text`)    | **æ¨¡ç³Šæ„ŸçŸ¥**ã€‚ | ç©¿é€å­—é¢å·®å¼‚ï¼Œæ•æ‰æ½œåœ¨æ„å›¾ã€‚é€‚åˆâ€œæœæ„æ€â€ã€‚                 |
| **BM25 Search** (`bm25`)           | **ç²¾å‡†å®šä½**ã€‚ | ä¸€å­—ä¸å·®åœ°åŒ¹é…ä¸“æœ‰åè¯æˆ–ç‰¹å®šçŸ­è¯­ã€‚é€‚åˆâ€œæœåå­—â€ã€‚           |
| **Hybrid Search** (`hybrid`)       | **åˆšæŸ”å¹¶æµ**ã€‚ | é€šè¿‡ `alpha` æ¨æ†è°ƒèŠ‚â€œç†æ€§(å…³é”®è¯)â€ä¸â€œæ„Ÿæ€§(å‘é‡)â€çš„æ¯”ä¾‹ã€‚  |
| **Generative Search** (`generate`) | **å³é—®å³ç­”**ã€‚ | ä¸ä»…æä¾›é“¾æ¥ï¼Œç›´æ¥æ ¹æ®æ£€ç´¢å†…å®¹ç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ (å†…ç½® RAG)ã€‚    |
| **Filters** (`filters`)            | **ä¸¥æ ¼æŠŠå…³**ã€‚ | åœ¨æœç´¢å‰/åè¿›è¡Œç¡¬æ€§æ¡ä»¶è¿‡æ»¤ï¼ˆå¦‚ï¼šå¿…é¡»æ˜¯â€œ2025 å¹´â€çš„æ–‡ä»¶ï¼‰ã€‚ |
| **Group By** (`group_by`)          | **å»é‡å½’ç±»**ã€‚ | é¿å…æœç´¢ç»“æœè¢«åŒä¸€æ¥æºåˆ·å±ï¼ŒæŒ‰å­—æ®µèšåˆå±•ç¤ºå¤šæ ·åŒ–å†…å®¹ã€‚     |

### 4.6 éƒ¨ç½²é€‰é¡¹

Weaviate æä¾›äº†ä»â€œè½»é‡çº§èƒŒåŒ…â€åˆ°â€œé‡å‹å ¡å’â€çš„å…¨å¥—æ–¹æ¡ˆï¼Œé€‚åº”ä¸åŒé˜¶æ®µçš„éœ€æ±‚ï¼š

| éƒ¨ç½²æ–¹å¼           | ç±»æ¯”           | é€‚ç”¨åœºæ™¯      | ç‰¹ç‚¹                                                                  |
| :----------------- | :------------- | :------------ | :-------------------------------------------------------------------- |
| **Embedded**       | **éšèº«èƒŒåŒ…**   | å¿«é€Ÿè¯„ä¼°/æµ‹è¯• | **é›¶ä¾èµ–**ã€‚ç›´æ¥ä½œä¸º Python åº“è¿è¡Œï¼Œéšèº«æºå¸¦ï¼Œä»£ç å³è®¾æ–½ã€‚            |
| **Docker**         | **é›†è£…ç®±**     | æœ¬åœ°å¼€å‘      | **æ ‡å‡†å°è£…**ã€‚ä¸€æ¡å‘½ä»¤å¯åŠ¨ï¼Œç¯å¢ƒä¸€è‡´ï¼Œå¼€å‘è€…çš„æœ€çˆ±ã€‚                  |
| **Kubernetes**     | **æ‘©å¤©å¤§æ¥¼**   | è‡ªæ‰˜ç®¡ç”Ÿäº§    | **ç¨³å¦‚æ³°å±±**ã€‚é«˜å¯ç”¨é›†ç¾¤ï¼Œæ”¯æŒå¤§è§„æ¨¡æ°´å¹³æ‰©å±•ï¼Œé€‚åˆä¼ä¸šçº§ã€‚            |
| **Weaviate Cloud** | **å…¨æœåŠ¡é…’åº—** | ç”Ÿäº§ç¯å¢ƒ      | **æ‹åŒ…å…¥ä½**ã€‚å®˜æ–¹å…¨æ‰˜ç®¡ Serverlessï¼Œå…å»ä¸€åˆ‡è¿ç»´çƒ¦æ¼ã€‚Sandbox å…è´¹ã€‚ |

### 4.7 å‘é‡é‡åŒ–æŠ€æœ¯<sup>[[25]](#ref25)</sup>

**ä¸ºäº†åœ¨å¯¸åœŸå¯¸é‡‘çš„å†…å­˜é‡Œå­˜ä¸‹æµ·é‡æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦â€œå‹ç¼©é­”æ³•â€ã€‚**

å‘é‡é‡åŒ–ï¼ˆQuantizationï¼‰å°±åƒæ˜¯ç»™é«˜æ¸…å‘é‡ **â€œæ‹ç¼©ç•¥å›¾â€**ã€‚åŸå§‹å‘é‡ï¼ˆfloat32ï¼‰è™½ç„¶ç²¾å‡†ä½†ä½“ç§¯åºå¤§ï¼Œé€šè¿‡é‡åŒ–æŠ€æœ¯å°†å…¶â€œå‹ç¼©â€ä¸ºä½ç²¾åº¦æ•°æ®ï¼Œåœ¨æŸå¤±æå¾®å°ç²¾åº¦çš„æƒ…å†µä¸‹ï¼Œè®©å†…å­˜ç©ºé—´ **ç¬é—´å˜å¤§ 4~32 å€**ã€‚

| é‡åŒ–æ–¹æ³•          | åŸç†ç±»æ¯”                 | å‹ç¼©æ¯” | ç‰¹ç‚¹ä¸å»ºè®®                                                         |
| :---------------- | :----------------------- | :----- | :----------------------------------------------------------------- |
| **SQ** (Scalar)   | **é™ä½æ·±** (32 ä½ â†’8 ä½) | 4x     | **æœ€ç¨³å¥ (æ¨è)**ã€‚ä¿ç•™å¤§éƒ¨åˆ†ç»†èŠ‚ï¼Œç²¾åº¦æŸå¤±å¾®ä¹å…¶å¾®ï¼Œæ— éœ€è®­ç»ƒã€‚    |
| **BQ** (Binary)   | **äºŒå€¼åŒ–** (0 å’Œ 1)      | 32x    | **æœ€æè‡´**ã€‚ç›´æ¥å‹æˆ 0/1 å­—ç¬¦ä¸²ï¼Œæ­é… OpenAI v3 ç­‰æ¨¡å‹æ•ˆæœæƒŠäººã€‚   |
| **PQ** (Product)  | **æŸ¥å­—å…¸** (åˆ‡å—èšç±»)    | ~24x   | **è€ç‰Œå¼ºåŠ›**ã€‚æŠŠå‘é‡åˆ‡ç¢äº†ç”¨â€œä»£å·â€å­˜å‚¨ï¼Œå‹ç¼©é«˜ä½†éœ€è¦åŸºäºæ•°æ®è®­ç»ƒã€‚ |
| **RQ** (Rotation) | **ç©ºé—´å˜æ¢**             | 4x/32x | **çµæ´»å¤šå˜**ã€‚é€šè¿‡æ—‹è½¬åæ ‡ç³»æ›´å¥½åœ°å¯¹é½æ•°æ®ï¼Œæ— éœ€è®­ç»ƒå³å¯å³æ—¶å¯ç”¨ã€‚ |

```python
# å¯ç”¨ SQ å‹ç¼©ï¼ˆå…¼é¡¾é€Ÿåº¦ä¸ç²¾åº¦çš„æœ€ä½³å¹³è¡¡ç‚¹ï¼‰
collection = client.collections.create(
    name="Article",
    vectorizer_config=weaviate.Configure.Vectorizer.text2vec_openai(),
    vector_index_config=weaviate.Configure.VectorIndex.hnsw(
        quantizer=weaviate.Configure.VectorIndex.Quantizer.sq()
    )
)
```

> [!TIP]
>
> ä¸ºäº†å¼¥è¡¥â€œçœ‹ç¼©ç•¥å›¾â€å¯èƒ½çœ‹èµ°çœ¼çš„é—®é¢˜ï¼ŒWeaviate ä¼šè‡ªåŠ¨é‡‡ç”¨ **â€œå¤šæ‹¿ç‚¹ + å†æ ¸å¯¹â€ (Over-fetch + Rescore)** ç­–ç•¥ï¼šå…ˆç”¨ç¼©ç•¥å›¾å¿«é€Ÿåœˆå‡ºä¸€æ‰¹å«Œç–‘äººï¼Œå†æ‹¿åŸå§‹é«˜æ¸…å›¾è¿›è¡Œå¤æ ¸ï¼Œç¡®ä¿æœ€ç»ˆç»™ä½ çš„ç»“æœä¾ç„¶ç²¾å‡†æ— è¯¯ã€‚

### 4.8 é›†ç¾¤æ¶æ„<sup>[[26]](#ref26)</sup>

Weaviate é‡‡ç”¨äº†ä¸€ç§**â€œå¤§è„‘ä¸è‚¢ä½“åˆ†å·¥â€**çš„æ··åˆæ¶æ„ï¼Œå·§å¦™åœ°ç»“åˆäº†å¼ºä¸€è‡´æ€§ä¸é«˜å¯ç”¨æ€§ï¼š

- **æ§åˆ¶é¢ï¼ˆå¤§è„‘ï¼‰**ï¼šä½¿ç”¨ **Raft** åè®®ã€‚å°±åƒ**è®®ä¼š**ï¼Œæ‰€æœ‰èŠ‚ç‚¹å¿…é¡»å¯¹â€œæ³•å¾‹â€ï¼ˆSchema/å…ƒæ•°æ®ï¼‰è¾¾æˆç»å¯¹ä¸€è‡´ã€‚
- **æ•°æ®é¢ï¼ˆè‚¢ä½“ï¼‰**ï¼šä½¿ç”¨ **Leaderless** æ¶æ„ã€‚å°±åƒ**ç‹¬ç«‹è½¦é—´**ï¼Œå¹²æ´»ï¼ˆå†™å…¥/æŸ¥è¯¢ï¼‰æ—¶äº’ä¸å¹²æ‰°ï¼Œè¿½æ±‚æè‡´æ•ˆç‡ï¼Œå…è®¸çŸ­æš‚çš„ä¿¡æ¯æ»åã€‚

```mermaid
graph TB
    subgraph "Coordination: åè°ƒè¿‡ç¨‹"
        direction TB

        Client[å®¢æˆ·ç«¯] --> |è¯·æ±‚| Node2
        Node2 --> |åè°ƒ| Node1 & Node3
    end

    subgraph "Cluster: æ··åˆæ¶æ„æœ‰æœºä½“"
        direction TB

        subgraph "Node 1"
            R1["ğŸ§  Schema<br/>(Raft Follower)"]:::meta
            S1["ğŸ“¦ Shard 1<br/>(Data Leader)"]:::data
            S2r["ğŸ“« Shard 2<br/>(Replica)"]:::replica
        end

        subgraph "Node 2 (Leader)"
            R2["ğŸ§  Schema<br/>(Raft Leader)"]:::meta_leader
            S2["ğŸ“¦ Shard 2<br/>(Data Leader)"]:::data
            S3r["ğŸ“« Shard 3<br/>(Replica)"]:::replica
        end

        subgraph "Node 3"
            R3["ğŸ§  Schema<br/>(Raft Follower)"]:::meta
            S3["ğŸ“¦ Shard 3<br/>(Data Leader)"]:::data
            S1r["ğŸ“« Shard 1<br/>(Replica)"]:::replica
        end
    end

    classDef meta fill:#4285f4,color:#fff,stroke:none
    classDef meta_leader fill:#0d47a1,color:#fff,stroke:#ffeb3b,stroke-width:2px
    classDef data fill:#faad14,color:#fff,stroke:none
    classDef replica fill:#ffe58f,color:#666,stroke:dashed
```

| ç»„ä»¶                   | åè®®           | ç±»æ¯”                  | ç‰¹ç‚¹                                                                                     |
| :--------------------- | :------------- | :-------------------- | :--------------------------------------------------------------------------------------- |
| **å…ƒæ•°æ®** (Schema)    | **Raft**       | **è®®ä¼š (Parliament)** | **å¼ºä¸€è‡´æ€§**ã€‚ä¿®æ”¹ Schemaï¼ˆå¦‚å¢åŠ ç±»ï¼‰éœ€è¦å…¨ä½“æŠ•ç¥¨é€šè¿‡ï¼Œç¡®ä¿å¤§å®¶éµå®ˆåŒä¸€å¥—è§„åˆ™ã€‚          |
| **æ•°æ®å¯¹è±¡** (Objects) | **Leaderless** | **è½¦é—´ (Workshops)**  | **é«˜å¯ç”¨æ€§**ã€‚äº¦ç§° Dynamo é£æ ¼ã€‚è¯»å†™åƒæµæ°´çº¿ä¸€æ ·å¹¶è¡Œï¼Œæ— éœ€ç­‰å¾…ä¸­å¤®æŒ‡æŒ¥ï¼Œé€‚åˆå¤§è§„æ¨¡ååã€‚ |

> [!TIP]
>
> **å…³é”®æœºåˆ¶**ï¼š
>
> 1. **åè°ƒèŠ‚ç‚¹ (Coordinator)**ï¼šä»»ä½•æ¥æ”¶åˆ°ç”¨æˆ·è¯·æ±‚çš„èŠ‚ç‚¹è‡ªåŠ¨æˆä¸ºâ€œåè°ƒè€…â€ï¼Œå®ƒå°±åƒ**å·¥å¤´**ï¼Œè´Ÿè´£å»å„ä¸ªè½¦é—´ï¼ˆåˆ†ç‰‡ï¼‰æ”¶é›†æ•°æ®å¹¶ç»„è£…ç»“æœã€‚
> 2. **å¯è°ƒä¸€è‡´æ€§**ï¼šé€šè¿‡ Replication Factor å’Œ Consistency Levelï¼Œå¯ä»¥åƒè°ƒèŠ‚**æ—‹é’®**ä¸€æ ·æ§åˆ¶è¯»å†™ç­–ç•¥ï¼ˆONE/QUORUM/ALLï¼‰ã€‚æƒ³å¿«å°±é€‰ ONEï¼ˆé—®ä¸€ä¸ªäººå°±è¡Œï¼‰ï¼Œæƒ³ç¨³å°±é€‰ QUORUMï¼ˆé—®åŠæ•°ä»¥ä¸Šäººï¼‰ã€‚

## 5. Pinecone

### 5.1 äº§å“æ¦‚è¿°

**æ ¸å¿ƒå®šä½**ï¼šé›¶è¿ç»´ã€é«˜æ€§èƒ½çš„å…¨æ‰˜ç®¡å‘é‡æ•°æ®åº“ SaaS æœåŠ¡ã€‚

Pinecone æ˜¯ä¸€æ¬¾å…¨æ‰˜ç®¡çš„å‘é‡æ•°æ®åº“æœåŠ¡ï¼Œä¸“ä¸ºç”Ÿäº§ç¯å¢ƒä¸­çš„ AI åº”ç”¨è®¾è®¡<sup>[[16]](#ref16)</sup>ã€‚å®ƒæä¾› Serverless æ¶æ„ï¼Œç”¨æˆ·æ— éœ€ç®¡ç†åŸºç¡€è®¾æ–½å³å¯ä½¿ç”¨é«˜æ€§èƒ½å‘é‡æœç´¢ã€‚

```mermaid
graph TB
    subgraph "Pinecone äº§å“çº¿"
        DB[Pinecone Database<br/>å‘é‡æ•°æ®åº“]
        AS[Pinecone Assistant<br/>AI åŠ©æ‰‹]
        INF[Integrated Inference<br/>å†…ç½®åµŒå…¥]
    end

    DB --> AS
    DB --> INF

    style DB fill:#5048E5,color:#fff
    style AS fill:#8B5CF6,color:#fff
```

### 5.2 æ ¸å¿ƒç‰¹æ€§

| ç‰¹æ€§           | æè¿°                | ä¼˜åŠ¿              |
| -------------- | ------------------- | ----------------- |
| **å…¨æ‰˜ç®¡**     | Serverless æ¶æ„     | é›¶è¿ç»´ï¼ŒæŒ‰éœ€æ‰©å±•  |
| **é›†æˆåµŒå…¥**   | å†…ç½® Embedding æ¨¡å‹ | ç®€åŒ–å¼€å‘æµç¨‹      |
| **å‘½åç©ºé—´**   | å¤šç§Ÿæˆ·æ•°æ®éš”ç¦»      | å•ç´¢å¼•å¤šåˆ†åŒº      |
| **å…ƒæ•°æ®è¿‡æ»¤** | æ ‡é‡å±æ€§è¿‡æ»¤        | å‘é‡ + ç»“æ„åŒ–æŸ¥è¯¢ |
| **é‡æ’åº**     | å†…ç½® Reranker       | æå‡æ£€ç´¢ç²¾åº¦      |

### 5.3 ç´¢å¼•ç±»å‹

Pinecone æ”¯æŒä¸¤ç§ç´¢å¼•ç±»å‹<sup>[[17]](#ref17)</sup>ï¼š

| ç´¢å¼•ç±»å‹         | æè¿°         | é€‚ç”¨åœºæ™¯          |
| ---------------- | ------------ | ----------------- |
| **Dense Index**  | ç¨ å¯†å‘é‡ç´¢å¼• | è¯­ä¹‰æœç´¢ï¼ˆä¸»æµï¼‰  |
| **Sparse Index** | ç¨€ç–å‘é‡ç´¢å¼• | BM25 ç±»å…³é”®è¯æœç´¢ |

```python
from pinecone import Pinecone

# åˆå§‹åŒ–å®¢æˆ·ç«¯
pc = Pinecone(api_key="YOUR_API_KEY")

# åˆ›å»º Dense Indexï¼ˆå¸¦é›†æˆåµŒå…¥ï¼‰
pc.create_index_for_model(
    name="my-index",
    cloud="aws",
    region="us-east-1",
    embed={
        "model": "llama-text-embed-v2",
        "field_map": {"text": "chunk_text"}
    }
)

# åˆ›å»º Sparse Index
pc.create_index(
    name="sparse-index",
    dimension=None,  # Sparse æ— éœ€æŒ‡å®š
    metric="dotproduct",
    spec=ServerlessSpec(cloud="aws", region="us-east-1")
)
```

### 5.4 å‘½åç©ºé—´ä¸å¤šç§Ÿæˆ·

Pinecone ä½¿ç”¨å‘½åç©ºé—´å®ç°æ•°æ®éš”ç¦»<sup>[[18]](#ref18)</sup>ï¼š

```mermaid
graph TB
    subgraph "Index"
        NS1[Namespace: tenant_a]
        NS2[Namespace: tenant_b]
        NS3[Namespace: tenant_c]
    end

    App[åº”ç”¨ç¨‹åº] --> NS1 & NS2 & NS3

    style NS1 fill:#4285f4,color:#fff
    style NS2 fill:#34a853,color:#fff
    style NS3 fill:#fbbc04,color:#000
```

- æ¯ä¸ªç´¢å¼•æœ€å¤š **100,000** ä¸ªå‘½åç©ºé—´
- æŸ¥è¯¢å’Œå†™å…¥æ“ä½œæŒ‡å®šå‘½åç©ºé—´
- å®ç°å¤šç§Ÿæˆ·æ•°æ®éš”ç¦»

### 5.5 æœç´¢ä¸è¿‡æ»¤

```python
# è¿æ¥ç´¢å¼•
index = pc.Index("my-index")

# æ–‡æœ¬æœç´¢ï¼ˆé›†æˆåµŒå…¥ï¼‰
results = index.query(
    data={"inputs": {"text": "What is machine learning?"}},
    top_k=10,
    include_metadata=True
)

# å¸¦å…ƒæ•°æ®è¿‡æ»¤çš„æœç´¢
results = index.query(
    vector=[0.1, 0.2, ...],
    top_k=10,
    filter={"genre": {"$eq": "technology"}}
)

# æ··åˆæœç´¢ï¼ˆéœ€è¦åŒæ—¶ä½¿ç”¨ Dense + Sparse ç´¢å¼•ï¼‰
```

**è¿‡æ»¤æ“ä½œç¬¦**ï¼š

| æ“ä½œç¬¦ | æè¿°   | ç¤ºä¾‹                             |
| ------ | ------ | -------------------------------- |
| `$eq`  | ç­‰äº   | `{"field": {"$eq": "value"}}`    |
| `$ne`  | ä¸ç­‰äº | `{"field": {"$ne": "value"}}`    |
| `$gt`  | å¤§äº   | `{"field": {"$gt": 10}}`         |
| `$in`  | åŒ…å«äº | `{"field": {"$in": ["a", "b"]}}` |
| `$and` | é€»è¾‘ä¸ | `{"$and": [cond1, cond2]}`       |
| `$or`  | é€»è¾‘æˆ– | `{"$or": [cond1, cond2]}`        |

### 5.6 å®šä»·æ¨¡å¼

| è®¡åˆ’           | è´¹ç”¨   | ç‰¹ç‚¹     | é™åˆ¶               |
| -------------- | ------ | -------- | ------------------ |
| **Starter**    | å…è´¹   | å…¥é—¨ä½“éªŒ | 1 ä¸ªåŒºåŸŸï¼Œæœ‰é™é¢åº¦ |
| **Standard**   | æŒ‰ç”¨é‡ | ç”Ÿäº§çº§   | æ›´é«˜é™åˆ¶           |
| **Enterprise** | è‡ªå®šä¹‰ | ä¼ä¸šçº§   | å®šåˆ¶åŒ–æ”¯æŒ         |

### 5.7 ä¼˜åŠ£åŠ¿åˆ†æ

**ä¼˜åŠ¿**ï¼š

- âœ… é›¶è¿ç»´ï¼Œå¼€ç®±å³ç”¨
- âœ… é«˜å¯ç”¨ï¼Œè‡ªåŠ¨æ‰©å±•
- âœ… é›†æˆåµŒå…¥å’Œé‡æ’åº
- âœ… ä¼ä¸šçº§ SLA ä¿éšœ

**åŠ£åŠ¿**ï¼š

- âŒ ä»… SaaSï¼Œæ— æ³•ç§æœ‰éƒ¨ç½²
- âŒ æˆæœ¬è¾ƒé«˜ï¼ˆå¤§è§„æ¨¡åœºæ™¯ï¼‰
- âŒ æ•°æ®éœ€ä¼ è¾“åˆ°äº‘ç«¯
- âŒ åŠŸèƒ½ç›¸å¯¹ç®€å•

### 5.8 æ··åˆæœç´¢<sup>[[27]](#ref27)</sup>

Pinecone æ”¯æŒä¸¤ç§æ··åˆæœç´¢å®ç°æ–¹å¼ï¼š

| æ–¹å¼                   | ä¼˜åŠ¿                                 | åŠ£åŠ¿                               |
| ---------------------- | ------------------------------------ | ---------------------------------- |
| **åŒç´¢å¼•æ–¹å¼**ï¼ˆæ¨èï¼‰ | çµæ´»ã€æ”¯æŒå•ç‹¬ sparse æŸ¥è¯¢ã€å¤šçº§é‡æ’ | éœ€ç®¡ç†ä¸¤ä¸ªç´¢å¼•                     |
| **å•æ··åˆç´¢å¼•**         | å®ç°ç®€å•                             | ä¸æ”¯æŒ sparse-onlyã€ä¸æ”¯æŒé›†æˆåµŒå…¥ |

```python
# åŒç´¢å¼•æ··åˆæœç´¢
# 1. åˆ›å»º Dense + Sparse ç´¢å¼•
pc.create_index_for_model(
    name="dense-index",
    cloud="aws", region="us-east-1",
    embed={"model": "llama-text-embed-v2", "field_map": {"text": "chunk_text"}}
)
pc.create_index_for_model(
    name="sparse-index",
    cloud="aws", region="us-east-1",
    embed={"model": "pinecone-sparse-english-v0", "field_map": {"text": "chunk_text"}}
)

# 2. åˆ†åˆ«æŸ¥è¯¢åä½¿ç”¨ RRF èåˆç»“æœ
```

### 5.9 é‡æ’åº<sup>[[28]](#ref28)</sup>

Pinecone æ”¯æŒé›†æˆé‡æ’åºå’Œç‹¬ç«‹é‡æ’åºï¼š

```python
# é›†æˆé‡æ’åº - åœ¨ search ä¸­ç›´æ¥ä½¿ç”¨
ranked_results = index.search(
    namespace="example-namespace",
    query={"inputs": {"text": "Disease prevention"}, "top_k": 4},
    rerank={
        "model": "bge-reranker-v2-m3",
        "top_n": 2,
        "rank_fields": ["chunk_text"]
    },
    fields=["category", "chunk_text"]
)
```

**å¯ç”¨é‡æ’åºæ¨¡å‹**ï¼š

| æ¨¡å‹                 | æœ€å¤§ Token | æœ€å¤§æ–‡æ¡£æ•° | ç‰¹ç‚¹                  |
| -------------------- | ---------- | ---------- | --------------------- |
| `cohere-rerank-3.5`  | 40,000     | 200        | é«˜ç²¾åº¦ã€å¤šå­—æ®µæ”¯æŒ    |
| `bge-reranker-v2-m3` | 1,024      | 100        | å¹³è¡¡æ€§èƒ½ä¸ç²¾åº¦        |
| `pinecone-rerank-v0` | 512        | 100        | Pinecone è‡ªç ”ã€ä½å»¶è¿Ÿ |

---

## 6. Google Cloud Spanner

### 6.1 äº§å“æ¦‚è¿°

**æ ¸å¿ƒå®šä½**ï¼š**å…¨çƒåˆ†å¸ƒå¼å…³ç³»å‹æ•°æ®åº“ + AI åŸç”Ÿå‘é‡æ£€ç´¢èƒ½åŠ›çš„"é‡å‹èˆªæ¯"æ–¹æ¡ˆï¼Œä¸“ä¸ºéœ€è¦ ACID äº‹åŠ¡ã€å…¨çƒä¸€è‡´æ€§ä¸å‘é‡è¯­ä¹‰æœç´¢ä¸‰ä½ä¸€ä½“çš„ä¼ä¸šçº§ AI åº”ç”¨è€Œç”Ÿã€‚**

Google Cloud Spanner æ˜¯ Google è‡ªç ”çš„å…¨çƒåˆ†å¸ƒå¼å…³ç³»å‹æ•°æ®åº“ï¼Œä»¥å…¶ç‹¬åˆ›çš„ **TrueTime** æŠ€æœ¯å®ç°è·¨æ´²é™…çš„å¼ºä¸€è‡´æ€§è€Œé—»å<sup>[[29]](#ref29)</sup>ã€‚è‡ª 2024 å¹´èµ·ï¼ŒSpanner å…¨é¢æ‹¥æŠ± AI æ—¶ä»£ï¼Œå°†å‘é‡æ£€ç´¢èƒ½åŠ›ã€Graph æŸ¥è¯¢ï¼ˆISO GQLï¼‰ã€ä»¥åŠä¸ Vertex AI çš„æ·±åº¦é›†æˆçº³å…¥æ ¸å¿ƒèƒ½åŠ›çŸ©é˜µï¼Œæˆä¸ºä¸šç•Œé¦–ä¸ªå°†**å…³ç³»å‹ã€å›¾æ•°æ®åº“ã€å‘é‡æœç´¢ã€AI/ML é¢„æµ‹**èä¸ºä¸€ä½“çš„ **Multi-Model** æ•°æ®åº“<sup>[[30]](#ref30)</sup>ã€‚

å¦‚æœå°†å…¶ä»–å‘é‡æ•°æ®åº“æ¯”ä½œ**ä¸“é¡¹èµ›è‰‡**ï¼ˆä¸“ç²¾æŸä¸€é¢†åŸŸï¼‰ï¼Œé‚£ä¹ˆ Spanner å°±åƒä¸€è‰˜**æ ¸åŠ¨åŠ›èˆªç©ºæ¯èˆ°**ï¼š

- **èµ›è‰‡ï¼ˆMilvus/Weaviate ç­‰ï¼‰**ï¼šè½»å¿«æ•æ·ï¼Œä¸“ä¸ºå‘é‡æ£€ç´¢è¿™æ¡èµ›é“è€Œç”Ÿï¼Œå†²åˆºæå¿«ã€‚
- **èˆªç©ºæ¯èˆ°ï¼ˆSpannerï¼‰**ï¼šä½“å‹åºå¤§ã€é€ ä»·æ˜‚è´µï¼Œä½†èƒ½åŒæ—¶èµ·é™æˆ˜æ–—æœºï¼ˆå‘é‡æœç´¢ï¼‰ã€ç›´å‡æœºï¼ˆGraph æŸ¥è¯¢ï¼‰ã€é¢„è­¦æœºï¼ˆML é¢„æµ‹ï¼‰ï¼Œå¹¶åœ¨å…¨çƒä»»æ„æµ·åŸŸï¼ˆè·¨åŒºåŸŸï¼‰ä¿æŒèˆ°é˜ŸååŒï¼ˆå¼ºä¸€è‡´æ€§ï¼‰ã€‚å®ƒä¸è¿½æ±‚å•ä¸€ç»´åº¦çš„æè‡´ï¼Œè€Œæ˜¯è¿½æ±‚**å…¨æ ˆèƒ½åŠ›çš„ç»Ÿä¸€ä¸å¯é **ã€‚

```mermaid
graph LR
    subgraph "Spannerï¼šMulti-Model èˆªç©ºæ¯èˆ°"
        direction LR
        Core[Spanner Core<br/>å…¨çƒåˆ†å¸ƒå¼<br/>å¼ºä¸€è‡´æ€§ ACID]:::core
        Core --> Vec[å‘é‡æ£€ç´¢<br/>ANN/KNN]:::ai
        Core --> Graph[Spanner Graph<br/>ISO GQL]:::ai
        Core --> ML[Vertex AI é›†æˆ<br/>ML.PREDICT]:::ai
        Core --> FTS[å…¨æ–‡æ£€ç´¢<br/>Full-Text Search]:::ai

        Vec & Graph & ML & FTS --> RAG[ç»Ÿä¸€ RAG/GraphRAG<br/>å·¥ä½œæµ]:::rag
    end

    classDef core fill:#4285f4,color:#fff,stroke:none
    classDef ai fill:#34a853,color:#fff,stroke:none
    classDef rag fill:#ea4335,color:#fff,stroke:none
```

### 6.2 æ ¸å¿ƒç‰¹æ€§

| ç‰¹æ€§               | æè¿°                   | æŠ€æœ¯è§„æ ¼                                                   |
| ------------------ | ---------------------- | ---------------------------------------------------------- |
| **å‘é‡æ•°æ®ç±»å‹**   | åŸç”Ÿæ”¯æŒå‘é‡åµŒå…¥å­˜å‚¨   | `ARRAY<FLOAT32>` / `ARRAY<FLOAT64>` + `vector_length` æ³¨è§£ |
| **æœ€å¤§ç»´åº¦**       | å–å†³äºå­˜å‚¨é…ç½®         | æœªæ˜ç¡®é™åˆ¶ï¼Œæ”¯æŒå¸¸è§åµŒå…¥æ¨¡å‹ç»´åº¦ï¼ˆ768/1536 ç­‰ï¼‰            |
| **è·ç¦»å‡½æ•°**       | 3 ç§æ ¸å¿ƒåº¦é‡æ–¹å¼       | COSINEã€EUCLIDEANã€DOT_PRODUCT                             |
| **ç´¢å¼•ç±»å‹**       | åŸºäºæ ‘çš„è¿‘ä¼¼æœ€è¿‘é‚»ç´¢å¼• | Tree-based Vector Indexï¼ˆ2 å±‚/3 å±‚é…ç½®ï¼‰                   |
| **ACID äº‹åŠ¡**      | å®Œæ•´åˆ†å¸ƒå¼äº‹åŠ¡ä¿è¯     | âœ… å…¨å±€å¼ºä¸€è‡´æ€§ï¼ˆTrueTime + Paxosï¼‰                        |
| **Graph æ”¯æŒ**     | åŸç”Ÿå›¾æ•°æ®åº“èƒ½åŠ›       | Spanner Graph + ISO GQL æ ‡å‡†                               |
| **ML é›†æˆ**        | å†…ç½® AI æ¨¡å‹è°ƒç”¨       | `ML.PREDICT` + Vertex AI æ¨¡å‹ç›´è¿                          |
| **LangChain é›†æˆ** | å®˜æ–¹ Python åº“æ”¯æŒ     | SpannerVectorStore / SpannerGraphStore ç­‰                  |

### 6.3 å‘é‡ç´¢å¼•ç®—æ³•

Spanner é‡‡ç”¨ **Tree-based Vector Index**ï¼ˆåŸºäºæ ‘çš„å‘é‡ç´¢å¼•ï¼‰ä½œä¸ºå…¶ ANN æœç´¢çš„æ ¸å¿ƒç®—æ³•<sup>[[31]](#ref31)</sup>ã€‚å¯ä»¥å°†å…¶ç†è§£ä¸ºä¸€ç§**å¤šçº§åˆ†åŒºç­–ç•¥**ï¼š

- **tree_depthï¼ˆæ ‘æ·±åº¦ï¼‰**ï¼šå†³å®šç´¢å¼•çš„"å±‚çº§æ•°"ã€‚å°±åƒ**è¡Œæ”¿åŒºåˆ’**â€”â€”å±‚çº§è¶Šå¤šï¼Œåˆ’åˆ†è¶Šç»†ã€‚
  - `tree_depth = 2`ï¼šé€‚ç”¨äº < 1000 ä¸‡è¡Œçš„æ•°æ®é›†ï¼ˆçœ â†’ å¸‚ï¼‰
  - `tree_depth = 3`ï¼šé€‚ç”¨äº ~ 100 äº¿è¡Œçš„æ•°æ®é›†ï¼ˆçœ â†’ å¸‚ â†’ åŒºï¼‰
- **num_leavesï¼ˆå¶èŠ‚ç‚¹æ•°ï¼‰**ï¼šæœ€åº•å±‚çš„"åˆ†åŒºæ•°é‡"ã€‚æ¨èè®¾ç½®ä¸º `sqrt(row_count)`ã€‚
- **num_leaves_to_searchï¼ˆæœç´¢å¶æ•°ï¼‰**ï¼šæŸ¥è¯¢æ—¶æ‰«æçš„åˆ†åŒºæ•°é‡ã€‚æ¨èè®¾ç½®ä¸º `num_leaves` çš„ 1%ï¼Œå¸¦è¿‡æ»¤æ¡ä»¶æ—¶åº”é€‚å½“å¢å¤§ã€‚

```sql
-- åˆ›å»ºå‘é‡åˆ—ï¼ˆå¿…é¡»æŒ‡å®š vector_lengthï¼‰
CREATE TABLE Documents (
    DocId INT64 NOT NULL,
    DocContents BYTES(MAX),
    DocEmbedding ARRAY<FLOAT32>(vector_length=>768) NOT NULL,
) PRIMARY KEY (DocId);

-- åˆ›å»º 2 å±‚å‘é‡ç´¢å¼•ï¼ˆé€‚ç”¨äº < 1000ä¸‡è¡Œï¼‰
CREATE VECTOR INDEX DocEmbeddingIndex
ON Documents(DocEmbedding)
STORING (DocContents)
OPTIONS (
    distance_type = 'COSINE',
    tree_depth = 2,
    num_leaves = 1000
);

-- åˆ›å»º 3 å±‚å‘é‡ç´¢å¼•ï¼ˆé€‚ç”¨äºå¤§è§„æ¨¡æ•°æ®ï¼‰
CREATE VECTOR INDEX DocEmbeddingIndexLarge
ON Documents(DocEmbedding)
OPTIONS (
    distance_type = 'COSINE',
    tree_depth = 3,
    num_branches = 1000,
    num_leaves = 1000000
);
```

**å‘é‡ç´¢å¼•å‚æ•°è°ƒä¼˜æŒ‡å—**ï¼š

| æ•°æ®è§„æ¨¡         | tree_depth | num_leaves        | num_leaves_to_search |
| :--------------- | :--------- | :---------------- | :------------------- |
| **< 10M (å°å‹)** | 2          | `sqrt(row_count)` | 1% of num_leaves     |
| **10M+ (å¤§å‹)**  | 3          | `sqrt(row_count)` | 1% of num_leaves     |
| **å¸¦è¿‡æ»¤æŸ¥è¯¢**   | -          | -                 | é€‚å½“å¢å¤§ä»¥ä¿è¯å¬å›   |

> [!TIP]
>
> **æœ€ä½³å®è·µ**<sup>[[32]](#ref32)</sup>ï¼š
>
> 1. **å…ˆæ’å…¥æ•°æ®ï¼Œåå»ºç´¢å¼•**ï¼šå‘é‡ç´¢å¼•çš„æ ‘ç»“æ„åœ¨åˆ›å»ºæ—¶åŸºäºç°æœ‰æ•°æ®ä¼˜åŒ–ï¼Œåç»­å¤§é‡æ’å…¥å¯èƒ½å¯¼è‡´ç»“æ„æ¬¡ä¼˜ã€‚
> 2. **ä½¿ç”¨ STORING å­å¥**ï¼šå°†è¿‡æ»¤æ¡ä»¶åˆ—å­˜å‚¨åœ¨ç´¢å¼•ä¸­ï¼Œå¯åœ¨å¶èŠ‚ç‚¹å±‚é¢ç›´æ¥è¿‡æ»¤ï¼Œæ˜¾è‘—æå‡æ€§èƒ½ã€‚
> 3. **å®šæœŸé‡å»ºç´¢å¼•**ï¼šå½“æ•°æ®åˆ†å¸ƒå‘ç”Ÿæ˜¾è‘—å˜åŒ–æ—¶ï¼Œé‡å»ºç´¢å¼•å¯æ¢å¤æœ€ä½³å¬å›ç‡ã€‚

### 6.4 æœç´¢èƒ½åŠ›

Spanner åŒæ—¶æ”¯æŒ **ANNï¼ˆè¿‘ä¼¼æœ€è¿‘é‚»ï¼‰** å’Œ **KNNï¼ˆç²¾ç¡®æœ€è¿‘é‚»ï¼‰** ä¸¤ç§å‘é‡æœç´¢æ¨¡å¼<sup>[[33]](#ref33)</sup>ï¼š

| æœç´¢ç±»å‹ | å‡½æ•°                                                                              | é€‚ç”¨åœºæ™¯      | ç‰¹ç‚¹                         |
| :------- | :-------------------------------------------------------------------------------- | :------------ | :--------------------------- |
| **ANN**  | `APPROX_COSINE_DISTANCE`<br/>`APPROX_EUCLIDEAN_DISTANCE`<br/>`APPROX_DOT_PRODUCT` | å¤§è§„æ¨¡æ•°æ®    | åˆ©ç”¨å‘é‡ç´¢å¼•åŠ é€Ÿï¼Œæ¯«ç§’çº§å“åº” |
| **KNN**  | `COSINE_DISTANCE`<br/>`EUCLIDEAN_DISTANCE`<br/>`DOT_PRODUCT`                      | å°è§„æ¨¡/é«˜ç²¾åº¦ | æš´åŠ›æœç´¢ï¼Œ100% å¬å›          |

```sql
-- ANN æœç´¢ï¼ˆä½¿ç”¨å‘é‡ç´¢å¼•åŠ é€Ÿï¼‰
SELECT DocId, DocContents
FROM Documents
WHERE DocEmbedding IS NOT NULL
ORDER BY APPROX_COSINE_DISTANCE(
    ARRAY<FLOAT32>[0.1, 0.2, ...],  -- æŸ¥è¯¢å‘é‡
    DocEmbedding,
    options => JSON '{"num_leaves_to_search": 10}'  -- æœç´¢å‚æ•°
)
LIMIT 10;

-- KNN æœç´¢ï¼ˆç²¾ç¡®æœç´¢ï¼Œé€‚ç”¨äºå°æ•°æ®é›†ï¼‰
SELECT DocId, DocContents
FROM Documents
ORDER BY COSINE_DISTANCE(
    ARRAY<FLOAT32>[0.1, 0.2, ...],
    DocEmbedding
)
LIMIT 10;

-- å¸¦è¿‡æ»¤æ¡ä»¶çš„ ANN æœç´¢
SELECT DocId, DocContents
FROM Documents
WHERE DocEmbedding IS NOT NULL
  AND Category = 'Technology'  -- æ ‡é‡è¿‡æ»¤
ORDER BY APPROX_EUCLIDEAN_DISTANCE(
    ARRAY<FLOAT32>[0.1, 0.2, ...],
    DocEmbedding,
    options => JSON '{"num_leaves_to_search": 20}'  -- å¸¦è¿‡æ»¤æ—¶å¢å¤§æœç´¢èŒƒå›´
)
LIMIT 10;
```

**è·ç¦»å‡½æ•°é€‰æ‹©æŒ‡å—**<sup>[[34]](#ref34)</sup>ï¼š

| æ•°æ®ç‰¹å¾           | æ¨èå‡½æ•°             | è¯´æ˜                              |
| :----------------- | :------------------- | :-------------------------------- |
| **å½’ä¸€åŒ–å‘é‡**     | `DOT_PRODUCT`        | è®¡ç®—æ•ˆç‡æœ€é«˜                      |
| **éå½’ä¸€åŒ–å‘é‡**   | `COSINE_DISTANCE`    | è‡ªå¸¦å½’ä¸€åŒ–ï¼Œé€‚ç”¨äºå¤§å¤šæ•°æ–‡æœ¬åµŒå…¥  |
| **æœªçŸ¥æ˜¯å¦å½’ä¸€åŒ–** | `COSINE_DISTANCE`    | æœ€å®‰å…¨çš„é€‰æ‹©                      |
| **ç‰©ç†è·ç¦»åœºæ™¯**   | `EUCLIDEAN_DISTANCE` | è¡¡é‡ç»å¯¹è·ç¦»ï¼Œé€‚ç”¨äºå›¾åƒ/éŸ³é¢‘ç‰¹å¾ |

### 6.5 é›†ç¾¤æ¶æ„

Spanner çš„åˆ†å¸ƒå¼æ¶æ„å»ºç«‹åœ¨ Google è‡ªç ”çš„ **TrueTime** å’Œ **Paxos** åè®®ä¹‹ä¸Š<sup>[[35]](#ref35)</sup>ã€‚å¯ä»¥å°†å…¶ç†è§£ä¸ºä¸€ä¸ª**å…¨çƒååŒçš„æ—¶é’ŸåŒæ­¥ç½‘ç»œ**ï¼š

- **TrueTime**ï¼šGoogle ç‹¬æœ‰çš„å…¨çƒåŸå­é’Ÿ + GPS æˆæ—¶ç³»ç»Ÿã€‚è®©åˆ†å¸ƒåœ¨å…¨çƒå„ä¸ªæ•°æ®ä¸­å¿ƒçš„æœåŠ¡å™¨å¯¹"ç°åœ¨æ˜¯å‡ ç‚¹"è¾¾æˆå…±è¯†ï¼Œè¯¯å·®æ§åˆ¶åœ¨å¾®ç§’çº§ã€‚è¿™æ˜¯å®ç°è·¨åŒºåŸŸå¼ºä¸€è‡´æ€§çš„åŸºçŸ³ã€‚
- **Paxos å¤åˆ¶**ï¼šæ¯ä¸ªæ•°æ®åˆ†ç‰‡ï¼ˆSplitï¼‰éƒ½é€šè¿‡ Paxos åè®®åœ¨å¤šä¸ªå‰¯æœ¬ä¹‹é—´åŒæ­¥ã€‚å†™å…¥æ“ä½œéœ€è¦å¤šæ•°æ´¾ï¼ˆQuorumï¼‰ç¡®è®¤æ‰èƒ½æäº¤ã€‚
- **å‰¯æœ¬ç±»å‹**ï¼š
  - **Read-Write å‰¯æœ¬**ï¼šå‚ä¸æŠ•ç¥¨å’Œå†™å…¥ï¼Œå¯æœåŠ¡è¯»å†™è¯·æ±‚
  - **Read-Only å‰¯æœ¬**ï¼šä»…æœåŠ¡è¯»è¯·æ±‚ï¼Œé™ä½è¯»å»¶è¿Ÿï¼Œä¸å‚ä¸å†™å…¥æŠ•ç¥¨
  - **Witness å‰¯æœ¬**ï¼šä»…å‚ä¸æŠ•ç¥¨ï¼Œä¸å­˜å‚¨å®Œæ•´æ•°æ®ï¼Œç”¨äºè·¨åŒºåŸŸä»²è£

```mermaid
graph TB
    subgraph "Spanner å…¨çƒåˆ†å¸ƒå¼æ¶æ„"
        direction TB

        subgraph "Region A (ç¾å›½)"
            RW1[Read-Write<br/>å‰¯æœ¬ 1]:::rw
            RW2[Read-Write<br/>å‰¯æœ¬ 2]:::rw
        end

        subgraph "Region B (æ¬§æ´²)"
            RW3[Read-Write<br/>å‰¯æœ¬ 3]:::rw
            RO1[Read-Only<br/>å‰¯æœ¬]:::ro
        end

        subgraph "Region C (äºšæ´²)"
            W1[Witness<br/>å‰¯æœ¬]:::witness
            RO2[Read-Only<br/>å‰¯æœ¬]:::ro
        end

        TrueTime[ğŸ• TrueTime<br/>å…¨çƒåŸå­é’ŸåŒæ­¥]:::truetime

        RW1 <--> |Paxos| RW2
        RW2 <--> |Paxos| RW3
        RW3 <--> |Paxos| RW1
        RW3 --> |å¤åˆ¶| RO1
        RW1 --> |å¤åˆ¶| RO2
        RW1 <--> |æŠ•ç¥¨| W1

        TrueTime -.-> RW1 & RW2 & RW3
    end

    classDef rw fill:#4285f4,color:#fff,stroke:none
    classDef ro fill:#34a853,color:#fff,stroke:none
    classDef witness fill:#fbbc04,color:#000,stroke:none
    classDef truetime fill:#ea4335,color:#fff,stroke:none
```

**å‰¯æœ¬ç±»å‹å¯¹æ¯”**ï¼š

| å‰¯æœ¬ç±»å‹       | å­˜å‚¨æ•°æ® | å‚ä¸æŠ•ç¥¨ | æœåŠ¡è¯»è¯·æ±‚ | æœåŠ¡å†™è¯·æ±‚ | å…¸å‹ç”¨é€”                 |
| :------------- | :------- | :------- | :--------- | :--------- | :----------------------- |
| **Read-Write** | âœ…       | âœ…       | âœ…         | âœ…         | ä¸»åŠ›å‰¯æœ¬ï¼Œå®Œæ•´èƒ½åŠ›       |
| **Read-Only**  | âœ…       | âŒ       | âœ…         | âŒ         | é™ä½è¯»å»¶è¿Ÿï¼Œå°±è¿‘æœåŠ¡     |
| **Witness**    | âŒ       | âœ…       | âŒ         | âŒ         | è·¨åŒºåŸŸä»²è£ï¼Œé™ä½å­˜å‚¨æˆæœ¬ |

### 6.6 Vertex AI ä¸ ML é›†æˆ

Spanner æä¾› `ML.PREDICT` å‡½æ•°ï¼Œå¯ç›´æ¥åœ¨ SQL æŸ¥è¯¢ä¸­è°ƒç”¨ Vertex AI æ¨¡å‹ç”ŸæˆåµŒå…¥å‘é‡<sup>[[36]](#ref36)</sup>ï¼Œå®ç°**æ•°æ®ä¸åŠ¨ã€æ¨¡å‹æ¥ç®—**çš„æ¶æ„èŒƒå¼ï¼š

```sql
-- 1. æ³¨å†Œ Vertex AI åµŒå…¥æ¨¡å‹
CREATE MODEL TextEmbeddingModel
INPUT(content STRING(MAX))
OUTPUT(
    embeddings STRUCT<
        statistics STRUCT<truncated BOOL, token_count FLOAT64>,
        values ARRAY<FLOAT64>
    >
)
REMOTE OPTIONS (
    endpoint = '//aiplatform.googleapis.com/projects/my-project/locations/us-central1/publishers/google/models/text-embedding-004'
);

-- 2. ä½¿ç”¨ ML.PREDICT ç”ŸæˆåµŒå…¥å¹¶å­˜å‚¨
INSERT INTO Documents (DocId, Content, Embedding)
SELECT
    @DocId,
    @Content,
    ARRAY<FLOAT32>(embeddings.values)  -- ç±»å‹è½¬æ¢
FROM ML.PREDICT(
    MODEL TextEmbeddingModel,
    (SELECT @Content AS content)
);

-- 3. æŸ¥è¯¢æ—¶åŠ¨æ€ç”ŸæˆæŸ¥è¯¢å‘é‡
SELECT DocId, Content
FROM Documents
WHERE Embedding IS NOT NULL
ORDER BY APPROX_COSINE_DISTANCE(
    (SELECT ARRAY<FLOAT32>(embeddings.values)
     FROM ML.PREDICT(MODEL TextEmbeddingModel, (SELECT @Query AS content))),
    Embedding
)
LIMIT 10;
```

### 6.7 Spanner Graph ä¸ GraphRAG

Spanner Graph æ˜¯ Spanner çš„åŸç”Ÿå›¾æ•°æ®åº“èƒ½åŠ›ï¼Œé‡‡ç”¨ **ISO GQL** æ ‡å‡†æŸ¥è¯¢è¯­è¨€<sup>[[37]](#ref37)</sup>ã€‚ç»“åˆå‘é‡æœç´¢ï¼Œå¯æ„å»ºå¼ºå¤§çš„ **GraphRAG** å·¥ä½œæµï¼š

- **ä¼ ç»Ÿ RAG**ï¼šä»…ä¾èµ–å‘é‡è¯­ä¹‰ç›¸ä¼¼åº¦æ£€ç´¢ä¸Šä¸‹æ–‡
- **GraphRAG**ï¼šå‘é‡æœç´¢ + å›¾éå†ï¼Œæ•è·æ•°æ®ä¸­çš„éšå¼å…³ç³»ï¼Œç”Ÿæˆæ›´ç²¾å‡†çš„ç­”æ¡ˆ

```mermaid
graph LR
    subgraph "GraphRAG å·¥ä½œæµ"
        direction LR
        Query[ç”¨æˆ·æŸ¥è¯¢] --> Vec[å‘é‡æœç´¢<br/>è¯­ä¹‰ç›¸ä¼¼]
        Query --> Graph[å›¾éå†<br/>å…³ç³»æ¨ç†]
        Vec --> Fusion[ç»“æœèåˆ]
        Graph --> Fusion
        Fusion --> LLM[LLM ç”Ÿæˆç­”æ¡ˆ]
    end

    style Vec fill:#4285f4,color:#fff
    style Graph fill:#34a853,color:#fff
    style Fusion fill:#ea4335,color:#fff
```

### 6.8 LangChain é›†æˆ

Spanner æä¾›å®Œæ•´çš„ LangChain å®˜æ–¹é›†æˆ<sup>[[38]](#ref38)</sup>ï¼ŒåŒ…æ‹¬ï¼š

| ç»„ä»¶                          | åŠŸèƒ½                  | å…¸å‹ç”¨é€”                     |
| :---------------------------- | :-------------------- | :--------------------------- |
| **SpannerVectorStore**        | å‘é‡å­˜å‚¨ä¸è¯­ä¹‰æœç´¢    | RAG åº”ç”¨çš„å‘é‡æ£€ç´¢å±‚         |
| **SpannerGraphStore**         | å›¾æ•°æ®å­˜å‚¨ä¸ GQL æŸ¥è¯¢ | çŸ¥è¯†å›¾è°±ã€GraphRAG           |
| **SpannerLoader**             | æ•°æ®åŠ è½½ä¸é¢„å¤„ç†      | å°† Spanner æ•°æ®åŠ è½½åˆ° LLM é“¾ |
| **SpannerChatMessageHistory** | å¯¹è¯å†å²æŒä¹…åŒ–        | å¤šè½®å¯¹è¯ AI åº”ç”¨             |

```python
from langchain_google_spanner import SpannerVectorStore
from langchain_google_vertexai import VertexAIEmbeddings

# åˆå§‹åŒ–åµŒå…¥æ¨¡å‹
embeddings = VertexAIEmbeddings(model_name="text-embedding-004")

# è¿æ¥ Spanner Vector Store
vector_store = SpannerVectorStore(
    instance_id="my-instance",
    database_id="my-database",
    table_name="documents",
    embedding_service=embeddings,
)

# è¯­ä¹‰æœç´¢
results = vector_store.similarity_search(
    query="ä»€ä¹ˆæ˜¯ Agentic AIï¼Ÿ",
    k=5
)

# ä¸ LLM é“¾é›†æˆ
from langchain.chains import RetrievalQA
from langchain_google_vertexai import ChatVertexAI

llm = ChatVertexAI(model_name="gemini-1.5-pro")
qa_chain = RetrievalQA.from_chain_type(
    llm=llm,
    retriever=vector_store.as_retriever(search_kwargs={"k": 10}),
    chain_type="stuff"
)

answer = qa_chain.invoke({"query": "è§£é‡Š GraphRAG çš„å·¥ä½œåŸç†"})
```

### 6.9 ä¼˜åŠ£åŠ¿åˆ†æ

**ä¼˜åŠ¿**ï¼š

- âœ… **å…¨çƒå¼ºä¸€è‡´æ€§**ï¼šTrueTime + Paxos å®ç°è·¨åŒºåŸŸ ACID äº‹åŠ¡
- âœ… **Multi-Model ç»Ÿä¸€**ï¼šå…³ç³»å‹ + å‘é‡ + å›¾ + ML ä¸€ä½“åŒ–ï¼Œæ— éœ€ ETL
- âœ… **GraphRAG åŸç”Ÿæ”¯æŒ**ï¼šå‘é‡æœç´¢ä¸å›¾éå†æ·±åº¦é›†æˆ
- âœ… **Vertex AI æ— ç¼å¯¹æ¥**ï¼šSQL å†…ç›´æ¥è°ƒç”¨ AI æ¨¡å‹
- âœ… **ä¼ä¸šçº§ SLA**ï¼š99.999% å¯ç”¨æ€§ä¿éšœ
- âœ… **è‡ªåŠ¨æ‰©å±•**ï¼šæ— éœ€æ‰‹åŠ¨åˆ†ç‰‡ï¼Œé€æ˜æ°´å¹³æ‰©å±•

**åŠ£åŠ¿**ï¼š

- âŒ **æˆæœ¬é«˜æ˜‚**ï¼šå…¨çƒåˆ†å¸ƒå¼æ¶æ„çš„ä»£ä»·ï¼Œé€‚åˆä¸­å¤§å‹ä¼ä¸š
- âŒ **ä»…æ‰˜ç®¡æœåŠ¡**ï¼šæ— æ³•ç§æœ‰éƒ¨ç½²ï¼Œå¿…é¡»ä½¿ç”¨ Google Cloud
- âŒ **å‘é‡ç´¢å¼•ç›¸å¯¹ç®€å•**ï¼šä»…æ”¯æŒ Tree-based Indexï¼Œä¸å¦‚ HNSW çµæ´»
- âŒ **å­¦ä¹ æ›²çº¿**ï¼šGoogleSQL æ‰©å±•è¯­æ³•ä¸æ ‡å‡† SQL æœ‰å·®å¼‚
- âŒ **å‘é‡æ£€ç´¢æ€§èƒ½**ï¼šä¸“ä¸ºåˆ†å¸ƒå¼ä¸€è‡´æ€§ä¼˜åŒ–ï¼Œå•æœºå‘é‡æ£€ç´¢æ€§èƒ½ä¸åŠä¸“ç”¨åº“

### 6.10 é€‚ç”¨åœºæ™¯

| åœºæ™¯                          | é€‚åˆåº¦     | è¯´æ˜                                |
| :---------------------------- | :--------- | :---------------------------------- |
| **å…¨çƒåŒ– AI åº”ç”¨**            | â­â­â­â­â­ | è·¨åŒºåŸŸä½å»¶è¿Ÿ + å¼ºä¸€è‡´æ€§æ˜¯æ ¸å¿ƒéœ€æ±‚   |
| **GraphRAG çŸ¥è¯†ç³»ç»Ÿ**         | â­â­â­â­â­ | å‘é‡ + å›¾ä¸€ä½“åŒ–ï¼Œæ— éœ€å¤šç³»ç»Ÿåè°ƒ     |
| **é‡‘è/åŒ»ç–—ç­‰å¼ºç›‘ç®¡è¡Œä¸š**     | â­â­â­â­â­ | ACID + åˆè§„å®¡è®¡ + é«˜å¯ç”¨            |
| **ç°æœ‰ Spanner ç”¨æˆ· AI å‡çº§** | â­â­â­â­â­ | é›¶æ¶æ„æ”¹é€ ï¼ŒåŸåœ° AI åŒ–              |
| **ä¸­å°è§„æ¨¡ AI åŸå‹**          | â­â­       | æˆæœ¬è¿‡é«˜ï¼Œæ¨è PGVector/Milvus Lite |
| **æè‡´å‘é‡æ£€ç´¢æ€§èƒ½**          | â­â­       | ä¸“ç”¨å‘é‡åº“ï¼ˆMilvus/Weaviateï¼‰æ›´é€‚åˆ |

---

## 7. ç³»ç»Ÿæ€§å¯¹æ¯”ï¼ˆæ¨ªå‘ï¼‰

### 7.1 æ ¸å¿ƒèƒ½åŠ›å¯¹æ¯”çŸ©é˜µ

| ç»´åº¦          | PGVector     | VectorChord | Milvus           | Weaviate     | Pinecone    | Spanner           |
| ------------- | ------------ | ----------- | ---------------- | ------------ | ----------- | ----------------- |
| **å¼€æºåè®®**  | PostgreSQL   | AGPLv3/ELv2 | Apache 2.0       | BSD-3        | å•†ä¸š        | å•†ä¸š (ä»…æ‰˜ç®¡)     |
| **éƒ¨ç½²æ¨¡å¼**  | å•æœº/é›†ç¾¤    | å•æœº/é›†ç¾¤   | åˆ†å¸ƒå¼/æ‰˜ç®¡      | åˆ†å¸ƒå¼/æ‰˜ç®¡  | ä»…æ‰˜ç®¡      | å…¨çƒåˆ†å¸ƒå¼/æ‰˜ç®¡   |
| **æœ€å¤§ç»´åº¦**  | 2,000 (HNSW) | 60,000      | 32,768           | æ— é™åˆ¶       | 20,000      | æ•°åƒç»´ (768/1536) |
| **å‘é‡ç´¢å¼•**  | HNSW/IVF     | RaBitQ/HNSW | IVF/HNSW/DiskANN | HNSW/Flat    | ä¸“æœ‰ç®—æ³•    | Tree-based Index  |
| **ACID äº‹åŠ¡** | âœ… å®Œæ•´      | âœ… å®Œæ•´     | âŒ ä¸æ”¯æŒ        | âŒ ä¸æ”¯æŒ    | âŒ ä¸æ”¯æŒ   | âœ… å…¨çƒå¼ºä¸€è‡´æ€§   |
| **æ··åˆæœç´¢**  | âœ… å…¨æ–‡æ£€ç´¢  | âœ… å…¨æ–‡æ£€ç´¢ | âœ… BM25          | âœ… BM25+å‘é‡ | âš ï¸ éœ€åŒç´¢å¼• | âœ… å…¨æ–‡ + Graph   |
| **å†…ç½®åµŒå…¥**  | âŒ           | âŒ          | âš ï¸ pymilvus      | âœ… å¤šæ¨¡å—    | âœ… é›†æˆ     | âœ… Vertex AI      |
| **GPU åŠ é€Ÿ**  | âŒ           | âŒ          | âœ… CAGRA         | âŒ           | âŒ          | âŒ                |

### 7.2 æ€§èƒ½å¯¹æ¯”

```mermaid
graph LR
    subgraph "QPS æ€§èƒ½ï¼ˆç›¸å¯¹å€¼ï¼‰"
        VC[VectorChord] --> |5x| PGV[PGVector]
        MV[Milvus] --> |2-5x| Others[å…¶ä»–å‘é‡æ•°æ®åº“]
    end

    style VC fill:#52c41a,color:#fff
    style MV fill:#00A1EA,color:#fff
```

| äº§å“            | 1M 768D QPS | å¬å›ç‡@95% | ç´¢å¼•æ„å»º | å†…å­˜æ•ˆç‡ |
| --------------- | ----------- | ---------- | -------- | -------- |
| **PGVector**    | ~1,000      | â˜…â˜…â˜…â˜…â˜†      | â˜…â˜…â˜…â˜†â˜†    | â˜…â˜…â˜…â˜†â˜†    |
| **VectorChord** | ~5,000      | â˜…â˜…â˜…â˜…â˜†      | â˜…â˜…â˜…â˜…â˜…    | â˜…â˜…â˜…â˜…â˜…    |
| **Milvus**      | ~10,000+    | â˜…â˜…â˜…â˜…â˜…      | â˜…â˜…â˜…â˜…â˜†    | â˜…â˜…â˜…â˜…â˜†    |
| **Weaviate**    | ~5,000      | â˜…â˜…â˜…â˜…â˜†      | â˜…â˜…â˜…â˜…â˜†    | â˜…â˜…â˜…â˜…â˜†    |
| **Pinecone**    | ~5,000      | â˜…â˜…â˜…â˜…â˜†      | N/A      | N/A      |

### 7.3 æˆæœ¬å¯¹æ¯”

| äº§å“            | 100K å‘é‡    | 1M å‘é‡      | 10M å‘é‡        | 100M å‘é‡        |
| --------------- | ------------ | ------------ | --------------- | ---------------- |
| **PGVector**    | $0ï¼ˆè‡ªæ‰˜ç®¡ï¼‰ | $0ï¼ˆè‡ªæ‰˜ç®¡ï¼‰ | $0ï¼ˆè‡ªæ‰˜ç®¡ï¼‰    | $0ï¼ˆè‡ªæ‰˜ç®¡ï¼‰     |
| **VectorChord** | $0.25        | $2.5         | $25             | $250             |
| **Milvus**      | $0ï¼ˆè‡ªæ‰˜ç®¡ï¼‰ | $0ï¼ˆè‡ªæ‰˜ç®¡ï¼‰ | Zilliz: ~$50/æœˆ | Zilliz: ~$500/æœˆ |
| **Weaviate**    | å…è´¹ Sandbox | WCS: ~$25/æœˆ | WCS: ~$100/æœˆ   | è‡ªå®šä¹‰           |
| **Pinecone**    | å…è´¹ Starter | ~$70/æœˆ      | ~$300/æœˆ        | ä¼ä¸šå®šä»·         |

> âš ï¸ ä»¥ä¸Šä»·æ ¼ä¸ºä¼°ç®—å‚è€ƒï¼Œå®é™…ä»·æ ¼è¯·ä»¥å®˜æ–¹å®šä»·ä¸ºå‡†ã€‚

### 7.4 è¿ç»´å¤æ‚åº¦å¯¹æ¯”

```mermaid
graph LR
    subgraph "è¿ç»´å¤æ‚åº¦"
        PC[Pinecone<br/>â˜…â˜†â˜†â˜†â˜†]
        WCS[Weaviate Cloud<br/>â˜…â˜†â˜†â˜†â˜†]
        ZC[Zilliz Cloud<br/>â˜…â˜†â˜†â˜†â˜†]
        PGV[PGVector<br/>â˜…â˜…â˜†â˜†â˜†]
        VC[VectorChord<br/>â˜…â˜…â˜†â˜†â˜†]
        WD[Weaviate Docker<br/>â˜…â˜…â˜…â˜†â˜†]
        MS[Milvus Standalone<br/>â˜…â˜…â˜…â˜†â˜†]
        MD[Milvus Distributed<br/>â˜…â˜…â˜…â˜…â˜…]
    end

    style PC fill:#52c41a,color:#fff
    style MD fill:#ea4335,color:#fff
```

### 7.5 ç”Ÿæ€é›†æˆå¯¹æ¯”

| æ¡†æ¶/å·¥å…·      | PGVector | VectorChord | Milvus   | Weaviate        | Pinecone | Spanner                     |
| -------------- | -------- | ----------- | -------- | --------------- | -------- | --------------------------- |
| **LangChain**  | âœ…       | âœ…          | âœ…       | âœ…              | âœ…       | âœ… langchain-google-spanner |
| **LlamaIndex** | âœ…       | âœ…          | âœ…       | âœ…              | âœ…       | âœ…                          |
| **Haystack**   | âœ…       | âš ï¸          | âœ…       | âœ…              | âœ…       | âš ï¸                          |
| **AutoGPT**    | âš ï¸       | âš ï¸          | âœ…       | âœ…              | âœ…       | âš ï¸                          |
| **Cognee**     | âœ…       | âš ï¸          | âœ…       | âœ…              | âœ…       | âš ï¸                          |
| **Python SDK** | psycopg2 | psycopg2    | pymilvus | weaviate-client | pinecone | google-cloud-spanner        |

### 7.6 åœºæ™¯æ¨èçŸ©é˜µ

| åœºæ™¯                     | é¦–é€‰æ–¹æ¡ˆ        | å¤‡é€‰æ–¹æ¡ˆ       | ç†ç”±                   |
| ------------------------ | --------------- | -------------- | ---------------------- |
| **å·²æœ‰ PostgreSQL ç³»ç»Ÿ** | PGVector        | VectorChord    | é›¶è¿ç§»æˆæœ¬ï¼Œæ•°æ®ä¸€è‡´æ€§ |
| **å¤§è§„æ¨¡ç”Ÿäº§ç³»ç»Ÿ**       | Milvus          | Weaviate       | åˆ†å¸ƒå¼æ¶æ„ï¼Œé«˜å¯æ‰©å±•   |
| **AI-Native åº”ç”¨**       | Weaviate        | Milvus         | å†…ç½®å‘é‡åŒ–ï¼ŒRAG æ”¯æŒ   |
| **æˆæœ¬æ•æ„Ÿå‹**           | PGVector/Milvus | VectorChord    | å¼€æºå…è´¹ï¼Œè‡ªæ‰˜ç®¡       |
| **ä¼ä¸šåˆè§„è¦æ±‚**         | Milvus/Weaviate | VectorChord    | ç§æœ‰éƒ¨ç½²ï¼Œæ•°æ®ä¸»æƒ     |
| **å¿«é€ŸåŸå‹å¼€å‘**         | Pinecone        | Weaviate Cloud | é›¶è¿ç»´ï¼Œå¿«é€Ÿä¸Šæ‰‹       |
| **å¤šç§Ÿæˆ· SaaS**          | Pinecone        | Weaviate Cloud | å‘½åç©ºé—´éš”ç¦»           |

---

## References

<a id="ref1"></a>[1] LlamaIndex, "Vector Databases in AI Applications," 2024. [Online]. Available: https://docs.llamaindex.ai/

<a id="ref2"></a>[2] pgvector, "Open-source vector similarity search for Postgres," _GitHub Repository_, 2024. [Online]. Available: https://github.com/pgvector/pgvector

<a id="ref3"></a>[3] Y. A. Malkov and D. A. Yashunin, "Efficient and robust approximate nearest neighbor search using hierarchical navigable small world graphs," _IEEE Trans. Pattern Anal. Mach. Intell._, vol. 40, no. 11, pp. 2529â€“2542, Nov. 2018.

<a id="ref4"></a>[4] H. JÃ©gou, M. Douze, and C. Schmid, "Product quantization for nearest neighbor search," _IEEE Trans. Pattern Anal. Mach. Intell._, vol. 33, no. 1, pp. 117â€“128, Jan. 2011.

<a id="ref5"></a>[5] TensorChord, "pgvecto.rs: Scalable Vector Search in Postgres," 2024. [Online]. Available: https://docs.vectorchord.ai/getting-started/overview.html

<a id="ref6"></a>[6] TensorChord, "VectorChord: High-Performance Vector Search," 2024. [Online]. Available: https://docs.vectorchord.ai/vectorchord/getting-started/overview.html

<a id="ref7"></a>[7] J. Gao and C. Long, "RaBitQ: Quantizing high-dimensional vectors with a theoretical error bound," _Proc. ACM Manag. Data_, vol. 2, no. 1, pp. 1â€“16, Jun. 2024.

<a id="ref8"></a>[8] TensorChord, "pgvector vs. pgvecto.rs Comparison," 2024. [Online]. Available: https://docs.vectorchord.ai/faqs/comparison-pgvector.html

<a id="ref9"></a>[9] Zilliz, "Milvus: The World's Most Advanced Open-Source Vector Database," 2024. [Online]. Available: https://milvus.io/docs/overview.md

<a id="ref10"></a>[10] Zilliz, "Milvus Architecture Overview," 2024. [Online]. Available: https://milvus.io/docs/architecture_overview.md

<a id="ref11"></a>[11] Zilliz, "Milvus Index Explained," 2024. [Online]. Available: https://milvus.io/docs/index-explained.md

<a id="ref12"></a>[12] Zilliz, "Milvus Performance Benchmarks," 2024. [Online]. Available: https://milvus.io/docs/benchmark.md

<a id="ref13"></a>[13] Weaviate, "The AI-Native Vector Database," 2024. [Online]. Available: https://docs.weaviate.io/weaviate/introduction

<a id="ref14"></a>[14] Weaviate, "Vector Indexing," 2024. [Online]. Available: https://docs.weaviate.io/weaviate/concepts/vector-index

<a id="ref15"></a>[15] Weaviate, "Model Providers," 2024. [Online]. Available: https://docs.weaviate.io/weaviate/model-providers

<a id="ref16"></a>[16] Pinecone, "The Vector Database for AI," 2024. [Online]. Available: https://docs.pinecone.io/guides/get-started/overview

<a id="ref17"></a>[17] Pinecone, "Indexing Overview," 2024. [Online]. Available: https://docs.pinecone.io/guides/index-data/indexing-overview

<a id="ref18"></a>[18] Pinecone, "Namespaces," 2024. [Online]. Available: https://docs.pinecone.io/guides/index-data/indexing-overview#namespaces

<a id="ref19"></a>[19] LlamaIndex, "Milvus Integration," 2024. [Online]. Available: https://docs.llamaindex.ai/en/stable/examples/vector_stores/MilvusIndexDemo/

<a id="ref20"></a>[20] LangChain, "Milvus Integration," 2024. [Online]. Available: https://python.langchain.com/docs/integrations/vectorstores/milvus/

<a id="ref21"></a>[21] Zilliz, "Milvus Lite: Lightweight Milvus for Local Development," 2024. [Online]. Available: https://milvus.io/docs/milvus_lite.md

<a id="ref22"></a>[22] pgvector, "Filtering and Iterative Scans," _GitHub Repository_, 2024. [Online]. Available: https://github.com/pgvector/pgvector#filtering

<a id="ref23"></a>[23] TensorChord, "VectorChord Graph Index," 2024. [Online]. Available: https://docs.vectorchord.ai/vectorchord/usage/graph-index.html

<a id="ref24"></a>[24] TensorChord, "VectorChord Prefilter," 2024. [Online]. Available: https://docs.vectorchord.ai/vectorchord/usage/prefilter.html

<a id="ref25"></a>[25] Weaviate, "Vector Quantization," 2024. [Online]. Available: https://docs.weaviate.io/weaviate/concepts/vector-quantization

<a id="ref26"></a>[26] Weaviate, "Cluster Architecture," 2024. [Online]. Available: https://docs.weaviate.io/weaviate/concepts/replication-architecture/cluster-architecture

<a id="ref27"></a>[27] Pinecone, "Hybrid Search," 2024. [Online]. Available: https://docs.pinecone.io/guides/search/hybrid-search

<a id="ref28"></a>[28] Pinecone, "Rerank Results," 2024. [Online]. Available: https://docs.pinecone.io/guides/search/rerank-results

<a id="ref29"></a>[29] J. C. Corbett, J. Dean, M. Epstein, et al., "Spanner: Google's Globally-Distributed Database," _Proc. 10th USENIX Symp. Oper. Syst. Des. Implement. (OSDI)_, pp. 251â€“264, 2012.

<a id="ref30"></a>[30] Google Cloud, "Spanner AI overview," 2024. [Online]. Available: https://cloud.google.com/spanner/docs/spanner-ai-overview

<a id="ref31"></a>[31] Google Cloud, "Create and manage vector indexes," 2024. [Online]. Available: https://cloud.google.com/spanner/docs/vector-indexes

<a id="ref32"></a>[32] Google Cloud, "Vector indexing best practices," 2024. [Online]. Available: https://cloud.google.com/spanner/docs/vector-index-best-practices

<a id="ref33"></a>[33] Google Cloud, "Find approximate nearest neighbors (ANN)," 2024. [Online]. Available: https://cloud.google.com/spanner/docs/find-approximate-nearest-neighbors

<a id="ref34"></a>[34] Google Cloud, "Choose a vector distance function," 2024. [Online]. Available: https://cloud.google.com/spanner/docs/choose-vector-distance-function

<a id="ref35"></a>[35] Google Cloud, "Replication in Spanner," 2024. [Online]. Available: https://cloud.google.com/spanner/docs/replication

<a id="ref36"></a>[36] Google Cloud, "Get Vertex AI text embeddings," 2024. [Online]. Available: https://cloud.google.com/spanner/docs/ml-tutorial-embeddings

<a id="ref37"></a>[37] Google Cloud, "Spanner Graph overview," 2024. [Online]. Available: https://cloud.google.com/spanner/docs/graph/overview

<a id="ref38"></a>[38] Google Cloud, "Build LLM-powered applications using LangChain," 2024. [Online]. Available: https://cloud.google.com/spanner/docs/langchain
