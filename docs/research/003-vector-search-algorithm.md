---
id: vector-search-algorithm
sidebar_position: 3.2
title: å‘é‡æ•°æ®åº“åŸç†ä¸ç®—æ³•æ·±åº¦è§£æ
last_update:
  author: Aurelius Huang
  created_at: 2025-12-24
  updated_at: 2025-12-28
  version: 1.2
  status: Pending Review
tags:
  - Vector Database
  - ANN Algorithms
  - Similarity Search
  - HNSW
  - IVF
  - Product Quantization
  - Embedding
---

> [!IMPORTANT]
> **è§£è¯»èŒƒå›´**ï¼šä» LLM ç¼ºé™·çš„è§’åº¦å‡ºå‘ï¼Œå¼•å‡ºå‘é‡æ•°æ®åº“çš„éœ€æ±‚ï¼Œç„¶åæ·±å…¥è§£æå‘é‡æ•°æ®åº“çš„æ•°å­¦æ¨¡å‹ã€ç®—æ³•åŸç†ã€å®ç°ç»†èŠ‚ã€æ€§èƒ½åˆ†æã€åº”ç”¨åœºæ™¯ä¸é€‰å‹å»ºè®®ã€‚
>
> å‘é‡æ•°æ®åº“çš„éœ€æ±‚ä¸ä»…æ¥è‡ª LLM åº”ç”¨ï¼Œè¿˜å—åˆ°å¦‚ä¸‹æœ‰åˆ«äºä¼ ç»Ÿæ•°æ®åº“å› ç´ çš„å½±å“ï¼š
>
> - **è¯­ä¹‰æœç´¢**
> - æ•°æ®**è§„æ¨¡çˆ†ç‚¸**çš„æŒ‘æˆ˜
> - æ•°æ®**ç»´åº¦è¯…å’’**

---

## 1. å‘é‡æ•°æ®åº“äº§ç”Ÿçš„èƒŒæ™¯

### 1.1 LLM çš„å›ºæœ‰ç¼ºé™·

å°½ç®¡ä»¥ GPT ä¸ºä»£è¡¨çš„å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰å±•ç°äº†æƒŠäººçš„æ–‡æœ¬ç†è§£ä¸ç”Ÿæˆèƒ½åŠ›ï¼Œä½†å®ƒä»¬å­˜åœ¨å‡ ä¸ªå…³é”®çš„å›ºæœ‰ç¼ºé™·<sup>[[1]](#ref1)</sup>ï¼š

```mermaid
mindmap
  root((LLM å›ºæœ‰ç¼ºé™·))
    å¹»è§‰é—®é¢˜
      ç”Ÿæˆè™šå‡ä¿¡æ¯
      ç¼–é€ ä¸å­˜åœ¨çš„äº‹å®
      è‡ªä¿¡åœ°ç»™å‡ºé”™è¯¯ç­”æ¡ˆ
    çŸ¥è¯†æ—¶æ•ˆæ€§
      è®­ç»ƒæ•°æ®æˆªæ­¢æ—¥æœŸ
      æ— æ³•è·å–å®æ—¶ä¿¡æ¯
      æ— æ³•æ„ŸçŸ¥æœ€æ–°äº‹ä»¶
    ä¸Šä¸‹æ–‡çª—å£é™åˆ¶
      æœ‰é™çš„ Token æ•°é‡
      é•¿æ–‡æœ¬å¤„ç†å›°éš¾
      é•¿æœŸè®°å¿†ç¼ºå¤±
    é¢†åŸŸçŸ¥è¯†ç¼ºä¹
      é€šç”¨çŸ¥è¯†ä¸ºä¸»
      ç¼ºä¹ä¸“ä¸šé¢†åŸŸæ·±åº¦
      æ— æ³•è®¿é—®ç§æœ‰æ•°æ®
    æ¨ç†èƒ½åŠ›å±€é™
      å¤æ‚æ•°å­¦æ¨ç†å›°éš¾
      å¤šæ­¥é€»è¾‘æ¨ç†æ˜“å‡ºé”™
      å› æœæ¨ç†èƒ½åŠ›ä¸è¶³
```

| ç¼ºé™·ç±»å‹                  | å…·ä½“è¡¨ç°                                            | å½±å“                                 |
| ------------------------- | --------------------------------------------------- | ------------------------------------ |
| **å¹»è§‰ï¼ˆHallucinationï¼‰** | ç”Ÿæˆçœ‹ä¼¼åˆç†ä½†å®é™…é”™è¯¯çš„å†…å®¹<sup>[[1]](#ref1)</sup> | é™ä½è¾“å‡ºå¯ä¿¡åº¦ï¼Œå¯èƒ½å¯¼è‡´ä¸¥é‡é”™è¯¯å†³ç­– |
| **çŸ¥è¯†æˆªæ­¢æ—¥æœŸ**          | æ— æ³•è·å–è®­ç»ƒæ•°æ®ä¹‹åçš„ä¿¡æ¯<sup>[[2]](#ref2)</sup>   | æ— æ³•å›ç­”æ—¶äº‹é—®é¢˜ï¼ŒçŸ¥è¯†åº“é€æ¸è¿‡æ—¶     |
| **ä¸Šä¸‹æ–‡çª—å£é™åˆ¶**        | å•æ¬¡å¯¹è¯æ— æ³•å¤„ç†è¶…é•¿æ–‡æœ¬<sup>[[1]](#ref1)</sup>     | æ— æ³•ç»´æŒé•¿æœŸå¯¹è¯è®°å¿†ï¼Œå¤§æ–‡æ¡£å¤„ç†å—é™ |
| **é¢†åŸŸçŸ¥è¯†ç¼ºä¹**          | ç¼ºå°‘ç‰¹å®šè¡Œä¸šæˆ–ç§æœ‰æ•°æ®çŸ¥è¯†<sup>[[3]](#ref3)</sup>   | æ— æ³•æä¾›ä¸“ä¸šç²¾å‡†çš„é¢†åŸŸå›ç­”           |
| **æ¨ç†èƒ½åŠ›å±€é™**          | å¤æ‚é€»è¾‘å’Œæ•°å­¦æ¨ç†æ˜“å‡ºé”™<sup>[[1]](#ref1)</sup>     | åœ¨éœ€è¦ç²¾ç¡®è®¡ç®—çš„åœºæ™¯å¯é æ€§ä¸è¶³       |

### 1.2 Embeddingï¼šè¿æ¥è¯­ä¹‰ä¸è®¡ç®—çš„æ¡¥æ¢

**Embeddingï¼ˆåµŒå…¥å‘é‡ï¼‰** æ˜¯è§£å†³ä¸Šè¿°é—®é¢˜çš„å…³é”®æŠ€æœ¯ä¹‹ä¸€ã€‚å®ƒå°†æ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ç­‰éç»“æ„åŒ–æ•°æ®è½¬æ¢ä¸ºé«˜ç»´å‘é‡ç©ºé—´ä¸­çš„æ•°å€¼è¡¨ç¤º<sup>[[4]](#ref4)</sup>ã€‚

> [!NOTE] Embedding çš„æ•°å­¦æœ¬è´¨
>
> **Embedding çš„æ•°å­¦æœ¬è´¨**æ˜¯ä¸€ä¸ªæ˜ å°„å‡½æ•° $f: X \rightarrow \mathbb{R}^d$ï¼Œå°†è¾“å…¥ç©ºé—´ $X$ ä¸­çš„å¯¹è±¡æ˜ å°„åˆ° $d$ ç»´å®æ•°å‘é‡ç©ºé—´ï¼š
>
> $$
>     \text{embed}(x) = [e_1, e_2, ..., e_d] \in \mathbb{R}^d
> $$
>
> å…¶ä¸­ï¼š
>
> - $x$ æ˜¯è¾“å…¥å¯¹è±¡ï¼ˆå¦‚æ–‡æœ¬ã€å›¾åƒï¼‰
> - $d$ æ˜¯åµŒå…¥ç»´åº¦ï¼ˆå¸¸è§å€¼ï¼š128, 256, 384, 512, 768, 1024, 1536, 3072ï¼‰
> - $e_i$ æ˜¯å‘é‡çš„ç¬¬ $i$ ä¸ªåˆ†é‡

Embedding çš„æ ¸å¿ƒä»·å€¼åœ¨äºï¼š**è¯­ä¹‰ç›¸ä¼¼çš„å¯¹è±¡åœ¨å‘é‡ç©ºé—´ä¸­è·ç¦»æ›´è¿‘**<sup>[[5]](#ref5)</sup>ã€‚

```mermaid
quadrantChart
    title Semantic Vector Space
    x-axis "ä½ç”Ÿå‘½æ€§" --> "é«˜ç”Ÿå‘½æ€§"
    y-axis "ä½æ™ºèƒ½æ€§" --> "é«˜æ™ºèƒ½æ€§"
    quadrant-1 "æ™ºèƒ½ç”Ÿå‘½ä½“"
    quadrant-2 "é«˜ç­‰æ™ºèƒ½"
    quadrant-3 "æ— ç”Ÿå‘½ç‰©"
    quadrant-4 "ç®€å•ç”Ÿå‘½ä½“"
    Cat: [0.8, 0.7]
    Dog: [0.85, 0.75]
    Car: [0.1, 0.1]
```

> [!TIP] **å›¾ç¤ºè¯´æ˜**
>
> - **"çŒ«" Cat (0.8, 0.7)** ä¸ **"ç‹—" Dog (0.85, 0.75)** ä½äºå³ä¸Šè±¡é™ï¼Œè¯­ä¹‰è·ç¦»ä»… **0.07**
> - **"æ±½è½¦" Car (0.1, 0.1)** ä½äºå·¦ä¸‹è±¡é™ï¼Œä¸"çŒ«"è¯­ä¹‰è·ç¦»è¾¾ **0.92**
> - è¿™ç›´è§‚ä½“ç°äº†è¯­ä¹‰ç›¸ä¼¼å¯¹è±¡åœ¨å‘é‡ç©ºé—´ä¸­èšé›†çš„ç‰¹æ€§

è¿™ç§ç‰¹æ€§ä½¿å¾—æˆ‘ä»¬å¯ä»¥ï¼š

1. **è¯­ä¹‰æœç´¢**ï¼šé€šè¿‡å‘é‡è·ç¦»æ‰¾åˆ°è¯­ä¹‰ç›¸å…³çš„å†…å®¹ â€”â€” å¦‚æœç´¢"å¦‚ä½•æå‡ä»£ç è´¨é‡"èƒ½åŒ¹é…åˆ°"ä»£ç é‡æ„æœ€ä½³å®è·µ"
2. **çŸ¥è¯†æ£€ç´¢**ï¼šä»å¤§è§„æ¨¡çŸ¥è¯†åº“ä¸­æ£€ç´¢ç›¸å…³ä¿¡æ¯ â€”â€” å¦‚ RAG ç³»ç»Ÿä»ç™¾ä¸‡æ–‡æ¡£ä¸­ç§’çº§å®šä½ç­”æ¡ˆæ¥æº
3. **å»é‡èšç±»**ï¼šè¯†åˆ«å’Œåˆ†ç»„ç›¸ä¼¼å†…å®¹ â€”â€” å¦‚æ–°é—»èšåˆå¹³å°è‡ªåŠ¨å½’ç±»åŒä¸€äº‹ä»¶çš„ä¸åŒæŠ¥é“

### 1.3 RAGï¼šå¼¥è¡¥ LLM ç¼ºé™·çš„å…³é”®æ¶æ„

**æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRetrieval-Augmented Generation, RAGï¼‰** é€šè¿‡å°†å¤–éƒ¨çŸ¥è¯†æ³¨å…¥ LLM çš„ä¸Šä¸‹æ–‡ï¼Œæœ‰æ•ˆè§£å†³äº†ä¸Šè¿°ç¼ºé™·<sup>[[2]](#ref2)</sup>ï¼š

```mermaid
flowchart LR
    subgraph "RAG å·¥ä½œæµç¨‹"
        Q[ç”¨æˆ·æŸ¥è¯¢] --> E1[æŸ¥è¯¢åµŒå…¥]
        E1 --> S[å‘é‡æœç´¢]
        S --> R[æ£€ç´¢ç»“æœ]
        R --> C[ä¸Šä¸‹æ–‡å¢å¼º]
        Q --> C
        C --> LLM[å¤§è¯­è¨€æ¨¡å‹]
        LLM --> A[å¢å¼ºå›ç­”]
    end

    subgraph "çŸ¥è¯†åº“"
        D1[æ–‡æ¡£1] --> E2[åµŒå…¥å‘é‡]
        D2[æ–‡æ¡£2] --> E3[åµŒå…¥å‘é‡]
        D3[æ–‡æ¡£...] --> E4[åµŒå…¥å‘é‡]
        E2 & E3 & E4 --> VDB[(å‘é‡æ•°æ®åº“)]
    end

    VDB --> S

    style VDB fill:#52c41a,color:#fff
    style LLM fill:#1890ff,color:#fff
```

| RAG ç»„ä»¶       | åŠŸèƒ½                       | è§£å†³çš„ LLM ç¼ºé™·          |
| -------------- | -------------------------- | ------------------------ |
| **å¤–éƒ¨çŸ¥è¯†åº“** | å­˜å‚¨æœ€æ–°ã€ä¸“ä¸šçš„çŸ¥è¯†æ–‡æ¡£   | çŸ¥è¯†æ—¶æ•ˆæ€§ã€é¢†åŸŸçŸ¥è¯†ç¼ºä¹ |
| **å‘é‡åŒ–**     | å°†æ–‡æ¡£è½¬æ¢ä¸ºè¯­ä¹‰å‘é‡       | ä¸ºç›¸ä¼¼æ€§æœç´¢æä¾›åŸºç¡€     |
| **å‘é‡æ•°æ®åº“** | é«˜æ•ˆå­˜å‚¨å’Œæ£€ç´¢å‘é‡         | çªç ´ä¸Šä¸‹æ–‡çª—å£é™åˆ¶       |
| **è¯­ä¹‰æ£€ç´¢**   | æ‰¾åˆ°ä¸æŸ¥è¯¢æœ€ç›¸å…³çš„çŸ¥è¯†ç‰‡æ®µ | æä¾›äº‹å®ä¾æ®ï¼Œå‡å°‘å¹»è§‰   |
| **ä¸Šä¸‹æ–‡å¢å¼º** | å°†æ£€ç´¢å†…å®¹æ³¨å…¥ LLM æç¤º    | æä¾›å‡†ç¡®ä¿¡æ¯æº           |

### 1.4 ç»´åº¦è¯…å’’ï¼ˆCurse of Dimensionalityï¼‰

ä¼ ç»Ÿæ•°æ®åº“ï¼ˆå¦‚ MySQLã€PostgreSQLï¼‰è®¾è®¡åˆè¡·æ˜¯å¤„ç†ç»“æ„åŒ–æ•°æ®ï¼Œæ— æ³•é«˜æ•ˆå¤„ç†é«˜ç»´å‘é‡çš„ç›¸ä¼¼æ€§æœç´¢ã€‚å‘é‡æ•°æ®åº“åº”è¿è€Œç”Ÿï¼Œè§£å†³ **ç»´åº¦è¯…å’’ï¼ˆCurse of Dimensionalityï¼‰** è¿™ä¸€æ ¸å¿ƒæŒ‘æˆ˜<sup>[[7]](#ref7)</sup>ï¼š

> [!IMPORTANT] éšç€ç»´åº¦å¢åŠ ï¼Œé«˜ç»´ç©ºé—´å‡ºç°ä¸¤ä¸ªå…³é”®ç°è±¡ï¼Œå¯¼è‡´ä¼ ç»Ÿæ•°æ®åº“ç´¢å¼•ï¼ˆå¦‚ KD-Tree, R-Treeï¼‰å¤±æ•ˆï¼š
>
> 1. **è·ç¦»é›†ä¸­æ•ˆåº”**ï¼šé«˜ç»´ä¸‹ä»»æ„ä¸¤ç‚¹çš„è·ç¦»å·®å¼‚æ¶ˆå¤±ï¼Œ**æ‰€æœ‰ç‚¹çœ‹èµ·æ¥éƒ½å·®ä¸å¤šè¿œ**ã€‚å°±åƒæ‰€æœ‰äººè·ç¦»ä½ éƒ½æ˜¯ 99-100 ç±³ï¼Œ"æœ€è¿‘"å’Œ"æœ€è¿œ"å¤±å»äº†ç•Œé™ã€‚
> 2. **ç©ºé—´ç¨€ç–æ€§**ï¼šç©ºé—´ä½“ç§¯éšç»´åº¦æŒ‡æ•°çº§è†¨èƒ€ï¼Œæ•°æ®å˜å¾—**æç«¯ç¨€ç–**ã€‚å°±åƒå°†ä¸€æ»´æ°´ï¼ˆæ•°æ®ï¼‰åˆ†æ•£åˆ°æ•´ä¸ªå¤ªå¹³æ´‹ï¼ˆé«˜ç»´ç©ºé—´ï¼‰ï¼Œä¼ ç»Ÿæ ¼å­åˆ’åˆ†æ³•ï¼ˆç´¢å¼•ï¼‰ä¼šå®Œå…¨å¤±æ•ˆã€‚

| ç»´åº¦              | æ•°æ®ç‰¹å¾ & ç´¢å¼•è¡¨ç°                                    | KD-Tree æ•ˆç‡å¯¹æ¯”æš´åŠ›æœç´¢    |
| :---------------- | :----------------------------------------------------- | :-------------------------- |
| **ä½ç»´ (2-10)**   | è·ç¦»åŒºåˆ†åº¦é«˜ï¼Œç©ºé—´åˆ’åˆ†æœ‰æ•ˆ                             | **å¿« 100-1000x** (O(log N)) |
| **ä¸­ç»´ (10-100)** | è·ç¦»å¼€å§‹é›†ä¸­ï¼Œç´¢å¼•å‰ªæèƒ½åŠ›å¤§å¹…ä¸‹é™                     | **æŒå¹³æˆ–ç•¥æ…¢**              |
| **é«˜ç»´ (>100)**   | **è·ç¦»é›†ä¸­æ•ˆåº”**æ˜¾è‘—ï¼Œç´¢å¼•éœ€è®¿é—®å‡ ä¹æ‰€æœ‰èŠ‚ç‚¹ï¼Œå®Œå…¨å¤±æ•ˆ | **æ›´æ…¢** (å› é¢å¤–å›æº¯å¼€é”€)   |

### 1.5 å‘é‡æ•°æ®åº“çš„æ ¸å¿ƒèƒ½åŠ›

```mermaid
graph TB
    subgraph "å‘é‡æ•°æ®åº“æ ¸å¿ƒèƒ½åŠ›"
        A[é«˜æ•ˆå‘é‡å­˜å‚¨]
        B[è¿‘ä¼¼æœ€è¿‘é‚»æœç´¢ ANN]
        C[å‘é‡ç´¢å¼•ç®—æ³•]
        D[æ··åˆæŸ¥è¯¢æ”¯æŒ]
        E[åˆ†å¸ƒå¼æ‰©å±•]
        F[å®æ—¶æ›´æ–°]
    end

    A --> |"å‹ç¼©é‡åŒ–"| A1[é™ä½å­˜å‚¨æˆæœ¬]
    B --> |"äºšçº¿æ€§æ—¶é—´"| B1[æ¯«ç§’çº§å“åº”]
    C --> |"HNSW/IVF/PQ"| C1[é«˜å¬å›ç‡]
    D --> |"å‘é‡+æ ‡é‡"| D1[ç²¾å‡†è¿‡æ»¤]
    E --> |"æ°´å¹³æ‰©å±•"| E1[ç™¾äº¿çº§å‘é‡]
    F --> |"å¢é‡ç´¢å¼•"| F1[å®æ—¶å¯ç”¨]

    style B fill:#52c41a,color:#fff
    style C fill:#1890ff,color:#fff
```

> [!IMPORTANT] ç²¾ç¡®æœç´¢ vs è¿‘ä¼¼æœç´¢
>
> | æœç´¢ç±»å‹                    | æ—¶é—´å¤æ‚åº¦       | å¬å›ç‡ | é€‚ç”¨åœºæ™¯                |
> | --------------------------- | ---------------- | ------ | ----------------------- |
> | **æš´åŠ›æœç´¢ï¼ˆBrute Forceï¼‰** | O(n Ã— d)         | 100%   | å°æ•°æ®é›†ï¼ˆ<10 ä¸‡ï¼‰      |
> | **è¿‘ä¼¼æœç´¢ï¼ˆANNï¼‰**         | O(log n) ~ O(âˆšn) | 95-99% | å¤§è§„æ¨¡æ•°æ®é›†ï¼ˆ>100 ä¸‡ï¼‰ |
>
> **å…³é”®æ´å¯Ÿ**ï¼šåœ¨å¤§è§„æ¨¡åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬æ„¿æ„ç”¨å°‘é‡çš„å¬å›ç‡æŸå¤±ï¼ˆ1-5%ï¼‰æ¢å–æ•°é‡çº§çš„æ€§èƒ½æå‡ã€‚è¿™æ­£æ˜¯ ANN ç®—æ³•çš„æ ¸å¿ƒä»·å€¼ã€‚

---

## 2. å‘é‡ç´¢å¼•æ¦‚è§ˆ

### 2.1 æ„å»ºä¸ä½¿ç”¨

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant API as API å±‚
    participant IDX as ç´¢å¼•å¼•æ“
    participant VDB as å‘é‡å­˜å‚¨

    rect rgb(240, 248, 255)
    Note over U,VDB: ç´¢å¼•æ„å»ºé˜¶æ®µ
    U->>API: æ’å…¥å‘é‡ (id, vector, metadata)
    API->>VDB: å­˜å‚¨åŸå§‹å‘é‡
    API->>IDX: è§¦å‘ç´¢å¼•æ›´æ–°
    IDX->>IDX: è®¡ç®—ç´¢å¼•ç»“æ„
    IDX->>VDB: å­˜å‚¨ç´¢å¼•æ•°æ®
    end

    rect rgb(255, 248, 240)
    Note over U,VDB: æŸ¥è¯¢é˜¶æ®µ
    U->>API: æœç´¢è¯·æ±‚ (query_vector, top_k, filter)
    API->>IDX: æ‰§è¡Œ ANN æœç´¢
    IDX->>IDX: éå†ç´¢å¼•ç»“æ„
    IDX->>VDB: è·å–å€™é€‰å‘é‡
    IDX->>IDX: è®¡ç®—ç²¾ç¡®è·ç¦»
    IDX-->>API: è¿”å› Top-K ç»“æœ
    API-->>U: è¿”å› (id, score, metadata)
    end
```

### 2.2 å‘é‡ç´¢å¼•ç®—æ³•æ¦‚è§ˆ

å‘é‡ç´¢å¼•ï¼ˆVector Indexï¼‰æ˜¯å‘é‡æ•°æ®åº“çš„æ ¸å¿ƒç»„ä»¶ï¼Œå†³å®šäº†æœç´¢æ•ˆç‡å’Œå¬å›è´¨é‡ã€‚ä¸»æµç´¢å¼•ç®—æ³•å¯åˆ†ä¸ºä»¥ä¸‹å‡ ç±»<sup>[[8]](#ref8)</sup>ï¼š

```mermaid
graph TB
    subgraph "å‘é‡ç´¢å¼•åˆ†ç±»"
        ROOT[å‘é‡ç´¢å¼•ç®—æ³•]

        ROOT --> TREE[åŸºäºæ ‘çš„ç´¢å¼•]
        ROOT --> HASH[åŸºäºå“ˆå¸Œçš„ç´¢å¼•]
        ROOT --> QUANT[åŸºäºé‡åŒ–çš„ç´¢å¼•]
        ROOT --> GRAPH[åŸºäºå›¾çš„ç´¢å¼•]

        TREE --> KD[KD-Tree]
        TREE --> BALL[Ball-Tree]
        TREE --> ANNOY[Annoy]

        HASH --> LSH[LSH]
        HASH --> MINHASH[MinHash]

        QUANT --> PQ[Product Quantization]
        QUANT --> SQ[Scalar Quantization]
        QUANT --> OPQ[Optimized PQ]

        GRAPH --> NSW[NSW]
        GRAPH --> HNSW[HNSW]
        GRAPH --> VAMANA[Vamana/DiskANN]
    end

    style HNSW fill:#52c41a,color:#fff
    style PQ fill:#1890ff,color:#fff
    style LSH fill:#fa8c16,color:#fff
```

| ç´¢å¼•ç±»å‹     | ä»£è¡¨ç®—æ³•       | æ—¶é—´å¤æ‚åº¦ | ç©ºé—´å¼€é”€ | å¬å›ç‡ | é€‚ç”¨åœºæ™¯             |
| ------------ | -------------- | ---------- | -------- | ------ | -------------------- |
| **åŸºäºæ ‘**   | KD-Tree, Annoy | O(log n)   | ä¸­       | é«˜     | ä½ç»´æ•°æ®ï¼ˆ<20 ç»´ï¼‰   |
| **åŸºäºå“ˆå¸Œ** | LSH            | O(1) å¹³å‡  | ä½-ä¸­    | ä¸­     | é«˜ååã€å®¹å¿ç²¾åº¦æŸå¤± |
| **åŸºäºé‡åŒ–** | PQ, SQ         | O(K Ã— M)   | æä½     | ä¸­-é«˜  | å†…å­˜å—é™åœºæ™¯         |
| **åŸºäºå›¾**   | HNSW, NSW      | O(log n)   | é«˜       | æé«˜   | é«˜å¬å›è¦æ±‚           |
| **å¤åˆç´¢å¼•** | IVF + PQ       | O(âˆšn Ã— M)  | ä½       | é«˜     | å¤§è§„æ¨¡ç”Ÿäº§ç¯å¢ƒ       |

### 2.3 å‘é‡ç±»å‹åˆ†ç±»

| å‘é‡ç±»å‹             | æè¿°                     | å­˜å‚¨æ•ˆç‡      | ç²¾åº¦ | å…¸å‹åº”ç”¨              |
| -------------------- | ------------------------ | ------------- | ---- | --------------------- |
| **Dense Vector**     | å¯†é›†å‘é‡ï¼Œæ‰€æœ‰ç»´åº¦æœ‰å€¼   | ä¸­            | é«˜   | æ–‡æœ¬/å›¾åƒåµŒå…¥         |
| **Sparse Vector**    | ç¨€ç–å‘é‡ï¼Œå¤§éƒ¨åˆ†ç»´åº¦ä¸ºé›¶ | é«˜            | é«˜   | TF-IDFã€BM25          |
| **Binary Vector**    | äºŒå€¼å‘é‡ï¼Œä»…å« 0/1       | æé«˜ï¼ˆ1-bitï¼‰ | ä½   | SimHashã€å±€éƒ¨æ•æ„Ÿå“ˆå¸Œ |
| **Quantized Vector** | é‡åŒ–å‘é‡ï¼Œå‹ç¼©è¡¨ç¤º       | é«˜            | ä¸­   | PQ ç¼–ç å‘é‡           |

### 2.4 å‘é‡æ•°å€¼ç²¾åº¦

```mermaid
graph LR
    subgraph "æ•°å€¼ç²¾åº¦å¯¹æ¯”"
        F32[Float32<br/>4 å­—èŠ‚/ç»´]
        F16[Float16<br/>2 å­—èŠ‚/ç»´]
        BF16[BFloat16<br/>2 å­—èŠ‚/ç»´]
        I8[Int8<br/>1 å­—èŠ‚/ç»´]
        B1[Binary<br/>1/8 å­—èŠ‚/ç»´]
    end

    F32 --> |"ç²¾åº¦æœ€é«˜"| APP1[ç²¾ç¡®è®¡ç®—]
    F16 --> |"GPU å‹å¥½"| APP2[æ¨ç†åŠ é€Ÿ]
    I8 --> |"4x å‹ç¼©"| APP3[å¤§è§„æ¨¡å­˜å‚¨]
    B1 --> |"32x å‹ç¼©"| APP4[æé™å‹ç¼©]

    style F32 fill:#1890ff,color:#fff
    style I8 fill:#52c41a,color:#fff
```

| ç²¾åº¦ç±»å‹   | å­˜å‚¨ç©ºé—´   | ç›¸å¯¹è¯¯å·® | è®¡ç®—é€Ÿåº¦ | æ¨èåœºæ™¯           |
| ---------- | ---------- | -------- | -------- | ------------------ |
| **FP32**   | 4 å­—èŠ‚     | åŸºå‡†     | åŸºå‡†     | ç²¾ç¡®è®¡ç®—ã€è®­ç»ƒ     |
| **FP16**   | 2 å­—èŠ‚     | <0.1%    | 1.5-2x   | GPU æ¨ç†ã€å­˜å‚¨ä¼˜åŒ– |
| **BF16**   | 2 å­—èŠ‚     | <0.5%    | 1.5-2x   | è®­ç»ƒç¨³å®šæ€§         |
| **INT8**   | 1 å­—èŠ‚     | <1%      | 2-4x     | å¤§è§„æ¨¡éƒ¨ç½²         |
| **Binary** | 0.125 å­—èŠ‚ | 5-10%    | 10-32x   | æç«¯å‹ç¼©ã€åˆç­›     |

---

## 3. åŸºç¡€ç´¢å¼•ç®—æ³•

æœ¬ç« è¯¦ç»†ä»‹ç»å‘é‡ç´¢å¼•çš„åŸºç¡€ç®—æ³•ï¼ŒåŒ…æ‹¬ K-Means èšç±»ã€å±€éƒ¨æ•æ„Ÿå“ˆå¸Œï¼ˆLSHï¼‰å’Œå¯¼èˆªå°ä¸–ç•Œå›¾ï¼ˆNSWï¼‰ã€‚

### 3 K-Means èšç±»ä¸å‘é‡é‡åŒ–

#### 3.1.1 K-Means ç®—æ³•åŸç†

K-Means æ˜¯å‘é‡é‡åŒ–ï¼ˆVector Quantizationï¼‰çš„åŸºç¡€ç®—æ³•ï¼Œé€šè¿‡å°†æ•°æ®åˆ’åˆ†ä¸º K ä¸ªç°‡ï¼Œç”¨ç°‡ä¸­å¿ƒï¼ˆCentroidï¼‰ä»£è¡¨è¯¥ç°‡æ‰€æœ‰å‘é‡<sup>[[9]](#ref9)</sup>ã€‚

**æ•°å­¦ç›®æ ‡**ï¼šæœ€å°åŒ–ç°‡å†…æ–¹å·®å’Œï¼ˆWithin-Cluster Sum of Squares, WCSSï¼‰ï¼š

$$
    J = \sum_{i=1}^{K} \sum_{x \in C_i} \|x - \mu_i\|^2
$$

å…¶ä¸­ï¼š

- $K$ æ˜¯ç°‡çš„æ•°é‡
- $C_i$ æ˜¯ç¬¬ $i$ ä¸ªç°‡
- $\mu_i$ æ˜¯ç¬¬ $i$ ä¸ªç°‡çš„ä¸­å¿ƒ
- $\|x - \mu_i\|^2$ æ˜¯å‘é‡ $x$ åˆ°ç°‡ä¸­å¿ƒçš„æ¬§å‡ é‡Œå¾—è·ç¦»çš„å¹³æ–¹

**ç®—æ³•æµç¨‹**ï¼š

```mermaid
flowchart TD
    A[åˆå§‹åŒ–: éšæœºé€‰æ‹© K ä¸ªä¸­å¿ƒç‚¹] --> B[åˆ†é…æ­¥éª¤: å°†æ¯ä¸ªç‚¹åˆ†é…åˆ°æœ€è¿‘çš„ä¸­å¿ƒ]
    B --> C[æ›´æ–°æ­¥éª¤: é‡æ–°è®¡ç®—æ¯ä¸ªç°‡çš„ä¸­å¿ƒ]
    C --> D{ä¸­å¿ƒç‚¹æ˜¯å¦æ”¶æ•›?}
    D -->|å¦| B
    D -->|æ˜¯| E[è¾“å‡ºæœ€ç»ˆç°‡åˆ’åˆ†]

    style A fill:#e6f7ff
    style E fill:#f6ffed
```

**ä¼ªä»£ç **ï¼š

```python
def kmeans(vectors, k, max_iters=100):
    # 1. éšæœºåˆå§‹åŒ– K ä¸ªä¸­å¿ƒ
    centroids = random_select(vectors, k)

    for _ in range(max_iters):
        # 2. åˆ†é…ï¼šæ¯ä¸ªå‘é‡åˆ†é…åˆ°æœ€è¿‘çš„ä¸­å¿ƒ
        clusters = assign_to_nearest(vectors, centroids)

        # 3. æ›´æ–°ï¼šé‡æ–°è®¡ç®—ä¸­å¿ƒ
        new_centroids = compute_centroids(clusters)

        # 4. æ£€æŸ¥æ”¶æ•›
        if converged(centroids, new_centroids):
            break
        centroids = new_centroids

    return centroids, clusters
```

#### 3.1.2 å‘é‡é‡åŒ–åº”ç”¨ï¼šç æœ¬ï¼ˆCodebookï¼‰

K-Means åœ¨å‘é‡ç´¢å¼•ä¸­çš„æ ¸å¿ƒåº”ç”¨æ˜¯æ„å»º**ç æœ¬ï¼ˆCodebookï¼‰**ã€‚

> [!NOTE] ç æœ¬æ˜¯ä»€ä¹ˆï¼Ÿ
>
> ç æœ¬å°±æ˜¯ä¸€ä¸ª **"å‘é‡å­—å…¸"**ã€‚å¦‚æœä¸å­˜åŸå§‹å‘é‡ï¼Œè€Œæ˜¯å­˜è¿™ä¸ªå‘é‡"æœ€åƒå­—å…¸é‡Œçš„å“ªä¸€ä¸ª"ï¼Œå°±èƒ½å¤§å¹…å‹ç¼©æ•°æ®ã€‚å­—å…¸é‡Œçš„æ¯ä¸€ä¸ªè¯æ¡ï¼ˆä¸­å¿ƒå‘é‡ï¼‰ï¼Œè¢«ç§°ä¸º**ç å­—ï¼ˆCodewordï¼‰**ã€‚

```mermaid
graph LR
    subgraph "å‘é‡é‡åŒ–è¿‡ç¨‹"
        V[åŸå§‹å‘é‡<br/>1536 ç»´ Ã— N ä¸ª] --> KM[K-Means<br/>K=1024]
        KM --> CB[ç æœ¬<br/>1024 ä¸ªä¸­å¿ƒå‘é‡]
        KM --> ID[å‹ç¼©å­˜å‚¨<br/>ä»…å­˜ 10-bit ID]
    end

    style KM fill:#1890ff,color:#fff
```

> [!TIP] ç æœ¬åˆ¶ä½œè¿‡ç¨‹ï¼ˆTraining Codebookï¼‰ï¼š
>
> 1.  **é‡‡æ ·**ï¼šä»æµ·é‡æ•°æ®ä¸­éšæœºæŠ½å–ä¸€éƒ¨åˆ†å‘é‡ï¼ˆå¦‚ 100 ä¸‡ä¸ªï¼‰ä½œä¸ºè®­ç»ƒé›†ã€‚
> 2.  **èšç±»**ï¼šå¯¹è®­ç»ƒé›†è·‘ K-Means ç®—æ³•ï¼ˆå¦‚ K=1024ï¼‰ï¼Œå¾—åˆ° 1024 ä¸ªç°‡ä¸­å¿ƒã€‚
> 3.  **ç”Ÿæˆ**ï¼šè¿™ 1024 ä¸ªä¸­å¿ƒå‘é‡å°±ç»„æˆäº†ç æœ¬ã€‚
> 4.  **ç¼–ç **ï¼šå¯¹ä»»æ„æ–°å‘é‡ï¼Œæ‰¾åˆ°ç¦»å®ƒæœ€è¿‘çš„ä¸­å¿ƒå‘é‡ IDï¼ˆ0-1023ï¼‰ï¼Œç”¨è¿™ä¸ª 10-bit çš„ ID ä»£æ›¿åŸå§‹å‘é‡å­˜å‚¨ã€‚

```mermaid
graph LR
    subgraph "å‹ç¼©æ•ˆæœ"
        ORIG[åŸå§‹: 6KB/å‘é‡] --> COMP[å‹ç¼©å: 1.25 å­—èŠ‚/å‘é‡]
    end

    style COMP fill:#52c41a,color:#fff
```

| å‚æ•°         | ä½œç”¨               | å…¸å‹å€¼          | æƒè¡¡                 |
| ------------ | ------------------ | --------------- | -------------------- |
| **K**        | ç°‡çš„æ•°é‡ï¼Œå†³å®šç²¾åº¦ | 256, 1024, 4096 | è¶Šå¤§è¶Šç²¾ç¡®ï¼Œå­˜å‚¨è¶Šå¤š |
| **åˆå§‹åŒ–**   | ä¸­å¿ƒç‚¹åˆå§‹é€‰æ‹©ç­–ç•¥ | K-Means++       | å½±å“æ”¶æ•›é€Ÿåº¦å’Œè´¨é‡   |
| **è¿­ä»£æ¬¡æ•°** | æœ€å¤§è¿­ä»£è½®æ•°       | 10-100          | è¶Šå¤šè¶Šç²¾ç¡®ï¼Œè€—æ—¶è¶Šä¹… |

### 3.2 å±€éƒ¨æ•æ„Ÿå“ˆå¸Œï¼ˆLSHï¼‰

#### 3.2.1 LSH æ ¸å¿ƒæ€æƒ³

å±€éƒ¨æ•æ„Ÿå“ˆå¸Œï¼ˆLocality Sensitive Hashing, LSHï¼‰çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š**ç›¸ä¼¼çš„å‘é‡ä»¥é«˜æ¦‚ç‡è¢«å“ˆå¸Œåˆ°åŒä¸€ä¸ªæ¡¶ï¼Œä¸ç›¸ä¼¼çš„å‘é‡ä»¥ä½æ¦‚ç‡è¢«å“ˆå¸Œåˆ°åŒä¸€ä¸ªæ¡¶**<sup>[[10]](#ref10)</sup>ã€‚

ä¸ä¼ ç»Ÿå“ˆå¸Œï¼ˆå°½é‡å‡å°‘å†²çªï¼‰ç›¸åï¼ŒLSH **åˆ»æ„å¢åŠ ç›¸ä¼¼é¡¹çš„å†²çª**<sup>[[10]](#ref10)</sup>ï¼š

```mermaid
graph TD
    subgraph LSH_Box["ğŸŸ¢ LSH (å±€éƒ¨æ•æ„Ÿ) - æœ€å¤§åŒ–å†²çª"]
        C["'apple'"] --> H2(LSH)
        D["'apply'"] --> H2
        H2 --> |èšåˆ| L1["Bucket 01"]
    end

    subgraph Traditional["ğŸ”´ ä¼ ç»Ÿå“ˆå¸Œ (å¦‚ MD5) - æœ€å°åŒ–å†²çª"]
        A["'apple'"] --> H1(Hash)
        B["'apply'"] --> H1
        H1 --> |åˆ†æ•£| T1["0x5e..."]
        H1 --> |åˆ†æ•£| T2["0x8a..."]
    end

    style T1 fill:#ffccc7,stroke:#ff4d4f
    style T2 fill:#ffccc7,stroke:#ff4d4f
    style L1 fill:#d9f7be,stroke:#52c41a
```

**æ•°å­¦å®šä¹‰**ï¼šä¸€ä¸ªå“ˆå¸Œå‡½æ•°æ— $\mathcal{H}$ æ˜¯ $(d_1, d_2, p_1, p_2)$-æ•æ„Ÿçš„ï¼Œå½“ä¸”ä»…å½“å¯¹ä»»æ„ $v_1, v_2 \in \mathbb{R}^d$ï¼š

- å¦‚æœ $\text{dist}(v_1, v_2) \leq d_1$ï¼Œåˆ™ $P[h(v_1) = h(v_2)] \geq p_1$
- å¦‚æœ $\text{dist}(v_1, v_2) \geq d_2$ï¼Œåˆ™ $P[h(v_1) = h(v_2)] \leq p_2$

å…¶ä¸­ $d_1 < d_2$ ä¸” $p_1 > p_2$ã€‚

> [!TIP] æˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªæ•°å­¦å®šä¹‰ç¿»è¯‘æˆ **"ä¸¤ä¸ªæ‰¿è¯º"**ï¼š
>
> - æ‰¿è¯ºä¸€ï¼ˆ**å¯¹è¿‘é‚»è´Ÿè´£**ï¼‰ï¼š å¦‚æœä¸¤ä¸ªå‘é‡éå¸¸åƒï¼ˆè·ç¦»å°äº $d_1$ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä¿è¯å®ƒä»¬å¤§æ¦‚ç‡ï¼ˆæ¦‚ç‡å¤§äº $p_1$ï¼‰ä¼šè¢«åˆ†åˆ°åŒä¸€ä¸ªæ¡¶é‡Œã€‚
> - æ‰¿è¯ºäºŒï¼ˆ**å¯¹è¿œé‚»è´Ÿè´£**ï¼‰ï¼š å¦‚æœä¸¤ä¸ªå‘é‡éå¸¸ä¸åƒï¼ˆè·ç¦»å¤§äº $d_2$ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä¿è¯å®ƒä»¬å°æ¦‚ç‡ï¼ˆæ¦‚ç‡å°äº $p_2$ï¼‰ä¼šè¢«åˆ†åˆ°åŒä¸€ä¸ªæ¡¶é‡Œã€‚

#### 3.2.2 éšæœºè¶…å¹³é¢æŠ•å½± LSH

å¯¹äºä½™å¼¦ç›¸ä¼¼åº¦ï¼Œæœ€å¸¸ç”¨çš„ LSH æ–¹æ³•æ˜¯**éšæœºè¶…å¹³é¢æŠ•å½±**<sup>[[10]](#ref10)</sup>ï¼š

```mermaid
graph LR
    subgraph "éšæœºæŠ•å½± LSH"
        V[å‘é‡ v] --> P1[æŠ•å½±åˆ°è¶…å¹³é¢ 1]
        V --> P2[æŠ•å½±åˆ°è¶…å¹³é¢ 2]
        V --> P3[æŠ•å½±åˆ°è¶…å¹³é¢ k]

        P1 --> |"vÂ·r1 > 0 â†’ 1"| B1[1]
        P2 --> |"vÂ·r2 < 0 â†’ 0"| B2[0]
        P3 --> |"vÂ·r3 > 0 â†’ 1"| B3[1]

        B1 & B2 & B3 --> HC[å“ˆå¸Œç : 101]
    end
```

**ç®—æ³•æµç¨‹**ï¼š

1. **ç”Ÿæˆéšæœºè¶…å¹³é¢**ï¼šç”Ÿæˆ $k$ ä¸ªéšæœºå•ä½å‘é‡ $r_1, r_2, ..., r_k$
2. **è®¡ç®—å“ˆå¸Œç **ï¼šå¯¹æ¯ä¸ªè¾“å…¥å‘é‡ $v$ï¼Œè®¡ç®— $h_i(v) = \text{sign}(v \cdot r_i)$
3. **æ„å»ºå“ˆå¸Œè¡¨**ï¼šå°†å…·æœ‰ç›¸åŒå“ˆå¸Œç çš„å‘é‡æ”¾å…¥åŒä¸€ä¸ªæ¡¶
4. **æŸ¥è¯¢**ï¼šå°†æŸ¥è¯¢å‘é‡å“ˆå¸Œï¼Œæ£€ç´¢åŒä¸€æ¡¶ä¸­çš„å€™é€‰å‘é‡

> [!TIP] æœ‰ä¸€ä¸ªè‘—åçš„ç»“è®ºï¼š
> ä¸¤ä¸ªå‘é‡è¢«éšæœºè¶…å¹³é¢åˆ†å‰²å¼€çš„æ¦‚ç‡ï¼Œç›´æ¥æ­£æ¯”äºå®ƒä»¬ä¹‹é—´çš„å¤¹è§’ $\theta$ã€‚ $P(h(x) \neq h(y)) = \frac{\theta}{\pi}$ï¼Œè¿™æ°å¥½å¯¹åº”äº†ä½™å¼¦è·ç¦»ï¼ˆå¤¹è§’å¤§å°ï¼‰ï¼Œå› æ­¤è®¤ä¸ºéšæœºè¶…å¹³é¢æŠ•å½±æ˜¯ä¸“é—¨é’ˆå¯¹ä½™å¼¦ç›¸ä¼¼åº¦è¿™ç§ç›¸ä¼¼åº¦é‡æ–¹å¼çš„ç´¢å¼•ç®—æ³•ã€‚

**ä¼ªä»£ç **ï¼š

```python
class RandomProjectionLSH:
    def __init__(self, dim, num_planes, num_tables):
        self.num_tables = num_tables
        # æ¯ä¸ªå“ˆå¸Œè¡¨æœ‰ä¸åŒçš„éšæœºè¶…å¹³é¢
        self.hyperplanes = [
            np.random.randn(num_planes, dim)
            for _ in range(num_tables)
        ]
        self.tables = [{} for _ in range(num_tables)]

    def hash(self, vector, table_idx):
        # è®¡ç®—å‘é‡ä¸è¶…å¹³é¢çš„ç‚¹ç§¯ç¬¦å·
        projections = self.hyperplanes[table_idx] @ vector
        return tuple((projections > 0).astype(int))

    def insert(self, vector, label):
        for i in range(self.num_tables):
            hash_code = self.hash(vector, i)
            if hash_code not in self.tables[i]:
                self.tables[i][hash_code] = []
            self.tables[i][hash_code].append(label)

    def query(self, vector, k):
        candidates = set()
        for i in range(self.num_tables):
            hash_code = self.hash(vector, i)
            if hash_code in self.tables[i]:
                candidates.update(self.tables[i][hash_code])
        # å¯¹å€™é€‰é›†è¿›è¡Œç²¾ç¡®è·ç¦»è®¡ç®—ï¼Œè¿”å› Top-K
        return refine_and_rank(candidates, vector, k)
```

#### 3.2.3 LSH å‚æ•°è°ƒä¼˜

| å‚æ•°              | å«ä¹‰             | å½±å“                             |
| ----------------- | ---------------- | -------------------------------- |
| **kï¼ˆæ¯”ç‰¹æ•°ï¼‰**   | æ¯ä¸ªå“ˆå¸Œç çš„ä½æ•° | è¶Šå¤§æ¡¶è¶Šç»†ï¼Œå¬å›é™ä½ï¼Œç²¾åº¦æé«˜   |
| **Lï¼ˆå“ˆå¸Œè¡¨æ•°ï¼‰** | ç‹¬ç«‹å“ˆå¸Œè¡¨çš„æ•°é‡ | è¶Šå¤šå¬å›ç‡è¶Šé«˜ï¼Œä½†å†…å­˜å’Œæ—¶é—´å¢åŠ  |
| **æ¡¶å¤§å°**        | æ¯ä¸ªæ¡¶çš„å®¹é‡     | å¤ªå¤§æŸ¥è¯¢æ…¢ï¼Œå¤ªå°å¯èƒ½æ¼æ‰ç›¸ä¼¼é¡¹   |

**å¬å›ç‡ä¸å“ˆå¸Œè¡¨æ•°é‡çš„å…³ç³»**ï¼š

$$
    P[\text{æ‰¾åˆ°è¿‘é‚»}] = 1 - (1 - p^k)^L
$$

å…¶ä¸­ $p$ æ˜¯ä¸¤ä¸ªç›¸ä¼¼å‘é‡è¢«å•ä¸ªè¶…å¹³é¢åˆ†åˆ°åŒä¸€ä¾§çš„æ¦‚ç‡ã€‚

#### 3.2.4 LSH å˜ä½“

| LSH å˜ä½“              | é€‚ç”¨è·ç¦»åº¦é‡   | ç‰¹ç‚¹                                       |
| --------------------- | -------------- | ------------------------------------------ |
| **Random Projection** | ä½™å¼¦ç›¸ä¼¼åº¦     | ä½¿ç”¨éšæœºè¶…å¹³é¢<sup>[[10]](#ref10)</sup>    |
| **MinHash**           | Jaccard ç›¸ä¼¼åº¦ | é€‚ç”¨äºé›†åˆæ•°æ®<sup>[[10]](#ref10)</sup>    |
| **SimHash**           | æ±‰æ˜è·ç¦»       | é€‚ç”¨äºæ–‡æ¡£å»é‡<sup>[[10]](#ref10)</sup>    |
| **p-stable LSH**      | Lp è·ç¦»        | é€‚ç”¨äº L1/L2 è·ç¦»<sup>[[10]](#ref10)</sup> |

### 3.3 å¯¼èˆªå°ä¸–ç•Œå›¾ï¼ˆNSWï¼‰

#### 3.3.1 å°ä¸–ç•Œç½‘ç»œç†è®º

å°ä¸–ç•Œç°è±¡æºäºç¤¾ä¼šå­¦ä¸­çš„"å…­åº¦åˆ†éš”"ç†è®ºï¼šä»»æ„ä¸¤ä¸ªäººä¹‹é—´å¹³å‡åªéœ€è¦å…­ä¸ªä¸­é—´äººå°±èƒ½å»ºç«‹è”ç³»ã€‚åœ¨å›¾è®ºä¸­ï¼Œå°ä¸–ç•Œå›¾å…·æœ‰ä»¥ä¸‹ç‰¹æ€§<sup>[[11]](#ref11)</sup>ï¼š

- **é«˜èšç±»ç³»æ•°**ï¼šå±€éƒ¨èŠ‚ç‚¹ç´§å¯†è¿æ¥
- **çŸ­å¹³å‡è·¯å¾„**ï¼šä»»æ„ä¸¤ç‚¹ä¹‹é—´çš„æœ€çŸ­è·¯å¾„è¾ƒçŸ­

```mermaid
graph TB
    subgraph "å°ä¸–ç•Œå›¾ç‰¹æ€§"
        A[èŠ‚ç‚¹] --> B[å±€éƒ¨è¿æ¥]
        A --> C[é•¿ç¨‹è¿æ¥]
        B --> D["é«˜èšç±»ç³»æ•°<br/>é‚»å±…ä¹‹é—´é«˜åº¦äº’è¿"]
        C --> E["çŸ­è·¯å¾„é•¿åº¦<br/>O(log n) è·³æ•°"]
    end

    style D fill:#bae7ff,stroke:#1890ff,color:#000000
    style E fill:#d9f7be,stroke:#52c41a,color:#000000
```

#### 3.3.2 NSW å›¾æ„å»º

**å¯¼èˆªå°ä¸–ç•Œå›¾ï¼ˆNavigable Small World, NSWï¼‰** æ˜¯ä¸€ç§åŸºäºè´ªå©ªè·¯ç”±çš„è¿‘é‚»å›¾ç»“æ„<sup>[[11]](#ref11)</sup>ï¼š

**æ„å»ºç®—æ³•**ï¼š

```mermaid
flowchart TD
    A[è¾“å…¥: æ–°å‘é‡ v] --> B[éšæœºé€‰æ‹©å…¥å£ç‚¹]
    B --> C[è´ªå©ªæœç´¢: æ‰¾åˆ°å½“å‰æœ€è¿‘ M ä¸ªé‚»å±…]
    C --> D[å°† v ä¸è¿™ M ä¸ªé‚»å±…åŒå‘è¿æ¥]
    D --> E[æ’å…¥å®Œæˆ]

    style C fill:#1890ff,color:#fff
```

**ä¼ªä»£ç **ï¼š

```python
class NSW:
    def __init__(self, M=16):
        self.M = M  # æ¯ä¸ªèŠ‚ç‚¹çš„æœ€å¤§é‚»å±…æ•°
        self.graph = {}

    def insert(self, vector, label):
        if len(self.graph) == 0:
            self.graph[label] = {'vector': vector, 'neighbors': []}
            return

        # 1. è´ªå©ªæœç´¢æ‰¾åˆ°å½“å‰ M ä¸ªæœ€è¿‘é‚»å±…
        neighbors = self.greedy_search(vector, self.M)

        # 2. å»ºç«‹åŒå‘è¿æ¥
        self.graph[label] = {'vector': vector, 'neighbors': neighbors}
        for n in neighbors:
            self.graph[n]['neighbors'].append(label)
            # å¦‚æœé‚»å±…æ•°è¶…è¿‡ Mï¼Œç§»é™¤æœ€è¿œçš„
            if len(self.graph[n]['neighbors']) > self.M:
                self._prune_neighbors(n)

    def greedy_search(self, query, k, entry=None):
        if entry is None:
            entry = random.choice(list(self.graph.keys()))

        visited = set()
        candidates = [(self._distance(query, entry), entry)]
        results = []

        while candidates:
            dist, current = heapq.heappop(candidates)
            if current in visited:
                continue
            visited.add(current)
            results.append((dist, current))

            # æ¢ç´¢é‚»å±…
            for neighbor in self.graph[current]['neighbors']:
                if neighbor not in visited:
                    d = self._distance(query, neighbor)
                    heapq.heappush(candidates, (d, neighbor))

        return [r[1] for r in sorted(results)[:k]]
```

#### 3.3.3 NSW çš„æœç´¢è¿‡ç¨‹

NSW ä½¿ç”¨**è´ªå©ªè·¯ç”±**è¿›è¡Œæœç´¢ï¼šä»å…¥å£ç‚¹å¼€å§‹ï¼Œæ¯ä¸€æ­¥éƒ½ç§»åŠ¨åˆ°å½“å‰èŠ‚ç‚¹é‚»å±…ä¸­è·ç¦»æŸ¥è¯¢æœ€è¿‘çš„èŠ‚ç‚¹ï¼Œç›´åˆ°æ— æ³•æ‰¾åˆ°æ›´è¿‘çš„é‚»å±…<sup>[[11]](#ref11)</sup>ã€‚

```mermaid
graph LR
    subgraph "NSW è´ªå©ªæœç´¢"
        Q[æŸ¥è¯¢å‘é‡] --> E[å…¥å£ç‚¹]
        E --> |"ç§»åŠ¨åˆ°æ›´è¿‘é‚»å±…"| N1[èŠ‚ç‚¹1]
        N1 --> |"ç»§ç»­ç§»åŠ¨"| N2[èŠ‚ç‚¹2]
        N2 --> |"ç»§ç»­ç§»åŠ¨"| N3[èŠ‚ç‚¹3]
        N3 --> |"å±€éƒ¨æœ€ä¼˜"| R[è¿”å›ç»“æœ]
    end

    style Q fill:#ffd591,color:#000000
    style R fill:#b7eb8f,color:#000000
```

**å¤æ‚åº¦åˆ†æ**ï¼š

| æŒ‡æ ‡       | å¤æ‚åº¦           | è¯´æ˜                         |
| ---------- | ---------------- | ---------------------------- |
| æ„å»ºæ—¶é—´   | O(n Ã— log n Ã— M) | n ä¸ªå‘é‡ï¼Œæ¯ä¸ªæœç´¢ O(log n)  |
| æœç´¢æ—¶é—´   | O(log^k n)       | k æ˜¯å°ä¸–ç•ŒæŒ‡æ•°ï¼Œé€šå¸¸ k â‰ˆ 1-2 |
| ç©ºé—´å¤æ‚åº¦ | O(n Ã— M)         | æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨ M ä¸ªé‚»å±…        |

**NSW çš„å±€é™æ€§**ï¼š

1. **å±€éƒ¨æœ€ä¼˜é™·é˜±**ï¼šè´ªå©ªæœç´¢å¯èƒ½é™·å…¥å±€éƒ¨æœ€ä¼˜
2. **å…¥å£ç‚¹æ•æ„Ÿ**ï¼šä¸åŒå…¥å£ç‚¹å¯èƒ½å¯¼è‡´ä¸åŒç»“æœ
3. **æ‰©å±•æ€§æœ‰é™**ï¼šå•å±‚ç»“æ„åœ¨å¤§è§„æ¨¡æ•°æ®ä¸Šæ•ˆç‡ä¸‹é™

> **è¿›åŒ–æ–¹å‘**ï¼šHNSW é€šè¿‡å¼•å…¥å¤šå±‚ç»“æ„è§£å†³äº†è¿™äº›é—®é¢˜ï¼Œå°†åœ¨ç¬¬ 4 ç« è¯¦ç»†ä»‹ç»ã€‚

---

## 4. é«˜çº§ç´¢å¼•ç®—æ³•

æœ¬ç« ä»‹ç»ä¸‰ç§æœ€é‡è¦çš„é«˜çº§ç´¢å¼•ç®—æ³•ï¼šåˆ†å±‚å¯¼èˆªå°ä¸–ç•Œå›¾ï¼ˆHNSWï¼‰ã€å€’æ’æ–‡ä»¶ç´¢å¼•ï¼ˆIVFï¼‰ç³»åˆ—å’Œä¹˜ç§¯é‡åŒ–ï¼ˆPQï¼‰ã€‚

### 4.1 åˆ†å±‚å¯¼èˆªå°ä¸–ç•Œå›¾ï¼ˆHNSWï¼‰

#### 4.1.1 HNSW æ ¸å¿ƒæ€æƒ³

**åˆ†å±‚å¯¼èˆªå°ä¸–ç•Œå›¾ï¼ˆHierarchical Navigable Small World, HNSWï¼‰** æ˜¯å½“å‰æœ€æµè¡Œçš„é«˜æ€§èƒ½ ANN ç®—æ³•ï¼Œç”± Yury Malkov åœ¨ 2016 å¹´æå‡º<sup>[[12]](#ref12)</sup>ã€‚

HNSW çš„æ ¸å¿ƒåˆ›æ–°æ˜¯å°† NSW ä¸ Skip List æ•°æ®ç»“æ„ç›¸ç»“åˆï¼Œæ„å»º**å¤šå±‚å›¾ç»“æ„**ï¼š

```mermaid
graph TB
    subgraph "HNSW å¤šå±‚ç»“æ„"
        L3["Layer 3 (æœ€ç¨€ç–)<br/>é•¿è·ç¦»è·³è·ƒ"]
        L2["Layer 2<br/>ä¸­ç­‰å¯†åº¦"]
        L1["Layer 1<br/>è¾ƒå¯†é›†"]
        L0["Layer 0 (æœ€å¯†é›†)<br/>æ‰€æœ‰èŠ‚ç‚¹"]
    end

    Q[æŸ¥è¯¢] --> L3
    L3 --> |"å¿«é€Ÿå®šä½åŒºåŸŸ"| L2
    L2 --> |"é€æ­¥ç»†åŒ–"| L1
    L1 --> |"ç²¾ç¡®æœç´¢"| L0
    L0 --> R[æœ€ç»ˆç»“æœ]

    style L3 fill:#ffe58f,color:#000000
    style L0 fill:#91d5ff,color:#000000
    style R fill:#b7eb8f,color:#000000
```

**å±‚çº§æ¦‚ç‡**ï¼šæ¯ä¸ªèŠ‚ç‚¹è¢«åˆ†é…åˆ°ç¬¬ $l$ å±‚çš„æ¦‚ç‡ä¸ºï¼š

$$
P(\text{level} = l) = \frac{1}{m_L} \cdot \left(\frac{1}{m_L}\right)^{l-1} = \left(\frac{1}{m_L}\right)^l
$$

å…¶ä¸­ $m_L$ æ˜¯å±‚çº§å› å­ï¼ˆé€šå¸¸ä¸º $\frac{1}{\ln(M)}$ï¼ŒM æ˜¯æœ€å¤§è¿æ¥æ•°ï¼‰ã€‚

#### 4.1.2 HNSW å›¾æ„å»ºç®—æ³•

```mermaid
flowchart TD
    A[è¾“å…¥: æ–°å‘é‡ q] --> B[è®¡ç®—æœ€å¤§å±‚çº§ l]
    B --> C[è®¾ç½®å…¥å£ç‚¹ ep = é¡¶å±‚å…¥å£]

    C --> D{å½“å‰å±‚ > l?}
    D --> |æ˜¯| E[åœ¨å½“å‰å±‚è´ªå©ªæœç´¢ï¼Œæ‰¾åˆ°ç¦» q æœ€è¿‘çš„ç‚¹]
    E --> F[ä¸‹é™åˆ°ä¸‹ä¸€å±‚]
    F --> D

    D --> |å¦| G[ä»å½“å‰å±‚åˆ° Layer 0]
    G --> H[åœ¨æ¯å±‚æœç´¢ ef_construction ä¸ªå€™é€‰é‚»å±…]
    H --> I[é€‰æ‹© M ä¸ªé‚»å±…å»ºç«‹åŒå‘è¿æ¥]
    I --> J[åº”ç”¨å¯å‘å¼å‰ªæ]
    J --> K{è¿˜æœ‰æ›´ä½å±‚?}
    K --> |æ˜¯| G
    K --> |å¦| L[æ›´æ–°å…¥å£ç‚¹ï¼ˆå¦‚æœ l æ›´é«˜ï¼‰]
    L --> M[æ’å…¥å®Œæˆ]

    style B fill:#e6f7ff,color:#000000
    style H fill:#1890ff,color:#000000
    style J fill:#fa8c16,color:#000000
```

> [!NOTE] å¯å‘å¼å‰ªæ (Heuristic Pruning)
>
> **"ä¸ä»…é€‰æœ€è¿‘çš„ï¼Œè¿˜è¦é€‰åˆ†å¸ƒå¹¿çš„"** çš„é‚»å±…é€‰æ‹©ç­–ç•¥ã€‚
>
> å®ƒçš„æ ¸å¿ƒç›®çš„æ˜¯ä¼˜åŒ–å›¾çš„ **è¿é€šæ€§**ï¼Œé˜²æ­¢ **"æŠ±å›¢"** ç°è±¡ï¼ˆå³æ‰€æœ‰é‚»å±…éƒ½èšåœ¨ä¸€èµ·ï¼‰ï¼Œä»è€Œåœ¨å›¾ä¸­å»ºç«‹æ›´é«˜æ•ˆçš„â€œé«˜é€Ÿå…¬è·¯â€ã€‚
>
> **é€šä¿—è§£é‡Š**ï¼šå‡è®¾ä½ è¦åœ¨å¾®ä¿¡é‡Œé€‰ 5 ä¸ªæœ‹å‹åšâ€œç´§æ€¥è”ç³»äººâ€ï¼ˆå»ºç«‹è¿æ¥ï¼‰ï¼š
>
> **æ™®é€šç­–ç•¥ï¼ˆåªçœ‹è·ç¦»ï¼‰**ï¼šä½ é€‰äº† 5 ä¸ªä½åœ¨ä½ æ¥¼ä¸‹çš„é‚»å±…ã€‚
>
> **é—®é¢˜**ï¼šå¦‚æœä½ è¦è”ç³»ä½åœ¨å¦ä¸€ä¸ªåŸå¸‚çš„äººï¼Œæ¶ˆæ¯ä¼ ä¸å‡ºå»ï¼Œå› ä¸ºä½ çš„åœˆå­å¤ªçª„äº†ï¼ˆå±€éƒ¨æœ€ä¼˜é™·é˜±ï¼‰ã€‚
>
> **å¯å‘å¼å‰ªæç­–ç•¥ï¼ˆHNSW çš„åšæ³•ï¼‰**ï¼šä½ å…ˆé€‰äº† 1 ä¸ªæ¥¼ä¸‹é‚»å±…ï¼Œç„¶åæƒ³é€‰ç¬¬ 2 ä¸ªé‚»å±…æ—¶ï¼š"å“ï¼Œç¬¬ 2 ä¸ªé‚»å±…è™½ç„¶ä¹Ÿç¦»ä½ å¾ˆè¿‘ï¼Œä½†ä»–ç¦»ç¬¬ 1 ä¸ªé‚»å±…æ›´è¿‘ï¼æ—¢ç„¶ä½ å¯ä»¥é€šè¿‡ç¬¬ 1 ä¸ªé‚»å±…æ‰¾åˆ°ä»–ï¼Œé‚£å°±ä¸éœ€è¦ç›´æ¥è¿ä»–äº†ã€‚ä½ åº”è¯¥è¿ä¸€ä¸ªè™½ç„¶ç¨è¿œä¸€ç‚¹ï¼Œä½†æ–¹å‘å®Œå…¨ä¸åŒçš„äººï¼ˆæ¯”å¦‚ä½åœ¨éš”å£åŒºçš„åŒå­¦ï¼‰ã€‚"
>
> **æ•ˆæœ**ï¼šé€šè¿‡è¿™ç§ **â€œå–œæ–°åŒæ—§â€**ï¼ˆåå¥½é‚£äº›ä¸èƒ½é€šè¿‡ç°æœ‰é‚»å±…å¿«é€Ÿåˆ°è¾¾çš„ç‚¹ï¼‰çš„ç­–ç•¥ï¼ŒHNSW æ„å»ºçš„å›¾æ—¢æœ‰çŸ­è¾¹ï¼ˆä¿ç•™ç»†èŠ‚ï¼‰ï¼Œåˆæœ‰é•¿è¾¹ï¼ˆè·¨è¶ŠåŒºåŸŸï¼‰ï¼Œå¤§å¤§æå‡äº†æœç´¢æ—¶çš„â€œå¯¼èˆªâ€æ•ˆç‡ã€‚

**ä¼ªä»£ç **ï¼š

```python
class HNSW:
    def __init__(self, M=16, ef_construction=200, ml=None):
        self.M = M                       # æ¯å±‚æœ€å¤§è¿æ¥æ•°
        self.M0 = 2 * M                  # Layer 0 æœ€å¤§è¿æ¥æ•°
        self.ef_construction = ef_construction  # æ„å»ºæ—¶æœç´¢å®½åº¦
        self.ml = ml or 1 / math.log(M)  # å±‚çº§å› å­
        self.layers = []
        self.entry_point = None
        self.max_level = 0

    def _random_level(self):
        """éšæœºç”ŸæˆèŠ‚ç‚¹æ‰€åœ¨çš„æœ€é«˜å±‚çº§"""
        level = 0
        while random.random() < self.ml and level < self.max_level + 1:
            level += 1
        return level

    def insert(self, vector, label):
        level = self._random_level()

        if self.entry_point is None:
            self.entry_point = label
            self.max_level = level
            self._add_node(label, vector, level)
            return

        # Phase 1: ä»é¡¶å±‚è´ªå©ªæœç´¢åˆ°ç›®æ ‡å±‚
        ep = self.entry_point
        for l in range(self.max_level, level, -1):
            ep = self._search_layer(vector, ep, 1, l)[0]

        # Phase 2: åœ¨ç›®æ ‡å±‚åŠä»¥ä¸‹å»ºç«‹è¿æ¥
        for l in range(min(level, self.max_level), -1, -1):
            candidates = self._search_layer(vector, ep, self.ef_construction, l)
            neighbors = self._select_neighbors(vector, candidates, self.M if l > 0 else self.M0, l)
            self._add_connections(label, neighbors, l)
            ep = candidates[0]

        # æ›´æ–°å…¥å£ç‚¹
        if level > self.max_level:
            self.entry_point = label
            self.max_level = level

    def _select_neighbors(self, vector, candidates, M, level):
        """å¯å‘å¼é‚»å±…é€‰æ‹©ï¼šå…¼é¡¾è·ç¦»å’Œå¤šæ ·æ€§"""
        # Simple heuristic: é€‰æ‹©æœ€è¿‘çš„ M ä¸ª
        # Advanced: å¯ä»¥ä½¿ç”¨ RNGï¼ˆRelative Neighborhood Graphï¼‰å¯å‘å¼
        return sorted(candidates, key=lambda c: self._distance(vector, c))[:M]
```

#### 4.1.3 HNSW æœç´¢ç®—æ³•

```mermaid
sequenceDiagram
    participant Q as æŸ¥è¯¢
    participant L3 as Layer 3
    participant L2 as Layer 2
    participant L1 as Layer 1
    participant L0 as Layer 0

    Q->>L3: ä»å…¥å£ç‚¹å¼€å§‹
    L3->>L3: è´ªå©ªæœç´¢ï¼Œæ‰¾åˆ°å±€éƒ¨æœ€ä¼˜
    L3->>L2: ä¸‹é™åˆ° Layer 2
    L2->>L2: ç»§ç»­è´ªå©ªæœç´¢
    L2->>L1: ä¸‹é™åˆ° Layer 1
    L1->>L1: è´ªå©ªæœç´¢
    L1->>L0: ä¸‹é™åˆ° Layer 0
    L0->>L0: ef_search èŒƒå›´æœç´¢
    L0->>Q: è¿”å› Top-K ç»“æœ
```

**æœç´¢ä¼ªä»£ç **ï¼š

```python
def search(self, query, k, ef_search=None):
    ef = ef_search or k

    # Phase 1: ä»é¡¶å±‚è´ªå©ªä¸‹é™
    ep = self.entry_point
    for l in range(self.max_level, 0, -1):
        ep = self._search_layer(query, ep, 1, l)[0]

    # Phase 2: åœ¨ Layer 0 è¿›è¡Œå®½åº¦ä¼˜å…ˆæœç´¢
    candidates = self._search_layer(query, ep, ef, 0)

    return sorted(candidates, key=lambda c: self._distance(query, c))[:k]

def _search_layer(self, query, entry_point, ef, level):
    visited = {entry_point}
    candidates = [(self._distance(query, entry_point), entry_point)]
    result = list(candidates)

    while candidates:
        dist, current = heapq.heappop(candidates)

        # å¦‚æœå½“å‰è·ç¦»å¤§äºç»“æœä¸­æœ€è¿œçš„è·ç¦»ï¼Œåœæ­¢
        if len(result) >= ef and dist > result[-1][0]:
            break

        # æ¢ç´¢é‚»å±…
        for neighbor in self._get_neighbors(current, level):
            if neighbor not in visited:
                visited.add(neighbor)
                d = self._distance(query, neighbor)
                if len(result) < ef or d < result[-1][0]:
                    heapq.heappush(candidates, (d, neighbor))
                    result.append((d, neighbor))
                    result = sorted(result)[:ef]

    return [r[1] for r in result]
```

#### 4.1.4 HNSW å‚æ•°è°ƒä¼˜æŒ‡å—

| å‚æ•°                | å«ä¹‰           | æ¨èå€¼  | å½±å“                           |
| ------------------- | -------------- | ------- | ------------------------------ |
| **M**               | æ¯å±‚æœ€å¤§é‚»å±…æ•° | 16-64   | è¶Šå¤§å¬å›è¶Šé«˜ï¼Œä½†æ„å»ºå’Œæœç´¢æ›´æ…¢ |
| **ef_construction** | æ„å»ºæ—¶æœç´¢å®½åº¦ | 100-200 | è¶Šå¤§ç´¢å¼•è´¨é‡è¶Šé«˜               |
| **ef_search**       | æœç´¢æ—¶æ¢ç´¢å®½åº¦ | 10-1000 | è¶Šå¤§å¬å›è¶Šé«˜ï¼Œå»¶è¿Ÿè¶Šå¤§         |
| **ml**              | å±‚çº§å› å­       | 1/ln(M) | æ§åˆ¶å±‚çº§åˆ†å¸ƒ                   |

**æ€§èƒ½ä¸å¬å›ç‡æƒè¡¡**ï¼š

```mermaid
graph LR
    subgraph "å‚æ•°è°ƒä¼˜"
        M[M=16] --> |"æ›´é«˜å¬å›"| M32[M=32]
        M32 --> |"æ›´é«˜å¬å›"| M64[M=64]

        EF[ef=10] --> |"æ›´é«˜å¬å›"| EF100[ef=100]
        EF100 --> |"æ›´é«˜å¬å›"| EF500[ef=500]
    end

    subgraph "æƒè¡¡"
        HIGH[é«˜å¬å›ç‡ 99%+] --> SLOW[å»¶è¿Ÿ 10-50ms]
        LOW[ä½å¬å›ç‡ 90%] --> FAST[å»¶è¿Ÿ 1-5ms]
    end
```

#### 4.1.5 HNSW å¤æ‚åº¦åˆ†æ

| æŒ‡æ ‡     | å¤æ‚åº¦                  | è¯´æ˜                         |
| -------- | ----------------------- | ---------------------------- |
| æ„å»ºæ—¶é—´ | O(n Ã— log n Ã— M Ã— ef_c) | ef_c = ef_construction       |
| æœç´¢æ—¶é—´ | O(log n Ã— ef Ã— M)       | å®é™…é€šå¸¸ < 1ms               |
| å†…å­˜å ç”¨ | O(n Ã— M Ã— L)            | L æ˜¯å¹³å‡å±‚æ•° â‰ˆ log(n)/log(M) |

### 4.2 å€’æ’æ–‡ä»¶ç´¢å¼•ï¼ˆIVFï¼‰ç³»åˆ—

#### 4.2.1 IVF åŸºæœ¬åŸç†

**å€’æ’æ–‡ä»¶ç´¢å¼•ï¼ˆInverted File Index, IVFï¼‰** ä½¿ç”¨èšç±»å°†å‘é‡ç©ºé—´åˆ’åˆ†ä¸ºå¤šä¸ªåŒºåŸŸï¼ŒæŸ¥è¯¢æ—¶åªæœç´¢æœ€ç›¸å…³çš„å‡ ä¸ªåŒºåŸŸ<sup>[[13]](#ref13)</sup>ã€‚

```mermaid
graph TB
    subgraph "IVF ç´¢å¼•ç»“æ„"
        DATA[åŸå§‹å‘é‡<br/>N ä¸ª] --> CLUSTER[K-Means èšç±»]
        CLUSTER --> C1[ç°‡ 1<br/>ä¸­å¿ƒ c1]
        CLUSTER --> C2[ç°‡ 2<br/>ä¸­å¿ƒ c2]
        CLUSTER --> C3[...<br/>...]
        CLUSTER --> CK[ç°‡ K<br/>ä¸­å¿ƒ cK]

        C1 --> V1[å‘é‡åˆ—è¡¨ 1]
        C2 --> V2[å‘é‡åˆ—è¡¨ 2]
        CK --> VK[å‘é‡åˆ—è¡¨ K]
    end

    Q[æŸ¥è¯¢å‘é‡] --> FIND[æ‰¾åˆ°æœ€è¿‘çš„ nprobe ä¸ªä¸­å¿ƒ]
    FIND --> SEARCH[åªåœ¨è¿™äº›ç°‡ä¸­æœç´¢]
    SEARCH --> RESULT[è¿”å› Top-K]

    style CLUSTER fill:#1890ff,color:#fff
    style FIND fill:#fa8c16,color:#fff
```

**æ•°å­¦è¡¨è¿°**ï¼š

1. **ç´¢å¼•æ„å»º**ï¼šä½¿ç”¨ K-Means å°† n ä¸ªå‘é‡åˆ’åˆ†ä¸º K ä¸ªç°‡
2. **æŸ¥è¯¢**ï¼šç»™å®šæŸ¥è¯¢å‘é‡ qï¼Œé¦–å…ˆæ‰¾åˆ° q æœ€è¿‘çš„ nprobe ä¸ªç°‡ä¸­å¿ƒï¼Œç„¶ååœ¨è¿™äº›ç°‡ä¸­è¿›è¡Œç²¾ç¡®æœç´¢

æœç´¢å¤æ‚åº¦ä» O(n) é™ä¸º O(K + nprobe Ã— n/K)ã€‚

#### 4.2.2 IVFFlat

**IVFFlatï¼ˆInverted File with Flat vectorsï¼‰** æ˜¯æœ€åŸºç¡€çš„ IVF å˜ä½“ï¼Œå®ƒå°†ç©ºé—´åˆ’åˆ†ä¸ºå¤šä¸ªèšç±»åŒºåŸŸï¼ˆVoronoi å•å…ƒï¼‰ï¼Œå¹¶åœ¨æ¯ä¸ªåŒºåŸŸå†…ç›´æ¥å­˜å‚¨åŸå§‹å‘é‡ã€‚

> [!TIP] IVFFlat å°±åƒæ˜¯"åˆ†å¥½ç±»çš„å›¾ä¹¦é¦†"ï¼š
>
> 1. **èšç±»ï¼ˆåˆ†æ¶ï¼‰**ï¼šå…ˆæŠŠä¹¦ï¼ˆå‘é‡ï¼‰æŒ‰ç±»åˆ«æŠŠä¹¦åˆ†åˆ°ä¸åŒçš„ä¹¦æ¶ï¼ˆèšç±»ä¸­å¿ƒï¼‰ä¸Šã€‚
> 2. **å­˜å‚¨ï¼ˆFlatï¼‰**ï¼šä¹¦æ¶ä¸Šçš„ä¹¦æ˜¯**åŸæ ·æ‘†æ”¾**çš„ï¼ˆå­˜å‚¨åŸå§‹å‘é‡ï¼Œæ— å‹ç¼©ï¼‰ã€‚
> 3. **æŸ¥è¯¢**ï¼šæ‰¾ä¹¦æ—¶ï¼Œå…ˆçœ‹ç›®å½•ç¡®å®šåœ¨å“ªå‡ ä¸ªä¹¦æ¶ï¼Œç„¶åå»è¿™å‡ ä¸ªä¹¦æ¶ä¸Š**æŒ¨ä¸ª**æ‰¾ã€‚

```python
class IVFFlat:
    def __init__(self, nlist):
        self.nlist = nlist  # ç°‡çš„æ•°é‡
        self.centroids = None
        self.inverted_lists = [[] for _ in range(nlist)]

    def train(self, vectors):
        """ä½¿ç”¨ K-Means è®­ç»ƒèšç±»ä¸­å¿ƒ"""
        self.centroids = kmeans(vectors, self.nlist)

    def add(self, vectors, labels):
        """å°†å‘é‡åˆ†é…åˆ°å¯¹åº”çš„ç°‡"""
        for vec, label in zip(vectors, labels):
            cluster_id = self._find_nearest_centroid(vec)
            self.inverted_lists[cluster_id].append((label, vec))

    def search(self, query, k, nprobe):
        """æœç´¢æœ€è¿‘çš„ k ä¸ªå‘é‡"""
        # 1. æ‰¾åˆ°æœ€è¿‘çš„ nprobe ä¸ªç°‡
        nearest_clusters = self._find_nearest_centroids(query, nprobe)

        # 2. åœ¨è¿™äº›ç°‡ä¸­ç²¾ç¡®æœç´¢
        candidates = []
        for cluster_id in nearest_clusters:
            for label, vec in self.inverted_lists[cluster_id]:
                dist = self._distance(query, vec)
                candidates.append((dist, label))

        # 3. è¿”å› Top-K
        return sorted(candidates)[:k]
```

#### 4.2.3 IVF å‚æ•°é…ç½®

| å‚æ•°         | å»ºè®®å€¼                 | è¯´æ˜                      |
| ------------ | ---------------------- | ------------------------- |
| **nlist**    | sqrt(n) æˆ– 4Ã—sqrt(n)   | ç°‡çš„æ•°é‡ï¼Œn æ˜¯å‘é‡æ•°      |
| **nprobe**   | nlistÃ—0.01 ~ nlistÃ—0.1 | æŸ¥è¯¢æ—¶æœç´¢çš„ç°‡æ•°          |
| **è®­ç»ƒæ•°æ®** | min(n, 256Ã—nlist)      | ç”¨äº K-Means è®­ç»ƒçš„æ ·æœ¬æ•° |

**nlist ç»éªŒå…¬å¼**ï¼š

| æ•°æ®è§„æ¨¡       | nlist å»ºè®®å€¼ | nprobe å»ºè®®å€¼ |
| -------------- | ------------ | ------------- |
| n < 1M         | 1,000        | 10-50         |
| 1M â‰¤ n < 10M   | 4,096        | 50-100        |
| 10M â‰¤ n < 100M | 16,384       | 100-200       |
| n â‰¥ 100M       | 65,536       | 200-500       |

### 4.3 ç§¯é‡åŒ–ï¼ˆProduct Quantizationï¼‰

#### 4.3.1 PQ æ ¸å¿ƒæ€æƒ³

**ç§¯é‡åŒ–ï¼ˆProduct Quantization, PQï¼‰** æ˜¯ä¸€ç§æå…·æ•ˆç‡çš„å‘é‡å‹ç¼©æŠ€æœ¯ï¼Œå°†é«˜ç»´å‘é‡åˆ†å‰²ä¸ºå¤šä¸ªå­å‘é‡ï¼Œåˆ†åˆ«é‡åŒ–åç”¨ç´§å‡‘çš„ç å­—è¡¨ç¤º<sup>[[13]](#ref13)</sup>ã€‚

**æ ¸å¿ƒæ€æƒ³**ï¼šå°† d ç»´å‘é‡åˆ†å‰²ä¸º M ä¸ªå­å‘é‡ï¼Œæ¯ä¸ªå­å‘é‡ç‹¬ç«‹è¿›è¡Œ K å‡å€¼èšç±»ï¼š

$$
    v = [v_1, v_2, ..., v_M], \quad v_i \in \mathbb{R}^{d/M}
$$

æ¯ä¸ªå­å‘é‡ $v_i$ ç”¨å…¶æ‰€å±ç°‡çš„ç å­— $q_i$ æ›¿ä»£ï¼š

$$
\tilde{v} = [q_1(v_1), q_2(v_2), ..., q_M(v_M)]
$$

```mermaid
graph TB
    subgraph "PQ ç¼–ç è¿‡ç¨‹"
        V["åŸå§‹å‘é‡<br/>128 ç»´"]
        V --> S1["å­å‘é‡ 1<br/>16 ç»´"]
        V --> S2["å­å‘é‡ 2<br/>16 ç»´"]
        V --> S8["...<br/>å­å‘é‡ 8<br/>16 ç»´"]

        S1 --> Q1["é‡åŒ–<br/>K=256"]
        S2 --> Q2["é‡åŒ–<br/>K=256"]
        S8 --> Q8["é‡åŒ–<br/>K=256"]

        Q1 --> C1["ç å­—: 42"]
        Q2 --> C2["ç å­—: 189"]
        Q8 --> C8["ç å­—: 73"]

        C1 & C2 & C8 --> CODE["PQ ç¼–ç : [42,189,...,73]<br/>8 å­—èŠ‚"]
    end

    style V fill:#ffe58f,color:#000000
    style CODE fill:#b7eb8f,color:#000000
```

#### 4.3.2 PQ å‹ç¼©ç‡åˆ†æ

å‡è®¾åŸå§‹å‘é‡ä¸º d=128 ç»´ FP32ï¼ˆ512 å­—èŠ‚ï¼‰ï¼Œä½¿ç”¨ M=8 ä¸ªå­ç©ºé—´ï¼Œæ¯ä¸ªå­ç©ºé—´ K=256 ä¸ªèšç±»ä¸­å¿ƒï¼š

| é¡¹ç›®         | è®¡ç®—                          | ç»“æœ           |
| ------------ | ----------------------------- | -------------- |
| åŸå§‹å‘é‡å¤§å° | 128 Ã— 4 å­—èŠ‚                  | 512 å­—èŠ‚       |
| PQ ç¼–ç å¤§å°  | 8 Ã— 1 å­—èŠ‚ï¼ˆlog2(256)=8 bitï¼‰ | 8 å­—èŠ‚         |
| å‹ç¼©ç‡       | 512 / 8                       | **64 å€**      |
| ç æœ¬å¤§å°     | 8 Ã— 256 Ã— 16 Ã— 4 å­—èŠ‚         | 128 KBï¼ˆå…±äº«ï¼‰ |

#### 4.3.3 PQ è·ç¦»è®¡ç®—

PQ ä½¿ç”¨**éå¯¹ç§°è·ç¦»è®¡ç®—ï¼ˆAsymmetric Distance Computation, ADCï¼‰**ï¼š

1. **é¢„è®¡ç®—**ï¼šæŸ¥è¯¢å‘é‡ q åˆ°æ¯ä¸ªå­ç©ºé—´æ‰€æœ‰ç å­—çš„è·ç¦»è¡¨

$$
    D_{ij} = \|q_i - c_{ij}\|^2, \quad i \in [1,M], j \in [1,K]
$$

2. **æŸ¥è¡¨è®¡ç®—**ï¼šå¯¹æ¯ä¸ªç¼–ç å‘é‡ï¼Œé€šè¿‡æŸ¥è¡¨ç´¯åŠ è·ç¦»

$$
    \|q - \tilde{v}\|^2 \approx \sum_{i=1}^{M} D_{i, \text{code}_i(v)}
$$

```python
class ProductQuantization:
    def __init__(self, d, M, Ks=256):
        self.d = d       # å‘é‡ç»´åº¦
        self.M = M       # å­ç©ºé—´æ•°é‡
        self.Ks = Ks     # æ¯ä¸ªå­ç©ºé—´çš„èšç±»æ•°
        self.ds = d // M  # å­å‘é‡ç»´åº¦
        self.codebooks = None  # M ä¸ªç æœ¬ï¼Œæ¯ä¸ª Ks Ã— ds

    def train(self, vectors):
        """è®­ç»ƒ M ä¸ªç‹¬ç«‹çš„ç æœ¬"""
        self.codebooks = []
        for m in range(self.M):
            sub_vectors = vectors[:, m*self.ds:(m+1)*self.ds]
            centroids = kmeans(sub_vectors, self.Ks)
            self.codebooks.append(centroids)

    def encode(self, vector):
        """å°†å‘é‡ç¼–ç ä¸º M ä¸ªç å­—"""
        codes = []
        for m in range(self.M):
            sub_vec = vector[m*self.ds:(m+1)*self.ds]
            code = self._find_nearest(sub_vec, self.codebooks[m])
            codes.append(code)
        return np.array(codes, dtype=np.uint8)

    def compute_distance_table(self, query):
        """é¢„è®¡ç®—æŸ¥è¯¢åˆ°æ‰€æœ‰ç å­—çš„è·ç¦»è¡¨"""
        table = np.zeros((self.M, self.Ks))
        for m in range(self.M):
            sub_query = query[m*self.ds:(m+1)*self.ds]
            for k in range(self.Ks):
                table[m, k] = np.sum((sub_query - self.codebooks[m][k])**2)
        return table

    def search_with_table(self, table, codes, k):
        """ä½¿ç”¨è·ç¦»è¡¨è®¡ç®—è¿‘ä¼¼è·ç¦»"""
        distances = []
        for i, code in enumerate(codes):
            dist = sum(table[m, code[m]] for m in range(self.M))
            distances.append((dist, i))
        return sorted(distances)[:k]
```

#### 4.3.4 IVFPQï¼šIVF + PQ ç»„åˆ

**IVFPQ** ç»“åˆäº† IVF çš„ç©ºé—´åˆ’åˆ†å’Œ PQ çš„å‘é‡å‹ç¼©ï¼Œæ˜¯å¤§è§„æ¨¡å‘é‡æœç´¢çš„ä¸»æµæ–¹æ¡ˆ<sup>[[14]](#ref14)</sup>ï¼š

```mermaid
graph TB
    subgraph "IVFPQ ç´¢å¼•ç»“æ„"
        V[åŸå§‹å‘é‡] --> IVF[IVF èšç±»<br/>nlist ä¸ªç°‡]
        IVF --> R1[ç°‡ 1: æ®‹å·®å‘é‡ä»¬]
        IVF --> R2[ç°‡ 2: æ®‹å·®å‘é‡ä»¬]
        IVF --> RK[ç°‡ K: æ®‹å·®å‘é‡ä»¬]

        R1 --> PQ1[PQ ç¼–ç ]
        R2 --> PQ2[PQ ç¼–ç ]
        RK --> PQK[PQ ç¼–ç ]
    end

    style IVF fill:#1890ff,color:#fff
    style PQ1 fill:#52c41a,color:#fff
```

```mermaid
graph TB
    subgraph "æœç´¢æµç¨‹"
        Q[æŸ¥è¯¢] --> S1[1. æ‰¾æœ€è¿‘ nprobe ä¸ªç°‡ä¸­å¿ƒ]
        S1 --> S2[2. è®¡ç®—æ®‹å·® = query - ä¸­å¿ƒ]
        S2 --> S3[3. å¯¹æ®‹å·®æ„å»ºè·ç¦»è¡¨]
        S3 --> S4[4. æŸ¥è¡¨ç´¯åŠ è®¡ç®—å€™é€‰è·ç¦»]
        S4 --> S5[5. è¿”å› Top-K]
    end
```

**æ®‹å·®ç¼–ç **ï¼šå­˜å‚¨çš„æ˜¯å‘é‡åˆ°ç°‡ä¸­å¿ƒçš„æ®‹å·®ï¼Œè€Œä¸æ˜¯åŸå§‹å‘é‡ï¼š

$$
r = v - c_{\text{cluster}(v)}
$$

è¿™æ ·å¯ä»¥è¿›ä¸€æ­¥æé«˜é‡åŒ–ç²¾åº¦ï¼Œå› ä¸ºæ®‹å·®åˆ†å¸ƒæ›´é›†ä¸­ã€‚

#### 4.3.5 PQ å˜ä½“å¯¹æ¯”

| ç®—æ³•       | æ ¸å¿ƒç‰¹æ€§         | é€‚ç”¨åœºæ™¯       | ç›¸æ¯” PQ çš„å·®å¼‚                 |
| :--------- | :--------------- | :------------- | :----------------------------- |
| **PQ**     | åŸºç¡€åˆ†å—é‡åŒ–     | é€šç”¨å¤§è§„æ¨¡æ£€ç´¢ | åŸºå‡†ç®—æ³•ï¼Œå‡è®¾å­ç©ºé—´ç‹¬ç«‹       |
| **OPQ**    | **æ—‹è½¬+PQ**      | é«˜ç²¾åº¦è¦æ±‚     | æ•°æ®é¢„å¤„ç†æ›´å¤æ‚ï¼Œä½†å¬å›ç‡æ›´é«˜ |
| **SQ**     | **ç‹¬ç«‹ç»´åº¦é™å‡†** | ç®€å•å¿«é€Ÿåœºæ™¯   | å‹ç¼©ç‡ä½ (4x)ï¼Œä½†è®¡ç®—æå¿«      |
| **RQ**     | **å¤šçº§æ®‹å·®é€¼è¿‘** | æé«˜ç²¾åº¦å‹ç¼©   | ç¼–ç /æœç´¢æ›´æ…¢ï¼Œä½†è¿˜åŸåº¦æœ€é«˜    |
| **RaBitQ** | **éšæœºäºŒå€¼åŒ–**   | å†…å­˜æåº¦å—é™   | 1-bit æé™å‹ç¼©ï¼Œç²¾åº¦æŸå¤±å¤§     |

> [!TIP] ç±»æ¯”ï¼šå¦‚ä½•å­˜å‚¨ä¸€å¼ é«˜æ¸…ç…§ç‰‡ï¼ˆå‘é‡ï¼‰ï¼Ÿ
>
> - **PQï¼ˆç§¯é‡åŒ–ï¼‰**ï¼šæŠŠç…§ç‰‡åˆ‡æˆ 16 å°å—ï¼Œæ¯å—åªå­˜ä¸€ä¸ª"æœ€åƒçš„æ ‡å‡†å—"ã€‚
> - **OPQï¼ˆä¼˜åŒ– PQï¼‰**ï¼š**åˆ‡ä¹‹å‰å…ˆæ—‹è½¬ä¸€ä¸‹ç…§ç‰‡**ï¼Œè®©é‡è¦çš„çº¿æ¡å¯¹é½ï¼Œåˆ‡å¾—æ›´å‡†ã€‚
> - **SQï¼ˆæ ‡é‡é‡åŒ–ï¼‰**ï¼šä¸åˆ‡å—ï¼Œåªæ˜¯æŠŠæ¯ä¸ªåƒç´ çš„é¢œè‰²å€¼ä» 32 ä½ç²¾ç®€åˆ° 8 ä½ï¼ˆINT8ï¼‰ã€‚
>
> * **RQï¼ˆæ®‹å·®é‡åŒ–ï¼‰**ï¼šå…ˆå­˜ä¸€ä¸ªæ¨¡ç³Šçš„å¤§æ¦‚è½®å»“ï¼Œå†å­˜ä¸€ä¸ªä¿®è¡¥ç»†èŠ‚çš„è¡¥ä¸ï¼Œ**å±‚å±‚ä¿®è¡¥**ã€‚
> * **RaBitQ**ï¼šæŠŠç…§ç‰‡å˜æˆçº¯é»‘ç™½çš„ï¼ˆ1-bitï¼‰ï¼Œåªçœ‹è½®å»“ï¼Œç»†èŠ‚å…¨ä¸¢ï¼Œä½†æå°ã€‚

---

## 5. ç£ç›˜ç´¢å¼•ä¸ GPU åŠ é€Ÿ

å½“æ•°æ®è§„æ¨¡è¶…å‡ºå†…å­˜å®¹é‡ï¼Œæˆ–éœ€è¦æè‡´æ€§èƒ½æ—¶ï¼Œéœ€è¦è€ƒè™‘ç£ç›˜ç´¢å¼•å’Œ GPU åŠ é€Ÿæ–¹æ¡ˆã€‚

### 5.1 DiskANNï¼šçªç ´å†…å­˜é™åˆ¶çš„å›¾ç´¢å¼•

#### 5.1.1 DiskANN è®¾è®¡åŠ¨æœº

**DiskANN** ç”±å¾®è½¯ç ”ç©¶é™¢å¼€å‘ï¼Œä¸“ä¸ºè§£å†³**åäº¿çº§å‘é‡æ— æ³•å®Œå…¨è½½å…¥å†…å­˜**çš„é—®é¢˜è€Œè®¾è®¡<sup>[[16]](#ref16)</sup>ã€‚å…¶æ ¸å¿ƒåˆ›æ–°æ˜¯å°†å›¾ç´¢å¼•å­˜å‚¨åœ¨ SSD ä¸Šï¼ŒåŒæ—¶åˆ©ç”¨å†…å­˜ä¸­çš„å‹ç¼©å‘é‡åŠ é€Ÿæœç´¢ã€‚

```mermaid
graph TB
    subgraph "DiskANN æ··åˆå­˜å‚¨æ¶æ„"
        RAM[å†…å­˜]
        SSD[å›ºæ€ç¡¬ç›˜]

        RAM --> PQV[å‹ç¼©å‘é‡<br/>PQ ç¼–ç ]
        RAM --> ENTRY[å…¥å£ç‚¹ç¼“å­˜]

        SSD --> FULL[å®Œæ•´å‘é‡]
        SSD --> GRAPH[å›¾ç´¢å¼•ç»“æ„]
    end

    style RAM fill:#91d5ff,color:#000000
    style SSD fill:#ffd591,color:#000000
```

```mermaid
graph TB
    subgraph "æœç´¢æµç¨‹"
        Q[æŸ¥è¯¢] --> S1[1. ä½¿ç”¨å†…å­˜ä¸­ PQ å‘é‡å¯¼èˆª]
        S1 --> S2[2. è¯»å– SSD ä¸Šçš„å€™é€‰å…¨ç²¾åº¦å‘é‡]
        S2 --> S3[3. ç²¾ç¡®è·ç¦»è®¡ç®—]
        S3 --> S4[4. è¿”å› Top-K]
    end
```

#### 5.1.2 Vamana å›¾æ„å»ºç®—æ³•

DiskANN ä½¿ç”¨ **Vamana** ç®—æ³•æ„å»ºæœç´¢å›¾ï¼Œä¸ HNSW çš„å…³é”®åŒºåˆ«åœ¨äº<sup>[[16]](#ref16)</sup>ï¼š

1. **å•å±‚ç»“æ„**ï¼šä¸ä½¿ç”¨å¤šå±‚å±‚çº§ï¼Œè€Œæ˜¯é€šè¿‡ä¼˜åŒ–å›¾çš„ç›´å¾„æ¥ä¿è¯æœç´¢æ•ˆç‡
2. **Î±-RNG å‰ªæ**ï¼šä½¿ç”¨ç›¸å¯¹é‚»åŸŸå›¾ï¼ˆRelative Neighborhood Graphï¼‰å¯å‘å¼è¿›è¡Œè¾¹å‰ªæ

**Vamana æ„å»ºæµç¨‹**ï¼š

```mermaid
flowchart TD
    A[åˆå§‹åŒ–éšæœºå›¾] --> B[å¯¹æ¯ä¸ªèŠ‚ç‚¹]
    B --> C[è´ªå©ªæœç´¢æ‰¾å€™é€‰é‚»å±…]
    C --> D[Î±-RNG å‰ªæé€‰æ‹©é‚»å±…]
    D --> E[å»ºç«‹åŒå‘è¿æ¥]
    E --> F{æ‰€æœ‰èŠ‚ç‚¹å¤„ç†å®Œï¼Ÿ}
    F --> |å¦| B
    F --> |æ˜¯| G[å¤šæ¬¡è¿­ä»£ä¼˜åŒ–]
    G --> H[è¾“å‡ºæœ€ç»ˆå›¾]

    style D fill:#fa8c16,color:#fff
```

**Î±-RNG å‰ªæè§„åˆ™**ï¼š

å¯¹äºå€™é€‰é‚»å±… $p$ï¼Œå¦‚æœå­˜åœ¨å¦ä¸€ä¸ªå·²é€‰é‚»å±… $p'$ æ»¡è¶³ï¼š

$$
\alpha \cdot d(v, p') < d(v, p) \quad \text{ä¸”} \quad d(p, p') < d(v, p)
$$

åˆ™ä¸é€‰æ‹© $p$ ä½œä¸ºé‚»å±…ã€‚å‚æ•° $\alpha \geq 1$ æ§åˆ¶å‰ªæçš„æ¿€è¿›ç¨‹åº¦ã€‚

#### 5.1.3 DiskANN æ€§èƒ½ç‰¹æ€§

| ç‰¹æ€§     | æ•°å€¼              | è¯´æ˜           |
| -------- | ----------------- | -------------- |
| æ•°æ®è§„æ¨¡ | 10 äº¿+ å‘é‡       | å­˜å‚¨åœ¨ SSD ä¸Š  |
| å†…å­˜å ç”¨ | çº¦ 8-16 å­—èŠ‚/å‘é‡ | ä»…å­˜å‚¨ PQ ç¼–ç  |
| æœç´¢å»¶è¿Ÿ | 1-5 æ¯«ç§’          | 95%+ å¬å›ç‡    |
| ç´¢å¼•æ„å»º | æ•°å°æ—¶ï¼ˆåäº¿çº§ï¼‰  | å¯å¹¶è¡Œæ„å»º     |

**ä¸ HNSW çš„å¯¹æ¯”**ï¼š

| ç»´åº¦     | HNSW           | DiskANN                     |
| -------- | -------------- | --------------------------- |
| å­˜å‚¨ä½ç½® | å…¨éƒ¨åœ¨å†…å­˜     | å›¾+å…¨å‘é‡åœ¨ SSDï¼Œå‹ç¼©åœ¨å†…å­˜ |
| å†…å­˜éœ€æ±‚ | ~100 å­—èŠ‚/å‘é‡ | ~10 å­—èŠ‚/å‘é‡               |
| å»¶è¿Ÿ     | äºšæ¯«ç§’         | 1-5 æ¯«ç§’                    |
| å¬å›ç‡   | æé«˜ï¼ˆ99%+ï¼‰   | é«˜ï¼ˆ95%+ï¼‰                  |
| é€‚ç”¨è§„æ¨¡ | <1 äº¿å‘é‡      | 1-100 äº¿å‘é‡                |

### 5.2 ScaNNï¼šGoogle çš„é«˜æ•ˆå‘é‡æœç´¢

#### 5.2.1 ScaNN æ ¸å¿ƒæŠ€æœ¯

**ScaNNï¼ˆScalable Nearest Neighborsï¼‰** æ˜¯ Google å¼€å‘çš„é«˜æ•ˆå‘é‡æœç´¢åº“ï¼Œå…¶æ ¸å¿ƒåˆ›æ–°æ˜¯**å„å‘å¼‚æ€§å‘é‡é‡åŒ–ï¼ˆAnisotropic Vector Quantizationï¼‰**<sup>[[17]](#ref17)</sup>ã€‚

ä¼ ç»Ÿ PQ ä¼˜åŒ–çš„æ˜¯**é‡æ„è¯¯å·®**ï¼š

$$
\min \sum_i \|v_i - \tilde{v}_i\|^2
$$

è€Œ ScaNN ä¼˜åŒ–çš„æ˜¯**å†…ç§¯ä¼°è®¡è¯¯å·®**ï¼Œç‰¹åˆ«å…³æ³¨é«˜å†…ç§¯å€¼çš„ç²¾åº¦ï¼š

$$
\min \sum_i \left( \langle q, v_i \rangle - \langle q, \tilde{v}_i \rangle \right)^2 \cdot w(v_i)
$$

å…¶ä¸­æƒé‡ $w(v_i)$ å¯¹æ›´å¯èƒ½æˆä¸ºè¿‘é‚»çš„å‘é‡èµ‹äºˆæ›´é«˜æƒé‡ã€‚

```mermaid
graph LR
    subgraph "ScaNN ä¸‰é˜¶æ®µæœç´¢"
        P[åˆ†åŒº<br/>Partitioning]
        Q[é‡åŒ–<br/>Anisotropic VQ]
        R[é‡æ’åº<br/>Reranking]
    end

    Query[æŸ¥è¯¢] --> P
    P --> |"é€‰æ‹©ç›¸å…³åˆ†åŒº"| Q
    Q --> |"å¿«é€Ÿè¿‘ä¼¼è·ç¦»"| R
    R --> |"ç²¾ç¡®é‡æ’"| Result[Top-K ç»“æœ]

    style Q fill:#52c41a,color:#000000
```

#### 5.2.2 å„å‘å¼‚æ€§é‡åŒ–åŸç†

```mermaid
graph TB
    subgraph "å„å‘åŒæ€§ vs å„å‘å¼‚æ€§é‡åŒ–"
        ISO[å„å‘åŒæ€§<br/>å‡åŒ€ä¼˜åŒ–æ‰€æœ‰æ–¹å‘]
        ANISO[å„å‘å¼‚æ€§<br/>ä¼˜å…ˆä¼˜åŒ–æŸ¥è¯¢æ–¹å‘]
    end

    ISO --> |"é‡æ„è¯¯å·®å‡åŒ€"| ISO_RES[æ‰€æœ‰å‘é‡ç²¾åº¦ç›¸åŒ]
    ANISO --> |"å†…ç§¯è¯¯å·®ä¼˜åŒ–"| ANISO_RES[é«˜ç›¸ä¼¼å‘é‡ç²¾åº¦æ›´é«˜]

    style ANISO fill:#1890ff,color:#000000
    style ANISO_RES fill:#b7eb8f,color:#000000
```

#### 5.2.3 ScaNN æ€§èƒ½åŸºå‡†

æ ¹æ®å®˜æ–¹åŸºå‡†æµ‹è¯•<sup>[[17]](#ref17)</sup>ï¼š

| æ•°æ®é›†     | å‘é‡æ•° | ç»´åº¦ | QPSï¼ˆå•çº¿ç¨‹ï¼‰ | å¬å›ç‡ |
| ---------- | ------ | ---- | ------------- | ------ |
| SIFT-1M    | 100 ä¸‡ | 128  | 50,000+       | 95%    |
| GIST-1M    | 100 ä¸‡ | 960  | 10,000+       | 95%    |
| GloVe-1.2M | 120 ä¸‡ | 100  | 30,000+       | 95%    |

### 5.3 GPU åŠ é€Ÿç´¢å¼•

#### 5.3.1 GPU IVF ç³»åˆ—

Faiss æä¾›äº†å¤šç§ GPU åŠ é€Ÿçš„ IVF ç´¢å¼•<sup>[[18]](#ref18)</sup>ï¼š

| ç´¢å¼•ç±»å‹         | æè¿°               | QPS æå‡ | æ˜¾å­˜éœ€æ±‚       |
| ---------------- | ------------------ | -------- | -------------- |
| **GPU_IVF_FLAT** | GPU åŠ é€Ÿçš„ IVFFlat | 10-50x   | å­˜å‚¨å…¨å‘é‡     |
| **GPU_IVF_PQ**   | GPU åŠ é€Ÿçš„ IVFPQ   | 5-20x    | å­˜å‚¨ PQ ç¼–ç    |
| **GPU_IVF_SQ8**  | GPU åŠ é€Ÿçš„æ ‡é‡é‡åŒ– | 10-30x   | å­˜å‚¨ INT8 å‘é‡ |

#### 5.3.2 CAGRAï¼šNVIDIA çš„å›¾ç´¢å¼•

**CAGRAï¼ˆCuda Accelerated GRAph-based indexï¼‰** æ˜¯ NVIDIA æ¨å‡ºçš„ GPU ä¼˜åŒ–å›¾ç´¢å¼•<sup>[[18]](#ref18)</sup>ï¼š

```mermaid
graph TB
    subgraph "CAGRA ç‰¹æ€§"
        F1[GPU åŸç”Ÿè®¾è®¡]
        F2[å¤š GPU æ”¯æŒ]
        F3[å›¾æ„å»º GPU åŠ é€Ÿ]
        F4[èåˆå†…æ ¸ä¼˜åŒ–]
    end

    F1 --> P1[æé«˜ååé‡]
    F2 --> P2[æ°´å¹³æ‰©å±•]
    F3 --> P3[å¿«é€Ÿç´¢å¼•æ„å»º]
    F4 --> P4[ä½å»¶è¿Ÿ]

    style F1 fill:#76b900,color:#fff
```

**CAGRA ä¸ CPU HNSW å¯¹æ¯”**ï¼š

| ç»´åº¦       | CPU HNSW         | GPU CAGRA        |
| ---------- | ---------------- | ---------------- |
| å•æŸ¥è¯¢å»¶è¿Ÿ | 1-10 æ¯«ç§’        | 0.1-1 æ¯«ç§’       |
| æ‰¹é‡åå   | 1,000-10,000 QPS | 100,000+ QPS     |
| ç¡¬ä»¶æˆæœ¬   | é«˜å†…å­˜æœåŠ¡å™¨     | GPU æœåŠ¡å™¨       |
| é€‚ç”¨åœºæ™¯   | é€šç”¨åœºæ™¯         | é«˜ååé‡å®æ—¶æ¨è |

---

## 6. ç›¸ä¼¼åº¦æµ‹é‡æ–¹å¼

é€‰æ‹©æ­£ç¡®çš„ç›¸ä¼¼åº¦åº¦é‡å¯¹å‘é‡æœç´¢ç»“æœæœ‰å†³å®šæ€§å½±å“ã€‚æœ¬ç« è¯¦ç»†ä»‹ç» 6 ç§ä¸»æµåº¦é‡æ–¹å¼ã€‚

### 6.1 æ¬§å‡ é‡Œå¾—è·ç¦»ï¼ˆL2 Distanceï¼‰

#### 6.1.1 æ•°å­¦å®šä¹‰

**æ¬§å‡ é‡Œå¾—è·ç¦»**ï¼ˆä¹Ÿç§° L2 è·ç¦»ï¼‰æ˜¯æœ€ç›´è§‚çš„è·ç¦»åº¦é‡ï¼Œè¡¨ç¤ºä¸¤ç‚¹ä¹‹é—´çš„"ç›´çº¿è·ç¦»"<sup>[[19]](#ref19)</sup>ï¼š

$$
d_{L2}(a, b) = \sqrt{\sum_{i=1}^{d}(a_i - b_i)^2} = \|a - b\|_2
$$

é€šå¸¸ä½¿ç”¨**å¹³æ–¹æ¬§å‡ é‡Œå¾—è·ç¦»**ä»¥é¿å…å¼€æ–¹è¿ç®—ï¼š

$$
d_{L2}^2(a, b) = \sum_{i=1}^{d}(a_i - b_i)^2
$$

#### 6.1.2 å‡ ä½•æ„ä¹‰

```mermaid
graph LR
    subgraph "æ¬§å‡ é‡Œå¾—è·ç¦»"
        A["ç‚¹ A (1,2)"] --> |"ç›´çº¿è·ç¦»"| B["ç‚¹ B (4,6)"]
        A --> C["è·ç¦» = âˆš((4-1)Â² + (6-2)Â²) = 5"]
    end

    style C fill:#91d5ff,color:#000000
```

#### 6.1.3 ç‰¹æ€§åˆ†æ

| ç‰¹æ€§           | æè¿°                               |
| -------------- | ---------------------------------- |
| **å°ºåº¦æ•æ„Ÿ**   | å¯¹å‘é‡çš„é•¿åº¦æ•æ„Ÿï¼Œé•¿å‘é‡è·ç¦»æ›´å¤§   |
| **ç»´åº¦è¯…å’’**   | é«˜ç»´ç©ºé—´ä¸­ï¼Œè·ç¦»è¶‹äºå‡åŒ€åŒ–         |
| **èŒƒå›´**       | $[0, +\infty)$ï¼Œè·ç¦»è¶Šå°è¶Šç›¸ä¼¼     |
| **ä¸‰è§’ä¸ç­‰å¼** | æ»¡è¶³ $d(a,c) \leq d(a,b) + d(b,c)$ |

#### 6.1.4 é€‚ç”¨åœºæ™¯

- **ç‰©ç†ç©ºé—´è·ç¦»**ï¼šåœ°ç†ä½ç½®ã€å›¾åƒåƒç´ å·®å¼‚
- **èšç±»åˆ†æ**ï¼šK-Meansã€DBSCAN
- **ç‰¹å¾å·¥ç¨‹**ï¼šå½“å‘é‡å·²å½’ä¸€åŒ–æ—¶

```python
def euclidean_distance(a, b):
    return np.sqrt(np.sum((a - b) ** 2))

def squared_euclidean_distance(a, b):
    return np.sum((a - b) ** 2)
```

### 6.2 ä½™å¼¦ç›¸ä¼¼åº¦ï¼ˆCosine Similarityï¼‰

#### 6.2.1 æ•°å­¦å®šä¹‰

**ä½™å¼¦ç›¸ä¼¼åº¦** æµ‹é‡ä¸¤ä¸ªå‘é‡ä¹‹é—´çš„å¤¹è§’ä½™å¼¦å€¼ï¼Œå…³æ³¨**æ–¹å‘**è€Œé**é•¿åº¦**<sup>[[19]](#ref19)</sup>ï¼š

$$
\cos(\theta) = \frac{a \cdot b}{\|a\| \cdot \|b\|} = \frac{\sum_{i=1}^{d} a_i \cdot b_i}{\sqrt{\sum_{i=1}^{d} a_i^2} \cdot \sqrt{\sum_{i=1}^{d} b_i^2}}
$$

**ä½™å¼¦è·ç¦»**æ˜¯ç›¸ä¼¼åº¦çš„è¡¥å……ï¼š

$$
d_{\cos}(a, b) = 1 - \cos(\theta)
$$

#### 6.2.2 å‡ ä½•æ„ä¹‰

```mermaid
graph TB
    subgraph "ä½™å¼¦ç›¸ä¼¼åº¦"
        O[åŸç‚¹] --> A[å‘é‡ A]
        O --> B[å‘é‡ B]
        O --> C[å‘é‡ C]

        A --- |"å¤¹è§’ Î¸=30Â°<br/>cos=0.87"| B
        A --- |"å¤¹è§’ Î¸=90Â°<br/>cos=0"| C
    end

    subgraph "ç‰¹æ€§"
        S1["å‘é‡é•¿åº¦è¢«å¿½ç•¥"]
        S2["åªå…³æ³¨æ–¹å‘ç›¸ä¼¼æ€§"]
    end

    style S1 fill:#b7eb8f,color:#000000
```

#### 6.2.3 ç‰¹æ€§åˆ†æ

| ç‰¹æ€§           | æè¿°                                       |
| -------------- | ------------------------------------------ |
| **å°ºåº¦æ— å…³**   | å‘é‡é•¿åº¦ä¸å½±å“ç›¸ä¼¼åº¦                       |
| **èŒƒå›´**       | $[-1, 1]$ï¼Œ1 ä¸ºå®Œå…¨ç›¸åŒæ–¹å‘ï¼Œ-1 ä¸ºå®Œå…¨ç›¸å |
| **å½’ä¸€åŒ–ç­‰ä»·** | å½’ä¸€åŒ–å‘é‡çš„ä½™å¼¦ç›¸ä¼¼åº¦ç­‰äºç‚¹ç§¯             |
| **é«˜ç»´å‹å¥½**   | åœ¨é«˜ç»´ç©ºé—´è¡¨ç°ç¨³å®š                         |

#### 6.2.4 é€‚ç”¨åœºæ™¯

- **æ–‡æœ¬è¯­ä¹‰ç›¸ä¼¼åº¦**ï¼šæ–‡æ¡£æ¯”è¾ƒã€é—®ç­”åŒ¹é…ï¼ˆæ¨èé¦–é€‰ï¼‰
- **æ¨èç³»ç»Ÿ**ï¼šç”¨æˆ·åå¥½å‘é‡
- **NLP ä»»åŠ¡**ï¼šè¯åµŒå…¥ã€å¥å­åµŒå…¥

```python
def cosine_similarity(a, b):
    dot_product = np.dot(a, b)
    norm_a = np.linalg.norm(a)
    norm_b = np.linalg.norm(b)
    return dot_product / (norm_a * norm_b)

def cosine_distance(a, b):
    return 1 - cosine_similarity(a, b)
```

### 6.3 ç‚¹ç§¯ç›¸ä¼¼åº¦ï¼ˆDot Product / Inner Productï¼‰

#### 6.3.1 æ•°å­¦å®šä¹‰

**ç‚¹ç§¯**ï¼ˆå†…ç§¯ï¼‰ç›´æ¥è®¡ç®—ä¸¤ä¸ªå‘é‡å¯¹åº”å…ƒç´ çš„ä¹˜ç§¯ä¹‹å’Œ<sup>[[19]](#ref19)</sup>ï¼š

$$
\langle a, b \rangle = a \cdot b = \sum_{i=1}^{d} a_i \cdot b_i
$$

#### 6.3.2 ä¸ä½™å¼¦ç›¸ä¼¼åº¦çš„å…³ç³»

$$
a \cdot b = \|a\| \cdot \|b\| \cdot \cos(\theta)
$$

**å…³é”®æ´å¯Ÿ**ï¼š

- å½“å‘é‡ **å·²å½’ä¸€åŒ–**ï¼ˆ$\|a\| = \|b\| = 1$ï¼‰æ—¶ï¼Œç‚¹ç§¯ **ç­‰äº** ä½™å¼¦ç›¸ä¼¼åº¦
- å½“å‘é‡ **æœªå½’ä¸€åŒ–** æ—¶ï¼Œç‚¹ç§¯åŒæ—¶è€ƒè™‘æ–¹å‘å’Œé•¿åº¦

#### 6.3.3 ç‰¹æ€§åˆ†æ

| ç‰¹æ€§             | æè¿°                                                 |
| ---------------- | ---------------------------------------------------- |
| **å°ºåº¦æ•æ„Ÿ**     | é•¿å‘é‡çš„ç‚¹ç§¯æ›´å¤§                                     |
| **èŒƒå›´**         | $(-\infty, +\infty)$ï¼Œå€¼è¶Šå¤§è¶Šç›¸ä¼¼                   |
| **è®¡ç®—é«˜æ•ˆ**     | æ— éœ€å½’ä¸€åŒ–ï¼Œå¯ä½¿ç”¨ SIMD åŠ é€Ÿ                         |
| **æœ€å¤§å†…ç§¯é—®é¢˜** | MIPSï¼ˆMaximum Inner Product Searchï¼‰æ˜¯ç‹¬ç«‹çš„ç ”ç©¶é—®é¢˜ |

#### 6.3.4 é€‚ç”¨åœºæ™¯

- **å½’ä¸€åŒ–å‘é‡**ï¼šç­‰ä»·äºä½™å¼¦ç›¸ä¼¼åº¦ï¼Œè®¡ç®—æ›´å¿«
- **æ¨èç³»ç»Ÿ**ï¼šç”¨æˆ·å‘é‡ Ã— ç‰©å“å‘é‡ï¼Œé•¿åº¦ä»£è¡¨ç½®ä¿¡åº¦/æµè¡Œåº¦
- **æ³¨æ„åŠ›æœºåˆ¶**ï¼šTransformer ä¸­çš„ QÂ·K^T

```python
def dot_product(a, b):
    return np.dot(a, b)

# å½’ä¸€åŒ–åçš„ç‚¹ç§¯ç­‰äºä½™å¼¦ç›¸ä¼¼åº¦
def normalized_dot_product(a, b):
    a_norm = a / np.linalg.norm(a)
    b_norm = b / np.linalg.norm(b)
    return np.dot(a_norm, b_norm)
```

### 6.4 æ›¼å“ˆé¡¿è·ç¦»ï¼ˆManhattan Distance / L1 Distanceï¼‰

#### 6.4.1 æ•°å­¦å®šä¹‰

**æ›¼å“ˆé¡¿è·ç¦»**ï¼ˆä¹Ÿç§° L1 è·ç¦»ã€åŸå¸‚è¡—åŒºè·ç¦»ï¼‰è®¡ç®—ä¸¤ç‚¹ä¹‹é—´æ²¿åæ ‡è½´çš„ç»å¯¹å·®å€¼ä¹‹å’Œ<sup>[[19]](#ref19)</sup>ï¼š

$$
    d_{L1}(a, b) = \sum_{i=1}^{d} |a_i - b_i| = \|a - b\|_1
$$

#### 6.4.2 å‡ ä½•æ„ä¹‰

```mermaid
graph LR
    subgraph "æ›¼å“ˆé¡¿è·ç¦» vs æ¬§å‡ é‡Œå¾—è·ç¦»"
        A["ç‚¹ A (0,0)"] --> |"L1: |3|+|4|=7"| B["ç‚¹ B (3,4)"]
        A --> |"L2: âˆš(9+16)=5"| B
    end

    style A fill:#ffe58f,color:#000000
    style B fill:#b7eb8f,color:#000000
```

#### 6.4.3 ç‰¹æ€§åˆ†æ

| ç‰¹æ€§           | æè¿°                             |
| -------------- | -------------------------------- |
| **å°ºåº¦æ•æ„Ÿ**   | å¯¹å‘é‡é•¿åº¦æ•æ„Ÿ                   |
| **ç¦»ç¾¤å€¼é²æ£’** | æ¯”æ¬§å‡ é‡Œå¾—è·ç¦»æ›´ä¸æ˜“å—æç«¯å€¼å½±å“ |
| **é«˜ç»´é€‚ç”¨**   | åœ¨é«˜ç»´ç¨€ç–æ•°æ®ä¸­è¡¨ç°æ›´ç¨³å®š       |
| **èŒƒå›´**       | $[0, +\infty)$ï¼Œè·ç¦»è¶Šå°è¶Šç›¸ä¼¼   |

#### 6.4.4 é€‚ç”¨åœºæ™¯

- **é«˜ç»´ç¨€ç–æ•°æ®**ï¼šTF-IDF å‘é‡ã€è¯è¢‹æ¨¡å‹
- **åŸå¸‚è·¯å¾„è§„åˆ’**ï¼šç½‘æ ¼çŠ¶é“è·¯è·ç¦»è®¡ç®—
- **å›¾åƒå¤„ç†**ï¼šåƒç´ å·®å¼‚åº¦é‡

```python
def manhattan_distance(a, b):
    return np.sum(np.abs(a - b))
```

### 6.5 æ±‰æ˜è·ç¦»ï¼ˆHamming Distanceï¼‰

#### 6.5.1 æ•°å­¦å®šä¹‰

**æ±‰æ˜è·ç¦»** è®¡ç®—ä¸¤ä¸ªç­‰é•¿åºåˆ—ä¸­å¯¹åº”ä½ç½®ä¸åŒå…ƒç´ çš„æ•°é‡<sup>[[25]](#ref25)</sup>ï¼š

$$
d_H(a, b) = \sum_{i=1}^{d} \mathbf{1}[a_i \neq b_i]
$$

å…¶ä¸­ $\mathbf{1}[\cdot]$ æ˜¯æŒ‡ç¤ºå‡½æ•°ï¼Œå½“æ¡ä»¶ä¸ºçœŸæ—¶è¿”å› 1ï¼Œå¦åˆ™è¿”å› 0ã€‚

#### 6.5.2 äºŒè¿›åˆ¶å‘é‡çš„é«˜æ•ˆè®¡ç®—

å¯¹äºäºŒè¿›åˆ¶å‘é‡ï¼Œæ±‰æ˜è·ç¦»å¯ä»¥é€šè¿‡å¼‚æˆ–ï¼ˆXORï¼‰è¿ç®—å’Œä½è®¡æ•°é«˜æ•ˆå®ç°ï¼š

$$
d_H(a, b) = \text{popcount}(a \oplus b)
$$

```python
def hamming_distance_binary(a, b):
    """äºŒè¿›åˆ¶å‘é‡çš„æ±‰æ˜è·ç¦»"""
    xor_result = np.bitwise_xor(a, b)
    return np.sum(xor_result)

def hamming_distance_general(a, b):
    """é€šç”¨æ±‰æ˜è·ç¦»"""
    return np.sum(a != b)
```

#### 6.5.3 ç‰¹æ€§åˆ†æ

| ç‰¹æ€§         | æè¿°                       |
| ------------ | -------------------------- |
| **ç¦»æ•£åº¦é‡** | ä»…é€‚ç”¨äºç¦»æ•£/äºŒè¿›åˆ¶æ•°æ®    |
| **ç­‰é•¿è¦æ±‚** | è¾“å…¥åºåˆ—å¿…é¡»ç­‰é•¿           |
| **æé€Ÿè®¡ç®—** | äºŒè¿›åˆ¶å‘é‡å¯ç”¨ç¡¬ä»¶æŒ‡ä»¤åŠ é€Ÿ |
| **èŒƒå›´**     | $[0, d]$ï¼Œd ä¸ºå‘é‡ç»´åº¦     |

#### 6.5.4 é€‚ç”¨åœºæ™¯

- **äºŒè¿›åˆ¶å“ˆå¸Œç **ï¼šSimHashã€LSH çš„å¿«é€Ÿæ¯”è¾ƒ
- **çº é”™ç¼–ç **ï¼šæ£€æµ‹ä¼ è¾“é”™è¯¯çš„ä½æ•°
- **DNA åºåˆ—æ¯”å¯¹**ï¼šåŸºå› çªå˜æ£€æµ‹
- **æ–‡æ¡£å»é‡**ï¼šå¿«é€Ÿè¯†åˆ«è¿‘ä¼¼é‡å¤

### 6.6 Jaccard ç›¸ä¼¼åº¦ï¼ˆJaccard Similarityï¼‰

#### 6.6.1 æ•°å­¦å®šä¹‰

**Jaccard ç›¸ä¼¼åº¦**ï¼ˆä¹Ÿç§° Jaccard ç³»æ•°ï¼‰è¡¡é‡ä¸¤ä¸ªé›†åˆçš„äº¤é›†ä¸å¹¶é›†ä¹‹æ¯”<sup>[[26]](#ref26)</sup>ï¼š

$$
J(A, B) = \frac{|A \cap B|}{|A \cup B|} = \frac{|A \cap B|}{|A| + |B| - |A \cap B|}
$$

**Jaccard è·ç¦»** æ˜¯å…¶è¡¥é›†ï¼š

$$
d_J(A, B) = 1 - J(A, B)
$$

#### 6.6.2 å‡ ä½•æ„ä¹‰

```mermaid
graph TB
    subgraph "Jaccard ç›¸ä¼¼åº¦"
        A["é›†åˆ A: {1,2,3,4}"]
        B["é›†åˆ B: {3,4,5,6}"]
        I["äº¤é›†: {3,4} = 2 ä¸ªå…ƒç´ "]
        U["å¹¶é›†: {1,2,3,4,5,6} = 6 ä¸ªå…ƒç´ "]
        R["J(A,B) = 2/6 = 0.33"]
    end

    A --> I
    B --> I
    A --> U
    B --> U
    I --> R
    U --> R

    style R fill:#52c41a,color:#fff
```

#### 6.6.3 MinHash åŠ é€Ÿ

å¯¹äºå¤§è§„æ¨¡é›†åˆï¼Œå¯ä½¿ç”¨ **MinHash** è¿‘ä¼¼è®¡ç®— Jaccard ç›¸ä¼¼åº¦ï¼š

1. å¯¹é›†åˆå…ƒç´ åº”ç”¨å¤šä¸ªå“ˆå¸Œå‡½æ•°
2. è®°å½•æ¯ä¸ªå“ˆå¸Œå‡½æ•°çš„æœ€å°å€¼
3. æ¯”è¾ƒæœ€å°å€¼ç­¾åçš„ç›¸ç­‰æ¯”ä¾‹

```python
def jaccard_similarity(set_a, set_b):
    """ç²¾ç¡® Jaccard ç›¸ä¼¼åº¦"""
    intersection = len(set_a & set_b)
    union = len(set_a | set_b)
    return intersection / union if union > 0 else 0

def jaccard_similarity_binary(a, b):
    """äºŒè¿›åˆ¶å‘é‡çš„ Jaccard ç›¸ä¼¼åº¦"""
    intersection = np.sum(a & b)
    union = np.sum(a | b)
    return intersection / union if union > 0 else 0
```

#### 6.6.4 ç‰¹æ€§åˆ†æ

| ç‰¹æ€§         | æè¿°                     |
| ------------ | ------------------------ |
| **é›†åˆåº¦é‡** | é€‚ç”¨äºé›†åˆæˆ–äºŒè¿›åˆ¶å‘é‡   |
| **å¯¹ç§°æ€§**   | $J(A,B) = J(B,A)$        |
| **å¿½ç•¥ç¼ºå¤±** | ä¸è€ƒè™‘ä¸¤è€…éƒ½ä¸º 0 çš„ç»´åº¦  |
| **èŒƒå›´**     | $[0, 1]$ï¼Œ1 è¡¨ç¤ºå®Œå…¨ç›¸åŒ |

#### 6.6.5 é€‚ç”¨åœºæ™¯

- **æ–‡æ¡£ç›¸ä¼¼åº¦**ï¼šåŸºäºè¯é›†åˆçš„æ–‡æ¡£æ¯”è¾ƒ
- **æ¨èç³»ç»Ÿ**ï¼šç”¨æˆ·è¡Œä¸ºé›†åˆçš„ç›¸ä¼¼æ€§
- **é‡å¤æ£€æµ‹**ï¼šMinHash + LSH çš„å¿«é€Ÿå»é‡
- **ç”Ÿç‰©ä¿¡æ¯å­¦**ï¼šåŸºå› é›†åˆæ¯”è¾ƒ

### 6.7 åº¦é‡æ–¹å¼å¯¹æ¯”ä¸é€‰æ‹©

#### 6.7.1 ç»¼åˆå¯¹æ¯”è¡¨

| åº¦é‡æ–¹å¼     | å…³æ³¨ç‚¹      | èŒƒå›´                 | ç›¸ä¼¼æ€§å«ä¹‰     | è®¡ç®—å¤æ‚åº¦ | æ•°æ®ç±»å‹        |
| ------------ | ----------- | -------------------- | -------------- | ---------- | --------------- |
| **æ¬§å‡ é‡Œå¾—** | é•¿åº¦ + æ–¹å‘ | $[0, +\infty)$       | è·ç¦»è¶Šå°è¶Šç›¸ä¼¼ | O(d)       | è¿ç»­å‘é‡        |
| **ä½™å¼¦**     | ä»…æ–¹å‘      | $[-1, 1]$            | å€¼è¶Šå¤§è¶Šç›¸ä¼¼   | O(d)       | è¿ç»­å‘é‡        |
| **ç‚¹ç§¯**     | é•¿åº¦ + æ–¹å‘ | $(-\infty, +\infty)$ | å€¼è¶Šå¤§è¶Šç›¸ä¼¼   | O(d)       | è¿ç»­å‘é‡        |
| **æ›¼å“ˆé¡¿**   | ç»å¯¹å·®å¼‚    | $[0, +\infty)$       | è·ç¦»è¶Šå°è¶Šç›¸ä¼¼ | O(d)       | è¿ç»­/ç¨€ç–å‘é‡   |
| **æ±‰æ˜**     | ä¸åŒä½æ•°    | $[0, d]$             | è·ç¦»è¶Šå°è¶Šç›¸ä¼¼ | O(d/64)\*  | äºŒè¿›åˆ¶/ç¦»æ•£å‘é‡ |
| **Jaccard**  | é‡å æ¯”ä¾‹    | $[0, 1]$             | å€¼è¶Šå¤§è¶Šç›¸ä¼¼   | O(d)       | é›†åˆ/äºŒè¿›åˆ¶å‘é‡ |

> \*æ±‰æ˜è·ç¦»åœ¨äºŒè¿›åˆ¶å‘é‡ä¸Šå¯ä½¿ç”¨ç¡¬ä»¶ POPCNT æŒ‡ä»¤åŠ é€Ÿè‡³ O(d/64)

#### 6.7.2 å½’ä¸€åŒ–å‘é‡çš„ç­‰ä»·æ€§

å½“æ‰€æœ‰å‘é‡éƒ½å½’ä¸€åŒ–ï¼ˆ$\|v\| = 1$ï¼‰æ—¶ï¼š

$$
d_{L2}^2(a,b) = 2 - 2 \cdot \cos(\theta) = 2 \cdot d_{\cos}(a, b)
$$

å› æ­¤ï¼Œ**å½’ä¸€åŒ–å‘é‡çš„æ¬§å‡ é‡Œå¾—è·ç¦»æ’åºä¸ä½™å¼¦è·ç¦»æ’åºä¸€è‡´**ã€‚

```mermaid
graph LR
    subgraph "å½’ä¸€åŒ–å‘é‡"
        L2[L2 è·ç¦»æ’åº] --> |"ç­‰ä»·"| COS[ä½™å¼¦è·ç¦»æ’åº]
        COS --> |"ç­‰ä»·"| DOT[ç‚¹ç§¯æ’åºï¼ˆå–åï¼‰]
    end

    style L2 fill:#91d5ff,color:#000000
    style COS fill:#b7eb8f,color:#000000
    style DOT fill:#ffd591,color:#000000
```

#### 6.7.3 é€‰æ‹©å†³ç­–æ ‘

```mermaid
flowchart TD
    START[é€‰æ‹©åº¦é‡æ–¹å¼] --> Q1{å‘é‡å·²å½’ä¸€åŒ–ï¼Ÿ}
    Q1 --> |æ˜¯| USE_DOT[ä½¿ç”¨ç‚¹ç§¯<br/>è®¡ç®—æœ€å¿«]
    Q1 --> |å¦| Q2{å‘é‡é•¿åº¦æœ‰æ„ä¹‰ï¼Ÿ}
    Q2 --> |æ˜¯ï¼ˆå¦‚æµè¡Œåº¦ï¼‰| USE_IP[ä½¿ç”¨ç‚¹ç§¯/æ¬§å‡ é‡Œå¾—]
    Q2 --> |å¦| Q3{æ˜¯æ–‡æœ¬/è¯­ä¹‰ä»»åŠ¡ï¼Ÿ}
    Q3 --> |æ˜¯| USE_COS[ä½¿ç”¨ä½™å¼¦ç›¸ä¼¼åº¦]
    Q3 --> |å¦| USE_L2[ä½¿ç”¨æ¬§å‡ é‡Œå¾—è·ç¦»]

    style USE_DOT fill:#52c41a,color:#000000
    style USE_COS fill:#1890ff,color:#000000
    style USE_L2 fill:#91d5ff,color:#000000
```

#### 6.7.4 å¸¸è§å‘é‡æ¨¡å‹çš„æ¨èåº¦é‡

| æ¨¡å‹/ä»»åŠ¡                 | æ¨èåº¦é‡   | åŸå›                    |
| ------------------------- | ---------- | ---------------------- |
| **OpenAI text-embedding** | ä½™å¼¦ç›¸ä¼¼åº¦ | å®˜æ–¹æ¨èï¼Œè¾“å‡ºå·²å½’ä¸€åŒ– |
| **Sentence-BERT**         | ä½™å¼¦ç›¸ä¼¼åº¦ | è¯­ä¹‰ç›¸ä¼¼æ€§ä»»åŠ¡         |
| **CLIP**                  | ä½™å¼¦ç›¸ä¼¼åº¦ | å›¾æ–‡åŒ¹é…               |
| **Recommendation (MF)**   | ç‚¹ç§¯       | ç”¨æˆ·-ç‰©å“äº¤äº’å¼ºåº¦      |
| **Image Features (CNN)**  | æ¬§å‡ é‡Œå¾—   | ç‰¹å¾ç©ºé—´è·ç¦»           |

---

## 7. æ··åˆæœç´¢ä¸è¿‡æ»¤ç­–ç•¥

åœ¨å®é™…åº”ç”¨ä¸­ï¼Œçº¯å‘é‡æœç´¢å¾€å¾€ä¸å¤Ÿâ€”â€”æˆ‘ä»¬éœ€è¦ç»“åˆå…ƒæ•°æ®è¿‡æ»¤å’Œå…¨æ–‡å…³é”®è¯æœç´¢ã€‚

### 7.1 æ··åˆæœç´¢æ¦‚è¿°

**æ··åˆæœç´¢ï¼ˆHybrid Searchï¼‰** ç»“åˆå‘é‡ç›¸ä¼¼æ€§æœç´¢ä¸ä¼ ç»Ÿç»“æ„åŒ–/éç»“æ„åŒ–æŸ¥è¯¢<sup>[[20]](#ref20)</sup>ï¼š

```mermaid
graph TB
    subgraph "æ··åˆæœç´¢ç»„æˆ"
        VS[å‘é‡æœç´¢<br/>è¯­ä¹‰ç›¸ä¼¼æ€§]
        KS[å…³é”®è¯æœç´¢<br/>BM25]
        MF[å…ƒæ•°æ®è¿‡æ»¤<br/>WHERE æ¡ä»¶]
    end

    Q[ç”¨æˆ·æŸ¥è¯¢] --> VS
    Q --> KS
    Q --> MF

    VS --> FUSION[ç»“æœèåˆ]
    KS --> FUSION
    MF --> FUSION
    FUSION --> R[æœ€ç»ˆæ’åºç»“æœ]

    style VS fill:#1890ff,color:#fff
    style FUSION fill:#52c41a,color:#fff
```

### 7.2 è¿‡æ»¤ç­–ç•¥ï¼šPre-filtering vs Post-filtering

å‘é‡æœç´¢ä¸­åº”ç”¨å…ƒæ•°æ®è¿‡æ»¤æœ‰ä¸¤ç§ä¸»è¦ç­–ç•¥<sup>[[21]](#ref21)</sup>ï¼š

#### 7.2.1 Post-filteringï¼ˆåè¿‡æ»¤ï¼‰

**å·¥ä½œæµç¨‹**ï¼šå…ˆæ‰§è¡Œå‘é‡æœç´¢ï¼Œå†å¯¹ç»“æœåº”ç”¨è¿‡æ»¤æ¡ä»¶ã€‚

```mermaid
sequenceDiagram
    participant Q as æŸ¥è¯¢
    participant VS as å‘é‡æœç´¢
    participant F as è¿‡æ»¤å™¨
    participant R as ç»“æœ

    Q->>VS: å‘é‡æœç´¢ Top-K'ï¼ˆK' > Kï¼‰
    VS-->>F: K' ä¸ªå€™é€‰ç»“æœ
    F->>F: åº”ç”¨ WHERE æ¡ä»¶
    F-->>R: æ»¡è¶³æ¡ä»¶çš„ Top-K
```

**å®ç°ç¤ºä¾‹**ï¼š

```python
def post_filtering_search(query_vector, k, filter_condition, margin=2):
    # 1. è·å–æ¯”éœ€è¦æ›´å¤šçš„å€™é€‰
    k_prime = k * margin  # å¤šå–ä¸€äº›ä»¥å¤‡è¿‡æ»¤æŸå¤±
    candidates = vector_index.search(query_vector, k_prime)

    # 2. åº”ç”¨è¿‡æ»¤æ¡ä»¶
    filtered = [c for c in candidates if filter_condition(c)]

    # 3. è¿”å› Top-K
    return filtered[:k]
```

**ä¼˜ç¼ºç‚¹**ï¼š

| ä¼˜ç‚¹               | ç¼ºç‚¹                       |
| ------------------ | -------------------------- |
| å®ç°ç®€å•           | å¯èƒ½è¿”å›ä¸è¶³ K ä¸ªç»“æœ      |
| å‘é‡ç´¢å¼•æ— éœ€ä¿®æ”¹   | è¿‡æ»¤ä¸¥æ ¼æ—¶æ•ˆç‡ä½           |
| é€‚ç”¨äºå®½æ¾è¿‡æ»¤æ¡ä»¶ | å¯èƒ½é”™è¿‡æ»¡è¶³æ¡ä»¶çš„çœŸæ­£è¿‘é‚» |

#### 7.2.2 Pre-filteringï¼ˆé¢„è¿‡æ»¤ï¼‰

**å·¥ä½œæµç¨‹**ï¼šå…ˆåº”ç”¨è¿‡æ»¤æ¡ä»¶ç¼©å°æœç´¢ç©ºé—´ï¼Œå†åœ¨å­é›†ä¸­æ‰§è¡Œå‘é‡æœç´¢ã€‚

```mermaid
sequenceDiagram
    participant Q as æŸ¥è¯¢
    participant F as è¿‡æ»¤å™¨
    participant VS as å‘é‡æœç´¢
    participant R as ç»“æœ

    Q->>F: è¯„ä¼° WHERE æ¡ä»¶
    F->>F: ç¡®å®šæ»¡è¶³æ¡ä»¶çš„å‘é‡ ID é›†åˆ
    F-->>VS: åœ¨å­é›†ä¸­æœç´¢
    VS->>VS: å­é›†å‘é‡æœç´¢
    VS-->>R: Top-K ç»“æœï¼ˆä¿è¯æ»¡è¶³æ¡ä»¶ï¼‰
```

**å®ç°ç¤ºä¾‹**ï¼š

```python
def pre_filtering_search(query_vector, k, filter_condition):
    # 1. è·å–æ»¡è¶³è¿‡æ»¤æ¡ä»¶çš„å‘é‡ ID
    valid_ids = metadata_index.query(filter_condition)

    # 2. ä»…åœ¨è¿™äº› ID ä¸­è¿›è¡Œå‘é‡æœç´¢
    if len(valid_ids) == 0:
        return []

    # åˆ›å»ºä¸´æ—¶ç´¢å¼•æˆ–ä½¿ç”¨ ID è¿‡æ»¤
    results = vector_index.search_in_subset(query_vector, valid_ids, k)

    return results
```

**ä¼˜ç¼ºç‚¹**ï¼š

| ä¼˜ç‚¹                        | ç¼ºç‚¹                                            |
| --------------------------- | ----------------------------------------------- |
| ä¿è¯è¿”å› K ä¸ªæ»¡è¶³æ¡ä»¶çš„ç»“æœ | å®ç°å¤æ‚ï¼Œéœ€è¦ç´¢å¼•é›†æˆ                          |
| é«˜é€‰æ‹©ç‡è¿‡æ»¤ä¸‹éå¸¸é«˜æ•ˆ      | å¯èƒ½ç ´å HNSW å›¾è¿é€šæ€§<sup>[[21]](#ref21)</sup> |
| å‡†ç¡®çš„å¬å›ä¿è¯              | å…ƒæ•°æ®ç´¢å¼•æˆä¸ºç“¶é¢ˆ                              |

#### 7.2.3 ç­–ç•¥å¯¹æ¯”ä¸é€‰æ‹©

| åœºæ™¯                 | æ¨èç­–ç•¥       | åŸå›                               |
| -------------------- | -------------- | --------------------------------- |
| è¿‡æ»¤æ¡ä»¶å®½æ¾ï¼ˆ>50%ï¼‰ | Post-filtering | ç®€å•ï¼ŒæŸå¤±å¯æ¥å—                  |
| è¿‡æ»¤æ¡ä»¶ä¸¥æ ¼ï¼ˆ<10%ï¼‰ | Pre-filtering  | Post-filtering å¯èƒ½æ‰¾ä¸åˆ°è¶³å¤Ÿç»“æœ |
| å®æ—¶æ€§è¦æ±‚æé«˜       | Pre-filtering  | é¿å…æ— æ•ˆå‘é‡è®¡ç®—                  |
| è¿‡æ»¤æ¡ä»¶å¤æ‚         | Pre-filtering  | é¿å…è¿‡æ»¤é€»è¾‘é‡å¤è¯„ä¼°              |

```mermaid
flowchart TD
    START[é€‰æ‹©è¿‡æ»¤ç­–ç•¥] --> Q1{è¿‡æ»¤åå‰©ä½™æ¯”ä¾‹ï¼Ÿ}
    Q1 --> |"> 50%"| POST[Post-filtering]
    Q1 --> |"< 10%"| PRE[Pre-filtering]
    Q1 --> |"10-50%"| Q2{æ˜¯å¦éœ€è¦ç²¾ç¡® K ä¸ªç»“æœï¼Ÿ}
    Q2 --> |æ˜¯| PRE
    Q2 --> |å¦| POST

    style POST fill:#ffd591,color:#000000
    style PRE fill:#91d5ff,color:#000000
```

### 7.3 æ··åˆç­–ç•¥ä¸é«˜çº§æŠ€æœ¯

#### 7.3.1 Single-Stage Filteringï¼ˆå•é˜¶æ®µè¿‡æ»¤ï¼‰

ä¸€äº›å‘é‡æ•°æ®åº“ï¼ˆå¦‚ Qdrantï¼‰å®ç°äº†**ç´¢å¼•æ„ŸçŸ¥è¿‡æ»¤**ï¼Œåœ¨å›¾éå†è¿‡ç¨‹ä¸­å®æ—¶è·³è¿‡ä¸æ»¡è¶³æ¡ä»¶çš„èŠ‚ç‚¹<sup>[[21]](#ref21)</sup>ï¼š

```mermaid
graph LR
    subgraph "ç´¢å¼•æ„ŸçŸ¥è¿‡æ»¤"
        N1[èŠ‚ç‚¹1<br/>æ»¡è¶³æ¡ä»¶] --> N2[èŠ‚ç‚¹2<br/>ä¸æ»¡è¶³ âŒ]
        N2 --> |"è·³è¿‡"| N3[èŠ‚ç‚¹3<br/>æ»¡è¶³æ¡ä»¶ âœ“]
        N3 --> N4[èŠ‚ç‚¹4<br/>æ»¡è¶³æ¡ä»¶ âœ“]
    end

    style N2 fill:#ff4d4f,color:#fff
    style N3 fill:#52c41a,color:#fff
```

è¿™ç§æ–¹æ³•ç»“åˆäº†ä¸¤ç§ç­–ç•¥çš„ä¼˜ç‚¹ï¼Œä½†éœ€è¦å‘é‡æ•°æ®åº“åŸç”Ÿæ”¯æŒã€‚

#### 7.3.2 åˆ†åŒºç´¢å¼•

å¯¹äºé«˜é€‰æ‹©æ€§çš„ç±»åˆ«å­—æ®µï¼ˆå¦‚ `tenant_id`ï¼‰ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªå€¼åˆ›å»ºç‹¬ç«‹ç´¢å¼•ï¼š

```sql
-- PostgreSQL + pgvector ç¤ºä¾‹
CREATE INDEX idx_tenant_1 ON items
  USING hnsw (embedding vector_cosine_ops)
  WHERE tenant_id = 1;

CREATE INDEX idx_tenant_2 ON items
  USING hnsw (embedding vector_cosine_ops)
  WHERE tenant_id = 2;
```

### 7.4 å‘é‡ + å…¨æ–‡çš„ç»“æœèåˆ

#### 7.4.1 èåˆæ–¹æ³•

å½“åŒæ—¶ä½¿ç”¨å‘é‡æœç´¢å’Œå…³é”®è¯æœç´¢æ—¶ï¼Œéœ€è¦èåˆä¸¤è€…çš„æ’åºç»“æœ<sup>[[20]](#ref20)</sup>ï¼š

| èåˆæ–¹æ³•                | å…¬å¼                                          | ç‰¹ç‚¹                 |
| ----------------------- | --------------------------------------------- | -------------------- |
| **çº¿æ€§åŠ æƒ**            | $s = \alpha \cdot s_v + (1-\alpha) \cdot s_k$ | ç®€å•ï¼Œéœ€è°ƒå‚         |
| **å€’æ•°æ’åèåˆï¼ˆRRFï¼‰** | $s = \sum \frac{1}{k + rank}$                 | æ— éœ€å½’ä¸€åŒ–ï¼Œæ•ˆæœç¨³å®š |
| **å­¦ä¹ æ’åºï¼ˆLTRï¼‰**     | æœºå™¨å­¦ä¹ æ¨¡å‹                                  | æœ€ä¼˜ä½†å¤æ‚           |

#### 7.4.2 Reciprocal Rank Fusion (RRF)

RRF æ˜¯æœ€å¸¸ç”¨çš„æ— å‚æ•°èåˆæ–¹æ³•ï¼š

$$
RRF(d) = \sum_{r \in R} \frac{1}{k + r(d)}
$$

å…¶ä¸­ï¼š

- $R$ æ˜¯æ‰€æœ‰æ’åºåˆ—è¡¨
- $r(d)$ æ˜¯æ–‡æ¡£ $d$ åœ¨æ’åºåˆ—è¡¨ $r$ ä¸­çš„æ’å
- $k$ æ˜¯å¹³æ»‘å‚æ•°ï¼ˆé€šå¸¸ $k=60$ï¼‰

```python
def reciprocal_rank_fusion(rankings, k=60):
    """
    rankings: List[List[doc_id]] - å¤šä¸ªæ’åºåˆ—è¡¨
    è¿”å›: èåˆåçš„æ’åº
    """
    scores = {}
    for ranking in rankings:
        for rank, doc_id in enumerate(ranking):
            if doc_id not in scores:
                scores[doc_id] = 0
            scores[doc_id] += 1 / (k + rank + 1)  # rank ä» 0 å¼€å§‹

    # æŒ‰åˆ†æ•°é™åºæ’åˆ—
    return sorted(scores.keys(), key=lambda x: scores[x], reverse=True)
```

#### 7.4.3 Weaviate æ··åˆæœç´¢ç¤ºä¾‹

```python
# Weaviate æ··åˆæœç´¢ï¼šalpha æ§åˆ¶æƒé‡åˆ†é…
results = client.query.get("Article", ["title", "content"]).with_hybrid(
    query="æœºå™¨å­¦ä¹ æœ€æ–°è¿›å±•",
    alpha=0.5,  # 0 = çº¯ BM25ï¼Œ1 = çº¯å‘é‡
    fusion_type="rankedFusion"  # æˆ– "relativeScoreFusion"
).with_limit(10).do()
```

---

## 8. æ€§èƒ½åˆ†æä¸åŸºå‡†æµ‹è¯•

### 8.1 æ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡

è¯„ä¼°å‘é‡æ•°æ®åº“æ€§èƒ½éœ€è¦å…³æ³¨ä»¥ä¸‹å…³é”®æŒ‡æ ‡<sup>[[22]](#ref22)</sup>ï¼š

| æŒ‡æ ‡                 | å®šä¹‰                 | é‡è¦æ€§         |
| -------------------- | -------------------- | -------------- |
| **å¬å›ç‡ï¼ˆRecallï¼‰** | è¿”å›çš„çœŸæ­£è¿‘é‚»å æ¯”   | å‡†ç¡®æ€§æ ¸å¿ƒæŒ‡æ ‡ |
| **QPSï¼ˆååé‡ï¼‰**    | æ¯ç§’å¤„ç†çš„æŸ¥è¯¢æ•°     | é«˜å¹¶å‘åœºæ™¯å…³é”® |
| **å»¶è¿Ÿï¼ˆLatencyï¼‰**  | å•æ¬¡æŸ¥è¯¢å“åº”æ—¶é—´     | ç”¨æˆ·ä½“éªŒå…³é”®   |
| **å†…å­˜å ç”¨**         | ç´¢å¼•å’Œæ•°æ®çš„å†…å­˜æ¶ˆè€— | æˆæœ¬æ§åˆ¶       |
| **ç´¢å¼•æ„å»ºæ—¶é—´**     | åˆ›å»ºç´¢å¼•æ‰€éœ€æ—¶é—´     | æ•°æ®æ›´æ–°æ•ˆç‡   |

#### 8.1.1 å¬å›ç‡ä¸ QPS çš„æƒè¡¡

```mermaid
---
config:
    xyChart:
        width: 800
        height: 400
        xAxis:
            titlePadding: 10
            labelPadding: 5
        yAxis:
            titlePadding: 10
            labelPadding: 5
---
xychart-beta
    title "HNSW æ€§èƒ½è°ƒä¼˜ï¼šå¬å›ç‡ vs QPS"
    x-axis "Recall (%)" [85, 95, 99, 99.5]
    y-axis "QPS (æŸ¥è¯¢/ç§’)" 0 --> 55000
    line [50000, 20000, 5000, 1500]
```

> [!TIP] å…³é”®æƒè¡¡ç‚¹
>
> - **Recall 85%**: é£ä¸€èˆ¬çš„é€Ÿåº¦ (ef=10)
> - **Recall 95%**: æœ€ä½³æ€§ä»·æ¯” (ef=50)ï¼Œæ¨èèµ·ç‚¹
> - **Recall 99%**: ä¸ºæœ€å 4% çš„ç²¾åº¦ä»˜å‡º 4 å€æ€§èƒ½ä»£ä»· (ef=200)
> - **Recall 99.5%**: è¾¹é™…æ”¶ç›Šé€’å‡æå¿« (ef=500)
>
> **æœ€ä½³å®è·µ**ï¼šå¤§å¤šæ•°åº”ç”¨é€‰æ‹© 95% å¬å›ç‡ä½œä¸ºç›®æ ‡ï¼Œåœ¨é€Ÿåº¦å’Œå‡†ç¡®æ€§ä¹‹é—´å–å¾—å¹³è¡¡ã€‚

#### 8.1.2 å»¶è¿Ÿåˆ†å¸ƒ

ç”Ÿäº§ç¯å¢ƒåº”å…³æ³¨**å°¾å»¶è¿Ÿï¼ˆTail Latencyï¼‰**ï¼Œå³ P95/P99 å»¶è¿Ÿ<sup>[[22]](#ref22)</sup>ï¼š

| å»¶è¿ŸæŒ‡æ ‡ | å«ä¹‰               | ç›®æ ‡å€¼ï¼ˆæ¨èï¼‰ |
| -------- | ------------------ | -------------- |
| **P50**  | ä¸­ä½æ•°å»¶è¿Ÿ         | < 5ms          |
| **P95**  | 95% è¯·æ±‚çš„å»¶è¿Ÿä¸Šé™ | < 20ms         |
| **P99**  | 99% è¯·æ±‚çš„å»¶è¿Ÿä¸Šé™ | < 50ms         |
| **MAX**  | æœ€å¤§å»¶è¿Ÿ           | < 200ms        |

### 8.2 ä¸»æµå‘é‡æ•°æ®åº“åŸºå‡†å¯¹æ¯”

åŸºäºå…¬å¼€åŸºå‡†æµ‹è¯•æ•°æ®<sup>[[22]](#ref22)</sup>ï¼Œä»¥ä¸‹æ˜¯ä¸»æµå‘é‡æ•°æ®åº“çš„æ€§èƒ½å¯¹æ¯”ï¼š

#### 8.2.1 ç™¾ä¸‡çº§å‘é‡åŸºå‡†ï¼ˆSIFT-1Mï¼Œ128 ç»´ï¼‰

| æ•°æ®åº“          | å¬å›ç‡@10 | QPSï¼ˆå•èŠ‚ç‚¹ï¼‰ | P99 å»¶è¿Ÿ | å†…å­˜å ç”¨ |
| --------------- | --------- | ------------- | -------- | -------- |
| **Milvus**      | 95%       | ~15,000       | 8ms      | ~2 GB    |
| **Qdrant**      | 95%       | ~12,000       | 10ms     | ~1.8 GB  |
| **Weaviate**    | 95%       | ~8,000        | 15ms     | ~2.2 GB  |
| **Pinecone**    | 95%       | N/A (äº‘æœåŠ¡)  | 7ms      | N/A      |
| **pgvector**    | 95%       | ~3,000        | 25ms     | ~1.5 GB  |
| **VectorChord** | 95%       | ~15,000       | 8ms      | ~1.2 GB  |

#### 8.2.2 äº¿çº§å‘é‡åŸºå‡†

| æ•°æ®åº“       | æ•°æ®è§„æ¨¡ | å¬å›ç‡ | QPS    | P99 å»¶è¿Ÿ | å¤‡æ³¨         |
| ------------ | -------- | ------ | ------ | -------- | ------------ |
| **Milvus**   | 1 äº¿     | 95%    | 2,000+ | < 10ms   | åˆ†å¸ƒå¼é›†ç¾¤   |
| **DiskANN**  | 10 äº¿    | 95%    | 500+   | < 5ms    | å•æœº SSD     |
| **Pinecone** | 10 äº¿    | 95%    | N/A    | < 10ms   | Pod ç±»å‹å½±å“ |

### 8.3 ç´¢å¼•ç®—æ³•æ€§èƒ½å¯¹æ¯”

| ç´¢å¼•ç±»å‹    | æ„å»ºæ—¶é—´ | æŸ¥è¯¢æ—¶é—´ | å†…å­˜å ç”¨ | å¬å›ç‡ | é€‚ç”¨è§„æ¨¡  |
| ----------- | -------- | -------- | -------- | ------ | --------- |
| **Flat**    | æå¿«     | O(n)     | 100%     | 100%   | < 10 ä¸‡   |
| **IVFFlat** | å¿«       | O(âˆšn)    | 100%     | 95-99% | < 1000 ä¸‡ |
| **IVFPQ**   | ä¸­       | O(âˆšn)    | ~5%      | 90-98% | æ— é™åˆ¶    |
| **HNSW**    | æ…¢       | O(log n) | 150%+    | 99%+   | < 1 äº¿    |
| **DiskANN** | ææ…¢     | O(log n) | ~10%     | 95%+   | 10 äº¿+    |

---

## 9. é€‰å‹å»ºè®®ä¸åœºæ™¯åŒ–æ–¹æ¡ˆ

### 9.1 å†³ç­–æ¡†æ¶

```mermaid
flowchart TD
    START[å‘é‡æ•°æ®åº“é€‰å‹] --> Q1{æ•°æ®è§„æ¨¡ï¼Ÿ}

    Q1 --> |"< 100 ä¸‡"| SMALL[å°è§„æ¨¡]
    Q1 --> |"100 ä¸‡ - 10 äº¿"| MEDIUM[å¤§è§„æ¨¡]
    Q1 --> |"> 10 äº¿"| LARGE[æµ·é‡]

    SMALL --> Q2{å·²æœ‰ PostgreSQLï¼Ÿ}
    Q2 --> |æ˜¯| PGV[pgvector/VectorChord]
    Q2 --> |å¦| Q3{éœ€è¦æ‰˜ç®¡æœåŠ¡ï¼Ÿ}
    Q3 --> |æ˜¯| PINECONE[Pinecone Free]
    Q3 --> |å¦| EMBEDDED[Milvus Lite / Chroma]

    MEDIUM --> Q4{è¿ç»´èƒ½åŠ›ï¼Ÿ}
    Q4 --> |å¼º| SELF[Milvus / Qdrant è‡ªæ‰˜ç®¡]
    Q4 --> |å¼±| MANAGED[Zilliz Cloud / Pinecone]

    LARGE --> Q5{é¢„ç®—ï¼Ÿ}
    Q5 --> |ä¸é™| CLOUD[å…¨æ‰˜ç®¡äº‘æœåŠ¡]
    Q5 --> |æœ‰é™| DISKANN[DiskANN + è‡ªå»º]

    style PGV fill:#336791,color:#fff
    style PINECONE fill:#5048E5,color:#fff
    style SELF fill:#00A1EA,color:#fff
```

### 9.2 åœºæ™¯åŒ–æ¨è

#### 9.2.1 RAG / çŸ¥è¯†åº“é—®ç­”

| éœ€æ±‚ç»´åº¦     | æ¨èæ–¹æ¡ˆ               | åŸå›                  |
| ------------ | ---------------------- | -------------------- |
| **å¿«é€Ÿå¯åŠ¨** | Pinecone Serverless    | é›¶è¿ç»´ï¼ŒæŒ‰é‡ä»˜è´¹     |
| **æˆæœ¬æ•æ„Ÿ** | pgvector + VectorChord | å¤ç”¨ç°æœ‰ PostgreSQL  |
| **é«˜æ€§èƒ½**   | Milvus Distributed     | é«˜ QPSï¼Œä½å»¶è¿Ÿ       |
| **å¼€ç®±å³ç”¨** | Weaviate               | å†…ç½®å‘é‡åŒ–ï¼Œç®€åŒ–æµç¨‹ |

**æ¨èé…ç½®**ï¼š

- å‘é‡ç»´åº¦ï¼š1536ï¼ˆOpenAIï¼‰æˆ– 768ï¼ˆå¼€æºæ¨¡å‹ï¼‰
- ç´¢å¼•ç±»å‹ï¼šHNSW
- ç›¸ä¼¼åº¦ï¼šä½™å¼¦ç›¸ä¼¼åº¦
- åˆ†å—å¤§å°ï¼š512 tokens

#### 9.2.2 ç”µå•†/æ¨èç³»ç»Ÿ

| éœ€æ±‚ç»´åº¦     | æ¨èæ–¹æ¡ˆ     | åŸå›                   |
| ------------ | ------------ | --------------------- |
| **å®æ—¶æ¨è** | Milvus + GPU | æé«˜ QPSï¼Œæ¯«ç§’çº§å»¶è¿Ÿ  |
| **ç”¨æˆ·ç”»åƒ** | Qdrant       | å¼ºå¤§çš„è¿‡æ»¤èƒ½åŠ›        |
| **å•†å“æœç´¢** | Weaviate     | æ··åˆæœç´¢ï¼ˆå‘é‡+å±æ€§ï¼‰ |

**æ¨èé…ç½®**ï¼š

- å‘é‡ç»´åº¦ï¼š128-256ï¼ˆå•†å“ç‰¹å¾ï¼‰
- ç´¢å¼•ç±»å‹ï¼šIVFPQï¼ˆå¤§è§„æ¨¡ï¼‰æˆ– HNSWï¼ˆä¸­è§„æ¨¡ï¼‰
- ç›¸ä¼¼åº¦ï¼šç‚¹ç§¯ï¼ˆè€ƒè™‘æµè¡Œåº¦ï¼‰
- è¿‡æ»¤ç­–ç•¥ï¼šPre-filtering

#### 9.2.3 å›¾åƒ/å¤šæ¨¡æ€æœç´¢

| éœ€æ±‚ç»´åº¦     | æ¨èæ–¹æ¡ˆ             | åŸå›            |
| ------------ | -------------------- | -------------- |
| **é€šç”¨å›¾æœ** | Milvus + CLIP        | åŸç”Ÿå¤šå‘é‡æ”¯æŒ |
| **äººè„¸è¯†åˆ«** | Milvus + GPU         | é«˜ç²¾åº¦è¦æ±‚     |
| **å•†å“å›¾æœ** | Weaviate + multi2vec | ä¸€ç«™å¼å¤šæ¨¡æ€   |

**æ¨èé…ç½®**ï¼š

- å‘é‡ç»´åº¦ï¼š512-768ï¼ˆCLIP/ViTï¼‰
- ç´¢å¼•ç±»å‹ï¼šHNSWï¼ˆé«˜å¬å›ï¼‰
- ç›¸ä¼¼åº¦ï¼šä½™å¼¦ç›¸ä¼¼åº¦
- å½’ä¸€åŒ–ï¼šæ˜¯

### 9.3 æˆæœ¬ä¼°ç®—å‚è€ƒ

| æ•°æ®è§„æ¨¡    | æ–¹æ¡ˆé€‰æ‹©            | æœˆæˆæœ¬ä¼°ç®—ï¼ˆUSDï¼‰ |
| ----------- | ------------------- | ----------------- |
| 10 ä¸‡å‘é‡   | Pinecone Starter    | $0ï¼ˆå…è´¹ï¼‰        |
| 100 ä¸‡å‘é‡  | pgvectorï¼ˆè‡ªæ‰˜ç®¡ï¼‰  | $50-100           |
| 1000 ä¸‡å‘é‡ | Milvusï¼ˆè‡ªæ‰˜ç®¡ï¼‰    | $200-500          |
| 1 äº¿å‘é‡    | Zilliz Cloud        | $1,000-3,000      |
| 10 äº¿å‘é‡   | Pinecone Enterprise | $10,000+          |

### 9.4 æŠ€æœ¯æ ˆåŒ¹é…

| æŠ€æœ¯æ ˆ         | æ¨èå‘é‡æ•°æ®åº“           | é›†æˆéš¾åº¦ |
| -------------- | ------------------------ | -------- |
| **Python**     | Milvus, Qdrant, Weaviate | ä½       |
| **Node.js**    | Pinecone, Weaviate       | ä½       |
| **PostgreSQL** | pgvector, VectorChord    | æä½     |
| **Kubernetes** | Milvus, Qdrant, Weaviate | ä¸­       |
| **Serverless** | Pinecone, Zilliz Cloud   | ä½       |

---

## 10. Demo å®æ–½æŒ‡å¼•

æœ¬ç« æä¾›ä¸‰ç§å¸¸è§åœºæ™¯çš„å®æ–½æŒ‡å¼•ã€‚

### 10.1 PostgreSQL + pgvector å¿«é€Ÿå…¥é—¨

#### 10.1.1 ç¯å¢ƒå‡†å¤‡

```bash
# ä½¿ç”¨ Docker å¿«é€Ÿå¯åŠ¨
docker run -d \
  --name pgvector \
  -e POSTGRES_PASSWORD=postgres \
  -p 5432:5432 \
  ankane/pgvector
```

#### 10.1.2 åˆ›å»ºå‘é‡è¡¨

```sql
-- å¯ç”¨æ‰©å±•
CREATE EXTENSION IF NOT EXISTS vector;

-- åˆ›å»ºæ–‡æ¡£è¡¨
CREATE TABLE documents (
    id SERIAL PRIMARY KEY,
    title TEXT NOT NULL,
    content TEXT,
    embedding vector(1536),  -- OpenAI embedding ç»´åº¦
    created_at TIMESTAMP DEFAULT NOW()
);

-- åˆ›å»º HNSW ç´¢å¼•
CREATE INDEX ON documents
USING hnsw (embedding vector_cosine_ops)
WITH (m = 16, ef_construction = 64);
```

#### 10.1.3 Python é›†æˆç¤ºä¾‹

```python
import psycopg2
from openai import OpenAI

# åˆå§‹åŒ–
client = OpenAI()
conn = psycopg2.connect("postgresql://postgres:postgres@localhost:5432/postgres")

def get_embedding(text):
    """è·å–æ–‡æœ¬çš„åµŒå…¥å‘é‡"""
    response = client.embeddings.create(
        model="text-embedding-3-small",
        input=text
    )
    return response.data[0].embedding

def insert_document(title, content):
    """æ’å…¥æ–‡æ¡£å¹¶ç”Ÿæˆå‘é‡"""
    embedding = get_embedding(content)
    with conn.cursor() as cur:
        cur.execute(
            "INSERT INTO documents (title, content, embedding) VALUES (%s, %s, %s)",
            (title, content, embedding)
        )
    conn.commit()

def search_documents(query, top_k=5):
    """è¯­ä¹‰æœç´¢"""
    query_embedding = get_embedding(query)
    with conn.cursor() as cur:
        cur.execute("""
            SELECT id, title, 1 - (embedding <=> %s::vector) AS similarity
            FROM documents
            ORDER BY embedding <=> %s::vector
            LIMIT %s
        """, (query_embedding, query_embedding, top_k))
        return cur.fetchall()

# ä½¿ç”¨ç¤ºä¾‹
insert_document("AI ä»‹ç»", "äººå·¥æ™ºèƒ½æ˜¯è®¡ç®—æœºç§‘å­¦çš„ä¸€ä¸ªåˆ†æ”¯...")
results = search_documents("ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ")
print(results)
```

### 10.2 Milvus åˆ†å¸ƒå¼éƒ¨ç½²

#### 10.2.1 Docker Compose éƒ¨ç½²

```yaml
# docker-compose.yml
version: "3.5"

services:
  etcd:
    image: quay.io/coreos/etcd:v3.5.5
    environment:
      - ETCD_AUTO_COMPACTION_MODE=revision
      - ETCD_AUTO_COMPACTION_RETENTION=1000
      - ETCD_QUOTA_BACKEND_BYTES=4294967296
    volumes:
      - etcd_data:/etcd

  minio:
    image: minio/minio:RELEASE.2023-03-20T20-16-18Z
    environment:
      MINIO_ACCESS_KEY: minioadmin
      MINIO_SECRET_KEY: minioadmin
    volumes:
      - minio_data:/minio_data
    command: minio server /minio_data

  milvus:
    image: milvusdb/milvus:v2.3.3
    command: ["milvus", "run", "standalone"]
    environment:
      ETCD_ENDPOINTS: etcd:2379
      MINIO_ADDRESS: minio:9000
    volumes:
      - milvus_data:/var/lib/milvus
    ports:
      - "19530:19530"
      - "9091:9091"
    depends_on:
      - etcd
      - minio

volumes:
  etcd_data:
  minio_data:
  milvus_data:
```

#### 10.2.2 Python å®¢æˆ·ç«¯ç¤ºä¾‹

```python
from pymilvus import MilvusClient, DataType

# è¿æ¥ Milvus
client = MilvusClient(uri="http://localhost:19530")

# åˆ›å»º Collection
schema = client.create_schema(auto_id=True, enable_dynamic_field=True)
schema.add_field("id", DataType.INT64, is_primary=True)
schema.add_field("embedding", DataType.FLOAT_VECTOR, dim=1536)
schema.add_field("title", DataType.VARCHAR, max_length=512)

index_params = client.prepare_index_params()
index_params.add_index(
    field_name="embedding",
    index_type="HNSW",
    metric_type="COSINE",
    params={"M": 16, "efConstruction": 256}
)

client.create_collection(
    collection_name="documents",
    schema=schema,
    index_params=index_params
)

# æ’å…¥æ•°æ®
data = [
    {"embedding": [0.1] * 1536, "title": "æ–‡æ¡£1"},
    {"embedding": [0.2] * 1536, "title": "æ–‡æ¡£2"},
]
client.insert(collection_name="documents", data=data)

# æœç´¢
results = client.search(
    collection_name="documents",
    data=[[0.15] * 1536],
    limit=5,
    output_fields=["title"]
)
print(results)
```

### 10.3 Faiss æœ¬åœ°ç´¢å¼•

#### 10.3.1 å®‰è£…

```bash
pip install faiss-cpu  # CPU ç‰ˆæœ¬
# æˆ–
pip install faiss-gpu  # GPU ç‰ˆæœ¬ï¼ˆéœ€è¦ CUDAï¼‰
```

#### 10.3.2 å®Œæ•´ç¤ºä¾‹

```python
import numpy as np
import faiss

# 1. å‡†å¤‡æ•°æ®
d = 128                        # å‘é‡ç»´åº¦
nb = 100000                    # æ•°æ®åº“å‘é‡æ•°
nq = 10                        # æŸ¥è¯¢å‘é‡æ•°

np.random.seed(42)
xb = np.random.random((nb, d)).astype('float32')  # æ•°æ®åº“å‘é‡
xq = np.random.random((nq, d)).astype('float32')  # æŸ¥è¯¢å‘é‡

# 2. åˆ›å»ºç´¢å¼•
# æ–¹æ¡ˆ A: Flat ç´¢å¼•ï¼ˆç²¾ç¡®æœç´¢ï¼‰
index_flat = faiss.IndexFlatL2(d)

# æ–¹æ¡ˆ B: IVF ç´¢å¼•ï¼ˆè¿‘ä¼¼æœç´¢ï¼‰
nlist = 100  # èšç±»æ•°é‡
quantizer = faiss.IndexFlatL2(d)
index_ivf = faiss.IndexIVFFlat(quantizer, d, nlist)
index_ivf.train(xb)  # éœ€è¦è®­ç»ƒ

# æ–¹æ¡ˆ C: HNSW ç´¢å¼•
index_hnsw = faiss.IndexHNSWFlat(d, 32)  # M=32

# 3. æ·»åŠ å‘é‡
index_flat.add(xb)
index_ivf.add(xb)
index_hnsw.add(xb)

# 4. æœç´¢
k = 5  # è¿”å› Top-K

# Flat æœç´¢
D_flat, I_flat = index_flat.search(xq, k)

# IVF æœç´¢ï¼ˆè®¾ç½®æ¢æµ‹æ•°é‡ï¼‰
index_ivf.nprobe = 10
D_ivf, I_ivf = index_ivf.search(xq, k)

# HNSW æœç´¢
D_hnsw, I_hnsw = index_hnsw.search(xq, k)

# 5. æ¯”è¾ƒç»“æœ
print(f"Flat å¬å›: {I_flat}")
print(f"IVF  å¬å›: {I_ivf}")
print(f"HNSW å¬å›: {I_hnsw}")

# 6. ä¿å­˜å’ŒåŠ è½½ç´¢å¼•
faiss.write_index(index_hnsw, "hnsw.index")
loaded_index = faiss.read_index("hnsw.index")
```

### 10.4 æ€§èƒ½è°ƒä¼˜æ£€æŸ¥æ¸…å•

| é˜¶æ®µ     | æ£€æŸ¥é¡¹               | ä¼˜åŒ–å»ºè®®                            |
| -------- | -------------------- | ----------------------------------- |
| **æ•°æ®** | å‘é‡ç»´åº¦             | ä¼˜å…ˆé€‰æ‹©è¾ƒä½ç»´åº¦æ¨¡å‹ï¼ˆ768 vs 1536ï¼‰ |
| **æ•°æ®** | å‘é‡å½’ä¸€åŒ–           | ä½¿ç”¨ä½™å¼¦/ç‚¹ç§¯æ—¶å¿…é¡»å½’ä¸€åŒ–           |
| **ç´¢å¼•** | ç´¢å¼•ç±»å‹é€‰æ‹©         | æ•°æ®é‡ < 100 ä¸‡ç”¨ HNSWï¼Œå¦åˆ™ IVFPQ  |
| **ç´¢å¼•** | HNSW M å‚æ•°          | 16-32 ä¸ºå¹³è¡¡å€¼ï¼Œé«˜å¬å›éœ€æ±‚ç”¨ 48+    |
| **ç´¢å¼•** | HNSW ef_construction | 100-200ï¼Œè¿½æ±‚è´¨é‡å¯ç”¨ 400           |
| **æŸ¥è¯¢** | ef_search / nprobe   | é€æ­¥è°ƒå¤§ç›´åˆ°å¬å›ç‡æ»¡è¶³éœ€æ±‚          |
| **æŸ¥è¯¢** | æ‰¹é‡ vs å•æ¡         | å°½é‡æ‰¹é‡æŸ¥è¯¢ä»¥æé«˜åå              |
| **ç¡¬ä»¶** | å†…å­˜                 | ç¡®ä¿ç´¢å¼•å®Œå…¨åŠ è½½åˆ°å†…å­˜              |
| **ç¡¬ä»¶** | SSD vs HDD           | ä½¿ç”¨ DiskANN æ—¶å¿…é¡»ç”¨ SSD           |

---

## References

<a id="ref1"></a>[1] T. Brown et al., "Language models are few-shot learners," in _Adv. Neural Inf. Process. Syst._, vol. 33, pp. 1877â€“1901, 2020.

<a id="ref2"></a>[2] P. Lewis et al., "Retrieval-augmented generation for knowledge-intensive NLP tasks," in _Adv. Neural Inf. Process. Syst._, vol. 33, pp. 9459â€“9474, 2020.

<a id="ref3"></a>[3] Amazon AWS, "What is retrieval augmented generation (RAG)?" _AWS Documentation_, 2024. [Online]. Available: https://aws.amazon.com/what-is/retrieval-augmented-generation/

<a id="ref4"></a>[4] T. Mikolov et al., "Efficient estimation of word representations in vector space," _arXiv preprint arXiv:1301.3781_, 2013.

<a id="ref5"></a>[5] N. Reimers and I. Gurevych, "Sentence-BERT: Sentence embeddings using siamese BERT-networks," in _Proc. Conf. Empirical Methods Nat. Lang. Process._, pp. 3982â€“3992, 2019.

<a id="ref6"></a>[6] V. Karpukhin et al., "Dense passage retrieval for open-domain question answering," in _Proc. Conf. Empirical Methods Nat. Lang. Process._, pp. 6769â€“6781, 2020.

<a id="ref7"></a>[7] Writer, "What is a vector database?" _Writer AI Glossary_, 2024. [Online]. Available: https://www.ai21.com/glossary/foundational-llm/vector-database/

<a id="ref8"></a>[8] Milvus Documentation, "Vector index overview," 2024. [Online]. Available: https://milvus.io/docs/index.md

<a id="ref9"></a>[9] S. Lloyd, "Least squares quantization in PCM," _IEEE Trans. Inf. Theory_, vol. 28, no. 2, pp. 129â€“137, Mar. 1982.

<a id="ref10"></a>[10] P. Indyk and R. Motwani, "Approximate nearest neighbors: Towards removing the curse of dimensionality," in _Proc. 30th Annu. ACM Symp. Theory Comput._, pp. 604â€“613, 1998.

<a id="ref11"></a>[11] J. Kleinberg, "Navigation in a small world," _Nature_, vol. 406, no. 6798, p. 845, Aug. 2000.

<a id="ref12"></a>[12] Y. A. Malkov and D. A. Yashunin, "Efficient and robust approximate nearest neighbor search using hierarchical navigable small world graphs," _IEEE Trans. Pattern Anal. Mach. Intell._, vol. 42, no. 4, pp. 824â€“836, Apr. 2020.

<a id="ref13"></a>[13] H. JÃ©gou, M. Douze, and C. Schmid, "Product quantization for nearest neighbor search," _IEEE Trans. Pattern Anal. Mach. Intell._, vol. 33, no. 1, pp. 117â€“128, Jan. 2011.

<a id="ref14"></a>[14] Zilliz, "Understanding IVF index," 2024. [Online]. Available: https://zilliz.com/learn/ivf-index-explained

<a id="ref15"></a>[15] TensorChord, "RaBitQ: Randomized binary quantization," 2024. [Online]. Available: https://www.tensorchord.ai/blog/rabitq

<a id="ref16"></a>[16] S. J. Subramanya et al., "DiskANN: Fast accurate billion-point nearest neighbor search on a single node," in _Adv. Neural Inf. Process. Syst._, vol. 32, 2019.

<a id="ref17"></a>[17] R. Guo et al., "Accelerating large-scale inference with anisotropic vector quantization," in _Proc. Int. Conf. Mach. Learn._, vol. 119, pp. 3747â€“3756, 2020.

<a id="ref18"></a>[18] NVIDIA, "CAGRA: GPU-accelerated graph index for vector search," _NVIDIA RAFT Documentation_, 2024. [Online]. Available: https://docs.nvidia.com/deeplearning/raft/

<a id="ref19"></a>[19] Pinecone, "Vector similarity explained," 2024. [Online]. Available: https://www.pinecone.io/learn/vector-similarity/

<a id="ref20"></a>[20] Weaviate, "Hybrid search explained," 2024. [Online]. Available: https://weaviate.io/developers/weaviate/search/hybrid

<a id="ref21"></a>[21] Qdrant, "Filtered vector search," 2024. [Online]. Available: https://qdrant.tech/articles/filtered-vector-search/

<a id="ref22"></a>[22] ANN-Benchmarks, "Benchmarking nearest neighbor algorithms," 2024. [Online]. Available: https://ann-benchmarks.com/

<a id="ref23"></a>[23] E. Bernhardsson, "Annoy: Approximate nearest neighbors in C++/Python," _GitHub Repository_, 2015. [Online]. Available: https://github.com/spotify/annoy

<a id="ref24"></a>[24] J. Johnson et al., "Billion-scale similarity search with GPUs," _IEEE Trans. Big Data_, vol. 5, no. 1, pp. 107â€“118, Mar. 2019.

<a id="ref25"></a>[25] R. W. Hamming, "Error detecting and error correcting codes," _Bell Syst. Tech. J._, vol. 29, no. 2, pp. 147â€“160, Apr. 1950.

<a id="ref26"></a>[26] P. Jaccard, "Ã‰tude comparative de la distribution florale dans une portion des Alpes et du Jura," _Bull. Soc. Vaudoise Sci. Nat._, vol. 37, pp. 547â€“579, 1901.

<a id="ref27"></a>[27] Milvus Documentation, "Filtered vector search," 2024. [Online]. Available: https://milvus.io/docs/filtered_search.md

<a id="ref28"></a>[28] VectorDBBench, "Vector database benchmarking tool," _GitHub Repository_, 2024. [Online]. Available: https://github.com/zilliztech/VectorDBBench

<a id="ref29"></a>[29] OpenAI, "Embeddings guide," _OpenAI Documentation_, 2024. [Online]. Available: https://platform.openai.com/docs/guides/embeddings

<a id="ref30"></a>[30] T. Ge et al., "Optimized product quantization," _IEEE Trans. Pattern Anal. Mach. Intell._, vol. 36, no. 4, pp. 744â€“755, Apr. 2014.
